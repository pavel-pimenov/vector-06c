;; программа работы с диском ╡╤╝╠╠╝╠╧╧╡
;;ШШШШШШШШШШШШШШШШШШШШШШШШШШШШШШШШШШШШШШШШШШШШШШШШШШШШШШШШШШШШШШШШШШШШ
INT		MACRO	A		; Макроподстановка организации
		MVI	C,A		; системных вызовов в операц╝
		CALL	SYS_MDOS	; системе CP/M (МикроДос╘
		ENDM			;
;;ШШШШШШШШШШШШШШШШШШШШШШШШШШШШШШШШШШШШШШШШШШШШШШШШШШШШШШШШШШШШШШШШШШШШ
BH_MOV		MACRO			; мкроподстановка копирования
		MOV	B,H		; регистровой пары╨ HL
		MOV	C,L		; в регистр╝ пару ╨ BC
		ENDM			;
;;ШШШШШШШШШШШШШШШШШШШШШШШШШШШШШШШШШШШШШШШШШШШШШШШШШШШШШШШШШШШШШШШШШШШШ

SYS_MDOS	EQU 5	; system point CP/M
SECSIZ		EQU 80H	; Длинна записи в CP/M
CR		EQU 09H ; Конец строки
LF		EQU 0AH	; Перевод строки

DR_OFSET	EQU 0	; Смещение номера накопителя в блоке FCB
NM_OFSET	EQU 1	; Смещение имени файла в блоке FCB
ET_OFSET	EQU 9	; Смещение расширения в блоке FCB
EX_OFSET	EQU 12	; Смещение номера текущего экстента
RC_OFSET	EQU 15	; Смещение числа записей данного экстента
CR_OFSET	EQU 32	; Смещение номера текущей записи

_CONIN		EQU 1	; чтение символа с консоли
_CONOUT		EQU 2	; запись символа в поток консоли
_LSTOUT		EQU 5	; вывод символа на печать
_DCONIO		EQU 6	; обмен с консолью
_PSTRING	EQU 9	; запись последовательности
			╩ в поток консоли  (terminated by '$')
_GETLIN		EQU 10	; прием в буфер консоли
_CSTAT		EQU 11	; получить статус консоли
_SELECT		EQU 14	; выбор диска
_OPENC		EQU 15	; открытие файла
_CLOSEC		EQU 16	; закрытие файла
_SEARCH_1	EQU 17	; поиск первого входа
_SEARCH_N	EQU 18	; поиск следующего входа
_DELC		EQU 19	; удаление файла
_READS		EQU 20	; читать текущюю запись в DMA
_WRITS		EQU 21	; записать ╜╜╜╞╞╜╜╜╜╞╞╞╜╜╜╜
_GREATS		EQU 22	; создать файл на диске
_RENC		EQU 23	; переименовать файл
_SDMA		EQU 26	; установить DMA
_GSUSER		EQU 32	; получение╞установка кода пользов╝
_READR		EQU 33	; произвольное чтение
_WRITR		EQU 34	; произвольная запись
_SFSIZC		EQU 35	; определение размера файла
_SRRECC		EQU 36	; установка указателя для произвольного
			╩ обмена с фаилом

FREE_TOP	EQU	40H		;

START:		LXI	D,FILE		; Указатель на исходное
		INT	_OPENC		; имя файла ╗с указ╝ номера диска╘
		LXI	D,500H		; организуем буфер DMA
		INT	_SDMA		;
		LXI	D,23	
		INT	44	

		LXI	D,FILE		; производим последовательное
		INT	_READS		; чтение файла в память
		LXI	D,FILE		;
		INT	_CLOSEC		;
		LXI	D,ST_SOOB1	;
		INT	_PSTRING	;
		RET			;

ST_SOOB2:	DB	'No free for file',CR,LF,'$'
ST_SOOB1:	DB	'Process complete !!!',CR,LF,'$'

FILE:		DB	1,'ED      ASM'	;
		DB	0,0,0,0,0,0,0,0	;
		DB	0,0,0,0,0,0,0,0	;
		DB	0,0,0,0		;
		END			;
