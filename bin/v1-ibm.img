ееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееее OS      COM   Ђ       	  OS      COM  
                DIR     COM                   DDR     ASM   3             L80     COM   H            M80     COM   Ђ         M80     COM    !              MAR     COM   d" # $ % & ' (    PIP     COM   @) * + ,          SID     COM   @- . / 0          DE      COM   P1 2 : ; <        DD      COM   3                DDR     PPA                   DE      ASM   {  4 5 6 7 8 9  KD      ASM   B= > ? @ A        START   ASM   !B C            SK      ASM   D                MADD    ASM   ЂL M N O P Q R S  MADD    ASM  ЂT U V W X Y Z [  MADD    ASM  Ђ\ ] ^ _ ` a b c  MADD    ASM  Ђd e f g h i j k  MADD    ASM  Ђl m n o p q r s  MADD    ASM  Ђt u v w x y z {  MADD    ASM  Ђ| } ~  Ђ Ѓ ‚ ѓ  MADD    ASM  !„ … †            KEY     ASM   Ђ‡ € ‰ Љ ‹ Њ Ќ Ћ  RD      ASM   IЏ ђ ‘ ’ “        P       ASM   ”                DE      DOC   E                SERV    ASM   tI J K ™ љ › њ ·  INSTAL  ASM   ќ                RED     ASM   Ђћ џ   Ў ў Ј ¤ Ґ  RED     ASM  Ђ¦ § Ё © Є « ¬ ! WD      ASM   Ђ­ ® Ї ° ± І і ґ  WD      ASM  µ                ED      ASM   ЂF G H • – —  ¶  KEY     ASM  pё є » ј Ѕ А Б    ED      ASM  Ђ№ ѕ ї В Г Д Е Ж  ED      ASM  ЂЗ И Й К Л М Н О  ED      ASM  ЂП Р С Т У Ф Х Ц  ED      ASM  ЂЧ Ш Щ Ъ Ы Ь Э Ю  ED      ASM  ЂЯ а б в г д е ж  ED      ASM  Ђз и й к л м н о  ED      ASM  !п р с            ED      COM   eт у ф х ц ч ш    EXT     PPA   щ ъ              I             ы                IM            ь                IP            э                IR            ю                IY            я                MACRO   PPA                   MAIN    PPA   5         PDDA    C     0           PDDA    COM   -	
           PPA     ASM   t PPAWD   ASM   P       TP      COM   '           VG      EQU                Z             !            RED     ASM  Ђ"#$%&'() RED     ASM  Ђ*+,-./01 RED     ASM  Ђ23456789 RED     ASM  Ђ:;<=>?@A RED     ASM  pBCDEFGH  еRED     ASM  jIJKL\]^   RE      ASM   xMNOPQRST B2      TEL   nUVWXYZ[  еRED8    ASM  Ђ`abcdefgеRED8    ASM  ЂhijklmnoеRED8    ASM  ЂpqrstuvwеRED8    ASM  Ђxyz{|}~ЂеRED8    ASM  CЃ‚ѓ„…      еRED8    $$$                    SINT    ASM                 еRED     $$$                   ееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееГ*DM: ђW ХЕХ! x±К"~#ГСБеb%x±КE{жВ8г~#гo}oТA„Г'бЙН Б! ~=ђW Х! x±Кe~#ГXСБеbx±К‡{жВzг~#гo}oТѓ„ГiС. й                                                                                                                                     у1 !  ' уНЏН ше>А  w#p#В,<В*б 	>Ђ w#w#ВCН	шEН	ш!  4 ЫНЏ! Ш" >ч2  ‡0 ! НЏЫж@МЫ>ЃУГ>#У* й+}ґВЏЙ                                                                                                      !Ђ I6 #x±В1v#Н $>2!Ї2 >Ню! |жьНѓ’Н	>Г2 ! "  ЕН$}ґБКgЕ
 	~#fo 	^#VБyНЧs#rГAyНЧяяs#rН »Н <КMё2Н >я2Ђ ГMK MicroDOS  Vers. 3.1
    25.11.92$
ѓ» INITIAL SUB                                                         Г0Г1Г€Г1Г…ГrГ№Г°Г'ГГ)Г.Г“Г?Г:ГxГ3НA:#<ВB>>Нц:` ·Дѓ:Z ЖAНц>>Нц!!"[ Н	!!~·ИG#~ю;Ию:Вy:- <ИИ#~ю-В†И>я2Ѓ #"!+#~Н!wВЉ#6 !”!Н4ВG!•!~ю ВЅ+~·К№=НF:Z 2 Н™Й:#·К:”!·В!–!~ю Вь+~Н)ЪехНHсWГ$N!eНя!lТьхеН™бсГСН*:™!ю В:ѕ ·К*!л”!*є НКГGюaШю{Рж_Й:#<АбНGЙеЇН4бГ›:!хН+с<ЙНA*!~Н$К_·К_Нц#ГM>?НцЙABDEKOUЮz;Ђb!”!Н4!•!~ю В’6?#В‹ Х!”!"[ лН·:!<СКZХ:х OС{ХжВАЕНAН.БГЖН)Н6xН жНцxюТею	ВИ>.НцГИН)>	Н жЂ>RВц> Нц>
Н жЂ>SВ> НцН7·ВНн:!<ВЁН+СЙ*X ЃН~Й> Гц:Z ЖAНц>:Гц!”!Н4юВL>НdА!”!"[ Ну:!<А>
НюГ+!”!Н2!•!НЪG|·ВG}юТG2` Й!”!Н2!”!"[ Нв!•!~ю К«НлЪGНФs#rНьГ+!– ЇхеНAб^#V{ІКТсхН1Н)еН†б#с<ГЇсЙ:Z ‡!– Г:#юА!”!Н4:•!ю ВшНГЄНтВG  BKНЙйЇ2Ђ Й>я2Ђ ЙН*!ќ!~ю ВG6C#6O#6MНШюКGюВсНHНAЇ2#1У#!  еГ !\ Н4!l Н4!!Ї2| ~·Кiю Кi#Г[ Ѓ ~·КЌO:Ѓ <yК‡ю<КЌю>КЌ#ГnЇ!Ђ p"X Н‡:Ѓ <И*!лН#Ию>КЗю<Вўл"!!I"Н4ВGНУКGГ™ю>ВОл"!х!н"Н4ВGсКйНКGГ™НпГгЇЙчГ>>  ??!$ ~·И№К#Гx7Йл!  ю ИН)Ш)DM))	НГЦ0Шю
?Йл"[ лy2_ юЪ‘:f =К‘!ѓНяТ‘!  9"Ѕ#1Й#!eеНН«:f х2ј#Н‰·Вz:_ ю!Ф Н&с=ВeogЙ!"( :_ O*[ л{2ж !  "!9"!1ј#Ї2!2] !Xе:ж _yKю!&КСюЂТЬюqРюl!tТСю3Р!Ю_ ^#V*[ лй1…њ°№rЙыЏ
		‰
ђ
C¬T·дуЊгЧя06NT]duЃЈЌАЏ
Џ
бЬЏ
Џ
DRт~Џ
WѓЎЁЏ
Џ
ёЗНЫЫЯН+*!щ*!}DЙеН:_ ю!Ф·С*Ѕ#щл}DЙБ<И:f ђgЙ*[ ~Тkж#^#Vл"[ M!§юpЪСЮp!іГСЏЛ­Л _[Р†їЕ!!Г`!ј#Г`!I" НЪ!I""[ НRлН¬Н=2j"И>я2j"2 :` 2k"> *[   wЙЇ2j"Йл>я2#"#<2#Й!н""[ НRлНЧН=2#И!m"Н?Ї2 Нх=2#:` 2#ЙЂ ГI s#x±ВIЙ~·А:Z <wЙ{ГаKBН	НgИГЩ_ #N#F! л!ЃелPй"!ЙНГЊ
yН$Тњх^Н<
сц@Oyю	В<
 Н<
:7 жВўЙ*B НЇГЊ
*D  )Ъ$ИГїy<КЬ<Кс<В…Н1ГЊ
Н7·И!!~6 ·ВЊ
Н1ГЊ
Н7·ВЬГЊ
*B ГЏKB!S 
ѕИЕOНњБГ	*[ :7 2
!N#е ЕеН–
бБюК8
ю
К8
юК<	юВK	x·К!	:7 2	!ГЌ	юВ\	ЕеНAЇ2
!Г#	юВm	Ее!T >–wГ#	юВ|	бНs
Т	Гs	юВ€	Нщ
бГ	юВї	ЕНщ
БбеЕx·КЈ	#~НцГ•	е:	!·К#	!7 –2	!Нм
!	!5ВІ	Г#	юВЬ	_x·{ВЬ	FXК!	#~ХНцСГО	юВ"
К!	~ю ЪA	Вш	Нs
Т!	Гб	НКA	К!	~НК!	юК
юК
ю Ъ!	Нs
Т!	Гю	#wНц~юxВ4
юК  №Ъ!	бp:	!·ВV
ЕН7БЕН…БЕ:T ·ДrБy!7 юИ4ю Р5~·ИyюВm
5Йю
А6 Й+Ее:
!!7 ѕТ†
5Нм
7бБЙН72!Й:! ГЊ
Н~К¤
!!~6 ·АН	юА!#~·В¤
6я:
!х:7 х*[ е!  9"#1v#Н3НA>>НцЇ2#*#щб"[ с27 с2
!Г¤
Нф
 Н…Г…#Н<
НA:7 !
!ѕР Н<
Г>ГЊ
Н–
Н$ШхOНњсЙН1Ию	ИюИю ЙюИю
Й:!·В‹НЊжИН¬юВ€Н¬юК  юКoюВq:#<Мµ:j"<Вo2j"ЇЙюВЂ!T >–wГoН…ГL2!>ЙЇ2 ~юЂЪ¦еЕН»Бб:!·АЇw4#^#VлН: <К№Ї~ЙqЙ#N#FЕ#^#V*X еН“Ї2!Х!Њ Нcб"[ л: <К:` х:k"2` НЊс2` бгН+!Њ НiБГ“:` х:#2` Нгс2` бгН?Гх>яГЏ:_ ю.К2юЪ2>я2!>НьKН:!НаН]LН:фНѓН]PН:хНѓНA:#<КН
:н·>я2нК  Г¦>я2!>НьГ’>Нь:!2Z :#<В1ГН
>я2!>Нь:Z O! Н±НГНbВ  НAЙ:!·ВР*Й :х НГУ*[ #НнКв#ГЪ~ю И>.Нц~ю ИжНц#ВнЙхНAЇНюН.:!<МЅсНюНA:#<ИюИTН:_ НѓН]XН*!~#foНЫ>HНцН<

Г<
ST= $S= $O= $PC= $>	Гц>Ню!!6Н	!!6#~юА#~жЯюYИюДЙ _Х…!С^#V#г0}“o|љgЪ Г“x·т·хyю0КѕНцсжGГКyНцГКсжюВКGГ·гВЊСЙ'иd 
  |На}хжНнсжЖ0ю:ЪцЖеЕХOН‹СБбЙ:Z OН|µИ^#V#"Г ##"Е ##"З ##л"а !Й НЪ*Л л!С НЪ*Ц |!й 6я·КE6 >я·ЙН'Ї*Е w#w*З w#wЙН?ГcН:·2!И:!·К =2!Й*a Н—"с "ч !с N#F*З ^#V*Е ~#foy“xљТ«е*С {•_zњWб+Г•е*С ЪАy•xњЪАлб#Г«бЕХелНФ~#foDMН)С*Е s#rС*З s#rБy“OxљG*а }ґК.лН3MDГ.!У N:п ·ВG>–O:о К·ГЂЙ*[  	:й ·К-n& Й	^#VлЙНъO Н"с Й*с }ґЙ:У *с )=ВL"у :Ф O:п Ўµo"с Й*[  Й*[ л!! Й*[  л! ЙНs~2п л~2н Нb:Х ¦2о ЙИ|·g}oГ*Й ЇЂ†#ВЄЙИ)ЏГІЕ:Z O! Н±БyµoxґgЙ*ї :Z OН—}жЙН	
 ~Ъz+~РеНњб~жwЙНМИ:Z O! Н±НГНRЙ*Й :х …oР$Й*[  ~ЙН6 Й*a л*Г {–#zћЙН#Шr+sЙ{•ozњgЙя*ч л*Ь Н9РЕН¤*Н л*ч БКhѕИН#РН6ЙwЙЇ2нН@НЌН`>я2нГ‡НЌНZ!X Гђ!Й N#Fi`"цЙ!a ~#ѕА<Й*Ш л*a #"a Н9Тє!яя"a Й:a ж2х ·АЕНtНЃБГByж<_WyжOx‡‡‡‡‡±OxжG*П 	~ВуЙХНТжюБ±ВwЙН	 ЕСИХ:й ·К%ЕеN Г+ЕN#Fеy°К:*Ц }‘|Фщб#БГ*Ц Н—#ЙЕх:Х /Gy Oс ‘жБЙ>я2д !и q*[ "c НіНI НўН™КЩ*c люеКЏХН#СТЩН	:и O y·КИю?КБxюКБюКё–жВrГБЕNНJБВr#Г:a ж2!!д ~РЇwЙНі>яGГЊ
НфН]Н™ИНЪН	6е ННjНrГлPYy°КХЕНТТ3БС*Ц {•zњТ;ЕХBKНТТ3СБГ<НбСЙy°В!  Й  Х *[ 	лН	БНЪНtГjНф*[ е~ "[ wН]б"[ Н™>я2д АН]Н™ИНЪНHНrГ„Н]Н™ИНFНrГќННвН[Н™МцИНb~хеН	л*[  ХНЪН…С! N! FбсwyѕxКн> Ън>Ђ*[  wЙ:` ·К*[ ~жаwН3А:Z ·И2л ЇНFН3х:л НFсКЬ:к жац2к :л 2м ЙН[Н™ИН	>
Н~жЂЙ~#¶+Аw#w+ЙНвЇ2!2a 2ц НМАНжЂАН[Н™И Н		л*[ 	:й ·К›~·ВЋw·В”~ѕВТГ°НFлНFлѕВТ#ѕВТ#ВЂмя	л	ѕЪКw 	л	~>я2в ГW!!5ЙННвН]Н™>яВЊ
Нф*[ е!м"[ Н]Н™б"[ Ил! Їw#В! wН0НDГ…Ї2в НWН™И*[  	~<жwКIG:Х  !в ¦КTГr 	4~жК‚Н]Н™Вr:г <К|НкН™К‚ГuНјНЂЇГЊ
НцВrННцЂwЙНв>2е >я2г НЂ:п !н ѕЪ№юЂВН Ї2п :!·ВН3Н@КНFН‚НZНs:е юВЧЇO:п Ѓwл:н wЙНв>2е > 2г Нф*[ НЭНЂ:п юЂТН3Н@ ВVНъ2з   ·К#OНDMН}ґВ0>ГЊ
"с л*[  	:й ·:з КLНsГTO 		s#r:!·АЕНF:е ==ВЈБЕy==ВЈе*Й Ww#тtНЌ*у "с ЕН‚БН`*с  :Ф GҐё#В‚б"с Н‡Н‚БЕН`Б:п !н ѕЪєw4ВЗхНжwсюВи:е юВиНЛН !!~·Вж=2п 6 ГЛЇ2е ЕНj~жх~#~жO~жGс#n,-.Вn!  w! y–В*! x–жКbЕХНWСБ.:!<Кg! q! pНІ:!<ВbБЕ.КgНк.:!<КgБЇГЊ
еН6АбБ}2!Г…лN ! ~жЂЃO> €G~жЂG! ~‡‡‡‡хЂGхб}бµжЙНвН]*[ ! еr#r#rН™КаН	 Нvбе_y–#xћ#{ћЪЪs+p+qНrГёбЙЇ2к =2] *[ ~ж=2ж юТ	:Z 2м ~2к жаwНC:` *[ ¶wЙ!  "ї "Б Ї2Z !Ђ "X Н‡ГR!] ~·ИЇw*[ w:к ·Иw:м 2ж :ж !Z ѕИх~2!сw*Б :Z OН—елНбМ‡}Ш*Б MDН№"Б Н@DM*П 6 #x±В{*Ъ л*П s#rНI*Г 6#6 НіяНўН™ИН	>еѕКњ:` ѕВА#~Ц$ВА=2!НН0ГњНyН>	ВЊ
*[ лН¬Н=В :ы <Кп>ГЊ
2!НЧ>КЊ
Н=КхЇ2!Н*ю Ђя"ю :ы <К"Ђя* !" !*ю Ђ "ю л* !Н9> ТJННoН+:!·К">х*ю л*щ ###s#rНсO2!:ы <АyхНWс2!Й:ы <КгГЊ*[ "щ л!ы НЪ*ь "[ ЙНyНвГ *[  #~ю?В¦Вћx·Й*!щ*[ Г$ л~ю?КОНb~ю?ДНвН]*Й л*X ЂИw#ГЫ*c "[ НвНrГСНвНг:д ГЊ
НвН]Гщ*Б Г`:Z ГЊ
*!лл"X Г‡*X "!Й*X Ђ Г*П Г`!ї N#FН№"ї *Ш #л*Г s#rЙ*ї Г`НвНГщ*Л "!Й{!` юяВq~ГЊ
жwЙНвяНлМ”ЙНв НлМлЙ*[   Нv!! q#p#wЙНj4А#4А#4ЙНjл!µ!ГЪНjµ!ГІ*[ }/_|/*Б ¤W}Ј_*ї л"Б }Јo|ўg"ї ЙНв>2е  НпМлЙ{<2щ O! Н±НГ!щ "[ Нв*П лН@  ·К!ТГ+}ґВ*Ц #}‘o|g:У OЇН±л*X s#r#wЙ{·КЬюЃТЬ2f Й{2g Йл~юcРл! Нл#~ююТsл^#VлГ`G#~И#~Й!Ђ !~ ~·К—К1#Г‡!!pНbГ1!t НіЙ!t лНіГЊ
ГЪ!, zЈ<ВJН.Г`!O Г»{!S <ВЩ~ГЊ
sЙл^#V#N#Fлx±ИеЕN:_ юoКшНrГыНњБб#Гд·Ию ШИю=Ию_Ию.Ию,Ию:Ию;Ию<Ию>И·Й·Ию К.ю	АГ#> Не*!лН#л"!лбеН!Ц@Gю:КZЇwГ\pНК…Ъ…#ю*Вr6?ГtwВ^НКЊЪЊГx#6 В…ю.ВёНКё#ю*ВҐ6?Г§wВ”НКїЪїГ«#6 Вё#6 ВБл"!б#~юaЪЩж_wВП·Йog"!ogН2*!~·Г`!яяГ`‡Н$НN#F:S х>$2S Н	с2S Й*є л*ј DM!  Нx±В%Й1v#:ѕ ·КMНл*ё Н9}ґКMН”1v#Н$Нµу>$2S !Ђ "X Н‡>Г2  !" 2 ! " Ї2#2Ѓ <2#2f : НFыН3Г1>Г2 ! " !0"Н  !”!НЪНтВУ"є е N#FСН"ё >я2ѕ ЙЇ2ѕ ЙЇ2ґ!! "э!ъ"[ НЛН+:!Й!ќ!~ю ВG6S#6P#6R”!Ї2ґ!* . "ё!л"є!!Ђя"ј!DM*X "ѕ!Н“*[ "А!*є!"[ лН¬Н=К*ј!DM*X "ѕ!Н“НК*ј!#^#V##N#Fл"В!	л*ё!лЇ•o> њg. "Д!л!Ђя"ј!НК*В! )|*Д!2И!"Ж!DMН“НК*Ж!Ђ :И!=ВЏ*ј!DMН“*В!MDл*Д!леby°Кц{жВйг}жВеЕХеНбСБ*ј!К
~#гo}oТт„ГГС*ѕ!DMН“*А!"[ Ї*Д!ЙСНч=ЙЇ2!НЊГ=ЕН$Б}·Иy2рЙ !фqЙ!хqЙ л	~oЙ>ГA>2т
Е!‚ Нc!рН$х!‚ НiсБ·ИВFЙрГmрл
ГЪ*F Гј*F ГЏ!j":#¶юяЙН~И*>  )Ъ$В’> Й:#<К:j"<Кѕ*>  )Ъ	$ВІ>ЙНЊ·КРН¬юКНG!l"~6 ·В! НЋoВН1Вх! НЋ!l"6В6 Н1КwсюАЇ2j"Гћ!#~юЂТНЋo·АЇ2#Гћ2п:Ђ <:пИНxНћOoН~yИНrК#:Ђ <yИю@Ш!о:пѕД_ю>ЂК\Ї±oЙyж Кj/ЎГm> ±O:пЙюИюЙ!оѕwИЕOНЈБЙ:Ђ <yКЈНrКxю@ЪЈ>Ъ >НxЕ Н$Б:#<! МИ:#<А:` х:#2` >я2 ! ~ю Д»Ї2!!н""[ лНTН=Ї2#с2` Йея ЂЂ    ”!   CCP             Й!I" m"н"      1                    P       Ђ Ђ     @           $   Ђ                                      я                                                                                                                                H@$ђ    ЂH@             $’I$’I$€Hђ„’@ ‚I ‚$$‘’BBD‰$Ђ ‰H‘"UI ЂA"B ‘$ЃI„H’$"„$„"II$„$’A"A$ B$‚HI$D‚ BDЂЂBђ€‰$’D‘$’   Ђ„‰$	"H‘!! "D‘! ЂUUUUUUUUUUUUUUU$@ђ€ BЄЄЄI$$‘$H@$D‘$H‘$ Ѓ "A BB$ђ „D’$‘$„$ђB‰!ђ„Dђ‘ЂA"$I A„I$"B’A"€@   H€$’B"Iђ€’„’„ђB  D‚ „‰Ѓ	 A@D "$DH’!$H’!!!BI$’I$’$BHђ„Ѓ$I „@ !DI$’H„   BB@   	$B  @ BHH„€ 	"""H Ђ " A D AH‚!Ђ ђ’ € "D  €D I@  ђ‘"ђ„’I‰ €$@   Ѓ  € A!  H’BI"H ‚	Ѓ! $$HHD @D! "I D„ I	’I"‚@ ! ‰!$HD€@ $‘Ѓ"A$A ЂHHHI  @ID DDЂ’D’II’D$H’I$„ „!$’BH„!"I ‚B I‰$"D HD"    Ђ B@D„B $     $ $‚ 	H’ ’"	$A$Ѓ	€!$  ђ‘€	$„‰$BHI@‘H!$‘@! DD’!$I A ђ‘ I$’I$’HЃ$‚H@’I!Ѓ	‘  BI  "„‚’HЂ€Ѓ D „„    BD’"! ’H€Ђ I @     B" @@’A$€"A$‘!H ‘ Ѓ$HI$H	ђH		$ HBI$€ @DI$‘$„’H B 	$HI D„‚HBH„DЂI"@DђI$ђ" ‰ ‰	 IDђ„ЂIЃ$€ђ„ђ	 @Ђ !	! €‘ђђD‘"  Ђ                                  >UQU>>kok><>IIЋЋ  wcw  ckc$*y*@@~	@%*w* >> 66 _ _ FE?=HVU5	pppppRR00>>8    8<><8>       _     >>""#db6IV P    "A  A" $~$> X8   ``   >QIE>  BaQIF!AIM3'EEE9>III2 y6III6&III> ff   [;   "AA" Y	>AYU||III6>AAA"AAA>IIIA			>AAI: AA !AAA?"A@@@`>AAA>			>AQa~	)F&III2?@@@? @ ?@8@?ccxaYIMC AA   AA @@@@@   $TT8@~HHH08DDDD0HHH~8TTT ~		TT|x Hz@ @@D=  (D B~@ |xx|x8DDD8|||TTT ?DD <@@<@0@0<@8@<D((D L0DdTLD 6AA  m  AA6 ~~~~~U Є UUЄUЄU$Ђ@	  я  я  

я  я я xx 

я  
ы я  я я 
z~ 
‹Џ ЏЏ 

Џ  x    ЏЏx  яя  я

 я я Џ‹
 ~z

‹
‹

z
z
 я я






ы ы


‹

"ї ~
??±Є¤ ±??""@??МТуТМ¤¤¤џЂџ%§¦њLR?’Њµ¤¤?ЃЂЃ? x| Hlt\H(lT|(||\\Tt$8\Tt Dd<(|T|(\T|88|D|8<$<Џ€Џ Џ 	ЌЋ‹	ЌЉЏѓѓЏЏ|8D8$TT8@8TTT"<  <``8$<`8TTT$~$|D((D<@@ |<@B ||(D@8|||||8DDD8||H4||8DDDD| L0D(|(D~JJL0 |HH0|H0 |(DTT(|@|@|DTTT8< < |||HH0>A>||III1?   `>!?`IIIA""cc "A@|>AAA>F)				>AAA"HHH?ccIII6HHH0H0 "AAI6@@"III>? ? ~~~~~ГшГTяГoшГѓяГОшГ4шГEяГVшГIшГ]я>Г28 !Јэ"9 Н—я>ЃУ! пЙхЫжВ5шyУ>пУ>яУсЙ~§ИЕNНѓяБ#ГIшGxН`шxжю
ъiшЖЖ0OГѓяЕХ WЫж_Ыж»КyшyOН№шЫж_z·т®шyюжВўшЇ2ЙяГ¬шюВyш>я2Йя	Вyш:Йя©СБЙх:Ея=ВЅшсЙЕХх>ЁWГЩшЕХхW>2КяzW>ЄжУ Ншш> ЄжУ НшшВЩшсСБЙх:ДяГЅш у у@фафЂх уАц`ч у уАц`чЂх у@фаф у у@ф`чЂх уафАц у у@фафЂх цАц`че!  91  Нџя:ГяНXщЇ2ЖяГ‘яЇ2ИяеХЕхНыс&е§МSыД4ыб %ВfщБСбЙхЕХе:Ия§ДWщ!®я~юЂК¬ью@К5эю Кѓъ·ВїщyюВҐщ4Г	ьюВІщ>Ђ2®яГ	ьюКИыюътыГѓъюВ4ъyюЂТ0ъюYКЎщюTКЎщюAКҐьюBКҐьюCКҐьюDКҐьюEКіьюJКҐьюKКҐьюHКҐью]КВью^Кйью\Кэю[К эюPК-эюaКSэюbКWэГ{ъ4Ц`OyюЂТ1ъ~юТdъyЦ тIъГNъюъPъ>OЃ/<Ц
O:«яЃ2¬яГЎщyЦ тmъГvъ юPтvъГxъ>O2­я!®я6 Г	ь!яшyЦ Т“ъЖ Г™ъ##В‰ъN#F& oT]))	еНы! уНѕъбНѕъ#ВІъГuыНЛъ:mъ§ИНЛъЙеХЕ~! п	V$$O~лW/_Ez¶w,z¶w,z¶w,z¶w,z¶w,z¶w,z¶w,z¶w,z¶whГ	ыO{¦wy§Кы,§ТыГыБСбЙ:­яo& )еБ)	 	|жGM:¬я_Йх! п	V$$~л¶wлсЙх! п	V$$~л¶wлсЙх! п	V$$~л/¦wлсЙх! п	V$$~л/¦wлсЙб!­я4 ~юPъ	ь6 :¬яЦ
2¬яOЖG:«яёВ	ьЦ
2«яyЦO& >а ir,r,r,r,r,r,r,r,r,r,r,r,r,r$јВ¤ыГ	ь!  9"рыу1 а  шя!ш?ЕЕЕЕЪЬы*рыщ!«я6яГSь  yю!­яВ$ь~= тьЇюOЪьЇw:®яю Вь:­яж В„щЇ2®ябСБсЙюВ/ь~< Гюыю
В7ьГЂыюКSьюКэюКэюК~эю	КљэГbьЇ2­я:«яЦ
2¬яГ	ьюВkьЇГью!¬яВЉь:«я
4ѕК„ьВxьГ	ьЦъwГ	ьюВѓъ:«я
5ѕК ьВ”ьГ	ьЦ
Г†ьЇ2®яГ„щЇ2®яГѓъ!яшН)эНпьН_эГҐь>2Bы2bы2pщ>2mъ><2+ь>=2эы>42yы>2ьГ{ъНпьГ{ъ>Й2Bы2bы> 2mъ2эы2+ь2yы>2ь2pщЙ!щГ#э!яшГ#э!щГ#э!/щН)эГ{ъ"„ъЙ>@2®яГ	ь:Вяю КHэЇ2Вяy2АяГ{ъ<2Вяy2їяГ	ьЇГYэ>Н`эГ{ъЇ{¦!z¶§Кkэл"ы>	!Юъs#r###=ВsэЙ:ЗяЖ
OAВ‡эxжУ :Зя№В„эГ{ъ> 2®яOГ„щхЕХе*їя{Уж}К·э|УУУУУУВ­э*Зя#"Зя>ЉУ :КяУ}жgжo:Гяј}2ГяКсэ>2ЖяЫжЂ!іяВю~·Кю6 !±я~оwГю6яЇУЫюяК2юю xУЫюяВ@ю{‚_xGВюН!яЇ2°я/2ІяГ?яТHюГ@юН!я!ѕюеЫж`G{ю?> И{юТrю!®ю ~юАxж >_И~Йю Т‘ююxТ€юж {К…юЖЖЙж {В…юГѓюxж@В›ю{жЙxж G:±яж°{в«юЖ Ж Й	
 Ђ!?яеG:ІяюяКгюёА!°я~ю2КШю4Й!Їя~ю
ВЦю6 НГшx2ІяюЂВшю:БяЖЂ2БяЙю!ЪяюКя:БяЂG!ґя~юР4:µя_ !·я<ж2µяpЙ:±яж	g:Кяж„g>€У |У:«яУ>УЙбСБсыЙ:Жя§Д?щ:ґя§И>яЙН]яюяКTяЙЕеНEя!ґя~·Вnя=бБЙ5!·я:¶яO 	<ж2¶я~бБЙе!  91  НџяНyщН—ящбЙх>#УсыЙхЇ2КяУсЙ   я      я            (   2K                                                         ГPЫГXЫГ[ЫГdЫГmЫГ"ЭГfЭГогГvЫГќгPKORREKT ZG 25.11.1992-KARAGANDA  PIMENOW PASHA  Ї2·и2±иЙГPЫНЌЫ§ЫЭ”ЫНЌЫЄЫ”ЫЭНЌЫ­Ы·ЫЭН–ЫЯ›б5вЌв‚гѓгљг›гўгњгбzюЪ—ЫЇЙбН›Ый‡…oТўЫ$^#fkЙГшГшГ	шх>#УсЙхеХЕ!ТЬ"ЈЬ"ѕЬ>02НЬ:Э§КЮЫ!тЬ"ЈЬ"ѕЬ> 2НЬ:ЭюТкЫyжO:Эю К¬ЬюК™ЬюКTЬюКЬюК-ЬГЇЬR R yюЂЪ¬Ьyж2Ь!	ЬNНш#В!ЬГЇЬyюЂЪTЬ>2Эyж2Ь!	ЬNН·Ы#ВCЬ>2ЭГЇЬyюКmЬ:Э·К‹ЬюКsЬyж2ЭЇ2ЭГЇЬyюRВЬ2ЭГЇЬНшOНшГlЬ:Эю К¬Ьyю`ЪґЬyжOю`Ъ¬Ь!ТЬ Ц`_NНшБСбсЙyжOю@Ъ¬Ь!ТЬ Ц@_~юЂЪОЬЖ0OГ¬ЬАЎўёҐ¦¶¤·Є«¬­®Ї°±БІіґµЁЈѕЅ©єї»№ѕО°±ЖґµДіЕё№є»јЅѕїПАБВГ¶ІМЛ·ИНЙЗј   Ы/жЙГшГш!  yюРН2ЭFЭVЭ6ЭбГ›Ы        ѕиqизй>й        ѕиЂичй_й        ѕиЏик’й~ю К'еюК'ееЕХЗй
~#ВyЭ:ЙйюК!ЮюК„ЮЇ§СБбЙх!ЗйґЭ	лхНыЭслеХНхЭСб~#ВќЭсЙ
ERORR=   DISK=  CHW=  OPER=  NSEC=  ATRK=  ASEC=  ADR2=  ADR1= ЕНЮБЙ~§ИЕNНчЯБ#ГыЭGxНЮxжю
ъЮЖЖ0OГчЯНЅЮ!  9"Ей*Сй}ЦЂoТ6Ю%ущ*Нй@:УйУЇСs†#r†#ВCЮG>?У*ФйщС{єВfЮёКrЮГrЮёКЮzёZКЂЮ*Ей>#УщыyГЏЭSХГrЮНЅЮ !  9"Ей*Сйущ*Нй@:УйУЇV‚+^ѓ+ХВўЮW>?У*Фй##ZщХГrЮ:ЛйюТНЮ!япГТЮ!яџЦ ь<=КеЮЪЦЮГЦЮ#:МйЂя=КфЮГмЮ"Сй>#Ђ2Уй:Лйo& )))):Мй=‡…o р"ФйЙНнд] Н)бm юRКEЯюWКJЯюAКOЯюPК[ЯюLКjЯюMК|ЯГ"б}2ЕяЙ}2ДяЙеН­ЫбMН­ЫЙеН­ЫPН­ЫLГRЯ}юТ"бж2Э}ж2ЭЙ}2›Я|2ЎЯ!’ЯNЇѕИ#НшГ‡ЯMS03NC НаХх!] r! НйЯлНйЯ*ЦйНйЯ*ШйНйЯ!m NНчЯ#ВИЯ.НчЯN#НчЯВШЯ НчЯсСЙ|НхЭ}НхЭ НчЯЙхЕеХYНгдСбБсЙНндНшvу@yНшю КаюяВаВа>яНшgyНшoyНшWyНш_"Цйл"Шй{/_z/W# л yНшwЂGНб#ВLаy+лНшёКnа! аНыЭ>я§Й!m >НшwЂG#Вsа>Ншё!Џа> ДgаЙFILNAME ERROR -  TAPE I/O ERRORS -  НндНшНбуЇGНшВїа>жНш>gНшЇoНш:m WНш>я_Нш ~ЂG~НшНб#ВеаxНш!] ~НшЂG#ВьаxНшЙЫж@И|юёИєА{ЅЙ>–v=ВбЙbдНрдЙ!  ю ИЦ0ъSбю
ъGбюъSбютSбЦO))))ЪSб	Г,бН"б\ Нъд7ЙеЕлН"е\ Неqб·БбЙOUT OF DATA SPACE$NO DIRECTORY SPACE$ OK $Ннд] Н)бШЇЅК"б"ји\ !l ~#~жю Кабю Кабю?К"бю[Т"бюAТабю/Ъ"бю:Т"б#В№бЇВиб\ Н	е\ Неѓб<К1в:јиG! Н^бВ1вЂ Н^бВ1вЂ В	в\ НъдШд<К1в–бНрдЙНнд] Н)бMЇЅИ!l ~2ей#Ъй> ѕИ~#ВSвЕН¤ЯБю А!l :ейw#Ъйю?КzвѕВ[в#Вpв*] ЕНҐбБВ[вЙ ЕНнд!] Ъй~#В›вЂ Н"еНeгНядqдБGюТрдЕяНидБ§{дВрдyю ВЭв2жйxНгy2жйЕГЈвЕЕЂ Н"еНeгНеБюТгВЮвНгБy2жйЕГЈвБЙЕ!Ѓ ‡‡‡‡‡…oлНhгНхдЇ2|  ХН"е\ НеюКCгС!Ђ лzюёКcгГгХх!] ГЖЯН;гС{ю КNгБj:жйg$ЕХНйЯСz2m НіаБЙЪй!] w#ВmгЇw#Вwг\ ЙЙНнд\ Нею–бЪрдbдГрдЙЙЙ>Г¤г>2Йй !ѕи"НйЂ>еw#Вґг>2Зй{2Мйz2Лй*НйеХЕ!ЗйНfЭД”ЭБСб"Нй{ю	ВїгzюмВїгЇЙ!тгЙдд(д)д~д@дCдTдШдqдqд‘д‘дBDOS ERROR ON $  DISK ERROR$$  SYSTEM FILE$SELECT  $  $IGNORE (Y/N) ?  $  FILE EXISTS$AMBIGOUSE NAME$
NO FILES
$
DELETE (Y/N) ?  $]b
  * VECTOR-06C *  
 * BIOS  V(3.0) * 
 ABC - DISK DRIVE ^a
$  FILE R/O$Г Г {д	Г Г Г Г Г Г Г Г Г Г Г "ўиН/е·Й~2Ґи##~2¤и##~2¦и#~=2Ёи#~#fo"єи:¤июК\еюКpеЇЙЇ2±и>2®и2Їи>2­иГжЇ2®и:»июиК›еХ:¦иЦ W:ЁиК‘еЖ(Г€еСж В›еy2­июВ»е>2±и:Ґи2Іи*¦и"іи:Ёи2µи:±и·Къе=2±и:Ґи!ІиѕВъе!іиНЎжВъе:Ёи!µиѕВъе4~ю(Ъуе6 *іи#"іиЇ2ЇиГжЇ2±и<2ЇиЇ2°и:Ёи···2¶и!·и~6·К@ж:Ґи!©иѕВ9ж!ЄиНЎжВ9ж:¶и!¬иѕК]ж:ёи·Д­ж:Ґи2©и*¦и"Єи:¶и2¬и:Їи·ДnзЇ2ёи:Ёижo& ))))))) лл*єиЂ:®и·Вѓж>2ёилw#Вѓж:­ию:°иА·АЇ2ёиН­ж:°иЙл!¦иѕА#ѕЙН.зВзН№зВзуе> Н#зЫЈКАж~У,ВАж$ЫЈКОж~У,ВОж$ЫЈКЬж~У,ВЬж$ЫЈКкж~У,Вкж$Нgзб:№иУЫжЭыИ2°и:¤июКзЇ2±и2·и>2Їи:°и§ЙУЫТ'зЙ:©ижц02№и&:ЄижКKз:Ы§КKз& :№иґ2№и:№иУЫТcзНgзГRз>РУ>Ђ=ВiзЙН.зН№зВзуе>ЂН#зЫЈК~зЫw,В~з$ЫЈКЊзЫw,ВЊз$ЫЈКљзЫw,Вљз$ЫЈКЁзЫw,ВЁз$Гшж:©ижo& ћи:Ы§~КПз·WЫєzУ:ЄиwКнз:Ы§~Кзз·_УГюз:Ы§~Кчз·_УєКJиєК+и>YТ	и>yН]и:ЫюPД иЫ»К+иН&иГи>(Н]иЙ>8Г"и>Н]иЫжКJи2°иНgзНUиНgз6 :°и·Й:¬и<УЇ! лЙх> Н]исЙУНgз:№иУЫЪbиНgзЙ  л ? А     (  ‡ А    (  ‡ А                                                                                                      ееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееее!  9"1MН 22!Ђ F#К/~юAЪюQТЦA2!@ "ы!с "ч>2 Н Їµх:_:»Д сК»Н ##~==2яе! )=Вj"эб#~2 ##^#V#л"щл^#Vл#"ы)))))л*э+:яO| ·Вћ/Oя*щ	:я=Кё)Г°"ч!\ 6 #6?#ВГГС\ Н ·ъ6*к#"кЂ жѓ_! ~юЂКПG: /O/ЂЎжG+++~жрЂw*оO 	"о*рw#В!"р*м#"мГП*м"	*	|·g}o"	ґКв|/g}/o#л*м"! ""л*	))T])A	л*))ХT])С	ѕЪ­В‘#Вѓ*#"л*|єЪ<В©}»Ъ<лГb>ђ/Oя	л	Nwy#Вє*	|/W}/_*"Їґъ‘µК‘Гe:ЖA2џ*мл!©Нм*клХ!ёНмСНђ*ыл!ЅНм*олХ!ФНеСНђ*чл!ЫНеья *м	яЪ4y2тo& )T]))"у*рP>яw#ВP	Н !M"х!т5ъУ*хН)юя:ДL НL*ул*хН)юя:ДL НL*ул*хН)юя:ДL НL*ул*хН)НL
НL*х "х>яѕВd:_:»Д *щЙНм6K#ЙzіКелНOНUG бНPНQzНzж»И0ѓw#ЙЇ)Џ'Т$#ВЙ~юяИНX НLНX НL~НbKНL еХЕН БСбЙ^#НLВXЙd Нt
НtЖ0_ГLяђТvЂхyєК€Ж0ГЉ> _НLсЙ{/_z/WЙ
DISK:    FILES:       ENTRIES:    (    LEFT)   SPACE USED:      (      LEFT)

$      M              ееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееее;;
;; ///////// 8.03.1993 /////////////////////////////////////
;; //	(C) 1993  лБТБЗБОДБ  лРФй  ьб-91-2  рЙНЕОПЧ р.б   //
;; //							  //
;; //  DDR.ASM - нПДХМШ УПДЕТЦЙФ ОЕВИПДЙНЩЕ  ЖХОЛГЙЙ ДМС  //
;; //		 ТБВПФЩ У ДЙУЛПН ОБ "ЖЙЪЙЮЕУЛПН" ХТБПЧОЕ. //
;; // ========= 52-81-95 ========= PPA Systems ========	  //
;; //		Copyright  by  рЙНЕОПЧ рБЫБ		  //
;; /////////////////////////////////////////////////////////
;;

	INCLUDE	MACRO.PPA		;
	INCLUDE	VG.EQU			;
;;
;; /////////////////////////////////////////////////////////
;; //	(C) 1993  лБТБЗБОДБ  лРФй  ьб-91-2  рЙНЕОПЧ р.б   //
;; //							  //
;; //	    рБЛЕФ РТПДРТПЗТБНН ДМС ТБВПФЩ У ознд	  //
;; //		  ОБ "ЖЙЪЙЮЕУЛПН" ХТБПЧОЕ.		  //
;; // ========= 52-81-95 ========= PPA Systems ========	  //
;; //		Copyright  by  рЙНЕОПЧ рБЫБ		  //
;; /////////////////////////////////////////////////////////
;;

;;______________________________________________________
;;		пРЙУБОЙС ЗМПВБМШОЩИ РТПГЕДХТ		
;;______________________________________________________
;;
	Public	READ_SEC
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;; рТПГЕДХТБ ЮФЕОЙС УЕЛФПТБ Ч РТПЙЪЧПМШОПЕ НЕУФП РБНСФЙ	;;
;; ХЛБЪБФЕМЕН ЛПФПТПК УМХЦЙФ РБТБ: DE			;;
;; РТПЙЪЧПДЙФУС ЮФЕОЙЕ ПДОПЗП УЕЛФПТБ У ФЕЛХЭЕК ДПТПЦЛЙ	;;
;; Й ФЕЛХЭЕК УФПТПОЩ					;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

	PUBLIC	SET_CULIND
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;   рТПГЕДХТБ SET_CULIND РТПЙЪЧПДЙФ ОЕРПУТЕДУФЧЕООПЕ 	;;
;; РПЪЙГЙТПЧБОЙЕ ЗПМПЧПЛ ФЕЛХЭЕЗП ОБЛПРЙФЕМС РТЙ ЬФПН 	;;
;; ОЕ РТПЙЪЧПДЙФУС ЛПОФТПМШ ОБ ОПНЕТ ФЕЛХЭЕК  ДПТПЦЛЙ 	;;
;; Ф.Е  РЕТЕНЕЭЕОЙЕ  ЧПЪНПЦОП РП  ОЕПФЖПТНБФЙТПЧБОПНХ 	;;
;; ДЙУЛХ.						;;
;;  фБЛ ЛБЛ БМЗПТЙФН ХУФБОПЧЛЙ ОЕ ПРЙТБЕФУС ОБ ЮФЕОЙЕ 	;;
;; ОПНЕТБ  ДПТПЦЛЙ У ДЙУЛБ ФП РЕТЕНЕЭЕОЙЕ  РТПЙУИПДЙФ 	;;
;; ЮЕТЕЪ  "чПУФБОПЧМЕОЙЕ"  ЗПМПЧПЛ ( ОБ 0-К ГЙМЙОДТ )	;;
;; Й  РПУМЕДХАЭЙН  РЕТЕНЕЭЕОЙЕН  ЗПМПЧПЛ  ОБ ЪБДБООЩК	;;
;; ГЙМЙОДТ РТЙ РПНПЭЙ ЛПНБОДЩ "рПЙУЛ"  ПРСФШ  ЦЕ  ВЕЪ	;;
;; ЛПОФТПМС ОПНЕТБ ДПТПЦЛЙ				;;
;;   рТПГЕДХТХ   ОЕПВИПДЙНП  ЧЩЪЩЧБФШ  РТЙ  ОБЮБМШОПК	;;
;; ЙОЙГЙБМЙЪБГЙЙ ЛПОФТПМЕТБ Й ознд.			;;
;; йУРПМШЪХЕНЩЕ РТПГЕДХТЩ:				;;
;;	PUSK - ъБРХУЛ ДЧЙЗБФЕМС Й ЧЩВПТ ОБЛПРЙФЕМС.	;;
;;	DS_WAIT - ПЦЙДБОЙЕ ЗПФПЧОПУФЙ ЛПОФТПМЕТБ.	;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;; 

	PUBLIC	DS_WAIT
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;   рТПГЕДХТБ DS_WAIT РТПЙЪЧПДЙФ ПЦЙДБОЙЕ ЗПФПЧОПУФЙ	;;
;; ЛПОФТПМЕТБ РХФЕН ГЙЛМЙЮЕУЛПЗП ЮФЕОЙС ВБКФБ УФБФХУБ	;;
;; Й БОБМЙЪБ НМБДЫЕЗП ВЙФБ.				;;
;;   рТПГЕДХТХ ОЕПВИПДЙНП ЧЩЪЩЧБФШ ДМС ПЦЙДБОЙС ЧЩРПМ-	;; 
;; ПМОЕОЙС ЛБЛПК МЙВП ПРЕТБГЙЙ.				;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
	PUBLIC	PUSK
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;   рТПГЕДХТБ PUSK РТПЙЪЧПДЙФ ЧЩВПТ ЪБДБООПЗП  ОБЛП-	;;
;; РЙФЕМС (  ознд  чЩВЙТБЕФУС  ЙУИПДС  ЙЪ УПДЕТЦЙНПЗП	;;
;; ЗМПВБМШОПК СЮЕКЛЙ DISK_MASKA).			;;
;;   рТПЮЕДХТХ ЧЩЪЩЧБАФ ОЕРПУТЕДУФЧЕООП РЕТЕД ОБЮБМПН	;;
;; ЧЩРПМООЕЙС ЛБЛПК МЙВП  ПРЕТБГЙЙ У ДЙУЛПН ( юФЕОЙЕ,	;;
;; ЪБРЙУШ, Й Ф.Д.).					;;
;;   йУРПМШЪХЕНЩЕ РТПГЕДХТЩ:				;;
;;	DS_TIME - фЙРПЧБС РПДРТПЗТБННБ ЪБДЕТЦЛЙ		;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
	PUBLIC	DS_TIME
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;   рТПГЕДХТБ ЧТЕНЕООПК ЪБДЕТЦЛЙ. "ЙОФЕТЧБМ ЧТЕНЕОЙ"	;;
;; ЪБДБЕФУС ЮЕТЕЪ ТЕЗЙУФТПЧХА РБТХ "BC"			;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

;;______________________________________________________
;;		пРЙУБОЙЕ ЗМПВБМШОЩИ РЕТЕНЕООЩИ
;;______________________________________________________
;;
	PUBLIC	DISK_MASKA
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;   рЕТЕНЕООБС  DISK_MASKA СЧМСЕФУС ВБКФПЧЩН ЬМЕНЕО-	;;
;; ФПН ХРТБЧМЕОЙЕН ЧЩВПТБ ОБЛПРЙФЕМШ РТЙ ЧУЕИ  ПРЕТБ-	;;
;; ГЙСИ ЧЧПДБ-ЧЩЧПДБ:					;;
;;	D0 - "0" - оБЛПРЙФЕМШ "б"			;;
;;	     "1" - оБЛПРЙФЕМШ "B"			;;
;;	D2 - "0" - зПМПЧЛБ 0				;;
;;	     "1" - зПМПЧЛБ 1				;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

;;=======================================================
;;   рТПГЕДХТБ ЮФЕОЙС ЙОЖПТНБГЙЙ РПУФХРБЕНПК ПФ ЛПОФТ.
;;
READ_SEC:
	IN	DS_STATUS	; РТПЮЙФБФШ УФБФХУ ЛПОФТПМЕТБ
	RRC			;
	RNC			; УЕЛФПТ РТПЮФБО ??? 
	RRC			; ЕУМЙ ДБ ФП ХИПД
	JNC	READ_SEC	; ПЦЙДБЕН ЗПФПЧОПУФЙ ДБООЩИ
	IN	DS_DATA		; ВЕТЕН ДБООЩЕ
	STAX	D		; УПИТБОСЕН Ч ВХЖЕТЕ
	INX	D		;
	JMP	READ_SEC	;

;;========================================================
;;РТПГЕДХТБ ХУФБОПЧЛЙ ЗПМПЧЩ ОБЛПРЙФЕМС ОБ ХЛБЪБОХА ДПТПЦЛХ
;;чИПД:	б - ОПНЕТ ДПТПЦЛЙ
;;
SET_CULIND:
	PUSH	PSW		;
	PUSH	PSW		; УПИТБОСЕН ТЕЗЙУФТ PSW
	CALL	PUSK		; ЪБРХУЛБЕН ДЧЙЗБФЕМШ ОБ
	MVI	A,00000000B	; ФЕЛХЭЕН ОБЛПРЙФЕМЕ Й
	OUT	DS_COM		; РТПЙЪЧПДЙН ЧПУФБОПЧМЕОЙЕ
	CALL	DS_WAIT		; ЗПМПЧЩ ( 0-Culinder )
	POP	PSW		; ЧПУФБОБЧМЙЧБЕН ОХЦОХА
	CALL	PUSK		; ОБН ДПТПЦЛХ Й РТПЙЪЧПДЙН
	OUT	DS_DATA		; РЕТЕНЕЭЕОЙЕ ЗПМПЧЩ
	MVI	A,00011000B	; 
	OUT	DS_COM		;
	CALL	DS_WAIT		; ПЦЙДБЕН ЗПФПЧОПУФШ
	XRA	A		; ВМПЛ ЛПТЕЛГЙЙ ОПНЕТБ ДПТ-
	IN	DS_TRACK	; ПЦЛЙ ЧЧЕДЕО ДМС ЧПЪНПЦОПУФЙ
	RAR			; ПВТБВБФЩЧБФШ 40-ДПТПЦЕЮОХА
	OUT	DS_TRACK	; ЪБРЙУШ.
	POP	PSW		;
	RET			; ЧПЪЧТБФ ЙЪ РТПГЕДХТЩ
;;========================================================
DS_WAIT:
	PUSH	PSW		;РТПГЕДХТБ ПЦЙДБОЙС ЗПФПЧОПУФЙ
DS_WAIT_00:			;
	IN	DS_STATUS	;ЛПОФТПМЕТБ ознд
	RRC			;
	JC	DS_WAIT_00	;ЪБОСФП ЙДЕФ ЙУРПМОЕОЙЕ ЛПНБОДЩ
	POP	PSW		;
	RET			;
;;========================================================
PUSK:
	PUSH	PSW		; РТПГЕДХТБ ЪБРХУЛБ ДЧЙЗБФЕМС
PUSK_00:			;
	LDA	DISK_MASKA	; РП ЪБДБОПК НБУЛЕ
	OUT	DS_MOTOR	; Ч РПТФ ХРТБЧМЕОЙС
	LXI	B,2000H		; ЛПОУФБОФБ ЪБДЕТЦЛЙ
	IN	DS_STATUS	;
	CALL	DS_TIME		; ДЕМБЕН РБХЪХ
	RLC			;
	JC	PUSK_00		; ЕУМЙ ОЕ ЗПФПЧ ФП РПЧФПТЙФШ
	POP	PSW		; ЧПУФБОПЧЙН ЖМБЗЙ
	RET			; ЧПЪЧТБФ
;;
DISK_MASKA:
	DB	00H	;НБУЛБ ЧЩВПТБ ТБВПЮЕЗП ОБЛПРЙФЕМС
			; D2 - ВЙФ ПФЧЕЮБЕФ ЪБ "УФПТПОХ"
			; ДЙУЛБ (РТЙ ПВНЕОЕ) ЕУМЙ ЬФПФ
			; ВЙФ = 1 ФП ЧЩВЕТБАФУС ЮЕФОЩЕ
			; ДПТПЦЛЙ ( РП ХФЙМЙФЕ DD.COM )
			; ЕУМЙ = 0 ФП ОЕ ЮЕФОЩЕ

;;
;;========================================================
DS_TIME:
	PUSH	PSW		; фЙРПЧБС РТПЗТБННБ ЧТЕНЕООПК
	PUSH	B		; ЪБДЕТЦЛЙ
DS_T0:				;
	DCX	B		; РХУФПК ГЙЛМ
	MOV	A,B		; ---//----
	ORA	C		; ---//----
	JNZ	DS_T0		; ---//----
	POP	B		; ЧПУФБОБЧМЙЧБЕФ ТЕЗЙУФТЩ
	POP	PSW		; Й ЧПЪЧТБЭБЕНУС
	RET			;
;;========================================================
	END

ЕДХТБ ЪБРХУЛБ ДЧЙЗБФЕМС
PUSK_00:			;
	LDA	DISK_MASKA	; РП ЪБДБОПК НБУЛЕ
	OUT	DS_MOTOR	; Ч РПТФ ХРТБЧМЕОЙС
	LXI	B,2000H		; ЛПОУФБОФБ ЪБДЕТЦЛЙ
	IN	DS_STATUS	;
	CALL	DS_TIME		; ДЕМБЕН РБХЪХ
	RLC			;
	JC	PUSK_00		; ЕУМЙ ОЕ ЗПФПЧ ФП РПЧФПТЙФШ
	POP	PSW		; ЧПУФБОПЧЙН ЖМБЗЙ
	RET			; ЧПЪЧТБФ
;;
DISK_MASKA:
	DB	00H	;НБУЛБ ЧЩВПТБ ТБВПЮЕЗП ОБЛПРЙФЕМС
			; D2 - ВЙФ ПФЧЕЮБЕФ ЪБ "УФПТПОХ"
			; ДЙУЛБ (РТЙ ПВНЕОЕ) ЕУМЙ ЬФПФ
			; ВЙФ = 1 ФП ЧЩВЕТБАФУС ЮЕФОЩЕ
			; ДПТПЦЛЙ ( РП ХФЙМЙФЕ DD.COM )
			; ЕУМЙ = 0 ФП ОЕ ЮЕФОЩЕ

;;
;;========================================================
DS_TIME:
	PUSH	PSW		; фЙРПЧБС РТПЗТБННБ ЧТЕНЕОО
ЕНЛ
БНЛ
*MеюМН0С!я—Ню Н0Н„НЅЙХ|Н@}НEСЙ         3       3 !G~·И5+FH!ФНІђG*DКnЬЂФҐyЂGл!ФНаНё2FЙЕХехx 	T]O	е*M	"Mбwё#ВсбСБЙЕХехx 	+лO*Mе	"Mеh	бБТЭmНtНёЇ2G<2;НµсбСБссЙ
w+y»ВЭxєВЭсбСБЙ!G~·А4ЙЕХех*PлНН¬ 	Cz>Ъ/O~©w,В-C|Ж g~©w-В%сбСБЙХх>Н<НВ<<НсСЙХх>Н<НВV<НсСЙ>2ЮЙНС
х
юВpс
юИ{<ВlЙЕх>6У yУxУxюВЌ>6УсБЙ!  "RЇНЛ
!"RЙЕХеГѕЕХе*Dл!У #ёКФКФwГЕpyбСБЙЕХех!AЇ¶КW5™™ГяЕХех!A4Вь5ГW ##~Ђ'w+~‰'wНГWЕХех*<|µКW+"<™™Г>ЕХех*<#|µКW"< !@~Ђ'w+~‰'w+~‰'wНсбСБЙ6 +В^#Й`ГpSНёНyЙ
·ИНГyНн<К„=ЙЫo  & p$|юаВ•}-УВ“Й*D~#»В«#~юИ"DЙ*D+++~»ВБ# Нлл#Ъ¶Й(C) 1993 KARAGANDA PRESENT BY PIMENOV PAVEL
	 PPA TEXT EDITOR V1.02

$ERROR
$ Version 1.02  00000/000  Edit  *:noname  .txt  1-Help  2-File  3-Goto 4-Search5-Servis 6-Info  7-Quit Message:!   r#x±Вї !>НH-НH-!НLлН2>њН>>‰Н(% НС
НС;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;		   Title    DDR.PPA
;;      (C) 1993 лБТБЗБОДБ Copyright  by  рЙНЕОПЧ рБЫБ
;;      Header  -  ЖБКМ  ПРТЕДЕМЕОЙС  ЛПОУФБОФ ДМС РТПЗТБНН
;; ОБ  БУУЕНВМЕТЕ  У  ПТЕОФБГЙЕК ОБ ТБВПФХ У ОБЛПРЙФЕМЕН ОБ
;; ЗЙВЛЙИ НБЗОЙФОЩИ ДЙУЛБИ (ознд) УРЕГЙБМШОП ДМС чЕЛФПТ-06г
;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

DS_STATUS	EQU 1BH	; ТЕЗЙУФТ УФБФХУБ EQU COM
DS_COM		EQU 1BH	; ТЕЗЙУФТ ЛПНБОД Й УФБФХУБ
DS_TRACK	EQU 1AH	; ТЕЗЙУФТ ДПТПЦЛЙ
DS_SECTOR	EQU 19H	; ТЕЗЙУФТ УЕЛФПТБ
DS_DATA		EQU 18H	; ТЕЗЙУФТ ДБООЩИ
DS_MOTOR	EQU 1CH	; ЪБРХУЛ ДЧЙЗБФЕМС

    DfwwfD            рррррррррррррррррррррррр         яяяяяяяяяяяяяяяяяяяяяяя        $’I$’I$’’I$’I$’I$’I$’I$’  пппппппппппп     Ђ„ДЖжзжЖД„Ђ     !#cgзgc#!    яяяяяяяяяяяя      ҐҐ ҐҐҐҐҐҐ       eeeеmmmmз     ж©"F¦©©¦F„©ж      ппп            зBfзBBBзfB       BBBBBBзfB       BfзBBBBBB         B"п"B           D„п„D                                                                                         BB BBBBBB              ҐҐҐ      ¦¦п¦¦¦п¦¦       	 F¦¦F 	        ©ҐDB"©‰         еЄЄкеF¦¦F             DBBB      "BDDDDDB"       DB"""""BD         ҐfяfҐ           BBзBB        DBBB                 з           BB              €„DB"!        ж©©­нл«©ж       зBBBBBЖFB       п©„DB"!©ж       ж©!!fB"©п       c""пЄ¦fb"       ж©!!о€€€п       ж©©©о€€„F       DDDDB"!©п       ж©©©ж©©©ж       Ж"!!з©©©ж        BB   BB        DBB   BB        !"BD„DB"!         з  з          „DB"!"BD„       BB BB"©©ж       ж€кллл©©ж       ©©©п©©¦F@       оҐҐҐжҐҐҐо       fҐ‰€€€‰Ґf       О¦ҐҐҐҐҐ¦О       пҐ…†Ж†…Ґп       М„„†Ж†…Ґп       GҐ©«€€‰Ґf       ©©©©п©©©©       fBBBBBBBf       ЖЄЄ"""""c       ­Ґ¦¦Ж¦¦Ґ­       пҐ…„„„„„М       ©©©©©йпЇ©       ©©©«лн­©©       F¦©©©©©¦F       М„„„жҐҐҐо      #"жлй©©©©ж       ­ҐҐ¦жҐҐҐо       ж©©"F„©©ж       fBBBBBZЫя       ж©©©©©©©©       @F¦©©©©©©       ¦Їпйй©©©©       ©©©¦FF¦©©       fBBBfҐ™™™       п©‰„DB*©п       fDDDDDDDf       !"BD„€        f"""""""f              ©¦F@   я             	Title	DE.ASM
	ORG	0000h
;;
;; ///////// 5.04.1993 ///////////////////////////////////
;; //  (C) 1993  лБТБЗБОДБ  лРФй  ьб-91-2  рЙНЕОПЧ р.б	//
;; //							//
;; // ====== 52-81-95 ======== PPA Soft Systems ======	//
;; //	(C)1993	Copyright  by  рЙНЕОПЧ рБЫБ		//
;; ///////////////////////////////////////////////////////
;;
;; зМПВБМШОЩЕ ПРЙУБОЙС ОБИПДСФУС Ч ЛПОГЕ ЖБКМБ.
;;
	Include	MAIN.PPA
;{
;	Include	MACRO.PPA	; нБЛПРПДУФБОПЧЛЙ
;	Include	EQU.PPA		; лПОУФБОФЩ.
;	Include	EXT.PPA		; чЩИПД ОБ ДТБКЧЕТЩ
;	Include DDR.PPA		; дЙУЛПЧЩЕ ЛПОУФБОФЩ.
;}
DE_START:
	LXI	SP,STACK_SEGMENT; хУФБОПЧЙН ХЛБЪБФЕМШ УФЕЛБ
	CALL	START_PPA	; УФБТФХЕН.
	JMP	TMP_DONE	;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;================== US + Servise ======================;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
FIND_SECTOR:
	DB 'P'	; вХЖЕТ ДМС УЕЛФПТБ.
FIND_HEAD:
	DB 'P'	; вХЖЕТ ДМС УФПТПОЩ.
FIND_CUL:
	DB 'A'	; вХЖЕТ ДМС ФТЕЛБ.
FIND_FLAG:
	DB 00h	;  0 - оемшъс ртпйъчпдйфш ртпдпмц. рпйулб
		; !0 - нпцоп !!!.
FIND_POS:
	DB '_'	; рПЪЙГЙС ХЛБЪБФЕМС ЗТБДХУОЙЛБ.
FIND_COUNT:
	DB 'S'	; уЮЕФЮЙЛ УЕЛФПТПЧ ДМС ЗТБДХУОЙЛБ.
FIND_PTR:
	DB "OF"	; хЛБЪБФЕМШ РТЕТЩЧБОЙС РПЙУЛБ.
F_COUNT_END:
	DB "T_"	; уЛПМШЛП ПУФБМПУШ ДП ЛПОГБ УЕЛФПТБ.
FIND_BUF:
	DB 0  ; уФПРПЧЩК ВБКФ.
	DB	"_(C)1993_COPYRIGHT_PIMENOV_PAVEL_"
;;;;;;; вХЖЕТ ДМС РПЙУЛПЧПК РПУМЕДПЧБФЕМШОПУФЙ

US_SERVISE:
	LXI	D,0D09h		;
	LXI	H,2A0Bh		;
	MVI	A,00010101b	;
	CALL	ACTIV		;
	LXI	D,0202h		;
	LXI	B,SOOB_20	;
	CALL	W_PUTSXY_Z	;
	DCR	E		;
	CALL	W_PUTSXY_Z	;
	DCR	E		;
	CALL	W_PUTSXY_Z	;
	CALL	Y_N_WRITE	;
	CALL	MENU		;
	CPI	0Eh		;
	CZ	DEACTI		;
	RZ			;
	ORA	A		;
	JZ	PAINT_SCREEN	; ===== ЧЩВПТ РБМЙФТЩ =====
	DCR	A		;
	JNZ	FIND_BEGIN	; ===== ОБЮБФШ РПЙУЛ ======
FIND_DONE:
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;	    вМПЛ ПВТБВПФЛЙ РТПДПМЦЕОЙС РПЙУЛБ.		;;
	LDA	FIND_FLAG	;
	ORA	A		;
	JZ	F_QUIT		;
	CALL	F_READ_STRING	;
	LDA	FIND_HEAD	;
	STA	HEAD		;
	LDA	FIND_SECTOR	;
	STA	SECTOR		;
	LDA	CULINDER	;
	MOV	B,A		;
	LDA	FIND_CUL	; чПУФБОПЧЙН УПУФПСОЙЕ.
	CMP	B		;
	STA	CULINDER	;
	DI			;
	CNZ	SET_CULIND	; рЕТЕКФЙ ЕУМЙ ВЩМП УНЕЭ.
	EI			;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;; пУОПЧОПК ГЙЛМ РПЙУЛБ УФТПЛЙ.
FD_FIND_LOOP:
	CALL	IN_KEY		;
	CPI	0Eh		; оБЦБФБ "F4" ???
	JZ	F_F_INTERRUPT	; рТЕТЧБФШ РПЙУЛ РТПЗТБННЩ.
	CALL	RE_PR_DISK	;
	DI			;
	CALL	DISK_READ	; рТПЮЙФБЕН УЕЛФПТ.
	EI			;
	LDA	FIND_POS	;
	MOV	D,A		;
	MVI	E,0		;
	MVI	A,081h		;
	CALL	ABS_DE		; ХУФБОПЧЙН "ЗТБДХУОЙЛ"
	CALL	PUTCXY		;
	LHLD	F_COUNT_END	;
	XCHG			;
	LHLD	FIND_PTR	;
	INX	H		;
FD_LOOP_01:
	SHLD	FIND_PTR	; уПИТБОСЕН ЧПЪНПЦОПЕ
	LXI	B,FIND_BUF	; ОБЮБМП РПУМЕДПЧБФЕМШОПУФЙ
;; рТПЧЕДЕН РПЙУЛ УФТПЛЙ Ч УЮЙФБОПН УЕЛФПТЕ.
FD_LOOP_02:
	DCX	D		;
	MOV	A,D		;
	ORA	E		;
	JZ	FD_LOOP_QUIT	;чЩКФЙ ЕУМЙ ЛПОЮЙМУС УЕЛФПТ
	LDAX	B		;
	ORA	A		;
	JZ	F_YES_FIND	;
	CMP	M		; уТБЧОЙЧБЕН У ПВТБЪГПН.
	INX	H		;
	JNZ	FD_LOOP_01	;
	INX	B		;
	JMP	FD_LOOP_02	;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
FD_LOOP_QUIT:	
	LXI	H,0400h		;
	SHLD	F_COUNT_END	;
	LXI	H,BUF_DISK	;
	SHLD	FIND_PTR	;
	CALL	DISK_INC	;
;; еУМЙ ЖМБЗ Carri УВТПЫЕО ФП РТПЙЪПЫМП РЕТЕРПМОЕОЙЕ.
	JNC	F_FIND_EXIT	;
	LDA	FIND_COUNT	;
	INR	A		;
	STA	FIND_COUNT	;
	CPI	20		;
	JC	FD_FIND_LOOP	;
	LDA	FIND_POS	;
	INR	A		;
	STA	FIND_POS	;
	XRA	A		;
	STA	FIND_COUNT	;
	JMP	FD_FIND_LOOP	;

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;  вМoЛ ПВТБВПФЛЙ ОБЮБМБ РПЙУЛБ УФТПЛЙ РП ЧУЕНХ ДЙУЛХ	;;
FIND_BEGIN:
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;;;;;;	рЕТЕИПДЙН Л РТПГЕДХТЕ ЗМПВБМШОПЗП РПЙУЛБ. ;;;;;;;;
	XRA	A		;
	STA	FIND_COUNT	;
	INR	A		;
	STA	FIND_POS	;
	CALL	F_READ_STRING	; рПМХЮЙН У ЛПОУПМЙ УФТПЛХ.
	DI			; поб чпъчтбфйф 0x00
	CALL	SET_CULIND	;
	EI			;
	STA	CULINDER	;
	INR	A		;
	STA	SECTOR		;
	LDA	HEAD		;
	ORI	4		;
	STA	HEAD		;
F_FIND_LOOP:
	CALL	IN_KEY		;
	CPI	0Eh		; оБЦБФБ "F4" ???
	JZ	F_F_INTERRUPT	; рТЕТЧБФШ РПЙУЛ РТПЗТБННЩ.
	CALL	RE_PR_DISK	;
	DI			;
	CALL	DISK_READ	; рТПЮЙФБЕН УЕЛФПТ.
	EI			;
	LDA	FIN* +щ"ъя"b"j ш"`"hЇgo"ш"2я22ю!Р#"d"\"f"^"е"г!"~"|"‚"Ђ2Q2/Г·?No Start Address ?Loading Error ?Nothing Loaded ?Out of memory !mГ¤!ЊГ°!|Г°!iНxЇ2Ђ *ъщ!Љ~·ВК4!)Нx>2OЇ2 НЎЇ2НкЪ­ю,К‚юК‚ю/В­Н‚IЕюMВюЂЙюG@ИюRК юSИюUИюXИюYИюEВ4 ЙН(	Нё  ЕГ¦Г  юOВ?2ю ЙЦHВч2юGЙ:°2Н‚ю:ВаХ>` К­Нtлйx·К­юТ­Н‚ВrН‚СГа"ь:	·ДЇ2Ђ шЕ!~жюѕwК«·ъ«:	·К©	~жэѕwВЅ:	·И2 Г—2 *|µИНpЪЖКЖyюИ·ВЖНсЪж~ж@ВЖГм"jГЖНќ*|µИГЖ*ь~жюВЪ: ·:К!юЂНЄ	Gж@ВЃxж В$ГіюЂФЄ	Г
L80    VERS 1.0                                          

 ?Command Error ~·ИНШ#Гx~ж#ю К‚ю
К‚ю`Ъњю{ТњЦ юА+ЙХЕ!Ђ ~·GКИ#~ю В·Г©x+#Кд~ГЅ:O·КЧН>*НШ
Н >
НШ:!	е…o> Њg6бБСЙЦ7КЦфКЦ
В­2	е
!. НћбЙхН‚ю:В­НдсеGЏ‡OВџ:Q·ВџНmле  Н`"~"‚б"|"Ђ*\е*d"\"гНќС*dлН–*f·НЮBK*dл*fеХН©"еЇ2PG<2QСбхГYХН–бzіИ6 #zіВ•ЙхЪ«:Q·В«OНmХНiН}Нґ
КСН`лН–Те!  Н–НiеЕyНгБлгН}ХН–yBKСбеХхН©сOСбНЌН}бсШхе!г	s#rС!|	s#rсШ!Ђ	s#rбЙХлН†Нґ
хФIсбгхесЪ4!Ђ	s#rСбХхН}л!г	схЪIs#rбсеТ\НiлyЕНгБНЌсШбЙ!|	~#foЙ!\ГcХНiН}Н–лСµЙл!dНcлЙХН`Н}Н–НiСЙ}“_|љWЙ>2P*|л*~Н–ЪД*\л*h:Q·КДНґ
ТШ*\л*hН–W{_*\лл#"f"^"еЙ  :юGллН‚OЦ0Ъю
Ъ ЦЪл)))юТКюТ)…o> ЊgГмлyюИ+Й%Overlaying   area <AData Program НOГе!%Нx!8	~#foНx!2НxбЙеГSеЕ  Н`Нґ
ТќеН†лгНґ
блКќНґ
Ъ®б}<КЁ=№ДIеyюВrБбЙеy7ГҐлгЕyM№е7КЖ,КЖН`#лНґ
лбБСеЪќ!хНiГі>	хЕХеж_Н бСБсЙ!>?НШ~#НШю!ЪВу!Г¤ Not Found >НШ>
ГШ>Ђ2Z‰Н 
НnН <Кй>я2аЙеХ:Z·ьV_ <2Z!‰~СбЙЕ‰Н 
Н Б<К›ЇЙ! Їw#Вu!  wЙН(	|µл![К°леНёе!¦НxН*шDMбЕГ¦[Begin execution] :·К§:я·К@*bл*jлНґ
К@~жаю`~В%о@wже+++юЪн>GOќ	~+Вт>‘Кл6 =ВС*bН–Х!њ	Н‡	Ї2яН©	*bСН–л~Oж_ Н–л+++y·т9++:я·ВЙН:ж2Н©	*ш>[НШН(НЦ  Н†е!"	р>G~#ВmЇНсЪЏ~ж@КЏ+^+VНлСs#rХбеН(НЦ*`л*hНґ
КЛЦЕ2SХН№Нл:S·ВАx/Gy/O~Ѓw#~€wСГ›б  Н†:Q·КжлН†Нґ
Тжл Ї•|О ’Н	>]НШН>Г2 *ш":/·Д{Г‹яЦ
Т	хxД	сЖ:ГШ$MEMRY*шй·И!рw#В6	ЇНсЪT	~ж@КT	+^+Vл"шЙе!i	НxбНwЇ2й!z	Г¤?Start symbol -   - undefined 
~ж#ВЊ	НГЅ         RELц7х:ж`ВЕ	  Нp:Q·ДpНЇ22њ
*bл*jлНґ
Кѓ
~жGсхТх	~ж`Вp
/2я:ж`Вp
е~жаю Кo
~·> т

>/НШх+^+V+~НШВ
сю/МШг~ж@В4
:њ
<2њ
>*2яНШНЦ~ж лКG
!ђНxГJ
Н(л~·гт\
НЦ+^+VлН(НЦ:ю?Ож2Мб~·тw
<<жЖ/Oя	ГП	:њ
·КkН:њ
Н	!ќ
НxГk  Undefined Global(s)
 |’А}“Й!76S#6Y#6MН¶>х*bл*jлНґ
К~жO~ж@Ке+^+VлН¦л> Н^+~Н^Вт
>	Н^бс=ВНВ>х~·т<<жЖ/Oя	ГО
сюДВГ4:ю·КMЇ)О0НШЕЇ)ЏВ<Ж0НШВ9БЙ|НR}хН[сНaГШжЖ0ю:ШЖЙНсЙ!8	~#foНxНЦН`Н(НЦН†Н(ГRQUEST НќГ—*b:R·Кмл*jНґ
лКм~ж_ ~еж@Кб+++~Ц#ВбН–*jлН–BKлбеНј"jбГ§бН–л+++Г§Ї2P2R2U:Q·МќЇgo"V"„"†2я"€<2T:Q·*\л*fДЌ*^л*hНЌ*еебНEНpТ?НWГ3ВHНЇГ3е !#		~#foBKйХЕе#:T=лКЊ:€·Вѓ*\|’КxТѓВ}}“Тѓл#·НббНEБp#СЙ:‰·Вѓ*^|’КЎТѓВ¦}“Тѓл#·НЮГѓХ:S=ВЫ:P·КЫеНэлгНvелџжЂw+p+qСБ+p+qляя#НЗBНWе++sбСЙНtю:7> ВлН‚ю[?ШЦ@Шл2
ФtxюЪЕлХК"Н‚ГбБ>
ђЪ3л6 #=т+лx2	y ю.хМtглХxюЪNК[Н‚ГOсКp!~ю Вp6R#6E#6Lбy·Й еН‚ю[Т’ю0Ъ’юAТЋю:Т’Гwю[КЋю]КЋю@КЋю\КЋю^КЋю_КЋOСЙлСХНй:P·Вб:T2SНЗBK|µК/~_q#¶VpНлВРГ/леНэ:S=КтНЗ>Ђ<G:T=Кэ>@Ђw+r+s+Сж@еМjб:T2SНЗr+sГ/>ЂНсЪ3е/o/g	ЪbбГ/~ц@wлq+p*гел>2SНЗл}|б	"гл*\лНґ
ФбГ/!€НxбНw>/НШНГ/~жW+++~НШ+В~Й%2nd COMMON Larger / *гл"„л	|2€л*\лНґ
ФбеНќбГ/> Нс~ц@wГ/ц7хНэ:P·>АКм:T=Кб>ЂG:S=Кл>@ЂЖwсџ<†w+НЗлглХ:T2SНЗ:P·К:T=еМjбr+s+лбглr+sГ/ББГшzіБК6ЇН,л"ш  Нй!„	^#V!ЂН=!гН=yюЪ<:Q·А*\л*dНґ
Вo*~"|  Н†л*~Н–Ъє*\еНб*fл*^Н–BK*fлб"fНґ
Ф©Ьћ"^"\"г  Н†"‚"ЂЙН†лН†Нґ
ЪКл*~лН–Х*fл*^Н–бНґ
Тр!  Н–*^НЮ*dл*\Н–BK*~л*|Н–*fл*dлН©*~"|*fл*^Н–BK*fл*d"fНћ"\"^"гГ­	~ѓw#~ЉwЙPYНй>Н,BKЇНсФІ~ж@ВЌ:P·Вr~ц@w+~_q+ГФлНэ:S=К>ЂЖCw+p+q+r+sГ/е!ћНxбНwНГ/%Mult. Def. Global  ~ж@Ае*+"бЙPYНй>Н,BKЕЇНс~+ЪуN+Fж@лбВ:P·В лzіК/Н[Г/лНCб|µК/:P·В лr#sГ/:P·В |µК/лНлГЛлzіК/#еНэ:S=К4>ЂЖBw+r+s+Сr+sГ/е*#"бЙе!Я~#4В\Н>6ш‡+wбЙ НMxGВeЙЇ2SНMЪНa7ЙНc·КЌНаЇЙеНcюхЪ¦юКПНcНасхюТПХНc!р·wВј4#6 _ъОНaжw#ГАСс! яюВЫ"ЯO<·бЙх2SНaXНaPсюМ‡еКююТюоO !б	N#Fл	џ2лбЙх:P·К!Ї2сгбЙсЙ/qB!ЅЧ АFЙКќ‡іC(#:P·МjХНќб"†л*е>я2‰л*^лНґ
ФЮГ/*елГ–>ЂНсЪ›+^+VНл"зГ/бЕНй:S=ъЄ<2T=В/:P·К/*е	гГ/PY Х7НџС*~лН–ТТ"~!  Н–*е"е  *fБе!  "V}2‰<2TГ/:·ИГЎ*bЕхл*jл|ЄG}«°КC~жOсх®жёВ0р©В0еA+++ѕВ/+ВлбсБЇЙб~·т7yЖ/Oя	ГцБрхЖOxЃеХ_ Н–лНШСбсO°wю#Вl2RеЇ+w+w+w+ВsС·ет‡Їw+w+"jлСБ7Й+@t••ч :P·ИЇ2P*\л*fХлН–лDM*V	"Vл*ее	"еС*^ХН–BKСб"fНћ"^  Н†"~"‚*`"XеНµ С*h|’Вы}“Кл~‡ж_ рЕе!Џ^#Vлй*X"hГ!Н№бгеНлq#pЙН№бгеНл^q#Vp{ІВ1ЙН№бгеЕб#~ж@Х+^+VлглВpБ{ІИr#sЕНл^#V{ІВ_Сr+sЙБГ1Н№бгеЕб~Oц@wyж@+Ns+FrЕХБСА{ІИГ1бе~2	Н№бге*X:	жцАw+r+s+p+q+"XЙбг~+V+^+F+N+ге*~·ъСллж@А	DMЙ>Ъ>Ъ>Ъ> ЕюТо<2=O Хею!fЪю!Z	^#VбюЪ
елН–хyюЪсбхсеТ-yю?Ъ4Н}Нґ
?Ъ4хЕНTБсхyю!\ЪA!d	сСТMs#rГP^#VлСБЙеХНFХН–ЪЎКЎбНќ!zp#Вl  *dе!lN#F#~#foе!tХ^#Vл	СБлгЕе	Блбгле!h~#foлгНґ
СТг!fХ^q#Vpлглбге!^лгл~s#_~rWбглХН–бг}гл·Кнх:U·Клс#МеЕбБеНґ
Ф©ЬћбС{_е!z6 л)лБЕ`iБ{юЪx!zЇ†#В ·Вr*rл*bН–л"j*lл*d"\СбЙЕХ!\yюЪT!d	^#V	 юЪcхя	F#fhюЪnлН–бе!\  Х^#VХ	 ^#VглН–бггчяВ}бСБЙy  Хе!\	^#VХ ^#VбхН–с№ВАбел!l	s#rGyюx ВЈб!tгНигs#r#ВЩбЙxЦКы|W}_ХН–лСллЙХЕыяx2U*h	·НЫЇ2U БСЙлеy•oxњgХл*V"Vл*е"е*зPYНґ
ЪA"зСблЙХ:TюКa=ВWл*Vл!  "VлСЙел*Vл*fНґ
бТWлГWНEВЉХл*е{•OzњGлСЙеХл*dлН–*|DMСб7Йx±Иw#Гћ	ел	+x±Кg~+ГЇx±Иw+Гј:S7=шеЕюМ#о‡O ·Кж:P·7ВтлН}Н–Н`лБбЙ?Intersecting  хЕея НmТOХН}Н`лН–блбБсЙ*\Нґ
џ<Й2ЮНЗШеЕ:Sю?џж OКK:P·ВтН`Нґ
ТтН†лНґ
лТте!хНi>,НШ*Ю& ШM^#VлНxy·В€бН§Гі!рF#~#НШВЌ>(НШбН§>)НШГі:SюџжН}Н–Г( Start =   External   Public =  ёВН                            П#           Ђ                                                                                                                                                                                                                                                                                                                                                                                                    Нo ВњНo2!:·ИНoК№Н`НН†НyюВ§*|л*~Нґ
Ьѓ*d  НЋ НiН}еНiНґ
бВцл*ъллНґ
ФЋyюВЬНiл*ъНґ
ФЋГЎ Нґ
Ъ/л*ъНґ
лЪ(Йе![Г3е!Uе!aНxбНx!iНxЇ2OНЎН‚юYбИГ1below above Origin   loader memory, move anyway(Y or N)? ЕХ лН†ХлН`Нґ
лСКЄНґ
Ьѕт”! Нґ
ЬѕлСБЙЕеy·ВН:Q·КСЇЖю*ъКъЪЫЇOН`ХлН†Нґ
лСВъy·*ъВъ!~НcНґ
Тл! 9щбе;;;;;;лНґ
Ъ?гНґ
ЪлбХН–z·СКC% 7НFЪ9НFКCБББББЙСлБЙлБЙЕХеЕбхНґ
Ъ}сСХхлНґ
Ъ}сТhбБЕеЕблХН–z·КwСБББ7ЙСбСБЇЙБбСБ·Й*\"г*^"е*dл*гН–ВЈіКCтҐЂK PЕ*геН–л"гл!‰НћС*\ХН–BK±С*гДћ*fл*еН–БЕВжіК(№ТжO*\СН–*fЕлНћ"\*fСХл*еН–BK*fСХллНћ*еСХН–л"е‰БНћГЏPY*\Н–л"\*fСХН–л"fГ*fл*еН–Ъ`BKі*fл*\Дћ"\*~л*|"~л"|*е"f*г"dЙю И!7ІЕ~юRА#~юEА#~юLА®:жКЈ±w+ВЈЙCOMHEXЪЕ‰Н .НnН .Н <К€Ї2ZЙ  :Q·КщНoКч*~л*|Нґ
Ъщ!~жКє
Х~жКМН?yоO:Q·Д?>:Н^ЇGН«*шН¦>Н«ЇђН«НВ>Н^Г Н†лН`лХН–{ІбИЕеН}Нiл}ЖO|О G{‘OzЪm>ГpyЖ·ВwББЙO >:Н^yН«гХН¦ YСгЇН«~#Н«В’ЇђН«НВГX|Н«}хНјсхНјсЂGЙНaГ^>Н^>
Г^*ш |µКяНґ
КяН`Нґ
 Ъя>ГН^*ш}Н^|Н^Н4НH:Q·К Н†лyоOНoК Н4НH:Z·Дx.Н <К€ЙН`Н–ШіИЇН^zіВ=ЙН}НiлН–zіИ~#Н^ГRХех!‰:Z_ сw{<ьx2ZбСЙЕ.Н ·В€БЇЙ!ЋГ¤?Can't save object file е!) Нќ !/ Нќ !2 Нќ !8 Нќ ##Вї##Нќ ##ВМ#Нќ !y Нќ !„ Нќ Х*d"€ л*\Н–л"† *|"Љ *f"Ћ л*^Н–л"Њ *~"ђ СбБщЕл% m Г%   Н’ Г+   НU ЪF  НU Фk Ь{ НU Гk Н{ НU Фk Ь{ Й!† 	N#F#^#V#~#fo|’А}“Й	л	+x±И~+Гp x±Иw#Г{             x±Иw#Г’ ЕеХ~#fo% Н–лСеБбq#pБЙ:A!·ИеС*hНґ
Ил~жю» ЕеКtН№бгйН!:т2@!*г"\Ї2€Нэ6Ж+:@!wГ/Н№бгеzхН!с2@!·ИГ6!:A!·ИН!*г"\Й:@!·И2A!  Нoл*гr#s+:@!Гh!*гНЎ!"\Й  Ї2@!2A!!Ї# p#ВO!!рN#Ї#~#В]!Г/еХr#sН#Но"С{жК„!{жЂЖЂ_Т„!zібКќ!ХеНЖ"бЂ гЂялГ„!Нў"ЙеН#НЩ"!-#Ні"!-#V#^бНх!Ъм!ХЂ Нэ!Се!ЂялбНх!ЪЭ!ХеНі"бЂ ГВ!zіКп!е!-#ХНі"СбНэ!еНў"бЙz·А{·ш7Й-#zіИ
w#Г "жЖ0ю:wШЦщwЙ:­#!:"хН"+сН"!0"Гx?Segment    ,  file not found can't create file read error Disk is full Н"!?"Г¤Н"!N"Г¤Н"Нў"!`"Г¤Н"Нў"!k"Г¤-#Н ®#Н ЙлН ®#Н ·ВЉ"ЙлН ®#Н ·В–"Й-#Н ®#Н <Кx"Й-#Н ®#Н ®#Н <КЃ"Йх2­#!№#Н"с+Н"##Ї2®#w#В&#Й                                                                                                                                          V                                                                       $‡o& 	е^#V*M8Н6СШлs#rЇ2a8Й*U8##Г$х:j7·КC$:a8·КC$ЕХе*O8л НРбСБЇ2a8сЙНZН{Нй
ю"К\$ю'ВШ$GНЬ
НЬ
*Б7++её К|$НЬ
юКѓ$ёВo$Нќ
ёКo$Нй
Н{ю,К™$ю;К™$ёК™$юб"Б7ВШ$yюЪШ$НЦ
GНЬ
НЬ
Г»$ЕНУБНЬ
юИёВі$НЦ
ёКТ$Нќ
ю,КI$ЙНУГI$Нх:$9·ъсНУyю,КI$ЙНIхxжѓДЄсЙНZН{ееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееее!
ГGMAC "'@</W ")@Ї;!м<_s#x±В!5O"A=w$$$$"@  	"@! ш"Г>!+@й=~·КvхжO#~ВQеНьСсжшw#6 #wлГDН„K>2м<Ї2@2Ѓ>2-=2у<2ф<2и=2х<2ъ?2д=!Т=
w#В—<2(=2.=2/=2С=>
2с<:€@2к<:Ќ@2*=>;23=<22=! "4=+"@+"6=*'@щ!Ме!6еЇ2[?21=2+=29=2ы?<2)=Н?беьЕй!H="F=„~№М#юКВБбеЕRЕйхе*4=#"4=!яя"6=:2==23=бсЙ!9=>2@2@Н–ю
КCНЖКC·тlжКCНЖКCю0ЪCw#ГCѓ!H=ю
КЋК~w#юВЋw:9=·И=28=ЙН–жГq:,=·КЁНфNРЇ2,=Н4OНMЪЇЙ! НМF>2H=НоJ>
НоJ7ГІ-юАГ!  "C=Ї20==2ы?*Ъ="Ю=:H=ю*Вн>$2H=Ц$2E=НUВю:К‹:E=·В$:й==В$НU!й=~ёТ4#>$Nwy#В*F=+~#юКїеН+НUНВЃ~·тЃ#~ю"КRюКRюВЃб*F=+"F=х:(=·КkН+схюКs·НьН-сю"Кx-юКЇ7ГD-б"F=Н+Гї:(=·К№Н1НьН-"C=лНjлц хН#ю:Вµсц@хНк
сНЫНUВН6:(=·КПНК’8НВ·х:(=·Вистlхж`Кkсты#~!
‡_ ^#Vлйж#NхН1!и	сГсю;ИюИ!H="F=*C=|µДU:(=·КlГЌ'!й=ь=Nwy#В3Й!>">!>  q#ВKЙН6НИ·КUеюКlю;КlННхсб:м<·В—:>юVК‹юMК‹юDК‹юXВЮ2[?НН~ГЮН+ГЮЕAГиЕCГиЕDГиЕEГиЕMГиЕNГиЕOГиЕPГиЕQГиЕRГиЕUГиЕVГиЕXех!>~ю Вьp:Ф>ц2Ф>сбБЙ%No END statement ГБ:к=ю.КЉю$К’ю[<РЦB·ш‡ЕХ_ !^#Vл:й==O~·К†·ъ[:к<‡~ВVюPТ[ГzюPТzж№Вzл=еA##ѕВy#ВhбЇ~СБЙб~жЖ_ Г=СС<Й!H	ЕХГ8!Р	ГЌМыjё‡®ЇЭу1UVТ%	,	-	.	/	F	G	*ОCI€DCR DCЂDDRDD*ЖDI NARND*жNIѓ SEGѓ"SET ZITѓ>YTE 3НALLSALL1ЬCj?CF1ьM/MA?MCёMP2ФNC2ДNZ…OMMONГOND1фPQ
Pr©PDs№PDR2мPE*юPIrЎPIs±PIRj/PL2дPOѓSEG1МZ 'AAj'AA	ADЃBЃC"CRCXRECѓEFBѓ"EFLѓEFMѓEFSѓEFWуIiуISJNZЃSѓSEGЃW ыIiыIГLSE‚	NDЈ
NDC¤
NDIF‹NDM„NTRY‚QUQXjЩXX„XITM‚XT‡XTERNAL„XTRN  … LOBAL kvALTvLT БFВ2FBД9FDIFВFEВFFД:FIDNГ3FNBВFTaM)ЫNQNRNC†8NCLUDErЄNDsєNDRrўNIsІNIR"NRNXВF1ВF2ДFDEFЕFNDEF’RP“RPC 1ЪC1ъM2ГMP2ТNC2ВNZ1тPQP2кPE2вPOQR1КZ  QD2:DA
DAXrЁDDsёDDRr DIs°DIR3*HLD„OCALJXI …8ACLIB”ACRO:@OVBVI ѓAMErDEG OPj OP QR°RA‚RG*цRIs»TDRsіTIR*УUTR UTs«UTDsЈUTI ѓAGEйCHLБOPR"OP… UBLICЕUSHS$USH  ALARШC“!EPTZ&ESЙETR(ETsMETIsEETN IMY*LjLALCZ,LCkLCAroLDшMРNCАNZрPиPEаPOY.RjRARCZ0RCkRCArgRD"ЗSTR2STИZ BB*ЮBIR4BCj7CFZ6ET‚"ET3"HLD0IMZ8LAщPHLZ:RAZ<RL22TATAX7TCђUBR>UB…#UBTTL*ЦUI „$ITLE    лCHGR@ORЁRA*оRIгTHL   „68080ѓ7Z80‡%COMMENT„&CREF‡'DEPHASE„(LALL†;LFCOND„)LIST…*PASS2…+PHASE†,PRINTX…-RADIX‡5REQUEST„.SALL†<SFCOND†=TFCOND„/XALL…0XCREF…1XLIST …EJECT‡8INCLUDE…4TITLE yЂЏћЄ№ЗУфhknytп&Ћ,'Ќ'>(ѓ('Ч()І-к((5‰*Б5Э,Э,)‡)‡))”)ћ)Ё)©)h6f6(5БC,~&ѕ+‰*A4Бѕ*µ*i7+†9M++[9;7’+U+\+!++г)д)й*к+ѓ+‹+,ш)ч)d+h+m+'-€Ђ  @Н ё 
F Г"  °  Б ЕЂ  ЗА (8 ђ Ё5„vїйѓCНdђЈП}µ е*F=~#"F=юКл
oюAТю0Ъю:Ъ7џ}бЙ·бЙю[ЪюaЪю{ТЇ}бЙНк
Г6Нк
хюВЗНБсе*F=+"F=бЙ*F=#"F=ЙНк
АюaЪSЦ їЙНИН6!к= q#Вa!й=6 #Н±Д2ж< юaЪЦ w#yюКџН±тxНЪТ—тxGy2й=ЇxЙН±тџНЪТ—тџГ—Нк
рю$Ию.Ию@Ию?Ию_И/·/ЙНк
рю КИю	КИ/·/Йх·Кдю&ВЗ:ы?·ВнсЙсН±·Кою&КоН6Н±7ЙНЪТ	ИБ GЙ!r?:й=хН'К"с2й=·~ЙБЙ!ґ?НЬ 		"p?^#V!g?	Їw#В:!й=~юЪK6!й=NzіКѕл^#VХ#^#VХе#~=Кy л=GѕВ‹#Вnб#~=№Вё#"?=#~+ББЙ?џжбхлхХj?!g?w#ВџСсw#s#rсбСКPлГP+>Гђ<*A=~Й*@####~·7И#еЖ _"@бЙ:к=ю$ Ию.Ию?Ию_Ию ИЦ;OЙхН$"?=БхЕсН“сИе*n?лzіКО:m?л O	Сs#rлЇw#В&й=юЪ7>wG#Їw"?=#w#w#w###w#ВI"A=####p л*@НЌЬ ;*?=|·> Й!xНМFГ ?Symbol table full
 |’А}“Йх:м<·КЗ:Њ@·КЗ:-=·ВЗ*?=~ж@ВЗсЪ№>‚Ъ>ЃНvLе!й=F#~НvLВГбЙ*p?ГхНГ G~ж8В#~ж В+~цЂw#~°w#s#r#Хл*Ю=лs#rСЙ~ж@w:к<·МН#Гй~ж”Дa~ЁжДa#Х^#V#гНЌДRСе*Ю=лxжюВD{ѕДa#zѕДaС:>ю *?=#КйЙ:0=·Вa*?=~·тЗех*?=#~цwxцGсбГµ>нНLyНLГ@ЕНZН6‡‡‡БЃГLЕНZН@‡‡‡БЃГLЕНZНRБЃГLЕНZНRБ‡‡‡ЃГLyхНZOсНLyГЩyхНm-сНLГХЕНZНRБ‡‡‡ЃOЕН*НZНRБЃюvМќГLЕНZНRБ‡‡‡ЃхН*НZOсНLyГЩЕНZБН@‡‡‡ЃхН*Нm-сНLГХН6Нк
ю,ДБЙ·ИюИжГќюхТKжКNНќсжЙюШжГќНm-z·Кf<Дќ{Й ЛнY !„
^#N!Ж
^#VлйЕНZюФќНBБxНL{ю?О ж‡‡‡ЃГLЕНZж8»ДќНBБЃГLЕНNЬќжДсБНc:и<жГњНѓ :В>·ВмНH:з<ю0Д:и<жАГњ>ЙГL:и<ж ЖЭНL>2и<ЙюВќ:и<<юК=юВќ<2и<ЙЕЇ2й<НИН6ю(В-2й<Нm-yЦ,Б·АНH:з<ю0Д7ЙНТ]Д:и<‡‡‡ж8ЃOЕНm-НBБyНLГХНЪ‹:з<ю ?Т]ю(МсН[:и<юДќНH>йГLВГKНТ«:и<юФќж‡‡‡Ж OЕНm-БН·yHНLyГL:Б>GжЂВЇНBxжGНjёВУюВвХ*Ъ=л*Ю=НЌСВУНj##лНT9z·CКы<Вќx·тќЙx·ъќЙЕНm-БГ«Н*ЕЇ2й<НИН6ю(В2й<Нm-Б:з<·Ию0Мќo:й<·}КHю(ВHz·КM<WКMНќzіДќЙН:з<·Кќю Й:й<·МќЙ:й<·ДќЙН:з<юА:и<юШГќНkН*Н[:з<юКЇ·ДќН;>УНL{НЩНNФќ:и<юДќГc:и<=ДќНNФќНc>нНLНcНnAГњНNФќНcНnхН	Н[:з<юК ·Дќ>ЫНLсюДќН;{ГЩ:и<=Дќ>нНLс@ГњНNЬќН*Нe КR:и<юКfюДќН[НNЬќНcНH:з<ю(Мс:и<юДќ>гГLНcНNЬќНe Дќ>ГLНcНNЬќ:з<ю Дќ:и<юДќ>лГLЕНZюФќж‡‡‡БЃOН*Нkц7х:з<ю(хМсбсех>ЛФLсЪєс{МЩхх:з<·Мќж :и<ВФЃНLНcссЙюДќ>ЃНLН[сТЗГ/Нk:з<·МќюК"ю(хМс:и<юВ:й<·В*НcсyюВ:и<жГњ:и<жГњ>Н%с{МЩЙН:з<·КiюК`ю(хМсН[:и<жюДќ>ЃНLГ/:и<жЃГL>FЃНLН;{ГЩНNН*Нc:з<юКґю Дќ:и<юДќ>нНLyожЖBOНNДќНe МќНcГ:и<юДќГ5НNН*Нc:з<юКґю(Кв:и<юДќ	Гў:и<хНсНNЬќхНe МќНc:и<юМќGсxКсёДќ>хБж	Гњ:з<юДќЙН:з<·К[юК4:й<·КБ:и<жюК™ФќхННcН:и<юДќсГњХН(Н[:Ѕ>х:Б>хН	Нc:з<·Мќю Ъ±:и<OжюКЎ>нНLyCНњН(с2Б>с2Ѕ>СГХ:з<ю(Мс>"НLГ’:и<юДќ>2НLГ’:и<хН	:з<ю Тс·Дќ:й<·В
схж`ЖќюАФLсжНњГХДссюДќНc:и<юДќ>щГLс2и<OжюВ$yю@Фс>*НLГХ>нНLyжKНњГХНc:и<юТ}хН	:з<·В^:й<·ВКН;сНњ{ГЩ:з<юМ
ю Вs:и<юЪШс‡‡‡Ж@OГњхН	Н:и<юДќ>нНLсжGГњ:и<ХхН(Н	Нcсхж`ЖќюАФLp:з<·КйНњН(сСю@{ФЩЙсюДќ>:НLГХН[сюДќ:и<
ГњН;Нc>6НLKBН(сСю@{ФЩН(YPyГЩ:и<юO:з<ШбсюДќ>нНLyжWГњЕХе!Ф>?AFwx#В3бСБЙх:з<·ДНсЙG:м<·7Дbе*Т=#"Т=бВ'ЙеХЕхНh'*>'>НЌЕФ+Б*>л:Џ@·КУ`Ї)Џ)ЏЖ0Ї)ЏВ‘Ж0ВЋлсхЪК:Ф>ж ККжЂВИ:Б>жюЪЕКВ6!6"6'6*#">сБСбЙНГџG:Ф>ц@2Ф>:м<·Дbе*Т=#"Т=бВюЙ:Ф>жї2Ф>е!Ф>~жКНЇ~ж@Гґ~ж К№ХЕ#~ж?Gx·Кљ#~·ъ72Н>>AНѕГжЪhюВS#^#Vл"Ю=лЕGНѓБ2Н>#^#Vл"О>л>CГ1#^#VЕел+~юЪz><2Е>= 	GМ>>B#~ВЉНЕбБГ:Ф>ж@х>В§>2Н>>AНѕсБС М'Н'бЙ2М>{2Е>Ее!Ж>"?=Н©бБЙ:м<·ДЙе*Т=##"Т=бИ:Б>G:Ф>ж@xМ“:Б>GНѓ*>жѓВ#">CН'BГ'xжЂЕВ&xжюъ7К46!Г96*л*ї>##~#foл6"6'Б##">НѓxжЂКP:Ф>ж@ВцxжЕК€Н:CН+BН+БxжЂИ*Т=++л*ї>#:С=G~жь°w#s#r#л*Ь=лs#rЙCН'BН'Гbх·тЗ:ѕ>2Б>:Ѕ>·КЗеЕХxНѓжВіzі	Д©Ї2Ѕ>СБ*ї>#~2Б>бсЙхеХ*>#>НЌФ+*>лбе:Џ@·КЇ)О0ЕЇ)ЏВсЖ0Вол">БСбсЙЕDНEНГяxНxжЖ0ю:Ъ(ЖЙхЕХеН:*=·КG:)=·КG:(=·КN:/=·ВS:>ю Д~:>ю Кo:ґ@<Кo2[?Н~Ї2[?<2+=Н?Н1бСБсЙ:ъ?·Кї=Вџ:ы?·Вџ:.=·Вї>+2+>Гї>+2+>:>ю Вї:.=·ъїИ:>ю И:1=·А:,=·КЛ>C2*>:[?·Вэ:/=·ВЯ:>ю И!3=4:2=ѕМp:[?·Вэ:Њ@·Кэ>ѓНvL!> ~#НdВ:+=·ВZ:ъ?=ъ#В#:ы?·К#!9=~#ю0Ъ6НdВ(>ёВC:8=·КH>	Нd!H=~#юКZюДdГK>Нd>
ГdO:[?·yКvLГоJ>23=:/=·КЌ>НvL!1>НХ!чНХ*4=#|µ+х:/=·К¤схКННЯс*6=#"6=:/=·И|µКѕ>-НvLНЯНZ!Ѓ>НХНZГZ>SНvLГ¤~#·ИНvLГХцяPX	Ъдел|µДв>:БЃГd	MSX.M-80 1.00	01-Apr-85	PAGE	 :>ю ИюQК)*н<#"н<Й*п<#"п<ЙНjх:м<·КЗ:>ю ВЗсл!>">НЙжЕO !f	~*>w!>">БЙ '"!*Т=:д=·КХл*е=С:з=Й:С=ЙхЕxжюВ¦Хе*Ь=л*Ю=НЌ"?="Ь=Д©бСБсЙЕ Н:A>НБyюЪРюИ>НCН+BН+yюРеюКЭюВЮ*?=+~ёЪиxGW>Н#######FyюКxжGН+#ВцбЙХW>’К_x‡ВGx‡GНFВСЙЇНFЕxGНFВ.БЙ7НFxНFxе!Г>~w#4ВZНЭL>ш2Д>бЙЕНUБКCтю К\ю	К\ю'КГю"КГю(К¬ю)КЇю+КІю-Кµю*Кёю/К»ю;КЁю,КЁюДБЇГА>>>>	>
>>юЙ!  ЕGН)ёВЩН#ёВщН)o2в=Н)ёВпН#ёxВфН)eoН)ёБГnв=·В=xГф*F=+еНHт2в=*F=++"F=НHб"F=ВыюGТHg:с<юТыo|юDКHюBВы}юТы|юBКwюDК•юHКќюOКdюQДБВ•НјюOКqюQДБ лГѕ!  НHюBКqЦ0ь»юФ»)·Кz#ГzНҐюDГnНХюHГn!  НHИшЦ0)T])) _ГЁ!  НHИшЦ0юФ»)))_ Гї!  НHшюGТхЦ0ю
ЪкЦ))))_ ГШюHИГ»:т<·В4!  ЕНHъ0Ц0ю
ЪЦЬ»O :с<=№Ь»<_PЕНc$лБ	ГБГ=НҐГ=НјН6ГqЕН6:й=2в=юТї=КдН$Кї!  КїКo#Гgк=ѕВb#Вt!S 	~юВЊ2л<Б·тАНИяяю;К№юК№·В°Нк
ю&Мк
Г—Нк
юВ°Н6Гѕ*F=еНк
ю#ВнНк
ю#Вн7НьН-#~Gж ДµxжцЂwБ+Г!б"F=Н$Кt:к<‡КНК®:л<·К7Н“Н$К!Ї*@wГ!7НьжЈGжЂxК22ѕ>Ђ"ї>жД©:к<‡> ВC~ж@·x##^#VБOКQ жюВbХ#^#Vл"Ю=Сyж yВѕжЂМЩ  Гѕех7Н“сб"?=~жюBЪЁ~ж8х:з<·ДБс2з<##~2и<Нe Мz +~+Г!#~+Г!·ъ#^жxO B!Ъ	~·КФюВО2З>Б ГАБ Гѕ   :к=юXВ  Н#ю'ВїНк
НХю'БГnю$ВїНjлЖ БOГѕXOR AND NOT MOD SHL SHR OR  EQ  NE  LT  LE  GT  GE  LOW HIGHNUL TYPEя:з<ю А:и<юА:ж<юAИюaЙН#ю'Мк
ЙЇG og2З>2Ѕ>2в=2л<2Ф>2Х>2У>2з<2и<9"И>л*)@НЌТ4ЕН\ъ!К]!юъ~!Кт!юЪО юЬf!O2Ж>Нѓ!=ёyТ"юК"ю	К"Н?"y2W?НЋ!юК<!·В!:Ж>юВ<!МБЕГ<!ЕНѓ!х:W?OсНf!G:Ж>ГО хН6Нк
ю,В8!:З>·К8!сЇ2З>>ГО сГџ!:W?O:Ж>юКO!ЕНf!Г"БЕxНѓ!G:W?OГ`!НД"Нf!Гі бХ_yжю{Вy!л*Ю=гелYХйGЕГі Х!ы"_ ~СЙбБxюВћ!НБЕЇGюйб|юџ2В>еН?"y2W?НЋ!ъП!юКF%Е:W?OНf!ГЁ!  Н@Ї2W?:W?G2Б>жOКЮ! xжЂ±!Ф>¶w*F=+N{*И>щЙ2Ж>СzюМБ·МБХГе г|г=Ке yБWЕx=zК6"zюК6"юКі юК6"юК6"юК6"ю	ДБ>GЕНѓ!GГі б"Y?Сz·ХВR"  Х ХНЄ""а=л"К>лy2W?НЋ!ъЎ"ЦКЎ"2X?юК‹"юК‹"юК‹"юК‹"юК‹"НЄ":X?*Y?е!#‡…o> Њg~#foйЕ:W?O*Y?йбБДБК¶"ЕйСyжюВ}!г"Ю=ЙхХеyжцЂНМ%жюВг"Х*Ю=лНу"СГм"юВм"*ї>лНу"бСсЙ{НМ%zГМ%					



P#Z#d#n#П#ю#N$ћ$%ќ#®#Q%\%h%u%{%„%¶%§%…#ф% &&&-&C&c&Н„$zґW{µ_ЙН„$z¬W{­_ЙН„$z¤W{Ґ_Й*К>|/W}/_:W?Oжѓ>ВВ%ГМ%*К>|/W}/_:W?Oжѓ>ВВ%ГМ%Н„$лzіК¬#)Гў#лЙН„$#+}ґИzW{_ГІ#*К>:W?жЂИyжЂьЇЙНа#:W?±OжѓюЂА2Ѕ>Й:W?ю Ко#*а="Ю=*К>лН”$>ВВ%ГМ%*К>НG$:W?жѓъ%$К%$yжѓъ%$К$$:W?№В%$ Г?$=х:W?жѓВ9$yжѓюЂВ9$2Ѕ>:W?±Oс>ВВ%ГМ%{•_zњWЙ*К>Нi$:W?±Oжѓ>	ВВ%ГМ%Нi$ ЙDM!  >=К‚$)еЕб)гБТp$Гp$лЙ:W?№ДУю ДУ*К>Й:W?жѓИyжѓЙ*К>Ні$:W?±Oжѓ>
ВВ%ГМ%ЕлzіМБz·Bь%|ЁG|µКШ$|·ль%ЕНЫ$с·ь%ллБЙ|/G}/O!  >х·Гц$хе	Тх$с7>б{_zW}o|gс=Вм$|·g}oЙЇO“_yљWЙ*К>ЕлzіК5%|µК5%|ЄхХлНі$лбсь%ллБ:W?±Oжѓ>ВВ%ГМ%>OЕ!ХЕGГиН™%НЌЦГo%Н™%НЌЦ?Гo%Н™%лНЌџW_ ЙН™%Г€%Н™%НЌГo%Н™%л{•_zњЪo%і7Кo%?Гo%:W?№ДУНL&*К>Й*К>\ЇW:W?O>ГВ%*К>]ЇW:W?O>х:Ф>ц@2Ф>сех!Х>4~ж?Кв%…oТЮ%$сwбЙ5yжѓКс%:Ф>ц2Ф>сбЙН„$}НRжѓ_ЙН„$}НRжѓ_ЙН„$}Н@жѓ_ЙН„$}Н6жѓ_ЙН„$}НRжo{НRж…_ЙН„$}ж?ѓ_ЙжюАеХ*Ю=л*а=НЌДУСбЙ:W?_  :>ю ИюOВx& > 2>ЙНФ,Нѓ лxж КЯЇ2и=xжGК±&:С=ёВУюВ±&е*Ъ=л*Ю=НЌВУб:С=Gл*Ъ="Ю=:м<·Дѓл"Т=л:и=·ВЯ&:м<·Д©:\?·М2':\?·ИЇ2\?НUКНЙН2'Н1> G2С=<2\?2и=*Ф=Гµ&Н2'Н1>2\?G2С=*Ц=Гµ&Н2'Н1>2\?G2С=*Ш=Гµ&:\?·ДФ,:С=Ф=жюК`'‡o& 	е^#V*Т=НЌСШлs#rЇ2и=Й*Ъ=##ГK'х:м<·К‡':и=·К‡'ЕХе*Ф=л Н©бСБЇ2и=сЙН1НИН6ю"К 'ю'В(GН)Н)*F=++её КА'Н)юКЗ'ёВі'Нк
ёКі'Н6НИю,КЭ'ю;КЭ'ёКЭ'юб"F=В(yюЪ(Н#GН)Н)Гя'ЕНLБН)юИёВч'Н#ёК(Нк
ю,КЌ'ЙНLГЌ'НZх:в=·ъЗсНЩyю,КЌ'ЙНѓ хxжѓДУсЙН1НИю"КN(ю'ДќOЇхН)юКЗ№Вd(Нк
№Вo(GсЕ·ДLсГP(Бхx‡xК|(цЂНLсю,КA(ЙН1НД(Нh'yю,В›(ХНZCСГ¤(:‘@·К№( zіИ*Т=#"Т=:м<·Д'Г¤(*Т=:С=GГµ&Н2(:м<·А:>юUА<2>ЙН1Нh'Нѓ НХyю,КЧ(Й:у<=ъ)G2у<:ф<=ёВ )2ф<:ф<ђџ<2(=Н?)2х<Г@НЈЙ:х<·ДЈ:у<·МЈ!ф<–К;)=В@4=2(=<2х<Г@5Г1):у<_ю2> РW!ц<7~ЙхН?)х<Т\)wЇ!у<4:(=·КЗс2(=!ф<·Кv)4Й:у<=–2)=ЙНС)zіГP)НС)zі/КP)ЇГP):м<Н@=ГP):м<Н@·ГP)ц7х:(=·КШ)НUН$ВА)ж ВЛ)НКЛ)сџГP)с?џГP):(=·ВД(БЇ!‹"F=ГP)ц7хН2*ВШ)"F=x±КЛ)ГЖ)ц7хН2*ВШ)ХЕ~ю,В**#"F=Н2*В-*"F=yБб№ВЖ)ѕВЖ)#В*ГЛ)НБббГШ)НИю<ДќН#·ВR*Нк
Н#ю&ВR*Нк
Г:**F=+  #~ю>Вb*T]ю,Вl*zіВr*юВY*#е*F=zіМќл}“O|љGб:>ю ЙНUOЕДќ7НьН-#~ц@wБж МЩ~жЂДµ¶wyю,К‰*Й1> OГЕ* Ѓ>;НИ*F=+~#юКв*№Кв*КМ*ГМ*Ї#"F=ЙНИю(ВќН)ю'ВќOНА*Н6Н)ю)ДќГ@>2/=ГY+Ї2/=ГY+Ї2-=ГY+НUВG+КG+хНД$В:+~ц@wсю,АНUВБГ,+>2-=Й>я2.=ГY+Ї2.=Г@>2.=ГY+ЇГ}+>яГ}+:Ќ@/o:м<·КY+}2Ќ@2*=ГY+>2к<ГY+Ї2к<ГY+>я2т<НД(Ї2т<z·Вќ:>ю А{=шКќюТќ<2с<ЇgkГ4НД(z·Вќ:м<·И{·Кб+ю
Ьќ:>ю Вб+{22=Н+Н?ГpНUВќх:й=юЪю+НН>!г=w#"?=:м<·Д©сю,Кк+Й:,=·ВБНИ*F=+НqN·К1,Н4OГЯ=2,=*F=~#"F=ю!Т5,ЙНИю(ВќН)ю'ВќНUВќю'ВќН)ю)ВќН@:м<·А:й=юЪx,>к=!]?G~·Вµw#В„,pЙНФ,НИю/ВќНUДМ,ю/ВќН@Нь#~жРВµе~ц$wН2'б+"Ъ=>2С=!  "Т=Г±&х>2й=сЙ:д=·ИБГЗЂ НUВ-х·ХНьН-С~Іw#~жdВ-~жіwсю,Ка,ЙНќГ -цwНµГя,~жюBШЇwеЇ#w#w#wбЙНUН~‡ФБ#~юК>-юДБЂГа,"C=Нm-:>21=юUИxжЂВЇxц 20=*C="?=НЫлxГ4Нѓ :В>·ИГН"C=~цЂw|21=Нm-xжЂВЇ*C=Н-#~ж”Вµ~ж@°ц w#s#r#Хл*Ю=лs#rбГ4хНёK:ъ?·Дw/:у<·ДЁ/с!м<4~=ВZ.!]?~·Вв-!1>~·Вв-!Х@# ]?~#ю К.ю	К.·К.юК.Ви-!V?p#"?=Н©Н2'!5O"@НДЪA."?=~жw#~ж@Вk/~жК.#^#V Н©Г.*Ш=л
 Н©*Ц=л{ІД©Гn*F=хФѓ ХЕН+!яя"4="6=}2/=Нp!ф/НХ!3=44!r?>Н—;НZ:3=ю8Фp!3=44!й/НХ!ґ?>Н—;НZНґ/*н<|µКЛ.еНЯб:ґ@<2[?ДЯЇ2[?ГС.!L/НР/!O/НР/*п<|µК/>,НvL:ґ@<>,ДоJеНЯб:ґ@<2[?ДЯЇ2[?!_/НР/Нґ/БСсТ/   НѓН©*Г>|юшК,/ЇНFГ/ Н© Н+:Њ@·КC/>ЂНvLНЫKНLГ No  Fatal error(s)  Warning(s)  :С=GН©Г.НН/!†/НР/Н)Гґ/REPT/IRP/IRPC/MACRO Unterminated  НН/!Э/НР/Н)>НZ>
НZ:ґ@<И>НоJ>
ГоJ!љ/еНХб:ґ@<ИГМFConditional Symbols:
 Macros:
 !вя9л*)@НЌТ4:ъ?·!  "#@"%@*ш?В#0*)@+<2ъ?Ї2ы?2@л*@$НЌТ>0л"ш?Й%леНO;бГ.0НА~·<р=хжКr0:@<2@сжоА:@·И:@=2@<Й#~юВ^0:@·В^0:@·В^0с7Й"ш?:ъ?=2ъ?ЙНк
ю&ВС0*F=~ю КП0ю	КП0еЕНUНЭ0Бб"F=ВП0>&2ь?Г>1ю&ВС0:ь?·ВЦ0>&Н;:·шхЇ2ь?сЙ*@ ~·К1й=ѕВ 1O+ѕВ 1Вр0xцЂїЙ+~юТ 1Гв0:@·А*@А~·К<1й=ѕВ11O+ѕВ11В#1ЇxЙ+~юТ11Г1<Й*F=еНUхНЭ0Вw1Gсбх~#ю К\1ю	Вd1еНС0бГP1xНС0сGхсВГ0ю&ВГ0Г6сбх"F=Нк
ю Кђ1ю	Кђ1Н6Г–1НС0Г}1Н±Вk1ГҐ1Н±ъk1НС0Гџ1Нк
ю;КЗ1Г№1НЖ:НС0юКћ:Нк
Г№1НЖ:НЖ:ю КК1ю	КК1·Нн:"%@Кћ:юКћ:>Н;:Гћ:ех:@·Кя1Хл*@4Ссжх‡ъI2*@~·К82сЕG+К#2~Х/_яСГ2~·КF2=G+~КF2НШ3Г*2с+<=КC2+Г;2~бЙБбЙ>.НШ3НШ3сж?Е*@O 	DНEНБбЙеНUбД‚2хй=<Ow+Вx2сЙюИю;ИСГќ Ее+НИю'К}3ю"К}3ю<К›3ю>К¦3ю%КУ2ю,К°3ю К°3ю	К°3ю;К°3ю!М)юКН3w+Нк
Г”2"{3Еq3ЕНД(л :>ю В63:с<юК.3юК3цяPX	Ъы2ел|µДщ2>:БЃГf3Ї)О0НR3>хЇ)ЏВ3Ж0НR3с=В3Г63DН>3EН>3А>0Гf3xНG3xжЖ0ю:ЪR3ЖВf3ю0ИOю:Ъf3>0Нf3yе*{3w+"{3бЙБН6*{3ГН2  Ow+Нк
№КЏ3юКТ3Г~3w+Нк
№К~3Г”2Кў3w+ГН2КН2ъµ3ГЛ2ВЛ2С{•=Бл*F=+~ю М6ю	М6лЙКµ3НеГµ3хе!К=НЌТл3#6+лбсЙбсЙН>1ю&Кр3ю:К>1ю!РюИхНК4НКЗсГ>1!4Гr?Stack overflow, try more P switches
 НД(:>ю КO4  л"э?Ню/БСбc4ЕХ>Г\Б^4ЕНUю:МUНH0К„4H=Н;:юВy4ЙЇН;:Нћ:БСб!МеХ*#@ее*э?е!Ме!¦4еЕЙНщ4БбСНЌВХ4:@·Вѕ4x±ВХ4*ш?еН”9бНЉ0Ї2@СХ*я?елйХНr:·К5H=Н€:НШ3юВа4еЕ*@е*@е*я?йСб"я?б"@б"@лйbkГ«4:ъ?·Ке2@БбС+5ХеЕЇ2@Г@ГБ:@·КЉ5БЮЕНUю:МUНА·рOжВ^5yжВf5yж Вn5yж@В{5Й:@=2@Й:@<2@Й:@·А:у<·ИГк(:@·А#~юИ>яГP)БСб!МеХЕЙ·хНю/"@Нi2O:>ю К°5*@НЉ0сЙy6 +ю,ДќсхКм5Н)ю<Дќсwех +:>ю ВG6схGКъ5НЊ2юКD6ю>КG6ГЫ5Н#Ц<2@Мк
ГЖ5Нк
юК=6х:@·К6сG6Хю Ию	Ию;Ию,ИСГ76сю<К36ю>В76КG6Г76Г76w+Гъ5:@·ВG6НН6 +Н.0x·Дќсб"	@& i"э?БСбm6Г\4ЇВ>Г”5Б^4Е*%@>2@еНр3хНH0К±6сбюК¶1ю;К«1ю'КЎ6ю"КЎ6Н>1Г‡6GН•0юК¶1ёК›6Гў6сб"%@ЇН;:Нћ:БСб!МеХ*#@ее*	@е*э?е!Ме!Ь6еЕЙНщ4БбС>2@"@бНЌВ7:@·Вэ6x±В7*@##~ю#Т7+ГБ4лХНr:·К47H=Нr:·ьо1Нн:НШ3юВ7е*@еЕГн4bkСГс6НИюКќOНоJН)юКV7НоJ№ВG7>НоJ>
НоJ:>ю АГ@НИюКќ2@OНк
юК„7№К@Гu7бСБЌ7Г\4Б^4Е!H=:@O~№КҐ7юИ#Г™7БСб!МеХЕЙ·НФ#"ц?~ц(wНю/"@ ЕНi2Бю,КГ7Їw+2@2@<w+"@"@6 y2@Н;:ЇН;:БСб!ч7еХЕЙБ^4Е*%@еЇ2@2@Нр3хНH0Ъ8КO8с2@бГ‡6сНUДќ*@хВ18:@<2@й=<Ow+В786 "@сю,К8б"%@ЙсбЇ"%@Н;:Нћ:*#@ л*@:@w*#@л*ц?#Хе^#VzіД”9бСs#r*@НЉ0БСб!МеХЕЙе7Н“Ню/6 +6"@+ НЊ2GН6НИюКН8ю;КН8ю,КҐ8xю КҐ8ю	ДНГҐ8г##^#VлН€:г·Кк8№Кк8Ък86 +ГЬ86 +Н.0бБН€:е*@еЕO 	"@Б*@е!Ме9ХЕЙНщ4б"@б"@бЇ2@Нr:·КI9H=Нr:·ьо1Нн:НШ3юВ+9е*@е*@еГн4*@#Ї2@ГЖ4}“_|љWЙ:д=·ВЗНѓ :>ю А2д=xжЂВќxж2з=*Т=лНT9л"е=Й:д=·МНЇ2д=Г@!!@Ns#FrН¦9НЇ9q#pЙ*@^#V+Й*@##^#V+Й*!@}ґКП9лХНЇ9л"!@СГы9*@  л"@Хл*)@НЌСЪI;*ш?%:ъ?·НЌЪI;*@лНT9ХН¦9л*%@л{жа_{ІВ:СХs#r#> w#wНЇ9СК%:s#rГ*:л"#@л*#@ХлН¦9Сs#r{ц_ЙХх*%@л{жМє9*@схw{жюКW:Мa:л"%@сСЙ{жа_НЇ9zіКє9ЙХл*@л}жВ‚:}цoл~лСЙНr:хХл{жюК—:Мa:лСсЙл{жа_ХНЇ9{ІБИЇw#w*@s#rЕН”9Б*#@лН¦9q#pЙ*%@Хл{жюМб:*@л"%@л~лСЙ{жа_Н¦9{ц_ЙХхл{жюКщ:Мa:лсСЙ*@л*ш?:ъ?·В;*)@%НT9Ъoz·КoW{_Х*@л*@НT9BKС*@л"@x±КE;+wГ8;"@ЙНO;ГП9Х*A=л*@НT9ЪozюЪoW{_бЕе*@лгНT9BKС*@е*A=е"@	"@бСx±К•;w#Г€;БЙ2Б>2В>O!^#V#еЕН·;БбВ ;:Б>№ДZЙ  ЕzіКЗле^#V{ІВА;б}ґИНж;++V+^{ІКК;Їw#w+++еГА; 	F#"?=~ж@А#~жЂДФ<~#^#VЕеGжВ5<ЕНА<с_жЂВ<{жВ…<{ж@Дђ<{ж К€<{ж_ !f~НvLНz<бБ###Е~#НvLВ;<Б>ђВL<<GНu<ВM<!Б>5Вm<:В>wНZ!3=4:2=ѕМp*?=~ц@wЙ> Г|<>	ГvL>*К>MК>CК>UНvLГ2<ХЕ*?=е#{жG#^#V#Х^#Vл"Ю=СНѓб"?=#~ж Д©БС>IГvL!>">НЙ*>6 !>ГХЕе~жG#^#VН©бБЙ                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     QAQB QCQDQEQHQLQMbSPcPSWQIQR	bBC bDEbHLbAFjIXDjIYdrNZ qZrNCqPrPOrPE                                                                                                                                                                                        RELCRFPRN                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      P                                                                                   ?Command error ?File not found ?Can't enter file ~жИНоJ#ГМF!›FГжF!ЄFГжF!єFНМFГXGCOMSCN                        тF",AтF·К<G:GG:
GO* . ѕВ2G#В$GГ<GВ2GИГGЇ2тF* +щ++"‚@*,Aе:Ћ@·В  2…@*‚@щНKJ:IFюКXGЇ2’@2‰@2ђ@2Џ@2Њ@2Ќ@2‹@2‘@<2Љ@2€@ЧFЕЇ2Ѓ@НбHШ8AНДH-Aю В§G>Ђ2Ѓ@е!“@НёHб> 2-A25AЇ2,AyЦ,·2‹@ВСG:Ѓ@оЂ2‹@НбHШ>A:Њ@·КЮG;AНДH-A:,A2‡@Ц 2†@ВыG:Ѓ@Ж@2Ѓ@е!ґ@НёHбyю=7АНбHю7АНДH,A·ъ#Hю 7Ие!Х@НёHб:Ѓ@‡!“@ЬH‡!ґ@х:Њ@·КSHЅ@;A>х
с=ВIHсЬH:‰@·ВhH:†@·ВhH:‡@2‰@Н хН с_Н Ї2Ђ Н„KН%KН;Kб*‚@##:Љ@2…@GЙх,A	~·ВІH·ъІHw#ВЁHсЙ#ГЁHw#В»HЙ:„@·Ие!5A~ю ВЯHжw#ВХHбЙН*Jю:7> ВIx·КбHлНЧJOx=yВ&Iю[РюAШЦ@л2,AФ*JxюЪIЕлХ-AКoIНЧJГIюTВ?IНЧJюT7АНЧJюY7Аџл·ГIюLВYIНЧJюS7АНЧJюT7А>юл·ГIюR7АНЧJюD7АюR7А>юл·ГIбБ>
ђЪЂIл6 #=тxIлy Ц.2„@М*JлХ5AxюЪIКҐIНЧJГ™IбyЦ/·yАНЧJюLВѕI2‰@НЧJOГ¦IюNВЙI2ђ@Г·IюOВФI2Џ@Г·IюRВЯI2‹@Г·IюCВнI2Њ@2‰@Г·IюMВшI2‘@Г·IюIВJ2€@Г·IюXВJ>я2Ќ@Г·IюZВJЇ2€@Г·IюP7А:Љ@<2Љ@Г·I еНЧJю[ТHJю0ЪHJюAТDJю:ТHJГ-JOСЙЕХ!Ђ ~6 ·GКzJ#~ю ВcJГUJHFx+#КtJ~ГiJ2Ћ@ГљJЇ2Ћ@:…@·ВЌJНK>*НоJ
GFН >
НоJСБ:HF!IFе"™F…o> Њg6#>
wб:…@·ВЦJе!IF~юКХJЦaЪСJюТСJЖAw#ГѕJбЙ~#ю КЧJю
КЧJюВK#"™FЙсеХЕхж_Н сБСб·Йе*™F+~жю
#МKJ#"™F+~бю7И·Й>НоJ>
ГоJхЕХеEB!  "CB!ґ@:‰@ГNKхЕХеCA!  "AA!“@:‹@·КKеН б~·ъKНЎKХН СХН <КгFбНЎKН <КЭFбСБсЙхЕХе! "EDGDН !Х@~·ъKГsKеХ Їw#ВЄK wбСЙхХХ@·ъШKЕеХGDН СЕеН бБСсЙх:‰@·К°HХ:ґ@<КШKъdL>НvL>
НvL>НvLе*CBEBЕґ@НNLEBН Ббґ@ГПKх:‹@·К°HХ:“@·ъШK>НЭLе*AACAЕ“@НNLCAН Бб“@ГПK|µИ}жКYLЖЂж)„`iГ­L>НvL>
НvL>НvLСсЙх:‰@·К°H:ґ@<КнJъUMгеХ*CB|юМҐL#"CBDBСсхжwсбЙEB!ґ@>хЕХеН СХН ·ВЎMСбЂ 	лБс=В­L!  ЙCA>!“@Г­Lх:‹@·К°H:“@·ънJгеХ*AA|=МТL#"AABAСсwбЙ:Х@<К KъђMеХ*ED|юМ%M#"EDFDСГKGD>хХЕН Х@Н БС=КNM!Ђ лс=В*M!  Йс>ГJMсеХЕхж_!’@ю ТsMЦКqM<КqM~=w4{ю	В€M> НvL~жВzMГ‹MН сБСбЙеХЕН БСбю7И·Й!БMНМFСЖ@ю@ВІM> НоJ!ЗMНМFНKГ  DISK   FULL                                                                                                                                                                     еХЕл!НMю:> ВЊNЦ@юТрNw#2„@ю.К·Nю!Ъ·Nw#ВђN2„@ю.КѕNю!ТҐNГѕN6 #В·N:„@ю.КЛNw#ВЛNpсMН НMН юяКрNЇ2нM2оMБСбЙеХЕ:оM=тOсMН НMН ЖяЪ0O!сM"пM>2оM*пM~юВ+O7Г0O#"пM·БСбЙЙ0                                                                                                                                                                                                          BEBЕґ@НNLEBН Ббґ@ГПKх:‹@·К°HХ:“@·ъШK>НЭLе*AACAЕ“@НNLCAН Бб“@ГПK|µИ}жКYLЖЂж)„`iГ­L>НvL>
НvL>НvLСсЙх:‰@·К°H:ґ@<КнJъUMгеХ*CB|юМҐL#"CBDBСсхжwсбЙEB!ґ@>хЕХеН СХН ·ВЎMСбЂ 	лБс=В­L!  ЙCA>!“@Г­Lх:‹@·К°H:“@·ънJгеХ*AA|=МТL#"AABAСГ72Г_ 	
   MAR   EDITOR V1.3
     
 MIEM GORSHKOFF & OZEROW CO. 
    VOLGOGRAD    1992

 >Но>HНо>Но>JГо  >Но>YНо> …Но> „ГопГ§       PЄ:P      
                                        ГNГч%!  "ї(ЕХеН}:АНNбСБЙ*Л(Ї2Э(Хл*ї(Н лСИ"ї(ЕХеН“:БНNбСБГА#е*ї(%Н
бЙх:єН &:»·Д &:ВНNсЙ<=ИхНА#Ї =ВWсГO1с+>яНsя1с+ЇНsНP  2€)!  9"›)DНЂ#)НЂ#Н/Ня-Н|/* 0 ~#·В§~<Кє+~#юВ·~юdТ·юТє>яюЇ2‡):ј·ВП!эяF>©w®p<!…)w: жюТЯ6яН†*¶л!m)>s#r#=ВлЇл"9'*9'"w)"y)"{)"})ј(±ЇВ2[ 2h 2k 2} * }юК.|Цg+"):·ЖјЪMН^ NOT ENOUGH MEM |·<<ж<G2g)2j)xюТf>2l)|юd! "b)Ъv)"d)>2h)Ъ‚‡2i)!] ~+ю ВџН^ NO FILE NAME ~НЙ wз(Х Нѓ~б·КёНЙ w:\ ѕКД>я2X)~)!C Нѓ:X)·Кз(Нk КН^ FILE EXISTS ON DESTINATION DSK \ Нk >яК2[ Г)2Y)Нx#
NEW FILE

 р(ХН}з(Нџ С!KНЂНДГБWMBACKUP$$$НpН| !\ ~2l :з(wГъНp)Нџ Г=2щЙНИ!Y)~·\ !КМд з(!e Гд НџВБН| з(Н !l Г[Нx#
ABORT (Y/N)?  Нў"НfюYЙНџКk*›)щ!БеН_$Н‚!д(~·Вж5*Ё:6 "‰)НѓН‚>*2б'Нa%Нў""‰)~·В:¦*ю
КGе#Нc#б·В$xНfюHКNюQК»юOКЉюEКbНVИНx#
 ??? *‰)лНЂ#НH%Ї2_'Н/Ня-ГБН›НH%СНЂ#Г(ЕХе"‹)Н‚!Pе*‹)НЂНc#"‰)еНc"‹)б·КAю>КAю;К–юКЩюКFюVКѓН+"Нc#"ђ)*ђ)Нc"Ћ)"‹)·К
юCК¦юDК¬юKКтюLКОюPКGюTКе*“)л! Н бТЯюBКБю/Вт>я2™)Нc"‹)"Ћ)юFКЇюNКµюRКБюSК»НoюQКЕНyВAюAКN	юIКQ	юZК‰ю<КЈюMКђ/ю!Кn	юWК—юYКVюXК(б·ГC :€)·КAГ& ;;Н‚НўВќГc~·И#ЙН^юaШю{РжЯЙх:—)·ъ(сЙЕG:™)·xБЙ! "Ѓ)"ѓ)!  "™)-"б(Й"‹)Н^ИюИГ–лН“*•)лНVШю>Кё·В(zіИzіИН;$Г«Нc"‹)"Ћ)юPКП
юXКфхН”сюLКў
юTК®
юKК»
юGКВ
Г(Н“*‹)е*ђ)е*“)еН0*o)НVЪВ€б"“)ЬЂН”Вяб"ђ)б"‹)Йл*“)леХ:_'·ВuН“Нx&>*Нa%Нў"НVх:_'·К\сК<»&Нc&Г(сНN/Нl/"‹)Сб{ІИ{ІИ"‹)Г-НIILLEGAL COMMAND Нx# QX? Г2!ДЦ9ШНISTACK OVFL НГюНъё"{)Г»"y)НГ:—)/!яя2—)"“)НxНюНўВОЙ *“)елНЛб"“)Й>яюЇГИНxГЇ! Ї2—)Ї2Z)"“)ЙНшНО! ЇНьН\лъ-*{)лТ5Н5>}Нa%Гa%*y)>{Ь'НЂН ИНa%Н;$Г8*“)е*—)еНў*ё& +еДЛбНб"—)б"“)Н”Н,А:—)·!{)т|!w)НrАе!  НыбЙ*ґгг+|µВЊе*“)|µКћ+"“)бе*“):Z)ґµбГ;$Н)ГДН
ГДН_ГДНТ”НyВШНx# ##  Г2НкНЂб·7ГC Н“Нк*‹)Нc"‹)ю<КдюMКдюAКH	юFКH	юIКH	юNКH	юRКE	юSКE	юWКH	юYКH	ю;М–КкюQВ=	Нc"‹)юLКH	ю>И·ИГкН’	Н’	ГкНЫ*Ћ)~·КBН‹	НЏ:ќ)·A>М—Г”:“)хНЂсН юАНx# TURKEY 
 Йе*Ћ)Г–	е*‹)Ехћ)ХяН^юВі	>>
Гћ	юВЅ	>Г­	НУ	Вћ	2ќ)"‹)ЇСyсБбЙюИюИ·ЙЕХеХЇВе	СХ*‹)Нc#:‡)·В
Х"‹)џ‹)Н *‹)Съ$
Г$
#~+ю:В$
Н†
К$
Ц@#Нh
ю.хе!d
ДЂбсМg
Сю КS
Нc#Н^"‹)НЦ	КC НIBAD FILE NAME LIB#Н†
К{
Вh
Н†
Вt
Йх> В|
сЙ~Н‘
И#Нf·Йю.Ию:Ию*Ию?Ию РїЙН·
Н‹	!q)Г’!o)Н Г8НyА*o)"q)Й!o)НrН лГќН·
!q)НЬНxл*{)лНь!q)Нц
Н0ННўВТ
ЙНИНЬНл*{)лНіл"{)лНВъ
ЙЕХе!o)Нr*m)л*)НуНи	ЂН ЪC НIQBUF FULL НЂНЩНAхЬщсЪHНU%Н;$юИюИ!HеюКmюВzН€Нa%"y)НЙю Т юВ†>юКH%юК•юВ¤НH%Н€ю
И"y)ГюВЅ:А(·ИН€ю
ИюИН-ГsюВс:А(·ИН€юИю
ИхН·сю	КВю КВ:А(·ИН€НKРН·ГЯюВНH%*y)+Н_Ъ	~ю
Вь#л*y)Г8юВ >Н >
Нa%хНЙН сw#Гsю	ВJл*г'FлИИНTВ<л+"г'лЙюКTю ЬTН.> НМ%Г.л*w)Н лРл*y)НтеН8*y)СхсЙ*y)+ХН_СШ~·ЙН{Р33Й!y)ћ)O Г !y)Н	НИНЬНіВ§·ЙеН жяw#В·лгs#r+СЙХ*y)л*{)Н С!y)Ш!y)ЕХеНrx·ВC Нz·ВГНТЯНIMEM FULL ННАЙН1РНюТ
:—)НЕ7ЙНgРНюТГН1РН%ШН‹	:—)·ъL!{)Н*{)ШНЕШГY!w)Н*y)ШН­НнГHНgРН%ШН1:ћ)Н’	ШG:—)·xъ†*y)Н°"y)ГЏ*{)Нѕ"{)НЏНЄГYНrЕGyђБOxЮ GЙ*y):ћ)еg}”бo|Ю gЙ:ћ)…o|О gЙ·ИХНуЪле·Ккѕ#КТ+Н#КТбСГЕССЙ·И#ХН
Ъле#·КѕКьНКьбС·ВсЙЕХ  *“)л:—)·ъ;*{)Т1#DM!яял*})Н4 ГS*y)НуЪLНЮDM!  л*w)Н" 	ГА>яНьХ*“)еНxСТЗхН%ТrсСЙсл"“)СЕХ*“)л!—)zіВ‡5~·ъЈНoН НсЪїzіВ’Гї!w)Нr*y)НА#НЪкzіВ­#лЇ2Z)Н,ВР!  "Z)"“)л"‘):—)·е!яяЪC *Y))ГC л>яГБ>
ГюѕД#ИВшВш7Й>
Г+ѕДИВВ7ЙюК;РюИюА·К9ѕ>КDїЙ~НK>Т9·ЙНl#7ИН›"ШНfюA?Рю[ЙЕХел*w)Н Ь‘*})#Н Ф‘*y)#Н ТЃлw)Гџ*{)Н Ь‘л{)Г|НIPUTCUR ERR НhНх+¦6 ВШ!Ъ(~6 ·хДsсВЛ!Б(~·тИЇw2Ч(Н	:П(*С("П(ЅДк:Ч(·ВН”Нс*Б(Нm>{Ь'  НСжАВЙН}Кю
ВНa%Гул"Б(>я2Ч( :Ш(·В­*Н(Н
НсНСжиВЙНЪDю
КHН†$НА#Г0Н„$:+:Щ(·В­НСжиВЙХл*Е(Н лСТzНСжФВЙНЪzН†$ГY*ї(еН„$:ї(!У(ѕКЋТ©!ј(ѕТ©НСжЂбВЙе>
Нa%яГ~б"У(!яя"Ш( Н!Я(~·И#6я><НМ%Г>
Нa%Г:_'·КЫ>яЙ:/·ВШЕХеНА# *у'лК	<Вях'<=К	Н@Гр:Ю(юЪ:Ы(Н@:Я(цу G:Л(·xК(жїGxТ=:Л(Ж!ј(ѕxЪ=жГГC юВJ> °GЙю ЪQ> !Нѕ~!bНѕ~°GЙ @ Ђ Ђ   @0   Ђ      0Ђ    ! я"б(Ї2Ю(2б':ёЦ2ј(·2Б(Н·Н{ЪґюВґНяю
МЁНџЇ2љ):Ы(!Ь(ѕВЗ>яw!ґе!Ю(5КЦт6НA2Ы(ю В!Ю(~х6 НШс!Ю(6юВъ6юВ6@ГШ!а(~6 ·К7НяЪ/юК/ю	К/юВ%>~ю Т,>^Г1> НМ%ННА#:Ы(юКЪю ТПхН$‡НѕН сйЧяѕЁ•С~)ПЩoЁ@)ќ¬H¦јQќ›S`”т¬ШЪ2б'бНЂ!в(~·И4*ј(Г
ННшНбхНYсюАГЁН€НлНYН{юАНкГјННсНЪYНKЪЧНбНЪYНбНl#Кж+ГYНлНYНкН€Нl#КщНлНYН€НKЪЙН€К>Ї2М(*ї(е!  "ї(Н™*‘)НY:ї(ГА >р2М(Г‰ :М(ц<ГBНЃх!Л(†!ј(–Ъ‡<!Б(ѕТ‡~=ъ‡НхК‡!Ю(6НН«НсГVсW*ї(е. НГДНЃНк*ї(е!  "ї(хoН™*‘)НYсG!Б(НЋ:ї(ђтАЇW!  "ї(НсН“Н§НYб"ї(ЙН€Кф*Б(Нл!  "Б(х:Ш(·М’сЙХ*Г(+еНоС*Б("Б(С:Ш(·АГ·:Ю(юТ“НхК“:Б(=т4Нш>Н€Н«Ь·ГНюЇ2ѕ(*У(Н
:ї(!Й(†W*З(Н&НЪ|Нa%:ї(е!ѕ(†бєЪOНЪ|НС$Ъ|ю
К|Нa%Гe*ї("У(НWНо:Й(!П(/<†wЙНЃ/<ГћНЃ!Б(†wГСН€*Б(#Нл*ј(+"Б(хЇ2Ч(сЙЇ2г(Нш*Б(л*Г(ЇНИН·>я2Ъ(ЙН€НsНWНлН{юКЪЙНЭН€Нl#КпНЭН€НKЪыЙНшНl#В НЃНшНl#КГDНDН{Ъ-Нl#АНшю К8ю	АНЃГ-НЃНшНKЪ>НFФЃЙНЂНтяхЇ2Ш(сЙНQН’НшХНтСЙНшюИю
ИНЃГoНшНW"{)НюК~ю
Аяе!  "Ш(бЙ!Я(~/wе!яя"Х(бЙ2в'НШН7юВЕН|	Н‰НW>юК@ю
М·х*Н(Н
сХ Н†$СН WНяЪюКG:Я(·xВYєКю ЪЃzю ЬYЪ„Н„Г:ї(!Л(ѕВYеНЩ"Н(*ї("Л(бГЈНЃхНw*y)++НYс=В,Г’Нд:Я(·К`НяЪWюКWяН„$НГWННсНЪtю
ВfГYНY>Н >
Г !Ю(~6 Й!Ь(ѕЙНя$Нб:ї(єРНШНаТЌ+Г“:М(<W:А(єРНШНС$ЪЮю
КЮюКЮНС$ЪЬНя$:А(єТЮНШГ»++Йю
Ае!Б(4бЙю
Ае!Б(5бЙ!Щ(~+¦+¦Й:Х(·ИГ	Н·Н«ТҐНот,НITOO LARGE FILE LINE :Ч(!Й(¦К:Л(!ј(–ЪJВ:М(·ВНSН”Г	Ї2ѕ(>
Нa%:ѕ(·Кk!У(5тk4!Й(ѕЪWЙ!Б(~·тђеНябТ€6 ГђЇ–Н€ГsН«ТҐх:Б(·КсНГђ!Х(6 ЙЕХе*ї(еЇ2Й(:Б(=Н„<Ъ!  "Г("ї(*Б(Н™"Н(z2Й(*ї("Л(*‘)л*y)Ну$"Ѓ)Нл*ї("С(лН!"Е(Н"З(:С(Н„б"ї(ГC НсНШю
КЮНя$ГНЉЪLНШю
Мfю ЪFе!А(4:№=ѕбТ!+~#Ня$Г!НШНС$ЪЮю
КaНя$ГL+ю
Ае!Г(4бЙХНWхл*y)НьлсСЙx±И~#Й=2ї(·ш:ї(<<W:ј(’Р/<7ЙНm>{Ьь$ Н}КЩНя$ю
ВЈ:ї(Wx±КЩ~#ю ЪУе!А(4:№=ѕбТµ+~#Ня$ГµНя*ї(ШНС$Ре*ї(,&"ї(б7ЙНoН ЙНяР33ЙНсx±ВНеН‚бхНА#Н&сШ~#ЙХл*{)НтСЙХлНoН y“OxљGСЙНAРНџГ7ЕХе:…)·В`НhЪC ЙКDНА#КSНhФу+7?ГC :…)·А:яч!†)ѕИ:…)·АН·Нс!е'"г':…)·А:ячхх>PТ>(2№с>Т¤>2ёЦ2ј(>2єс2†)7Й MAR     HLP                      НсН·!·4)! Нѓ4)Нk В>24)4)Нk ВНIMAR  .HLP NOT FOUND 4)!$*Н !ЪU4)!$*Н!$*х~#юКDНa%с=В1ГН7ю
ВTеНсбГ<сЙ4)НЮ	Нk ВtНIFILE NOT FOUND Н;$4)!$*Н !Ъ”Нх O$*НќсЪtГ”НўК(2)ЇНЮ	  !{)Н3Н НулНx*‘)леЃ 	Н +гЪХ4)Н‘!СГєНтБлНўКле*‘)НюбТЄ{Нb4)Н©!Н† *‘)ГYН;$НYНўИН;$:—)·ъ8ГД:—)·7ьХРНTРГХН5ШНШН5Ф·ЙЕХе:—)·w)ъE{)*k)лНr`iН ГC ЕХеНѓЪC !љ)4F!j)Ї†Вf=цO:i)=GНѓКВt·ГC *w)НкШе*	)л*\)Н бз(ТўН¬!ГЇН¦!л*\)#"\)лЂ "w)ЙЕХе!Ѓ "Ѓ)!)НА*})НYНѓТМГC ЕХеНхЪC :i)G‡OНхКсВж·ГC *})Н!В:1)WН°еzНbГЂяегНъгТбЙе*^)лНZН бТ4\ Ні!ГYе*`)лНZН б)ТLН¬!ГYН¦!е*`)+"`)бН!·б"})ЙЕХ$*ХG‚+~#Вn>ВwГC Н!ИЕХеН!Ђ Н л*d)Т НTЪ‘лл!)Н„ГУЕХе!) xНґН!Ккy·ВУГC ЕХеН!Кк!)Нj*})НнФЪв21)"})ВЦ·ГC Н;$)·7Д'!Р[ ·7Д !ЙЂ~жяwюК#В7>ЂЙН<!>ЂђЙе:[ !)¶7бЙ:—)·:ж(ф!·ЙЕХе:ж(·7КgХ!w)Нm*w)Н;$Ђяз(Н'!Ъf"w)ВO·ГC Tе*d)ХНН бЬS*b))$$лбНґюЪЏЦO·АНIMEM SHORTAGE, TRY CLEARING QBUF НАХНбН4 л)ЪБлzJЙНЄН·НЄТЛ!w)НrН yНbз(Н¦!Г† е*Ѓ)л*y)НулбГ е*ѓ)л*{)СН лЙХy)Н САЕХех!w)Нk*	)л*\)Н лТ."\)!{)НkНZНул*^)Н лЪH"^)л*`)Н лЪV"`)сГC Х*/)л*~ НуяСЙНr`i)\ ТxЙЕХелеН лНьбеН Нѓг++s#r#Сs#r·ГC ЕХел##еН Ньг##^#VгНҐгr+sС+r+s·ГC ЕХел!o)Н Ьэ!Ђ)Н Фэ!o)#Н +ЪкН3Н#ГЩ!})Н ТC НO++++ГнН^ PUTHOLE ERR Ее  !m)Нrл	лН#ТбБЙХ####~)Н СЙ!s)ЕХеНrН гs#r+гНѓбе##s#rГC ЕХее++НrбеН лг#r+sгНҐб+r+sГC !{)ХеН НьбСЙ!К ННН В“	л	  ЙГњ~#ВВЙННН ВёНи	л	  ЙГБ+~ВЅВЅЙBAKxц<АНICOPY ERR хЇ•o> њgсЙхЇ‘O> GсЙлХлНЮлСЙеНуDMбx±Й++^#V#~#foЙ++Г ЕGz”В {•xБЙН Ъ- !  ·ЙеНуС7ЙН К( Ъ( лНу7ЙбСБЙХЂ НP СгЕN#ХеН бСБгЙНH%СНЂ#НH%ГkНG <е!# 6 +6 бЙ)·ИНG <АН^ CLOSE ERR )Н НG Н<!Г<!Нџ Нp НG <АН^ DIRECTORY FULL Х_:‡)·{ВЩ НP СЙС·Вг НP <ЙЕХеХ!  лНѓ6 С! лбеНЂбСБНG <А:‡)·АН^ RENAME FAILURE Н+!Ф¬!ЙНі!ШНА#ЇНЮ!Ъ<!НP ·=АЇ7Йеbk++~·М« 6ябНЃ!Ахе!)Н бКn!:)·ХМ™ СсНЃ!АхсюВ· НIDISK FULL НЬ!НP юИюяИюЙЕеХЂ $*ХНѓбСН©!бБЙН;$НB!Е Г·!ЕяяХе>я!# еН 	|Ґ<КХ!лбs#r·ГC Ї7бГC >яЕGе!" Н }жO)|! ѕК"ех!! ~·Д† 6 сбwНG <В"x·7К "Н± !  q#~°wбхлНP лсБЙ—)ЇНc##ю+К0"ю-ВD">яГ0"+яял"•)лНc#ю##К†"+Н›" Т†"~Н›"ТЃ"#еbk))ЪЊ"Ц0_ ЪЊ"лбГa"л"•)лл"“)лЙНINUMBER OVFL ю0?Рю:ЙЕХ!б(~хЇwO*Ё:еyю}ТL#СХНAхЬ8сЪ°"НU%юКQ#ю
КG#е!°"гюКЯ"юВж"Н?#ИГa%юКр"юВх"л >юКH%юВ#Н?#ИГ-юВ+#Н?#ИGН-xНl#К#Н?#ИGНKТ<#Н-Г#юВ6#НH%Г8юК»w#Йy·И<+~ЙГS#>Нa%
2¦*6 xНa%бс2б(СБ~Нl#А#Гc#ю	Ию Ию
ИюЙгхНЉ#сгЙхлеНЉ#блсЙ~·ИНa%#ГЉ#е*у'~·КІ#х6 #~<В©#!х'"у'НА#сбЙбН$жяН$Кі#·ЙеН%$Кя#*с'~·Вн#Н$w#~<ВЬ#!х'"с'~·Вн#Н%$ВЗ#Гы#>!Нa%>Н &Ї2Ч(бцЙ*у'~·бЙЙ!Нѕ~!TЙ  >Н,$юА:б'2г(>Й>Н,$·ЙЕХе!C е* Нѕyйх:б(·ВH$НА#сЙН_$ВP$сЙНIINTERRUPTED НА#е!г(~6 ·бИЕе!х'"с'"у'dЇw#Вz$бБЙ>юМ•$НК$РН•$Гa%хК¤$   ю	ВЗ$:Э(юКЗ$НА#:є·Д8ВЗ$> НК$ЪЗ$НА#Г№$сЙНС$ШГa%юИю
ИЕG:А(Oxю	Ви$yцO/ю Ту$юКу$:№№xБЙНя$ех!А(ю Ъ%4:№ѕК%Т6%6+4сГ %юК	%ю
К4%юК9%ю	КA%4Г	%+4сбЙНА#6 сбЙ~цwГ	%х>Нa%>
Нa%сЙюИюИюИюИхеюВj%>$юВq%>~хНС$ТЂ%Нx#
>> *г'юВЋ%!е'ГА%ю	В­%#~<Вљ%+6 > НМ%4:А(жВњ%ГА%ю ТА%ю
КА%>^НМ%сЖ@х"г'сбю	ДМ%сЙхН &схеНЩ%бсЙ!А(ю
Кл%юВй%6 Й4Й+4:ё=ѕР5+4ЙхЇ2Э(сГ&2Э(ЕO>	Н,$БЙ:_'·К”#е*Ь&~ю#"Ь&бхю
В1&:є&юВ1&сГ&2є&сАеХ!Ю&"Ь&лНP »&НP ·СК&»&Нc&!^'"Ь&бЇ2_'Г”#еХН† ! СЇw#Вp&бЙ!^'"Ь&>2_'2`'2є&Х»&НЮ	*‹)Н[/Н%/»&НP С<АНIEXEC FILE NOT FOUND                                   ^'                                                                                                                                                                                                                                                                    е'я          ях'х'                                                                                                    я                                                                                                  НҐ"НжћНK'бНяНoГG-!ње       ЇхН?1Н‰-:д62в6Нo!На$сбхНяс·ДK'бНяНжў>НcНж–Н31НѓН№$Ї2г6:д62в6На!ЌѕВе&Ї2Я6Н%Г—-!«6~·И6H
	CALL	CMPHD	;1F9FH
	POP	H
	JNC	L1BBD	;1BBDH
	LXI	D,FC                                   2	 1BE2H
L1BBD:		;1BBD 
	PUSH	H
	LHLD	L2724	;2724H
	XCHG
	CALL	L1DE3	;1DE3H
	CALL	CMPHD	;1F9FH
	POP	H
	LXI	D,L26D1	;26D1H
	JNC	L1BD5	;1BD5H
	CALL	L2135	;2135H
	JMP	L1BE2	;1BE2H
L1BD5:		;1BD5 
	CALL	L212F	;212FH
	PUSH	H
	LHLD	L2724	;2724H
	DCX	H
	SHLD L2724	;2724H
L1BE0:		;1BE0 
	POP	H
	INR	B
L1BE2:		;1BE2 
	CALL	L1CAA	;1CAAH
	ORA	A
	POP	H
	SHLD	L2741	;2741H
	RET
L1BEB:		;1BEB 
	PUSH	B
	PUSH	D
	LXI	D,L27E9	;27E9H
	PUSH	D
	MOV	B,A
	MVI	C,82H
	INR	B
	DCX	H
	DCX	D
L1BF7:		;1BF7 
	MOV	A,M
	STAX	D
	INX	H
	INX	D
	DCR	C
	DCR	B
	JNZ	L1BF7	;1BF7H
L1C00:		;1  :б'·В&е:/·Кa,*/Н ~юВ$,*/Х/Н СКW,++"/Г,#Хл*/s#rСбG:в'·> 2в'xАюАеХ*/Н ~#л*/s#rСбН…,Гу+Ї2/НСН¬Н&бG:в'·> 2в'xАюАН&юКЛ,2/Н…,Гу+е!8.Gxѕ#Кћ,#~юВђ,#~юВЉ,Хе*//Н Вї,НIMACRO NEST OVFL ##"/Сs#rСбЙ*ё& еН
:є·Кб,Н8Гп,> НК$Ъп,НА#Гб,бН
Н&юВ-Н.еХГ‰-Нa%х>>Нa%сН…,еХ*/Н ~юВЯ-p /"/#Н ЪЅ-Н&юВA-Н&wН§-Г'-юК”-юВW-Нa%НH%*/Г-юВk-еХЕНa%Н&.БСбГ.-wхН§-сюВ'-yю>ВЃ-+w#w"	/Ня-НСН¬СбГу+y·+~К'-+ЕХН-СБГ'-юК±-ю
Вa%х>^Нa%сЖ@Гa%*	/"/6СбНIVIO MACRO TABLE OVFL Е>MD#ѕВд-#	/~#Н Во-БСбxГ-!/"//s#rЙ!/"	/Ня-!9.Н.!/>w#w#wЙНH%6*/#~юИНa%Г..                                                                                                                                                                                                                               !(7"Ё:ЙХ*Ё:Ђ Ё:Н С"Ё:РН/НIMACRO NEST OVFL Х*Ё:Ђя"Ё:СЙХЕл*Ё:~ 	s#rлБСЙХЕ*Ё:~ 	^#VлБСЙ!3"!7>Н .Н .!7Г .Нc·К(юMК>1юВ„0НcюК;0+"‹)62НЮ	62Нk КЛ/НIFILE EXISTS 62НP <Вж/НINO DIR SPACE 62Нk W2@xюMК 0ХНк1Нх1С}ґК 0MН2Н2HН2NН2#yюВ0
Н2xю[Вт/Н2В)062Нc&Г”"‹)>@2Ѓ0:Ѓ0юMКd0Нк1Нх1}ґКd0е!Ѓ0Нv0бНv0НH%:Ѓ0<2Ѓ0ю[Н;$ВC0Г”~юИНa%#Гv0A>лН“хХ*“)елНк1Н[/Нх1|·ВЄ0НINOT FOUND лН%/"‹)ЂюК1ю%В1ХлНN/Нl/~ю<Вь0Ве0НICMD STRING OVFL #~ю<Вн0ю>хсВО0ВО0#Н[/Н%/лСГі0wКТ0#Гі06 *‹)НVВ(НN/Нl/"‹)С{ІбБИЕсG{ІxИН;$хеХГЏ0ЙНcюВO1"‹)Н|/Г”Нк1еOНх1лz·"#7К~1KBюВc1*!7#Н Ъn1i`+"!7*!7:'7w#"%7лбН^ю"‹)Вќ1л+6Г”·К–1Гґ1е!7Н бТШ1Н^юВї1Н^Г¤1·КИ1юВ¤1л6#6"!7л"‹)Г”НICMD MACRO OVFL Ц@Ъ(юШГ(2'7ЕG!3xѕ#К2#~юВ2#~юВэ1!  БЙеy!Ч2Н бШЕW2ХеНP 62НP ГC  НT2Гh>w2X2>2l2>2m2НT2*›)щЙ®ю!f2~юяИ  #ГZ2	Ђя	
 Ђя                                                                                                                                                   !(7"Ё:ЙХ*Ё:Ђ Ё:Н С"Ё:РН/НIMACRO NEST OVFL Х*Ё:Ђя"Ё:СЙХЕл*Ё:~ 	s#rлБСЙХЕ*Ё:~ 	^#VлБСЙ!3"!7>Н .Н .!7Г .Нc·К(юMК>1юВ„0НcюК;0+"‹)62НЮ	62Нk КЛ/НIFILE EXISTS 62НP <Вж/НINO DIR SPACE 62Нk W2@xюMК 0ХНк1Нх1С}ґК 0MН2Н2HН2NН2#yюВ0
Н2xю[Вт/Н2В)062Нc&Г”"‹)>@2Ѓ0:Ѓ0юMКd0Нк1Нх1}ґКd0е!Ѓ0Нv0бНv0НH%:Ѓ0<2Ѓ0ю[Н;$ВC0Г”~юИНa%#Гv0A>лН“хХ*“)елНк1Н[/Нх1|·ВЄ0НINOT FOUND лН%/"‹)ЂюК1ю%В1ХлНN/Нl/~ю<Вь0Ве0НICMD STRING OVFL #~ю<Вн0ю>хсВО0ВО0#Н[/НееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееГОЙ  Й        (INP:/OUT:SPACE)(INP:/OUT:SPACE)(INP:/OUT:SPACE)(INP:/OUT:SPACE)(INP:/OUT:SPACE)(INP:/OUT:SPACE)(INP:/OUT:SPACE)(INP:/OUT:SPACE)(INP:/OUT:SPACE)(INP:/OUT:SPACE)(INP:/OUT:SPACE)(INP:/OUT:SPACE)(INP:/OUT:SPACE)(INP:/OUT:SPACE)(INP:/OUT:SPACE)   COPYRIGHT (C) 1979, DIGITAL RESEARCH,  PIP VERS 1.5 $$$     SUB    =.:,<>_[]INPIRDPTRUR1UR2RDROUTLPTUL1PRNLSTPTPUP1UP2PUNTTYCRTUC1CONNULEOF DISK READ ERROR$DISK WRITE ERROR$VERIFY ERROR$NOT A CHARACTER SINK$READER STOPPING
$NOT A CHARACTER SOURCE$ABORTED$BAD PARAMETER$INVALID USER NUMBER$RECORD TOO LONG$INVALID DIGIT$END OF FILE, CTL-Z?$CHECKSUM ERROR$CORRECT ERROR, TYPE RETURN OR CTL-Z$INVALID FORMAT$HEX$$$$NO DIRECTORY SPACE$NO FILE$COM$START NOT FOUND$QUIT NOT FOUND$CANNOT CLOSE DESTINATION FILE$DESTINATION IS R/O, DELETE (Y/N)?$**NOT DELETED**$$$$$$$NOT FOUND$COPYING -$REQUIRES CP/M 2.0 OR NEWER FOR OPERATION.$UNRECOGNIZED DESTINATION$CANNOT WRITE$INVALID PIP FORMAT$CANNOT READ$INVALID SEPARATOR$1тЂ ЕЂМН
:МЦ Цџ2ҐНLл> Н„ТэMН9Н  Н	2А  Н 2ь1тН@:А2Б!o6 +6 +6 !¦6#6 !у6 #6ю:ҐТG*ННo	Н.!N6я:Мю В^*ьMН^Н  !K6 !6 !¤6 +6 'Н :©юВЃГ$:©юВГ:”=2KНН :©юК¤Н\:хТ·\ НоНxГА'НоНІГЫ:©ЦЖяџ!х¶ТЦН\НўНН :©юВН€НЖ'Е!Н
НЯНІГЫ:©юВ$Н:ЁюКГ$Н€НІГЫ!N6я'Н :©Цџ!х¶ТCwНЇ	!6 :©юВ^НўНc!Ё6яГ{:ЁЦџ/х>!Ё–џ/БH±Т{ђНЇ	:Ё<2ЈюВЉНПН :©ЦЖяџх:ЁЦ=ЖяџБH±Т®ќНЇ	!§6:§Тѕ:А2БН !6 :©ЦЦџх:х/БHЎТнН€Нѕ!Ё6яГ:©ЦЖяџх>
!Ё–џ/х>–џБHЎБH±Т°НЇ	:^!¶w:Ё<2¤:ЁюВ0НПГ}:ЁюВ@НEГ}:ЁЦџ!¦ТS!W6:Јю
Вz!]6:cю Вm!c6:_ю Вz!_6НlНН :©ЦЖяџх:ЁЦ,Жяџх:ЁЦЖяџБHЎБH±Т°јНЇ	:ЁЦЖяџ2§Гі:ЈюВОНEНП:Јю ВЫ Н1:Ґ2МГыv!тq!те*8йЙ!ые*6й:	Й>ъН¦>ъН¦Й  Н Й  Н Й!«q:«ж_ Н ЙН
НЙ!­p+qН.*¬л	Н Й  Н Й  Н Й!Їq*Ї& лН Й!±p+q*°лН 2®Й!іp+q*ІлН 2®Й!µp+q*ґлН 2®Й  Н 2®Й!·p+q*¶лН Й!№p+q*ёлН Й!»p+q*єлН Й!Ѕp+q*јлН 2®Й!їp+q*ѕлН Й!Гp+q*ВлН Йя  Н Й!Дq*Д& л Н Й*АMН	Й*БMН	Й!Жp+q*Ел!Н Й!Иp+q*Зл"Н Й!Кp+q*Йл$Н Й!Л6ЂЛ
Н Й  Н Й!kp+q*jлН Й>У>УЫЪЄ	Гћ	ЫжЙ!qp+qН/	*pDMН9:Н Н:M2r:N!rѕЪш	!М:rѕТс	*r& Н	NН!r4ВР	!М6 :Н”:®юяК
:НіН.ГЙ!ws+p+q+СБp+qХ:w=2wюяКN
*sе*uБ
w*s#"s*u#"uГ'
Й!  "ќ*MН^Н7	!x6 :ы!xѕЪѕ
*ќл*DMН†	НГ2yю К­
:yюК—
”НЇ	*ќ"џл*6:ы2xГ·
Ђ *ќ"ќ!x4Вd
!  "ќН/	Й!ЎНj}=2|юяВЫ
Й!  "Ў*KMН^'Н_	!z6 :|!zѕЪ1*ЎК	"}*}DMН†	'НУю К ¤НЇ	Ђ *Ў"Ў!z4Ву
:eТЙ!  "ЎЂ Н†	!z6 :|!zѕЪА'Н?	Ц Цџ2*H#"H!{6 :{ЦЂџ!¦Тў*{& Ђ 	:{ЎеН4К	Б
–Цџ2!{4ГmЂ *Ў"Ў:Ъ№µНЇ	!z4ВI'НУ2!  "ЎЙ!Ђq:Ђю Ъф!у4> !SѕТф:S!уѕТфЙ: 2Ѓ*ЈM !Э		^#VлйяЎНЋЪНИ
*ЎК	:Ђw*Ў#"ЎГГ=Г=Г=Г=Г=ВНЇ	Г*ЂMНжГ! 6ЂГqГ! 6АГqГ! 6ЂГqГ*Ђ& лН Г! 6Г Г! 6 Г Г! 60Г Г*Ђ& лН Г! 6 ГПГ! 6ГПГ! 6ГПГ*Ђ& лН Г
.147:=FP[fqЉ• ®№ДП:Ѓ2 Й!‚q:‚ю	К"*‚MНРГn:cю В4*‚MНРГn:у2ѓ!c:ѓѕЪQ!c:ѓ–2ѓГ:!ѓ:c–w> !ѓѕТn!ѓ5 НРГY:‚юВ{!у6 Й!„q:„Ц Цџ!l¦wТ™ НГў:„Ж0OНЙ!…q:…жшOН|:…жOН|Й!†6:]ЦЦџ2l:o†'2o:nО '2n:mО '2m*mMНЈ*nMНЈ*oMНЈ:]юВ:Н НГ	НЙ*Ў}ж2‰ЂяНD"‡НИ
*‡К	е*‰лН
*‰& "ЎЙ!Љq:UТY:ЉюВYЙ:¦Т©:ЉюК©:_2‹ю К:‹юВЂ!‹6<:ф<2ф!‹ѕЪ!ф6 Н> !]ѕТ¤Нѕ!¦6 :QТМ:ЉЦЦџх:ЈЦ ЦџБHЎТМНЙ:ЉюВЩ!ф6 *ЉMН:Љю
Вн!¦6Й!Њq:ЊЦaџ/х>z!Њ–џ/БHЎТ:Њж_2Њ:ЊЙ!Ќq:ЌЦAџ/х>Z!Ќ–џ/БHЎТ8:Ќц 2Ќ:ЌЙ:¤=O>№Ъm:W!Q¶хН}	БHЎТmНюВd>ЙЧН9>Й!ђ6: 2Ћ*¤M !E		^#VлйэќНЋЪ—НO
*ќл*~2Џ*ќ#"ќГmНу2ЏГmН–	2ЏГm! 6ГаГm! 6ГаГm! 6ГаГm  Н ж2ЏГmГГГГГГГГйНЇ	Гm! 6 Г2Гm! 6Г2Гm! 6Г2Гm!ђ6   Н 2ЏГm€­¶їКХаруцщья'2:Ћ2 :TТ’:Ј2Ћ!Ј6*ЏMНE:Ћ2Ј:ђТЬ:ТІ:§<2§Ц Цџ2ђГЅ:ЏЦ
Цџ2ђ:ђТЬН}	ТЬНюВЦ>Й НЇ	:iТл:Џж2Џ:dТъ*ЏMНоЙ:[Т	*ЏMНЙ:ЏЙ> !ъѕТ(:ъ=2ъюВ%>
Й>Й> !шѕТF!ш5+N !Н	~2‘!ч4ЙН<2‘юВT>Й> !bѕТ}*bMН­Тz:b2ч!b6 :щ<2шГ©> !`ѕТҐ*`MН­Тћ!`6 !ъ6>Й:‘ЙГ©:‘ЙГ(Й!’q:щ!’†wO !Н	~2“юВЩ*’& Н	:‘w>Й!‘:“ѕВк!щ4Гп!щ6 > Й:N<2N!МѕЪ>Й*N& Н	NНоЙНт2Ёю ВГЙ!–p+q!х6 !©6 +6 !Є6 :Єю ТS:ЄюВM!Ё6 НgГ8Н:N2M*ЁMН8ТpНБ!©6Й!”6 !—6 >!—ѕЪ•*—& P	6 !—4Вz!ц6 !ш6 #6 #6 !Є6 *ЁMН8ЪЪ:ЄюЪѕЙ:Ёю*ВОН‡ГСНgНт2ЁГЄ:Ёю:Вї:”ю КлЙ:ЄюВ,НЎЦA<2”O>№ТЙН*ЁMН8Т):Ёю[ВН±!N5!©6ЙГ±:ЄюК5Й!Ў6я#6 >!ўѕЪ°! 6 : <2 O>‘џ/х: !Ў†O !T	е* MНЎб–ЦџБHЎТ~ГK: юВЎ!©6Нтю[В–Н±!N5:ў2ЁЙ:ЎЖ2Ў!ў4В=Й:Ёю[ВјН±Г4:Єю ВИЙ!Є6:Ёю.ВНт2ЁOН8Ъ:ЄюЪмЙ:Ёю*ВьН‡ГяНgГХ:Ёю[ВН±!N5!©6:”ю В%:ь<2”*•6   *•	6 ЙГҐЙ!љq!›6 >
!›ѕЪd*›& I	:љѕВ]>Й!›4ВA> Й:Є<2ЄO *•	:Ёw:Ёю?В†!х6Й!њq!Ё6?!њ:ЄѕТ НgГђЙ!ќq*ќ& л*•~Й!ц6:А2БНт2Ё:ЁЦЦџх:ЁЦ]ЦџБH±Ъє:ЁЦA2ћO>№Т:Ёю ВъНт2ЁГ НЇ	Г·:ЁЦSЦџх:ЁЦQЦџБH±ТI:N<2џНт2ЁЦЦџх:ЁЦЦџБH±Ъ@Г"Нт2ЁГЌНт2ЁЦ02џO>	№Тc!џ6ГЌНт2ЁЦ02™O>	№ЪЌ*џ& НOе*™& Б	л!џsГc*ћ& P	:џw:ћюВ·>!џѕТ±НЇ	:џ2БГВНт2ЁЙ:Ёю_ВО!Ё6=Й!Ј6 >'!ЈѕЪй НE!Ј4ВФЙ!©p+q*Ёе0Н
Й!­r+s+p+q*¬~ю$К7*¬>¦*Єх>¦БH№К&> Й*Є#"Є*¬#"¬Г>ЙН2Ё:ТRќџНЋџЙ:ЁЦЦџЙ!Ї6!њ6 Н=2µю:К™!њ6 :µюВ“HН9НюВЋ>Й!њ6 Н-Гe!µ6 Н»2ґю ВЗН=2ґюКєН-Г©:ЇТД>Й>ЙНД"·Н»2¶:ґЦ Жяџ!Ї¦Тр!ґ5Н»2іГУН¬!µ†ю К\НН-:ЇТ> Й>Й!±p+q:ЇТ,!Ї6 *°DMН9Й:®Т<!®6 НЙ:ЇТzН2ІюВW!®6ГD*њ& L	:Іw:њ<2њюOЪv*Н:ІЙ>ЙН=2№Ц0O>	№Ъ’:№Ц0Й:№ЦAO>№Т¤:Н:№ЦAЖ
ЙН}‡‡‡‡хН}БH±ЙН¬!µ†wЙН»O `iНdеН»бНVЙН[2єO>№Ъ2:єЦЦџ!X¦Ъ!»6:њ!»ѕЪ:»=O !L	NНE!»4ВьНE
НE:єюВ/ЙГЪН.*њ& L	6$LН9kН9Н.НюВXЙГЪЙЏНЇ	Й*KMН^ћ0Нэ20Е¤Н
:0ж20:1ж21ўНк'Ні'Нг:®юяВІҐНЇ	!G6 !  "ЎЙ!яя"џН7	*MН^НnН/	:a/х:БHЎТм!®6я:®юяВъёНЇ	!&6 АНэ2*э"ќЙ> !bѕТ!ДНЇ	> !`ѕТ0ФНЇ	Й!јq:јТE:24ГJ!46 *Ў}жю Кa!44НEГJННИ
*KMН^'НЃ:®юяВ‚гНЇ	¤Нк!36 'Нn:®юяКй:0Тг:fЪХН9НOНоюYКТ#Н9Н.3Нк'НіЙН.:0ж20'Н	'Ні'Е7Н
6Нк'НцЙ!яНj>яНA+л!ыsЙ!К" @яН“Ъ1!Ђ"яГ<*эл*я"яНЙК Н“еНnК	" ябНDНn"э"яНЙ:¤Ц Жяџ!Q¦2ЅТ‚Н:X!W¶Т“НЪГ¤Н:Ъ¤*ЁMНEГ“:ЅТ±НН@ЙН@:O2MНcНѕ!ѕ6#6 >!їѕЪ)*ї& P	~ю К":їЦЦџх:їЦЦџБH±х:їЦЦџБH±х:їЦЦџБH±х:їЦЦџБH±Ъ"!ѕ6 !ї4ВЙ:ѕТ_ННjЪYНO
НjТM*џ"ЎГS*я"ЎНИ
Г3Н@ГbНl*ѕMН1ЙяяџН“µЖяџЙ!  "А"ДН7	*MН^Ђ Н†	\ Н”!  "В:®ЦяЖяџАВхНЋџБHЎТД*В#"ВН§ГќН/	:®юяВе> ДН›µВб9НЇ	Н.Й*В#"А:®ж‡‡‡‡‡_ !Ђ е'Н
!'6 !36 'ЕН
:1/!a¶ТE*Д#"Д>НzµВ?CН9НIНІГЃЙН.!Ж6>!ЖѕЪ‡*Ж& '	~2Зю КЂ:Жю	Вy.Н*ЗMН!Ж4ВQЙ> !”ѕТ›:”=2ГЎ:ь2Й:цТ¬Н\> !”ѕТї:”=2KГЕ:ь2KЙ!А:БѕКСЙ!:KѕВЮН\ЙН:ЁюКнН\Й!Йp+qН€НЯЕ*ИDM!Н
НЖЙН :©ЦЦџх:ЁЦ=ЦџБHЎЪ-Н\:N2OЙл_ л…oЊgЙ_ {Ґoz¤gЙ^#Vл)е))Б	Й_ {µozґgЙ^#Vл)ВdЙ^#Vл|·g}oВnЙ_ {•ozњgЙO {‘ozgЙi`N#F‘ogЙo& •oњgЙHВ©=ВЁЙ                                                          -m^  ю      »  ^ ^и}s, print ctrls|P Place markers|^O Onscreen                                   |V Moving text  |Space Bar returns                             |               |youя  Ma
n M nu.                    < < Ђ еееееееееееееееееееееееееееееееееееееееееееееееееееееееееееее?еееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееее  я H  Display & set the help lev    |  Lяatus line    | (from Main only)     B  Paragraph reform (CONTROL-B)  | R  Ruler line     | ^J  Help  ^K  Block  F  Flags in right-most column    | M  Margins & Tabs | ^Q  Quick ^P  Print  D  Dot commands, print controls  | P  Place markers  | ^O  Onscreen                                          | V  Moving text    |  Space Bar returns                                    |             "Г=                                    
XSID  чЕТУ. 1.0$01 ЕЕ	Н Б! ~=ђW Х! x±Кe~#ГXСБеbx±К‡{жВzг~#гo}oТѓ„ГiС. йпнул пнул пнул пнул пнул пнулурлв рТПНЩЫМЕООПК бЧФПНБФЙЛЙурлв рТПНЩЫМЕООПК бЧФПНБФЙЛЙ пнул пнул пнул пнул      J Б[Гv   ГBГ         хyН‚сЙю Ию	Ию,ИюИюКЙН 
Н ЙНюКН К9 !m6 #ВL !mwНН Кj #КГX :mю ЙН‹=ВлN#FyЙНp ВЙж8Йж0Йл*mл{ѕВў #zѕИ+++В ЙХmѕВЅ #В° СЙ#ВЅ шяСВЄ ЙЕН9 К!SН“ ВyБЙЕН9 К!eНЄ ВyБЙНд юКЙНд юКюА=Й!mnw#Вю Вw!CН“ ВyН† ЙНхНp сцАЙ* w#" ЙНюК3ю.К3Н< К!™8НЄ ВqГC
!БНЄ В…НCН ГD!ЩНЄ ВќНCНp НDxГD!ЭНЄ В№НО Н† G@НО ±°ГD!эНЄ ВПyН† GЂГ±!НЄ ВзНО Н† ±ГD!	НЄ ВНО Н† цНDН ГD!!НЄ В)yюЪЖGНъ НЊ °НDжПюАГ“!%НЄ ВDН юТН† цЗГD!1НЄ ВdВXБГZЕННЊ ±ГD:mюJВtН8цГ~юCВ‰Н8цНDyНDxГDюRВНцАГD* Хл* {•zњТЄ* щЙС~#" Й<жюЪ»ЖюЪВЖЖAOГ GжрЖђ'О@'OН xжЖђ'О@'OГ NН #Ви Г zж8ЙНц‡O!5	NН #NН  Н Г НцжюВ±SН PГ Н. * |НИ}НИ Н Н Й!  9" : ·Кd!яя" <Вd<2 * ГЉН‘В3! ~·Кv5К3* Н”Н.  Н Н Н.Н–W!8 ѕКр#В”
ѕКЬ#ВџѕКБ#ВЄжАю@К§юЂКzжЗЦК‰=Кѓ=КozжАК=zжК2ЦК'ЦКЦКzжВюzжO=!,	НжНцюВ’!)НжГd!%НжНцНИГdCН НэГМJН НэГМRН НэГd!zжКюzж=КaюЪTЦ‡‡O	НжНГdНжН,Н ГМ!	НжНцН±,Н Гз!ГЊ!НжНцН±Гdzж8O!б	НжГё!ЭНжНцН±,Н zжН±Гdy‡‡O!Б	НжН–хН–Wс_Н€Гdy‡‡O!™	НжН–Н…Гdy‡‡O!U	НжГd!iНжzН…ГdН. ?Н * щ!  9" Н+" Н|НM* " Г* щЙ '/7?vЙгйлущыЖОУЦЫЮжоцю"*2:ГНEI  SPHLDI  XCHGPCHLXTHLRET HLT CMC STC CMA DAA RAR RAL RRC RLC NOP CPI ORI XRI ANI SBI IN  SUI OUT ACI ADI CALLJMP LDA STA LHLDSHLDMOV ADD ADC SUB SBB ANA XRA ORA CMP INR DCR MVI LXI STAXINX DAD LDAXDCX RST PSW POP PUSHNZZ NCC POPEP M B C D E H L M A B   D   H   SP  PSW ??=       Г—ГџГГЮГГпГ4Г]ГJГбГNГг"KгГЬ* "ќ!—" !  " "мЇ2P2G22M! " "^" "о! 1е! е++"ее"I>Г2( !y") :] ю Кю!  Ге1НNД—НD>#НпНЮНюКю!E6 ю-В*5НЦAЪУюТУ_ !A^#Vлй—Ур д2	F	

:УУБЁУУжЁХАOJУ‹УУеХЕЇ2[ \ Н—БСбЙ>2G!s" "мЙНЧТУНJ·В±:E·К»Н€Гю=ВУНб" Н	 ГюНЧТУНJКеНб" =КеНб" =ВУЇГз>2 Н ГюНJЪУКУНбе  =В	ЕЕГНбе=ВЕГНбеСБ!югйН;К?НбЪ/"^ж=К?Нб=ВУГJ*^}жрoї "`НDНNВю*^"bН–>:Нп:F·К†Нн^#V#лН–лН·ЪљВmГљНн~Н4#Н·Ъљ}жВ†"^:E·ВЅ*bлНнНћ*^}“В«|’В«*^Н·ЪюГMНJюВУНбеНбеНбСБЙ{‘zЙНЙНЯЪУ+#НЯЪюНNВю
ѕВ	ГпНDЕгН–> НпНп~Н4>	НпгН–> НпНп~Н4БГпНЙ|·ВУНЯЪю}Г:	Ї2?НDНJ2@НбеНб"AеНб"CDMСбГr	е!?6ябуКЋ	Ъ|	" ж=КЋ	Нв	=КЋ	YPНв	!е~·КИ	#^#Vе:?·КБ	* {ЅВБ	zјВБ	бб"е~6 2ГИ	б#wл6яб В“	1СБсбщ* е*ыЙхЕ!P~4·Кэ	#~#F#»Вэ	xєВэ	~#s#r#w>пБсЙНJКЖ
Нб=КD
=ВУеНбСеНDН–НнбЇ•o> њgН–Гю'иd 
  лНDХХН]Нн>#Нп…!:
^#V#г0}“o|љgЪn
Гa
x·т…
хyю0КЊ
НпсжGГ
yНпГ
сжюВ
GГ…
гВZ
ССz·Вю{жю Ъю<КюНн>'Нп{жНп>'НпГю*м##V+^+N+yюТюНDлН–лНнКп
~+НпГг
НNВюГЛ
 x ·АГю.ИюИю*Ию ЙНК'w#Нъ
ВНИНъ
Г ю*В3Нъ
?r#В3Й:E·ВУg!Ђ Ow#wВLq!\ Нш
ю КZхНъ
ю:ВvсЦ@w#Нш
Г{G6 #сНю.Мъ
ННК–Нъ
ГЉ6 #ВВZ6 ГюНЙНЯЪю
w#Г«!e ѕАx#ѕАy#ѕЙл*о}“|љлЙНЕР"оЙ:GюРе!  НЕбЙНJЪУКrНбе! =:EК·ВУНбГ!  ·В! |·ВУ"к!е~·К>#~#VбгЅВ<zјВ<:кбw·Гюгеб В:к·КУ!е~·Вf:кбwС#s#rГюб ВSГУ!е~·Књ:E·К‰6 ГњЕНD~Н4Нн#^#VН]Бб ВwГюНJюВУНбеНблБНЯЪУНD>:НпЕХНЮНюКюю"В!!g~##СБех2ЕНЯЪюНNВю
ѕВ:=2#Взббеy”oxЮ gНD>*НпН–ЕБсбГбю'ВHНЧТУ!љ" НM* љН»§ВУ{СБГбю@ВoН`aН`i"љ>!љГЯ ННґННґЙю=ВxЇГю#ВУ>2™љ ННЕКҐg:™§|КџНВГ‡НґГ‡y!g~§В…лГ8НФGyжрЂOЙЦ0ю
ТУхy‡G‡‡ЂGсЂOЙНJ!  Ке=ВУНб"к!l Ъ~#Вр:] ю?К®НuюяКУ>HXEНё*кеК=б е\ Н—б·В®Ђ Ђw#В/НПГНњюКУЮ:В=WбеН _Н хН БO	{·Вpx±! Кji`" Г®Н Н w#ВsН хНПсВУГ=НњНФжрхНњНФБ°ЙЕеХНЉGС‚WxбБЙ!  НЕЪѕ:G·М€>UTLНёх!Ъ\ ~#ВПЇ2| :] ю Кl!¤НьНu<КУНњюКlю!ЪрНЌхНЉС_*кеНњю КбНњю ЪуГ*  +Нњю	КBюКBю!ЪУw{юТУГ$Хел* #^#Vбr+s+6ГНЕТУл* л" лСs#Сs#rГрсВ‚!xе* й* "мГю!®Нь*оН–Нн* Н–Нн* +Н–Гю
SYMBOLS 
NEXT  PC  END
 Н;=ВУНбНDеН–Ннбе:F·Кз^#VлН–Гл~Н4НнНЮНбюК>ю.В:g·Кю>.ю"еВНбюККw#еГНM=ВУНб:F·К7лбs#r#ГК·ВУ}бw#:F·КК#ГК>ГQ>2MН;!  "I#К~ЪnНбх}ґКУсе=К}=ВУНб"Iб"NЇ2@НГk	НJКУ=! КџНб=ВУеНблбе{•ozњgЪУE|·g}oВІxжКД##е\ ХН—СХН—<КУСБбx±КЕХЂ Ђ~#ВкСБеЕХН—·ВУГЪН—<КУГюНюВНГю !пѕК0#В#ГУНюВУЕНDНФНнНЮНJ·Кю=ВУНбБxюТЃ|·ВУ}юТУНќgA>юН{¤Ag}Н{ґГюИГ{В‘|·ВУ}!wГюеН»Сs#rГюеХЕ:[ жКј _!Ђ ~юКО![ 4·ГП\ Н—·ВО2[ Г§7БСбЙНD>?НпГю
fН—!h"dЙ> еХЕ_Н—БСбЙ~·ИНп#ГьНюИюaШж_Йе!g~·>К&5*d~#"dбЙЖ0ю:ЪпЖГпхжН(сжГ(>Нп>
ГпЕХеН—жбСБЙлХлН–С:E·АНоИНн>.Нп^+~НпВuЙе:E·САНоИНDНt>:НпЙ|Н4}Г4юяТІю ТпюТІю Тп>.Гпл*`}“o|љлЙю/Ию+Ию-ИюИю,Ию ЙЦ0ю
ШЖщюШГУл^#V#лЙХН*мхNyюТУслХх*dе*fелНВКК4+ѕВ4НГВ4бббНЕК-НГ=б#^#VбЙб"fб"dсбх~/…o>яЊg++сГпл!  ю.Кию@ВeНиел^#VбЙю=ВtНиел^ бЙю'ВлНю ЪУю'В“ННЕИю'ВУS_Гzю#ВјННЕКєЦ0ю
ТУ)DM))	O 	ГќлЙю^ВУХ*^#V#Ню^КЕбЙНФ))))µoННЕВјлЙл"лs#r#е!W4бЙю-В  Г(ю+Вл*лГНMю+В%ХННMБл	лГю-АНХНMБхy“_xљWсГН!F6 юWВM6яН!W6 #юКЏю,Вh>Ђ2W  ГkНчНзюКЏННчНзюКЏННчНзюВУWюЃКУ·Йе!яX N!~лбЙНќКёГ°жЙЦ!ъ_ ^я!"ЙН»^#VлЙxюТзН­·>-Кп~Гпх~Нп>=НпсВэ!~Н4ЙНМН–ЙНDНн!п ЕеНФбБ#xюТ)юЪНнГНнН©хХЕНЧТI* " ! 6яН Гq+"`* ~Н4#Н·ЪqхНнсіКm^#VН]Гq~Н4* ~GжАюЂВ€xжюВлГµю@ВҐxюvКлжюКБxж8ю0ВлГБxю6КБю4Кµю5ВЗ>=Нп*~Н4*ГЪжзюВлxж*ВЪ*:E·ВллНоКлНlБСсЙCZMEIABDHSPцфьъю!  "NЇ2MЙу"б+" х! 9с1ехЕХы* ~юпхе:2?!;е~·КF#^#V#~бьяВ9Н›!P~6 ·Кi=G#^#V#~xГXбсКЌ#" л!ќN#FНЯЪЌН*Kл>‚·7Гk	:·В2!е~·Кп#~#V* ЅВпzјВпб~=ВЅх=2ГФwхНhюКФ:E·КФН©Гk	НDс<Н4!aНь* лН]НГk	б В™НNВ2НhК=ВН©Гk	* ННГk	:?·К2*CMD*Aл:@·7Гk	НDН›!  "IН2>*Нп* НЧТU" Н\*"^Гю PASS  !M~·Ие*N+"N|µбВЃw=2~·Й !Ф~ #ѕ#К—ВЉZ Й:·И*wЇ2Й* F#еН„!Hs!А^#VлйЬЬв(YYVVLYGНтВ\НэГ\:ќ»А:ћєЙБб^#V#еЕГи*^#VЙНтКБЕ>Г^СХГ\xюяВ ЇГ`ж8_ Г\*лНиВ\Гв:HюШю?Ш* ###лЙСХГ\НэБЕ>Г^СХСХ><7х*I|µК‘ХЕе!HN* л!yгй·БСК‘х>#НпсН4> НпГ5:M!F¦К§Н5Ъ§с>ГТсх·КС=л_~/wѕ/w{лхКЕН5ТЕНэс=КСХYPБГ®сбЙяГЗВяНЗДяЙЗЗяйЗЗЖПз"ЗАчУ*м##F+N+~юТе/…o>яЊg{№ВzђВб<Й33ГуЇЙ                                                                             @                                                                                                                                                                                            ђ @ !’!BH" H  @HI!$D $BB"I	$„’HI$€I$„ђ‚A"I	!$HЂ„’’!	ђ€„„„	 Ѓ  Ђ„B@„$€„Ђ‘D’HD’HЃ! B"!AI$ђ’BI@$’I!$’II!Ѓ ђ"I$‘$$’I$                                       ’I$’ 	$$‚Iђђ’B@*ЄЄЄЄЄЁ 	I$‰$’I"H€I$ђђ‰$’	@	$’!$€ђI"!	$ђ‘HHIH„BDHII$Hђ"ђH„ЂЂ‰BЂ ђ  	"" @	@ D$ђ!$ЂDBI @ ђ‰Ђ€ђ D $I$!$Ѓ  ЂD@ђ’@H’ђ$DЂђH	€ђ 	!"BђI!" „Ђ„’I$A			$HI’H!  ЂI!" @IA	$"I H ’D@ $‘!	„"B@ Ђ "I$’@ђ   "Hђ€$ђBD‚	D DB’"H‰$Ѓ"   @  @!BH"	!I B	 ђ€€ $$ђ DЂ„„ D"D ‰D!B     ЂA"DH $ H €BH!	$ @€„H B"B$" $Ѓ	A$$ђ’BA ЂЃ B H"‰"H$’	$„‰"Hђ	 @H!H’H‰    D! ЂЂ’ H „DH	BHBD’H’$‘$’Hђ€Iђ’I$Ђ DЂ@B!HЂUUURI! 	@„"I @ ‚"„’$‚ H@Ђ   Ђ B                                  еяяяяяяя~  l^ яяяЇяяяя        яяяюяяюя |     юяяяяяяяь ю ю2  Ђ цЬ  юяяяяюяюю       яяяяяяяя  D яэьяяяяя Ю  юяяяяяяячяяяяяяя     0 яяэЇяя!я        я3я0яя0я 0     яяяяяяїя0 0 02    0"   2яяяя2яю0       яя#юяя#я    @  ээ0я#яяя    2яяэяяяячяяяяяяя:  ** яыяЇяя»я        я»яєяяєя 8     яяяяяяїяё є є"    т  єяяяяєяює       яя»яяя»я    яэёя»яяю  љ  ъяяяяяяяPPA1 Н'ГзPPA _SOFT_ _(C)1993_COPYRIGHT_PIMENOV_PAVEL_	!*>Нl	,НъНъНъНФНШюМи
И·К?=Въ:·КтНя:2$:2%:&G:ё2&уДБыН)	юКіНЮуН5ы:W >ЃНIН‚*л*#"zіКО
·КWѕ#ВґГє! "! 8"Н…ТИ:<2юЪЋ:<2Ї2ГЋЇ2<2НяуНБы2&<2%:$ц2$Н)	юКіНЮуН5ы:W >ЃНIН‚ ! 8"zіК“
·КWѕ#В=ГC=2:&2:%2:$2л"* 8НЅ ННъ НIНІН 	ГтН…ТИ:<2юЪ:<2Ї2ГЇ2	!	.>Нl	ЉГжЇ2&2<уНБН5ы	!	+>Нl	{Н>Ђv=ВнНи
Ни
Ни
НґЙ!8>Нl	:(W =К(Х>ЃХНIН‚СВСНI>ЂН‚В-ЖНъЕНъБ
·ВJл"T	лНD![еН 	юТЁюКѓюКЉюКЉюбСМи
Ми
ИХйНDЇбЙW*T	|ю	ШzНD%"T	> лНIН‚НDЙW*T	|ю)zРНD$"T	%лНIН‚НDЙоБКФЙ: оБКДЕОП РП УНЕЭЕОЙА:      !W#6>42пыv:&уНБН5ыНґ**Нy!еН)	G*!#"!|ЦВ,go"!НD:#/2#И:#<В;2#НDЫOж@xКyж xКрюТ‰юК юКzюК†юКюКЪю	КWюКUюКCюК юКъюКhЙ>я2':(·ВЮ:)Oxю0Шю:Ъ­ю@Шж_юGРGЖ	жGyжрКјxGy**/¦°wG*T	лyжрВРxНн**НyН†Й**px*T	лНIН™ГЧюКbюКеюКьюКjГL:ќюКюКYюК8юКCЙ       р 8оБЮБФШ РПЙУЛ РП ДЙУЛХ - F1 рТПДПМЦЙФШ РПЙУЛ      - F2 йЪНЕОЕОЙЕ РБМЙФТЩ ЬЛТБОБ дЙУЛ ПВТБВПФБО рТЕТЩЧБОЙЕ РПЙУЛБ !W#6ЕХНIН=В§СБ6ЙНЮНе! 8"*DM  !"T	лНРЙ:(<МeДЕНL	Й:&Нт:$оН:%НЙХНIНСЙН)л*T	}лряюК<Г}жрo	  8е	DMбЙ** 8НЅЙНI|Нт}Нт>:Н‚>ѓН‚&ЙХехН4
Н™%ВWсбСЙХх НQ{_ВjсСЙFХ 8НЅ(НІxНтН™СЙхю ТЎ>.юЂЪ­юАТ­>.Н‚сЙх|Нт}НтсЙz/W{/_ЙХх НЩ{_ВКсСЙХехН4
Нт%ВЯсбСЙЕНIБЕGНxНxБЙжю
ЪЖЖ0Н‚ЙХх
·К!Н‚ГсСЙЫo  & p$|юаВ,}-УВ*ЙЕХехГOЕХех*T	лНIН/ 	Cz>Ъb/O~©w,Вc-C|Ж g~©w-ВqсбСБЙХх>Н‚<Н‚В€<Н‚сСЙХх>Н‚<Н‚Вў<Н‚сСЙ      я  PPA Systems
 ЕХех!І~·Вц5*ґ{Уж}Кз|УУУУУВЭ>ЉУ !іЫжЂВ~·К5:¶о2¶Г6ЇУЫ<К9ю xУЫ<ВD{‚_xGВ'Ну>я2ёГн=ЪEНу!ќs#еЫ ЎW{ёТjюАz·{А>_Й№Т~z·{КuЂЂo{ю}ШЁЙю?yИz·:·В‹/·{К‘ЃЃ_:¶·{ИЖЂ©ЙP!неO:ё№!№Вµ~юКЗ4Й6 >2Ї#~=Ві5+ГО6 >2Їy+w+ёВЪ~/w!»~ёН	И4O 	:ёwЙсбСБыЙ>€У :¶У>яУ>УЙх0:¶O<ж±УХВ	СВ	сЙН)	<К 	=ЙЕХе!»яу5КE	F#NыT]#~В<	5ы4yбСБЙх>2»сЙ
   ?  0   ™‹ЊЉќђЄЏ©ѓ”ЕХех:]	2^	с2]	|’Ъ#
G}“Ъ#
O:]	жВЇ	xю?Ъљ	? &?yюЪ¦	 .НN
НWГ
юЪе	жВе	xю=ЪЕ	=&>yюЪС	.$,НN
НWНo%-Г
xю<Ъс	<&=yюЪэ	.$$,НN
%НWНoН(
%-"X	л"V	!  "T	ЇбСБыЙеХ:]	ж‡ЖG$-xН‚zјВ6
xН‚{ЅВA
СбЙХе:]	жКП
е!Z	4бНЩХЕ! X =Вi
л 0! 	DM*[	е	бБСЪП
ЕХЇxхНЩ
ХzЂ=WНЩ
Сс=В‰
x·К¦
НЩ
СБ:^	w#Хл*T	НТ
*X	НТ
*V	НТ
`iНТ
лСs#r#"[	бСЙ}|ЙЕХНrw#ВЫ
СБЙЕХех!Z	~·Кш5*[	+V+^+F+N{Ѓ=_+ХлНh"V	Нh"X	Нh"T	л+СЇxх‚Wс"^	! Т-,е*^	Т8НYНYгz•”W$гНYгz…„W$|ёгЪ8#"[	сГшЕХ~Н‚+В[СБЙgoЙ:]	ЕХехж`	КЃf	
Н‚Х]
Н‚л
Н‚г]
Н‚г-Х
Н‚{ЅВќСлХ,
Н‚{ЅТ«Сс-%
Н‚Х]Н‚СлН‚Х]Н‚СлzјЪєГш|’<G}“<OЙ*V	л*X	Й|’жOz¬жКяzжКя}“GЙЕХеН%В
бСБ|Ж gzЖ WН%ВЙЕХеНэ$В+бСБ|Ж gzЖ WНэ$В?Йхе*V	z„W{…_бсЙЕХехГeЕХехНвНЩЕХеНеЕ6 #ВpБб@ ВnбСБyжGzТ•НУ|ЪЈлХ]НУСл%|’<OН/ЇЕP]w,ВЇBk$ВЇ%Б|Ж gЇw,ВГBk%ВГГшХЕ> Н‚ВЧБСЙЕХехГрЕХехНв{ЅКеХНЩН@ лНэВэСбеХНкН/T}Ж_лН(Сб]НWГшЕХехГ3ЕХехНв}»КeеХНЩлНАялНВAСбХеНклН/T}Ж_+НбСkНWГшеНIГsеН~бЙХНIН‚СЙЕХехНwGН/л|xхХ& o))))ТСслЪС~Ўwжр¶w,В©|Ж g-~ЎwЎ¶wВЅГшр~ЎwЎ¶w,ВУ|Ж g-~Ўwж¶wВксбСБЙЕХе~#В бСБЙЕХе~+ВбСБЙЕ 4& k))))))	 J	БЙх{жozц gсЙ!0>Нl	НъНъ>НRНДН 	юМи
Ми
ИюКh!`еюК¶юКЈ!YгюК‘юКљЙЇНR{·ИЙЇНR{=ИЙ*ґ{%·В®-$"ґЇ2ІЙ*ґ{$·В®,%Г®Х*ґ|Нн}НтСЙНвНЩл`AН~DYНњН 	Нњ!меюКюКюКюКЙ{№ШЙ{·АЙ{бЙ!;еХНW
Нъ{<В.Н 	СбНWНґЙНЇИН$>#У*"9  Н 	!*>Нl	+Н~ёНъНъНъНФ >НPН,Н 	юК!€еюКюКэюКЩюА{·КП=КА:&<юPЪјЇ2&Й:%<юЪЛ>2%Й:$о2$ЙЙ{іКП=Кр:&·Вл>P=2&Й:%=Вщ>2%ЙИЇНP>НPЙ{юРЇНP>НPЙу:&НБН5ыНи
НґЙХНI:&Нт:%Н:$оНСЙ	ХЕНњБPНIН‚СЙ:$о2$Й! 8"*!"T	НzЙ*T	}юТђ,"T	**ряГ"Н)|·ВЮ}жрВЮНФ:%=2%ВL>2%НaВL:&·КН=2&уНб>xН‰ГL>2%>O2&уНБГLНй*T	-"T	Нz**D}жрOН) Гs! 8ГжО	Н  Н№®	Н 
КН НcЪю Т2Нє	Н 
КН НcЪ+·К+юТ+2КO>2ЛК]ЂГU2МГЌ!Л^ #~Ц0ШюЪu?ЙWx7?ШOШШЃШ‚ШGВi7?xЙ	¬Н :Н _ЦdЪ¤Гљz·К±Ж0OХН№С{ _Ц
ЪѕГґz·КЛЖ0OХН№С{Ж0OН№	єН :КЖ0OН№ :НOН№! "И :МOН!№*ИDMН$№Н'№Ђ>?ўВХ	ЕН С*И~#"Ию Т'>.OХН№СВ:М<2М:Л<2Лю	ВтН	№ю КВюКВюКcюКЋюPКГD>2Л:К<2КюВЌ>2К2М:Н<2НЦ ВЌ2НГЌ>2Л:МЦ2М:К=2КВЌ>2К>!2М:Н=2Н<ВЌ>џ2НГЌН№Г№жН–J^a[
DUMP-DISK A:   Version 1.0

(C)opyright by AK(R)UP, Kaliningrad 1990.
All rights reserved.


\bufer: 100H..4FFH
->      - wpered
<-      - nazad
<P>     - zadanie pozicii
<SPACE> - wyhod w [MicroDOS\

$J
dorovka: $
sektor: $
$LJ                        ! ж~#|ёВп}№ВпГ ееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееD_POS	;
	MOV	D,A		;
	MVI	E,0		;
	MVI	A,081h		;
	CALL	ABS_DE		; ХУФБОПЧЙН "ЗТБДХУОЙЛ"
	CALL	PUTCXY		;
	LXI	D,0400h		;
	LXI	H,BUF_DISK	;
F_LOOP_01:
	SHLD	FIND_PTR	; уПИТБОСЕН ЧПЪНПЦОПЕ
	LXI	B,FIND_BUF	; ОБЮБМП РПУМЕДПЧБФЕМШОПУФЙ
;; рТПЧЕДЕН РПЙУЛ УФТПЛЙ Ч УЮЙФБОПН УЕЛФПТЕ.
F_LOOP_02:
	DCX	D		;
	MOV	A,D		;
	ORA	E		;
	JZ	F_LOOP_QUIT	;чЩКФЙ ЕУМЙ ЛПОЮЙМУС УЕЛФПТ
	LDAX	B		;
	ORA	A		;
	JZ	F_YES_FIND	;
	CMP	M		; уТБЧОЙЧБЕН У ПВТБЪГПН.
	INX	H		;
	JNZ	F_LOOP_01	;
	INX	B		;
	JMP	F_LOOP_02	;
F_YES_FIND:
	DCR	A		;
	STA	FIND_FLAG	; ТБЪТЕЫЙН РТПДПМЦБФШ РПЙУЛ
	LDA	CULINDER	;--+
	STA	FIND_CUL	;  !
	LDA	SECTOR		;  ! рЕТЕОЕУЕН ХЛБЪБФЕМШ
	STA	FIND_SECTOR	;  ! ФЕЛХЭЕЗП ДБНРБ Ч ТБ-
	LDA	HEAD		;  ! ВПЮЙЕ СЮЕКЛЙ.
	STA	FIND_HEAD	;--+
;; уПИТБОЙН ХЛБЪБФЕМШ РПЙУЛБ ДМС ЧПЪНПЦОПУФЙ РТПДПМЦЙФШ.
	XCHG			;
	SHLD	F_COUNT_END	;
	LHLD	FIND_PTR	;
;; HL - бВУПМАФОПЕ УНЕЭЕОЙЕ ОБКДЕОПК УФТПЛЙ.
	LXI	D,BUF_DISK	;
	CALL	NEG_DE		; рПМХЮЙН -BUF_DISK
	DAD	D		;
;; HL - мПЗЙЮЕУЛПЕ уНЕЭЕОЙЕ Ч ДБНРЕ ОБКДЕООПК УФТПЛЙ.
	LXI	D,0100h		;
	LXI	B,SOOB_FIND_END	;
	CALL	W_PUTSXY_Z	;
	LXI	D,1500h		;
	CALL	ABS_DE		;
	CALL	PUT_WORD_HEX	;
	CALL	KEY_DELAY	;
	JMP	F_QUIT		;

F_LOOP_QUIT:	
	CALL	DISK_INC	;
;; еУМЙ ЖМБЗ Carri УВТПЫЕО ФП РТПЙЪПЫМП РЕТЕРПМОЕОЙЕ.
	JNC	F_FIND_EXIT	;
	LDA	FIND_COUNT	;
	INR	A		;
	STA	FIND_COUNT	;
	CPI	20		;
	JC	F_FIND_LOOP	;
	LDA	FIND_POS	;
	INR	A		;
	STA	FIND_POS	;
	XRA	A		;
	STA	FIND_COUNT	;
	JMP	F_FIND_LOOP	;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;		рТПЙЪЧЕДЕН РТЕТЩЧБОЙЕ РПЙУЛБ.		;;
F_F_INTERRUPT:
	XRA	A		;
	STA	FIND_FLAG	;
	LXI	D,1A09h		;
	LXI	H,2E09h		;
	MVI	A,00010110b	;
	CALL	ACTIV		;
	LXI	B,F_INTER_SOOB	;
	JMP	F_INT_EXIT	;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;		   " рПЙУЛ ЪБЛПОЮЙМУС"			;;
F_FIND_EXIT:
	XRA	A		;
	STA	CULINDER	; рЕТЕИПД ОБ ОХМЕЧПК ФТЕЛ.
	STA	FIND_FLAG	; оемшъб ртпдпмц. рпйул
	INR	A		;
	DI			;
	CALL	SET_CULIND	;
	CALL	DISK_READ	;
	EI			;
	LXI	D,1A09h		;
	LXI	H,2B09h		;
	MVI	A,00010110b	;
	CALL	ACTIV		;
	LXI	B,F_END_SOOB	;
F_INT_EXIT:
	MVI	D,1Ch		;
	CALL	PUTSXY_Z	;
	MVI	A,80h		;
F_F_EX_00:
	HLT			;
	loop	A,F_F_EX_00	;
F_QUIT:
	CALL	DEACTI		;
	CALL	DEACTI		;
	CALL	DEACTI		;
	CALL	RE_DISK_POS	;
	RET			;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;   рТПГЕДХТБ ПТЗБОЙЪБГЙЙ ЪБРТПУБ УФТПЛЙ ДМС РПЙУЛБ.	;;
F_READ_STRING:
	LXI	D,0F07h		;
	LXI	H,3808h		;
	MVI	A,00010110b	;
	CALL	ACTIV		;
	LDA	FIND_POS	;
	MVI	B,40		;
	MOV	D,A		;
	MVI	E,0		;
	DCR	A		;
	JZ	F_R_STR_DONE	;
	PUSH	D		;
	MVI	A,081h		;
F_DONE_LOOP:			; рТПТЙУХЕН ЗТБДХУОЙЛ.
	PUSH	D		;
	CALL	ABS_DE		;
	CALL	PUTCXY		;
	DCR	B		;
	POP	D		;
	loop	D,F_DONE_LOOP	;
	POP	D		;
	INR	D		;
F_R_STR_DONE:			;
	CALL	ABS_DE		;
	MVI	A,080h		;
F_R_LOOP:
	CALL	PUTCXY		;
	INR	D		;
	loop	B,F_R_LOOP	;
	INR	E		;
	LXI	B,SOOB_50	;
	LXI	D,0101h		;
	CALL	W_PUTSXY_Z	;
	LXI	B,FIND_BUF	;
	LXI	D,0801h		;
	PUSH	B		;
	CALL	W_PUTSXY_Z	;
	POP	B		;
F_R_SET_LOOP:
	LDAX	B		; хУФБОПЧЙН ЛХТУПТ ОБ ЛПОЕГ
	INX	B		;
	INR	D		;
	ORA	A		;
	JNZ	F_R_SET_LOOP	;
	DCX	B		; лПТЕЛФЙТХЕН ХЛБЪБФЕМШ
	DCR	D		; Й УЮЕФЮЙЛ ЪБРПМОЕОЙС.
	XCHG			; ХУФБОБЧМЙЧБЕН ЛХТУПТ.
	SHLD	CURSOR		;
	XCHG			;
	CALL	CINV		;
F_R_KEY_LOOP:
	LXI	H,F_R_KEY_LOOP	;
	PUSH	H		;
	CALL	KEY_DELAY	;
	CPI	10h		;
	JNC	F_R_SYMBOLS	; оБЦБФБ УЙНЧПМШОБС ЛМБЧЙЫБ
	CPI	02h		; ==== Enter ====
	JZ	F_R_ENTER	;
	CPI	03h		; ==== ъБВПК ====
	JZ	F_R_ZABOY	;
	CPI	04h		; ==== LEFT =====
	JZ	F_R_ZABOY	;
	CPI	0Eh		; ===== F4 ======
	POP	H		;
	POP	D		;
	CZ	DEACTI		;
	CZ	DEACTI		;
	RZ			;
	PUSH	D		;
	PCHL			;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;		пВТБВПФЛБ ОБЦБФЙС ЛМБЧЙЫЙ ччпд		;;
F_R_ENTER:
	CALL	CINV		;
	XRA	A		; ХУФБОПЧЙН уфпр ВБКФ.
	STAX	B		;
	POP	H		;
	RET			;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;		пВТБВПФЛБ ОБЦБФЙС ЛМБЧЙЫ ЪБВПС		;;
F_R_ZABOY:
	MOV	D,A		;
	LHLD	CURSOR		;
	MOV	A,H		;
	CPI	9		;
	RC			;
	DCX	B		;
	MOV	A,D		;
	CALL	CINV		;
	DCR	H		;
	SHLD	CURSOR		;
	MVI	A,20h		;
	XCHG			;
	CALL	ABS_DE		;
	CALL	PUTCXY		;
	CALL	CINV		;
	RET			;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;	пВТБВПФБЕН ОБЦБФЙЕ УЙНЧПМШОПК ЛМБЧЙЫЙ		;;
F_R_SYMBOLS:
	MOV	D,A		;
	LHLD	CURSOR		;
	MOV	A,H		;
	CPI	41		;
	MOV	A,D		;
	RNC			;
	STAX	B		;
	INX	B		;
	CALL	CINV		;
	INR	H		;
	SHLD	CURSOR		;
	DCR	H		;
	XCHG			;
	CALL	ABS_DE		;
	CALL	PUTCXY		;
	CALL	CINV		;
	RET			;
;;
;; оБКФЙ:
;;
SOOB_50:
	DB	0EEh,0C1h,0CAh,0D4h,0C9h,':',000h
;;
;; оБКДЕОП РП УНЕЭЕОЙА:
;;
SOOB_FIND_END:
	DB	0EEh,0C1h,0CAh,0C4h,0C5h,0CEh,0CFh
	DB	020h,0D0h,0CFh,020h,0D3h,0CDh,0C5h
	DB	0DDh,0C5h,0CEh,0C9h,0C0h,":     ",000h

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
TMP_DONE:			;
	LXI	H,C_ALT_INV	;
	INX	H		;
	MVI	M,1h		;
	MVI	A,34h		;
	STA	DISK_MASKA	;
	EI			;
	HLT			;
	LDA	CULINDER	;
	DI			;
	CALL	SET_CULIND	;
	CALL	DISK_READ	;
	EI			;
	CALL	RE_DISK_POS	;
	LHLD	POSITION	;
	CALL	RE_PRINT_POS	;	

KEY_LOOP_IN:			;
	LXI	H,KEY_LOOP_IN	;
	PUSH	H		;
	CALL	IN_KEY		; ЧПЪШНЕН  ЛПД    ЛМБЧЙЫЙ
	MOV	B,A		; УПИТБОЙН   Ч   ТЕЗЙУФТЕ
	LHLD	MIG_CURSOR	; ЮЙФБЕН  УЮЕФЮЙЛ НЙЗБОЙК
	INX	H		; ХЧЕМЙЮЙЧБЕН ОБ  ЕДЙОЙГХ
	SHLD	MIG_CURSOR	; УФБЧЙН ОБ  НЕУФП  РПФПН
	MOV	A,H		; РТПЧЕТЙН ЪОБЮЕОЙЕ  ЛПДБ
	SUI	5h		; ЕУМЙ  РТЕЧЩУЕМП  РТЕДЕМ
	JNZ	K_L_1		; ЙОЧЕТФЙТХЕН  ЛХТУПТ
	MOV	H,A		; ЙОБЮЕ  РТПУФП РЕТЕИПДЙН
	MOV	L,A		; ОБ РТПЧЕТЛХ Й ПВТБВПФЛХ
	SHLD	MIG_CURSOR	; ЛПДБ  ОБЦБФПК  ЛМБЧЙЫЙ.
	CALL	CINV		;
	LDA	ST_CURSOR	;
	CMA			;
	STA	ST_CURSOR	;
K_L_1:
	INR	B		;
	RZ			;
;;
;; рПФХЫЙН ЛХТУПТ ЙЪ ПУОПЧОПЗП ПЛОБ ТЕДБЛФПТБ.
;;
	LDA	ST_CURSOR	;
	INR	A		;
	JNZ	K_L_2		; ЕУМЙ ЗПТЙФ РПФХЫЙФШ.
	STA	ST_CURSOR	;
	CALL	CINV		;
K_L_2:
	DCR	B		;
	IN	01h		;
	MOV	C,A		;
	ANI	01000000b	; НБУЛБ ЛМБЧЙЫЙ "ху"
	MOV	A,B		;
	JZ	ALT_ADD_KEY	;
	MOV	A,C		;
	ANI	00100000b	; НБУЛБ ЛМБЧЙЫЙ "ху"
	MOV	A,B		;
	JZ	CNTR_ADD_KEY	;
KEY_DONE:
	CPI	010h		;
	JNC	SUMBOLS_KEY	;
;;
;; пВТБВПФБЕН ЧБТЙБОФ ОБЦБФЙС ОБ ЖХОЛГЙПОБМШОХА ЛМБЧЙЫХ
;;
	CPI	04h		;===== чмечп =====
	JZ	LEFT_KEY	;
	CPI	05h		;==== ччети ======
	JZ	UP_KEY		;
	CPI	06h		;==== чртбчп =====
	JZ	RIGHT_KEY	;
	CPI	07h		;===== чойъ ======
	JZ	DOWN_KEY	;
	CPI	08h		;===== HOME ======
	JZ	HOME_KEY	;
	CPI	09h		;====== уфт ======
	JZ	STR_KEY		;
	CPI	0Dh		;====== F3 =======
	JZ	F3_KEY		;
	CPI	0Eh		;====== F4 =======
	JZ	US_QUIT		;
	CPI	03h		;===== ъбвпк ======
	JZ	LEFT_KEY	;
	CPI	0Bh		;====== F1 ========
	JZ	FIND_BEGIN	;
	CPI	0Ch		;====== F2 ========
	JZ	FIND_DONE	;
	RET			;

;;
;; пВТБВПФБЕН ОБЦБФЙС УЙНЧПМШОПК ЛМБЧЙЫЙ.
;;
SUMBOLS_KEY:
	MVI	A,0FFh		;
	STA	FATAL		; ХУФБОПЧЙН ЖМБЗ ЙЪНЕОЕОЙК
	LDA	DE_MODE		;
	ORA	A		;
	JNZ	SUM_K_TEXT	;
;;
;;	пВТБВПФЛБ ЛПДПЧПЗП ТЕЦЙНБ.
;;
	LDA	MODE_NIBL	;
	MOV	C,A		;
	MOV	A,B		;
	CPI	30h		; ХИПДЙН ЕУМЙ УРЕГ УЙНЧПМ.
	RC			;
	CPI	3Ah		;
	JC	SUM_K_CIFRA	; ПВТБВПФБФЙ ОБЦБФЙЕ ГЙЖТЩ
;;
;; ОБЦБФБ "ВХЛЧЕООБС" ЛМБЧЙЫБ.
;;
	CPI	40h		;
	RC			; ХИПДЙН ЕУМЙ УРЕГ УЙНЧПМ.
	ANI	01011111b	; УЧЕДЕН Л РТПРЙУОЩН мбф.
	CPI	47h		;
	RNC			; ХИПДЙН ЕУМЙ ОЕ HEX ВХЛЧБ
;;
;; оБЦБФБ ПДОБ ЙЪ ВХЛЧ: "A B C D E F"
;;	
	MOV	B,A		;
	ADI	9		;
SUM_K_CIFRA:
	ANI	00001111b	;
	MOV	B,A		;
	MOV	A,C		;
	ANI	11110000b	;
	JZ	SUM_K_H_NIBL	; РЕТЕИПД ЕУМЙ НМБДЫЙК ОЙВМ
	MOV	A,B		;
	RLC			;
	RLC			;
	RLC			;
	RLC			;
	MOV	B,A		;
SUM_K_H_NIBL:
	MOV	A,C		;
;; C = A:
;; УФБТЫЙК ОЙВМ: 11110000 }
;; НМБДЫЙК ОЙВМ: 00001111 }
	LHLD	POSITION	;
	CMA			;
	ANA	M		;
	ORA	B		;
	MOV	M,A		;	
	MOV	B,A		;
	LHLD	CURSOR		;
	XCHG			;
	MOV	A,C		;
	ANI	11110000b	;
	JNZ	SUM_K_00	; ЕУМЙ УФПТЫЙК ОЙВМ ПВПКФЙ.
	DCR	D		;
SUM_K_00:
	MOV	A,B		;
	CALL	W_PUT_HEX	;
	LHLD	POSITION	;
SUM_K_02:
	CALL	RE_PRINT_POS	;
	CALL	RIGHT_KEY	;
	RET			;
SUM_K_TEXT:
	LHLD	POSITION	;
	MOV	M,B		;
	MOV	A,B		;
	LHLD	CURSOR		;
	XCHG			;
	CALL	ABS_DE		;
	CALL	PUT_CHAR	;
	JMP	SUM_K_02	;
	
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;	вМПЛ ПВТБВПФЛЙ ТЕЗЙУФТБГЙЙ ОБЦБФЙС ЛМБЧЙЫЙ "уу"	;;
;;   У  ДТХЗЙНЙ ХРТБЧМСАЭЙНЙ ЛМБЧЙЫБНЙ ЕУМЙ ЛМБЧЙЫЙ ОЕ	;;
;;   РПДДЕТЦЙЧБЕФУС ПВТБВПФЮЙЛПН ХРТБЧМЕОЙЕ РЕТЕ ДБЕФУС	;;
;;   ОБ ДП-ПВТБВПФЛХ УФБОДБТФОЩН ПВТБВПФЮЙЛПН.		;;

CNTR_ADD_KEY:
	CPI	06h	; ======= "уу"+ RIGHT_KEY ========
	JZ	CC_RIGHT_KEY;
	CPI	04h	; ======== "уу"+ LEFT_KEY ========
	JZ	CC_LEFT_KEY;
	CPI	07h	; ======== "уу"+ DOWN_KEY ========
	JZ	CC_DOWN_KEY;
	CPI	05h	; ========= "CC"+ UP_KEY =========
	JZ	CC_UP_KEY;
	JMP	KEY_DONE;

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;   вМПЛ ПВТБВПФЛЙ ТЕЗЙУФТБГЙЙ ОБЦБФЙС "ху" УПЧНЕУФОП	;;
;; У  ЛБЛПК-ФП ДТХЗПК ЛМБЧЙЫПК (ЛПД УПДЕТЦЙФУС Ч "A")	;;
;;							;;
ALT_ADD_KEY:
	LDA	KEY_NUM	;
	CPI	11h	; ==== "ху" + "1" ====
	JZ	US_HELP	;
	CPI	13h	; ==== "ху" + "3" ====
	JZ	US_GOTO	;
	CPI	15h	; ==== "ху" + "5" ====
	JZ	US_SERVISE;
	CPI	17h	; ==== "ху" + "7" ====
	JZ	US_QUIT	;
	RET		;

BUF_OF_VECTOR:	DW	0000h	; вХЖЕТ ДМС ЧЕЛФПТБ.
MIG_CURSOR:	DW	0000h	; УЮЕФЮЙЛ НЙЗБОЙК.
ST_CURSOR:	DB	0h	; УФБФХУ ЛХТУПТБ.
				; ( ЗПТЙФ - ОЕ ЗПТЙФ )
HEAD:		DB	00000100b; вБКФ ХЛБЪЩЧБАЭЙК ОБ
				; ОПНЕТ ЗПМПЧЛЙ.
SECTOR:		DB	01h	; ПРТЕДЕМСЕФ ОПНЕТ УЕЛФПТБ.
CULINDER:	DB	04h	; ОПНЕТ ГЙМЙОДТБ.
FATAL:		DB	00h	; ЖМБЗ ЙЪНЕОЕОЙК.
DE_MODE:	DB	0h	; ЖМБЗ ТЕЦЙНБ "SUM-CODE"
MODE_NIBL:	DB	11110000b; ХЛБЪБФЕМШ ОЙВМБ.
		;;
		;; 11110000b - уФБТЫЙК ОЙВМ
		;; 00001111b - нМБДЫЙК ОЙВМ
		;;
POSITION:	DW	BUF_DISK; ХЛБЪБФЕМШ ОБ ФЕЛХЭЙК
				; ВБКФ

;;
;; оБЮБФШ РПЙУЛ РП ДЙУЛХ - F1
;;
SOOB_20:
	DB	0EEh,0C1h,0DEh,0C1h,0D4h,0D8h
	DB	020h,0D0h,0CFh,0C9h,0D3h,0CBh
	DB	020h,0D0h,0CFh,020h,0C4h,0C9h
	DB	0D3h,0CBh,0D5h
	DB	' - F1',000h
;;
;; рТПДПМЦЙФШ РПЙУЛ      - F2
;;
	DB	0F0h,0D2h,0CFh,0C4h,0CFh,0CCh
	DB	0D6h,0C9h,0D4h,0D8h,020h,0D0h
	DB	0CFh,0C9h,0D3h,0CBh
	DB	'      - F2',000h
;;
;; йЪНЕОЕОЙЕ РБМЙФТЩ ЬЛТБОБ
;;
	DB	0E9h,0DAh,0CDh,0C5h,0CEh,0C5h
	DB	0CEh,0C9h,0C5h,020h,0D0h,0C1h
	DB	0CCh,0C9h,0D4h,0D2h,0D9h,020h
	DB	0DCh,0CBh,0D2h,0C1h,0CEh,0C1h
	DB	000h
;;
;; дЙУЛ ПВТБВПФБО
;;
F_END_SOOB:
	DB	0E4h,0C9h,0D3h,0CBh,020h,0CFh
	DB	0C2h,0D2h,0C1h,0C2h,0CFh,0D4h
	DB	0C1h,0CEh,000h
;;
;; рТЕТЩЧБОЙЕ РПЙУЛБ
;;
F_INTER_SOOB:
	DB	0F0h,0D2h,0C5h,0D2h,0D9h,0D7h,0C1h
	DB	0CEh,0C9h,0C5h,020h,0D0h,0CFh,0C9h
	DB	0D3h,0CBh,0C1h,000h

	Public	HEAD		;
	Public	SECTOR		;
	Public	CULINDER	;
	Public	FATAL		;
	Public	BUF_OF_VECTOR	;
	Public	POSITION	;
	Public	DE_MODE		;
	Public	MODE_NIBL	;

	External DISK_MASKA	;
	External RE_DISK_POS	;
	External RE_PR_DISK	;
	External SET_CULIND	;
	External DISK_READ	;

	External STR_KEY	;
	External CC_RIGHT_KEY	;
	External RIGHT_KEY	;
	External HOME_KEY	;
	External CC_LEFT_KEY	;
	External LEFT_KEY	;
	External F3_KEY		;
	External DOWN_KEY	;
	External CC_DOWN_KEY	;
	External UP_KEY		;
	External CC_UP_KEY	;

	External US_GOTO	;
	External US_QUIT	;
	External US_HELP	;

	External START_PPA	;
	External SCREEN_CLS	;
	External PUTSXY_Z	;
	External W_PUTSXY_Z	;
	External CINV		;
	External INV_LINE	;
	External CINV_ABS	;
	External C_ALT_INV	;
	External GOR_STREL	;
	External VER_STREL	;
	External DUMP_HEX	;
	External DUMP_TEXT	;
	External LINE_HEX	;
	External LINE_TEXT	;
	External W_PUT_HEX	;
	External PUT_HEX	;
	External PUT_NIBL	;
	External NEW_DUMP	;
	External LOAD_OFFSET	;
	External Y_N_WRITE	;
	External DA_NET		;
	External PTR_SET	;
	External MENU		;
	External PAINT_SCREEN	;
	External PUSK		;
	External DISK_COMMAND	;
	External DISK_INC	;

	External RE_PRINT_POS	;
	External PUT_CHAR	;
	External PUT_WORD_HEX	;
	External NEG_DE		;

	END


KEY	;
	External HOME_KEY	;
	External CC_LEFT_KEY	;
	External LEFT_KEY	;
	External F3_KEY		;
	External DOWN_KEY	;
	External CC_DOWN_KEY	;
	External UP_KEY		;
	External CC_UP_KEY	;

	External US_GOTO	;
	External US_QUIT	;
	External US_HELP	;

	External START_PPA	;
	External SCREEN_CLS	;
	External PUTSXY_Z	;
	External W_PUTSXY_Z	;
	External CINV		;
	External INV_LINE	;
	External CINV_ABS	;
	External C_ALT_INV	;
	External GOR_STREL	;
	External VER_STREL	;
	External DUMP_HEX	;
	External DUMP_TEXT	;
	External LINE_HEX	;
	External LINE_TEXT	;
	External W_PUT_HEX	;
	External PUT_HEX	;
	External PUT_NIBL	;
	Extя"*! "T	НЙ*T	}·К*-"T	** "*НyЙН)|юЪX}жрюрВXНФН…ЪLЇ2&уНБуН5ы**НґЙН,*T	,"T	Н**D}жрOН)  }жрo:(·ДQМЩНL	Й:%<2%юШ>2%Нa7И:&<юPР2&уНб>XН‰ы7Й	!
,>Нl	НФѓНъ® 	НяНи
·Й:'<АЇ2'”!	.>Нl	Нъ 	Ня·Д_Ни
ЙНъяНњН 	юК1юК3юК"юВНњy±/OКГ yЙЕХех:%У:пжыG:$°2п 8>„уНбУН«ысбСБЙЕХех:%У:пжыG:$°2п 8>ҐуНбУНЏысбСБЙУНШЙЫТ’Ы КУВВЙ!ґЫТ®ЫРТґЫйххНб> Н‰сНбУ>Н‰сЙхЫЪЩсЙх:пУЫЪвсЙ >я2':(·ВE:)Oxю0Шю:Ъю@Шж_юGРGЖ	жGyжрК#xGy**/¦°wG*T	лyжрВ7xНн**НyН†Й**px*T	лНIН™Г>:(·М†Н†Й>р2)*T	:(·&Вu&5"T	**}цo"*НyЙ:(·В»*T	лzю6ЪћННеЙ:)юр/2)К¶**#"*Нyл"T	Й*T	|юЪЛННеЙ$"T	**#"*НyЙ:(·М Н Й>р2)*T	&"T	**}жрo"*НyЙ:(·В**T	лzю	Ш:)юр/2)В¶**+"*НyГ¶*T	|ю	Ш%"T	**+"*НyЙН)еНеб}жИхНWс=ГK:(/2(·Вz*X	T&;"X	bНWННЕН@Й*X	T&"X	bНWННeН@ЙъБРЙУБФШ УЕЛФПТ ОБ ДЙУЛ ? дБ    оЕФ дПТПЦЛБ  [    ] ( 00h - 4Fh ) уЕЛФПТ   [   ]  ( 0 - 5 ) уФПТПОБ  [   ]  ( 0 - 1 ) _____ лМБЧЙЫЙ ХРТБЧМЕОЙС:________________________  уФТЕМЛЙ - хРТБЧМЕОЙЕ ЛХТУПТПН.  F3 - рЕТЕЛМАЮЕОЙЕ ТЕЦЙНБ ТЕДБЛФПТБ HEX - ASCII.  F5 - рЕТЕЛМАЮЕОЙЕ ТЕЗЙУФТБ ЛМБЧЙБФХТЩ  (от/чт).  уу + чЧЕТИ (чОЙЪ)  -  "ыБЗБОЙЕ"  РП   УЕЛФПТБН.  уу + чМЕЧП (чРТБЧП) -  оБЮБМП  (ЛПОЕГ)  УФТПЛЙ.  ху + <ГЙЖТБ> -  чЩВПТ   "РБОЕМШЛЙ" У  ЖХОЛГЙЕК. __________________________ PPA Soft Systems _____ чЩКФЙ ЙЪ ТЕДБЛФПТБ ? гЧЕФ РЕТЕДОЕЗП РМБОБ  [    ] гЧЕФ ЪБДОЕЗП РМБОБ    [    ]                     зZ~<з       зяЅ™яяЫяз   f f f f f язffB f f f f f f f f  BBffзя f f f f      "fооf"                         DfwwfD            рррррррррррррррррррррррр         яяяяяяяяяяяяяяяяяяяяяяя        $’I$’I$’’I$’I$’I$’I$’I$’ пппппппппппппп    Ђ„ДЖжзжЖД„Ђ     !#cgзgc#!   яяяяяяяяяяяяя      ҐҐ ҐҐҐҐҐҐ       eeeеmmmmз     ж©"F¦©©¦F„©ж      ппп            зBfзBBBзfB       BBBBBBзfB       BfзBBBBBB         B"п"B           D„п„D                                                                                         BB BBBBBB              ҐҐҐ      ¦¦п¦¦¦п¦¦       	 F¦¦F 	        ©ҐDB"©‰         еЄЄкеF¦¦F             DBBB      "BDDDDDB"       DB"""""BD         ҐfяfҐ           BBзBB        DBBB                 з           BB              €„DB"!        ж©©­нл«©ж       зBBBBBЖFB       п©„DB"!©ж       ж©!!fB"©п       c""пЄ¦fb"       ж©!!о€€€п       ж©©©о€€„F       DDDDB"!©п       ж©©©ж©©©ж       Ж"!!з©©©ж        BB   BB        DBB   BB        !"BD„DB"!         з  з          „DB"!"BD„       BB BB"©©ж       ж€кллл©©ж       ©©©п©©¦F@       оҐҐҐжҐҐҐо       fҐ‰€€€‰Ґf       О¦ҐҐҐҐҐ¦О       пҐ…†Ж†…Ґп       М„„†Ж†…Ґп       GҐ©«€€‰Ґf       ©©©©п©©©©       fBBBBBBBf       ЖЄЄ"""""c       ­Ґ¦¦Ж¦¦Ґ­       пҐ…„„„„„М       ©©©©©йпЇ©       ©©©«лн­©©       F¦©©©©©¦F       М„„„жҐҐҐо      #"жлй©©©©ж       ­ҐҐ¦жҐҐҐо       ж©©"F„©©ж       fBBBBBZЫя       ж©©©©©©©©       @F¦©©©©©©       ¦Їпйй©©©©       ©©©¦FF¦©©       fBBBfҐ™™™       п©‰„DB*©п       fDDDDDDDf       !"BD„€        f"""""""f              ©¦F@   я                         "@B     еЄЄж"Ж          кҐҐҐ¦Ж„„Њ       ж©€€©ж          еЄЄЄ¦f""b       ж©€п©ж          ЖDDDЖDEeb     ЖЄ"жЄЄЄе          ­ҐҐҐе¦„„Њ       fBBBBF BB     F¦¦""""b ""       ­Ґ¦Ж¦Ґ„„Њ       fBBBBBBBF       ййййй®          ҐҐҐҐҐж          ж©©©©ж        М„„жҐҐҐо        c""жЄЄЄе          М„„Ґек          ж©bД©ж          beDDоDD@        еЄЄЄЄЄ          @F¦©©©          ¦пйй©©          ©¦FF¦©        Ж"!з©©©©          пҐDBЄп          #BBBDBBB#       BBBBBBBBB       ДBBB"BBBД                я    я             ] » ] » ] » ] » рррррррр’I$’I$’I$’I$’I$’BBBBBBBBBBBBBBBBBBBBBBBООBBBBBBBBBBBBBОBBОBBBBBB$$$$$$$¬¬$$$$$$$$$$$$$$оо       BBBBBBОBBО      $$$$$$¬  ¬$$$$$$$$$$$$$$$$$$$$$$$$$$$$¬  о            о  ¬$$$$$$       оо$$$$$$$      ОBBОBBBBBBBBBBBBBОО              ssBBBBBBB       яяBBBBBBBBBBBBBBяя       BBBBBBBssBBBBBBB       яя       BBBBBBBяяBBBBBBBBBBBBBsBBsBBBBBB$$$$$$$55$$$$$$$      w5$$$$$$$$$$$$5w            я  Ѕ$$$$$$$$$$$$Ѕ  я      $$$$$$55$$$$$$      я  я      $$$$$$Ѕ  Ѕ$$$$$$      я  яBBBBBB       яя$$$$$$$BBBBBBя  я      $$$$$$$яя              ww$$$$$$$      sBBsBBBBBBBBBBBBsBBs      $$$$$$$ww       $$$$$$$ЅЅ$$$$$$$BBBBBBя  яBBBBBB       ООBBBBBBBBBBBBBBss                     (C)1993 karaganda awtorskoe prawo pimenow pawel alekseewi~ 470075 karaganda ul.40 let kazahstana d.39/3 kw.1programma peredana dlq rasprostraneniq firme "sistemotehnika" 400074 wolgograd a/q 40 SEE YOU SOON d(                                                                  "T0pшp0T"  ZfҐЫз з зЫҐfZ  ЂD**DЂ      ЄййнйЄ          еЄЄж"Ж          ж©©©©о€ж!     !пЄЄЄЄЄ        	©п¦¦¦¦F          ж©€п©ж        BBBзЫЫЫз          М„„…Ґп          ©¦FF¦©          ©­нл«©          ©­нл«© F       ­¦ЖЖ¦­          Ґeeec#          ©©йпЇ©          ©©©п©©          ж©©©©ж          ©©©©©п          «¦жЄЄз        М„„жҐҐҐо          ж©€€©ж          BBBBГз        ж!!з©©©©          ййжжйй          оҐҐжҐо          оҐҐж„М          нллн©©          ж©!b©ж          пййййй          ж©!c©ж        !пййййй          !!з©©©          feefLМ          ЄйййнйййЄ       ©©©п©©¦F@       оҐҐҐж„…Ґп     !пЄЄЄЄЄЄЄЄ     	©п¦¦¦¦¦¦¦f       пҐ…†Ж†…Ґп       fBBзЫЫЫЫз       М„„„„„…Ґп       ©©©¦FF¦©©       ©©­нл«©©©       ©©­нл«©©©F     ­Ґ¦¦Ж¦¦Ґ­       ©ҐҐҐҐҐec#       ©©©©©йпЇ©       ©©©©п©©©©       F¦©©©©©¦F       ©©©©©©©©п       «Є¦fжЄЄЄз       М„„„жҐҐҐо       fҐ‰€€€‰Ґf       fBBBBBZЫя       ж!!!з©©©©       йййжFжййй       оҐҐҐжҐҐҐо       оҐҐҐж„„„М       нлллн©©©©       ж©!!f!!©ж       пйййййййй       ЖЄ!!g!!ЄЖ     !пйййййййй       !!!!з©©©©       feeefDDLМ   (C) 1992 KARAGANDA PRESENT BY PIMENOV PAVEL
	     PPA DISK EDITOR$Т&	Н > v=В'у*9 "ЇУН$!К"9 ы! 4 6 #x±В>'  !?>Нr.НrНд'<Нд'Н~>—Н‚>”Н‚zю;Вs'>†Н‚
>‘Н‚>ЎН‚!"V	!;"X	!"T	ю'Н%НННН6Н=ВЙ'/Н! ш"ґЇ2ІЙХ>љН‚>Љ
Н‚Во'>›Н‚СЙ рЙНЕОПЧ рБЫБ РТЕДУФБЧМСЕФ   Ѕѕї PPA Disk Editor   дЙУЛ A: 00/0/1 ќќќќ [0000] = 00 = '*'   (C) лБТБЗБОДБ-1993  чЕТУЙС 1.00 ПФ 26 УЕОФСВТС  1 - рПНПЭШ  3- рЕТЕИПД  5 - уЕТЧЙУ  7 - чЩИПД                                                		Title	KD.ASM
		Include EQU.PPA
;;
;; рБЛЕФ ОБРЙУБО  ОБ  БУУЕНВМЕТЕ  (Intel 8080) Й УМХЦЙФ ДМС
;; РТПЗТБНОПК РПДДЕТЦЛЙ  НПДХМС  ЛМБЧЙБФХТЩ ,УПДЕТЦЙФ РЕТЕ-
;; ТБВПФБОЩК  ДТБКЧЕТ  ЛМБЧЙБФХТЩ  ПФ "Basic Korvet v 2.0"
;; РПУМЕДОСС НПДЙЖЙЛБГЙС: 12.4.1993 
;; лБТБЗБОДБ  Ф. 52-81-95 	/* PPA Soft Systems */
;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;	рБЛЕФ  РТЕДОБЪОЕЮЕО  ДМС УЛМЕКЛЙ У ДТХЗЙНЙ РТП-	;;
;; ГЕУУБНЙ  ЛПФПТЩН  ФТЕВХЕФУС  ТБВПФБФШ  У ЛМБЧЙБФХТПК	;;
;; ЛТПНЕ  ЬФПЗП  ДТБКЧЕТ РТПЙЪЧПДЙФ ОБЮБМШОХА ХУФБОПЧЛХ	;;
;; ТЕЦЙНБ  ЬЛТБОБ  ( 512 * 256  - 2 ГЧЕФБ ДОПЧТЕНЕООП )	;;
;; БДТЕУБ ЬЛТБООПК ПВМБУФЙ: 0A000h - 0DFFFh.		;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

	Public	BEEP	; ЗЕОЕТБГЙС УЙЗОБМБ ФЙРБ "ЭЕМЮЕЛ"
	Public	IN_KEY	; РТПЮЙФБФШ ЛПД ЛМБЧЙЫЙ ЙЪ ВХЖЕТБ
	Public	KEY_INT	; ПВТБВПФЮЙЛ РТЕТЩЧБОЙС.
	Public	KEY_RESET; УВТПУ ЛМБЧЙБФХТЩ.
	Public	KEY_DELAY; пЦЙДБОЙС ОБЦБФЙС.
	Public	FLAGC	; ЖМБЗ БЛФЙЧОПУФЙ ГЧЕФПЗЕОЕТБФПТБ
	Public	COLOR	; ЛПД ФЕЛХЭЕЗП ГЧЕФБ.
	Public	RUSLAT	; УФБФХУ ЛМБЧЙБФХТЩ РП БМЖБЧЙФХ
	Public	SMALL	; ---//----//----//--- ТЕЗЙУФТХ
	Public	SEEK	; ХЛБЪБФЕМШ ЪБРПМОЕОЙС
	Public	KEY_KOD	; ДЙОБНЙЮЕУЛЙК ЛПД ЛМБЧЙБФХТЩ
	Public	KEY_NUM	; ЖЙЪЙЮЕУЛЙК ОПНЕТ ЛМБЧЙЫЙ
	
;;////////// ТБВПЮЙЕ СЮЕКЛЙ KEYBOARD.DRIVE ////////
FLAGC:	DB	0	;ЕУМЙ <>0 ФП ГЧЕФПЗЕОЕТБФПТ ОЕ ФТПЗБЕФУС
RAB0:	DB	0	
COLOR:	DW	0000H	
RUSLAT:	DB	0	
SMALL:	DB	0	
KEY_KOD: DB	255	;УПД.ЛПД ЛМБЧЙЫЙ ОБЦ Ч ДБООЩК НПНЕОФ
KOOL:	DB	0	
DREB:	DB	0	
SEEK:	DB	1	
	DB	"PPA Systems"	;ВХЖЕТ ЛМБЧЙБФХТЩ
	DB	CR,LF,0		; 14 - ЬМЕНЕОФПЧ

;; нПДЙЖЙЛБГЙС ДТБКЧЕТБ: 12.4.1993 ++++ рПОЕДЕМШОЙЛ ++++
;; ================ 21:55 "Good luck "================
;; РТПЙЪЧЕДЕОП ЛПНЕОФЙТПЧБОЙЕ ЙУИПДОПЗП ФЕЛУФБ НПДХМС ДТБК-
;; ЧЕТБ ЛМБЧЙБФХТЩ У ГЕМША ЙУРПМШЪПЧБОЙС ЕЗП Ч РПУМЕДХАЭЙИ
;; ТБЪТБВПФЛБИ  Б  ФБЛЦЕ   ЙЪНЕОЕОЩ  ОЕЛПФПТЩЕ ХРТБЧМСАЭЙЕ
;;  ЛМБЧЙЫЙ:
;;  "F5" - фТЙЗЕТОБС  ЛМБЧЙЫБ РЕТЕЛМАЮБЕФ  РТЙП-
;;         ТЕФЕФОПЕ УПУФПСОЙЕ ДБФЮЙЛБ  РТПРЙУОЩЕ
;;         - УФТПЮОЩЕ  ВХЛЧЩ  ФЕЛХЭЕЗП  БМЖБЧЙФБ
;;
;;  "уу" - лМБЧЙЫБ РТПЙЪЧПДЙФ ЧТЕНЕООПЕ РЕТЕЛМА-
;;         ЮЕОЙЕ НБМЕОШЛЙИ-ВПМШЫЙИ ВХЛЧ
;;

KEY_INT:
	PUSH	B	; рТПЙЪЧПЦХ РПМОПЕ УПИТБОЕОЙЕ
	PUSH	D	; УПУФПСОЙС РТПГЕУУПТБ Ч НПНЕОФ
	PUSH	H	; ЧПЪОЙЛОПЧЕОЙС РТЕТЩЧБОЙС
	PUSH	PSW	;
	LXI	H,FLAGC	; юЙФБЕН ЖМБЗ РПДНЕОЩ РБМЙФТЩ
	MOV	A,M	;
	ORA	A	;
	JNZ	KEY_DO0	; ЕУМЙ =0 ФП РЕТЕРТПЗТБНЙТПЧБФШ ФБВМЙГХ
	DCR	M	;
	LHLD	COLOR	; юЙФБА ДЧБ ВБКФБ ЖЙЪЙЮЕУЛЙИ ГЧЕФПЧ
	LXI	D,100FH	; ЖПОБ Й РЕТЕДОЕЗП РМБОБ
KEY_00:
	MOV	A,E	; H - ГЧЕФ ретдоезп рмбоб
	OUT	02	; L - ГЧЕФ жпоб
	ANI	06	; Й РЕТЕИПДЙН Л ТБУРТЕДЕМЕОЙА
	MOV	A,L	; ЕФЙИ ВБКФПЧ Ч УППФЧЕФУФЧЙЙ
	JZ	KEY_01	; У НБФЕНБФЕНБФЙЮЕУЛЙНЙ ГЧЕФБНЙ
	MOV	A,H	;
KEY_01:
	OUT	0FH	; РТПЙЪЧПДЙН НОПЗПЛТБФОХА ЪБРЙУШ
	DCR	E	; РПМХЮЕОПЗП ЛПДБ Ч УЧСЪЙ У НБМПК
	OUT	0FH	; УЛПТПУФША ТБВПФЩ пъх -л155тх2-
	OUT	0FH	;
	OUT	0FH	;
	DCR	D	;
	OUT	0FH	;
	JNZ	KEY_00	;
KEY_DO0:
	MVI	A,8AH	; оБУФТБЙЧБЕН УЙУФЕНОЩК РПТФ ОБ
	OUT	00	; УЛБОЙТПЧБОЙЕ ЛМБЧЙБФХТЩ
	LXI	H,RAB0	;
	IN	01	; РТПЮЙФБФШ УПУФПСОЙЕ РПТФБ "C"
	ANI	80H	; бОБМЙЪЙТХЕН ВЙФ ЛМБЧЙЫЙ "тху/мбф"
	JNZ	M5	; РЕТЕИПД ЕУМЙ ПОБ ОЕ ОБЦБФБ !!!
	MOV	A,M	; РТПЧЕТСЕН УПДЕТЦЙНПЕ ЧУРПНПЗБФЕ-
	ORA	A	; МШОПК СЮЕКЛЙ ЕУМЙ ПОБ ТБЧОБ ОХМА
	JZ	DONE01	; ФП ЛМБЧЙЫБ тху/мбф еЭЕ ОБЦБФБ
	DCR	M	; Й РПЧФПТОХА РЕТЕХУФБОПЧЛХ РТПЙ-
	LDA	RUSLAT	; ЪЧПДЙФШ ОЕ ОБДП
	XRI	08H	; РТПЙЪЧПДЙН ЙОЧЕТУЙА Ч ВЙФЕ УЧЕФП-
	STA	RUSLAT	; ДЙПДБ
	JMP	DONE01	;
M5:
	MVI	M,1	; ЖЙЛУЙТХЕН ОЕ ОБЦБФПЕ УПУФПСОЙЕ
DONE01:
	XRA	A	; ЧЩДБЕН ОБ НБФТЙГЕ ЪБРТПУ П ОБЦ-
	OUT	03	; БФЩИ ЛМБЧЙЫБИ
	IN	02	; 
	INR	A	; РТПЙЪЧПДЙН РТПЧЕТЛХ ОБ ОБЦБФЙЕ
	JZ	EXIT1	; ХИПДЙН ЕУМЙ ОЕ ОБЦБФБ ОЙ ПДОБ
	LXI	B,0FE08H; ЛМБЧЙЫБ
	LXI	D,0800H	; РЕТЕИПДЙН Л РПДУЮЕФХ НЕУФБ ОБЦБФЙС
	MOV	A,B	; РП УТЕДУФЧПН ЗПОЕТБЮЙЙ ОБ ЧИПДОЩИ
KEY01:
	OUT	03	; МЙОЙСИ ЛПДБ : "вЕЗХЭЙК ОПМШ"
	IN	02	; Й БОБМЙЪПН ЛПДБ ОБ ЧЩИПДОЩИ
	INR	A	; МЙОЙСИ НБФТЙГЙ ЛМБЧЙБФХТЩ
	JNZ	KEY010	;
	MOV	A,E	;
	ADD	D	;
	MOV	E,A	;
	MOV	A,B	;
	RLC		;
	MOV	B,A	;
	DCR	C	;
	JNZ	KEY01	;
EXIT1:
	CALL	HLP	; РТПЙЪЧЕДЕН ХУФБОПЧЛХ РБТБНЕФТПЧ
	MVI	A,0FFH	; ЬЛТБОБ Й ЪБЧЕТЫЙН РТЕТЩЧБОЙЕ
	STA	KEY_KOD	; У ЛПДПН ОЕ ОБЦБФПК ЛМБЧЙЫЙ
	JMP	MAIN_EXIT;
KEY010:
	DCR	A	;
KEY00:
	RAR		;
	INR	E	;
	JC	KEY00	;
	DCR	E	;
	CALL	HLP	;
	LXI	H,KEY_NUM;
	MOV	M,E	; УПИТБОСЕН ОПНЕТ ЛМБЧЙЫЙ
	INX	H	; DONEM-LABEL
	PUSH	H	; ЧЕЛФПТ РЕТЕИПДБ УПИТБОСЕН Ч УФЕЛЕ
	IN	01H	; ЮЙФБЕН УФБФХУ ХРТБЧМСАЭЙИ ЛМБЧЙЫ
	LXI	B,1020H	; BC - ТБВПЮЙЕ ЛПОУФБОФЩ
	ANA	C	; ЧЩДЕМСЕН ЛМБЧЙЫХ "уу"
	MOV	D,A	; УПИТБОСЕН Ч ТЕЗЙУФТЕ MPU
	MOV	A,E	; РТПЮЙФБЕН ОПНЕТ ЛМБЧЙЫЙ
	CMP	B	; УТБЧОЙН У ЛПДПН == 10H ===
	JNC	DONE03	; РЕТЕИПД ЕУМЙ ОПНЕТ ВПМШЫЕ 10H
;; рТПЙЪЧПДЙН ПВТБВПФЛХ ОБЦБФЙС ЛМБЧЙЫ УМХЦЕВОПК ЛМБЧЙБФХТЩ
;; ЙНЕАЭЙЕ УМЕДХАЭЙЕ ОПНЕТБ:
;;
	CPI	03H	; ОПНЕТ ЛМБЧЙЫЙ НЕОЙЫЕ 10H
	RNZ		; Ф.Е. ОБЦБФБ ЛМБЧЙЫБ УМХЦЕВОПК
	MOV	A,D	; ЛМБЧЙБФХТЩ ( РЕТЧЩЕ ДЧЕ МЙОЙЙ ОБ
	ORA	A	; УИЕНЕ ОЕПВИПДЙНП РПНЕОСФШ НЕУФБНЙ)
	MOV	A,E	; ЪДЕУШ ОЕПВИПДЙНП РТПЧЕТЙФШ ФПМШЛП
	RNZ		; ЛМБЧЙЫХ "ъв" Ч ЪБЧЙУЙНПУФЙ ПФ
	MVI	A,5FH	; ОБЦБФЙС ЛМБЧЙЫЙ "уу"
	RET		;

DONE03:
	CMP	C	; УТБЧОЙН У ЛПДПН == 20H ==
	JNC	DONE05	; РЕТЕИПД ЕУМЙ ВПМЙЫЕ ЙМЙ ТБЧОП
;; пВТБВПФБЕН ЧБТЙБОФ ОБЦБФЙС ЛМБЧЙЫ У ОПНЕТБНЙ
;; ПФ 10H-20H - ГЙЖТЩ Й УРЕГ ЪОБЛЙ
	MOV	A,D	; ЧПЪШНЕН УФБФХУ ЛМБЧЙЫЩ "уу"
	ORA	A	; ЕУМЙ ФБН 0 ФП ЪОБЮЙФ ОБЦБФБ
	MOV	A,E	; ЙОБЮЕ ОЕ ОБЦБФБ
	JZ	KEY02	; 
	ADD	B	;
KEY02:
	ADD	B	;
	MOV	L,A	;
	MOV	A,E	;
	CPI	1CH	;
	MOV	A,L	;
	RC		;
	XRA	B	;
	RET		;
;;
;; пВТБВПФБЕН ЧБТЙБОФ ОБЦБФЙС ВХЛЧЕОЩИ ЛМБЧЙЫ
;;
DONE05:
	CPI	3FH	; ЕУМЙ ЬФП РТПВЕМ ФП ЧПЪЧТ.
	MOV	A,C	; ЛПД 20H
	RZ		;
	MOV	A,D	;
	ORA	A	;
	LDA	SMALL	; ЮЙФБЕН УФБФХУ СЮЕКЛЙ ТЕЗЙУФТПЧ
	JNZ	D_5_OBH	;
	CMA		;
D_5_OBH:
	ORA	A	; РТПЧЕТСЕН ОБ ТБЧЕОУФЧП 0
	MOV	A,E	; ЕУМЙ = 0 ФП РТПРЙУОЩЕ ВХЛЧЩ
	JZ	KEY04	; ЙОБЮЕ УФТПЮОЩЕ ВХЛЧЩ
	ADD	C	;
KEY04:
	ADD	C	;
	MOV	E,A	;
	LDA	RUSLAT	;
	ORA	A	;
	MOV	A,E	;
	RZ		;
	ADI	80H	; ЛПТЕЛГЙС ОБ ТХУЛЙЕ ВХЛЧЩ
	XRA	C	;
	RET		;
;###				;
KEY_NUM:	DB	'P'	;ОПНЕТ ЛМБЧЙЫЙ
;###				;
DONEM:
	LXI	H,MAIN_EXIT;	
	PUSH	H	;
	MOV	C,A	;
	LDA	KEY_KOD	;
	CMP	C	;
	LXI	H,KOOL	;
	JNZ	M22	;
	MOV	A,M	;
AL1:
	CPI	30	;
	JZ	M24	;
M23:
	INR	M	;
	RET		;
M22:
	MVI	M,0	;
	MVI	A,30	;ЧТЕН.ПЦЙДБОЙС
	STA	AL1+1	;
	INX	H	;DREB
	MOV	A,M	;
	DCR	A	;
	JNZ	M23	;
	DCR	M	;
	DCX	H	;
	JMP	DONE10	;
M24:
	MVI	M,0	;
	MVI	A,2	;CONST AUTO
	STA	AL1+1	;
DONE10:
	MOV	A,C	;
	DCX	H	;
	MOV	M,A	;
	DCX	H	;
	DCR	B	;
	CMP	B	;
	JNZ	M31	;
	MOV	A,M	;SMALL
	CMA		;
	MOV	M,A	;
M31:
	LXI	H,SEEK	;
	MOV	A,M	;
	CMP	B	;
	CALL	BEEP	;
	RZ		;
	INR	M	;
	MOV	C,A	;
	MVI	B,0	;
	DAD	B	;
	LDA	KEY_KOD	;
	MOV	M,A	;
	RET		;
MAIN_EXIT:
	POP	PSW	;
	POP	H	;
	POP	D	;
	POP	B	;
	EI		;
	RET		;

HLP:
	MVI	A,88H	;
	OUT	00H	;
	LDA	RUSLAT	;
	OUT	01	;
	MVI	A,0FFH	;УЛТПМЙОЗ
	OUT	03	;
	MVI	A,10H	;ТЕЦЙН Й ВПТДАТ
	OUT	02	;
	RET		;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;	рТПГЕДХТБ РПДБЮЙ ЭЕМЮЛБ РП УТЕДУФЧПН ЫФБФОПЗП	;;
;; ЗЕОЕТБФПТБ "ЫХНБ" (РПТФ НБЗОЙФПЖПОБ)			;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
BEEP:
	PUSH	PSW	;
	MVI	B,8	;
	MVI	E,30H	;
	LDA	RUSLAT	;
	MOV	C,A	;
BIP0:
	INR	A	;
	ANI	1	;
	ORA	C	;
	OUT	1	;
	PUSH	D	;
BIP:
	DCR	E	;
	JNZ	BIP	;
	POP	D	;
	DCR	B	;
	JNZ	BIP0	;
	POP	PSW	;
	RET		;

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;	рТГЕДХТБ  ПЦЙДБЕФ  ОБЦБФЙЕ ЛМБЧЙЫЙ Й ЧПЪЧТБЭБЕФ	;;
;; РПМХЮЕОЩК ASCII ЛПД Ч ТЕЗЙУФТЕ "б"			;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
KEY_DELAY:
	CALL	IN_KEY		;
	INR	A		;
	JZ	KEY_DELAY	;
	DCR	A		;
	RET			;

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;     рТПГЕДХТБ ЧЪСФЙС ЛПДБ ЛМБЧЙЫЙ ЙЪ ТЧВПЮЕЗП ВХЖЕТБ	;;
;; ЕУМЙ ВХЖЕТ РХУФ ФП ЧПЪЧТБЭБЕФУС 0xFF			;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
IN_KEY:
	PUSH	B	;
	PUSH	D	;
	PUSH	H	;
	LXI	H,SEEK	;
	MVI	C,255	;
	DI		;
	DCR	M	;
	JZ	INQ	;
	MOV	B,M	;
	INX	H	;
	MOV	C,M	;
	EI		;
	MOV	D,H	;
	MOV	E,L	;
IN0:			;
	INX	H	;
	MOV	A,M	;
	STAX	D	;
	INX	D	;
	DCR	B	;
	JNZ	IN0	;
	DCR	M	;
INQ:			;
	EI		;
	INR	M	;
	MOV	A,C	;
	POP	H	;
	POP	D	;
	POP	B	;
	RET		;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;	рТГЕДХТБ ПУХЭЕУФЧМСЕФ УВТПУ ЛМБЧЙБФХТЩ		;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
KEY_RESET:
	PUSH	PSW	;
	MVI	A,1	;
	STA	SEEK	;
	POP	PSW	;
	RET		;
	END		;

;;;;;;;;;;;;;
KEY_DELAY:
	CALL	IN_KEY		;
	INR	A		;
	JZ	KEY_DELAY	;
	DCR	A		;
	RET			;

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;     рТПГЕДХТБ ЧЪСФЙС ЛПДБ ЛМБЧЙЫЙ ЙЪ ТЧВПЮЕЗП ВХЖЕТБ	;;
;; ЕУМЙ ВХЖЕТ РХУФ ФП ЧПЪЧТБЭБЕФУС 0xFF			;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
IN_KEY:
	PUSH	B	;
	PUSH	D	;
	PUSH	H	;
	LXI	H,SEEK	;
	MVI	C,255	;
	DI		;
	DCR	M	;
	JZ	INQ	;
	MOV	B,M	;
	INX	H	;
	MOV	C,M	;
	EI		;
	MOV	D,H	;
	MOV	E,L	;
IN0:			;
	INX	H	;
	MOV	A,M	;
	STAX	D	;
	INX	D	;
	DCR	B	;
	JNZ	IN0	;
	DCR	M	;
INQ:			;
	EI		;
	INR	M	;
	MOV	A,C	;
	POP	H	;
	POP	D	;
	POP	B	;
	RET		;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;	рТГЕДХТБ ПУХЭЕУФЧМСЕФ УВТПУ ЛМБЧЙБФХТЩ		;;
;;;;;;;;;;ееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееее;;
;; ///////// 5.04.1993 ///////////////////////////////////
;; //  (C) 1993  лБТБЗБОДБ  лРФй  ьб-91-2  рЙНЕОПЧ р.б	//
;; //							//
;; // ====== 52-81-95 ======== PPA Soft Systems ======	//
;; //		Copyright  by  рЙНЕОПЧ рБЫБ		//
;; ///////////////////////////////////////////////////////
;;
	Include	MACRO.PPA	; нБЛПРПДУФБОПЧЛЙ
	Include	EXT.PPA		; чЩИПД ОБ ДТБКЧЕТЩ

	Public	START_PPA	;
	External BUF_OF_VECTOR	; ВХЖЕТ ДМС ЧЕЛФПТБ.

	External SCREEN_CLS	; ЖЙТНЕОБС ПФЮЙУФЛБ
	External PUTSXY_Z	; ЧЩЧПД УФТПЛЙ
	External GOR_STREL	; ЗПТЙЪПОФБМШОБС УФТЕМЛБ
	External VER_STREL	; ЧЕТФЙЛБМШОБС УФТЕМЛБ
	External CINV_ABS	; БВУПМАФОБС ЙОЧЕТУЙС

;;
;;	уФБТФПЧБС РТПГЕДХТБ РТПЙЪЧПДЙФ ЙОЙГЙБМЙЪБГЙА ЧУЕИ
;; ЧОХФТЕООЙИ ДТБКЧЕТПЧ Й ВХЖЕТПЧ ,Б ФБЛЦЕ ЖПТНЙТХЕФ ПУО-
;; ПЧОПЕ  ПЛОП ТЕДБЛФПТБ. ч РПУМЕДХАЭЕН ОЕ ЙУРПМШЪХЕФУС Й
;; НПЦЕФ ВЩФШ ЪБФЕТФБ ЙМЙ ЙУРПМШЪПЧБФУС Ч ЛБЮЕУФЧЕ ВХЖЕТБ.
;;
PPA_COPYRIGHT_DE:
  DB "(C) 1992 KARAGANDA PRESENT BY PIMENOV PAVEL",0Dh,0Ah
  DB 09h,"     PPA DISK EDITOR",'$'
START_PPA:			;
	LXI	D,PPA_COPYRIGHT_DE;
	int	9		;
	MVI	A,50		;
ST_PPA_LOOP20:
	HLT			;
	loop	A,ST_PPA_LOOP20	;
	DI			;
	LHLD	0039h		;
	SHLD	BUF_OF_VECTOR	;
	XRA	A		;
	OUT	10h		;
	CALL	SCREEN_CLS	;
	LXI	H,KEY_INT	;
	SHLD	0039h		; хУФБОПЧЙН ЧЕЛФПТ РТЕТЩЧБ
	EI			;
	LXI	H,W_EMUL_TXT	; -ОЙС ОБ УЧПК ДТБКЧЕТ.
	LXI	B,400h		; Й ПФЮЙУФЙН ПВМБУФШ ЬНХ-
ST_PPA_00:			; МСГЙЙ ФЕЛУФПЧПЗП ЬЛТБОБ.
	MVI	M,' '		;
	INX	H		;
	DCX	B		;
	MOV	A,B		;
	ORA	C		;
	JNZ	ST_PPA_00	;
	LXI	D,0000h		;
	LXI	H,3F02h		;
	MVI	A,00001000B	;
	CALL	BORT		;
	MVI	E,0Dh		;
	MVI	L,0Fh		;
	CALL	BORT		;
	LXI	D,0302h		;
	CALL	DOUBLE_STOLB	;
	MVI	D,3Ch		;
	CALL	DOUBLE_STOLB	;
	MVI	B,08h		;
	MVI	E,0Ch		;
	CALL	VER_STREL	;
;;
;; хУФБОПЧЙН ЛППТДЙОБФЩ ФЕЛХЭЕЗП ПЛОБ ТЕДБЛФПТБ.
;;
	LXI	D,0304h		;
	MVI	A,97h		;
	CALL	PUTCXY		;
ST_PPA_03:
	MVI	A,94h		;
	INR	D		;
	CALL	PUTCXY		;
	MOV	A,D		;
	CPI	3Bh		;
	JNZ	ST_PPA_03	;
	INR	D		;
	MVI	A,86h		;
	CALL	PUTCXY		;
	LXI	D,0A04h		;
	MVI	A,91h		;
	CALL	PUTCXY		;
	MVI	E,0Dh		;
	MVI	A,0A1h		;
	CALL	PUTCXY		;
	LXI	H,0405h		;
	SHLD	WIND1		;
	LXI	H,3B0Ch		;
	SHLD	WIND2		;
	LXI	H,0807h		;
	SHLD	CURSOR		;
	LXI	D,020Fh		;
	LXI	B,COPY_RIGHT	;
	CALL	PUTSXY_Z	;
	MVI	D,25h		;
	CALL	PUTSXY_Z	;
	LXI	D,0C0Dh		;
	CALL	PUTSXY_Z	;
	LXI	D,0602h		;
	CALL	PUTSXY_Z	;
	LXI	D,0601h		;
	CALL	PUTSXY_Z	;
	DCR	D		;
	MVI	B,36h		;
ST_PPA_10:
	CALL	CINV_ABS	;
	INR	D		;
	DCR	B		;
	JNZ	ST_PPA_10	;
	LXI	D,0C04h		;
	MVI	B,2Fh		;
	CALL	GOR_STREL	;
	LXI	H,0F800h	;
	SHLD	COLOR		;
	XRA	A		;
	STA	FLAGC		;
	RET			;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;	рТПГЕДХТБ ТЙУХЕФ РЕТЕЗПТПДЛЙ Ч ПУОПЧОПН ПЛОЕ	;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
DOUBLE_STOLB:
	PUSH	D		;
	MVI	A,9Ah		;
	CALL	PUTCXY		;
	MVI	A,8Ah		;
	MVI	B,0Ah		;
D_L_00:
	INR	E		;
	CALL	PUTCXY		;
	DCR	B		;
	JNZ	D_L_00		;
	INR	E		;
	MVI	A,9Bh		;
	CALL	PUTCXY		;
	POP	D		;
	RET			;

COPY_RIGHT:
;;
;; "рЙНЕОПЧ рБЫБ РТЕДУФБЧМСЕФ"
;;
	DB	6,7,20h
	DB	0F0h,0C9h,0CDh,0C5h,0CEh,0CFh,0D7h
	DB	020h,0F0h,0C1h,0DBh,0C1h,020h,0D0h
	DB	0D2h,0C5h,0C4h,0D3h,0D4h,0C1h,0D7h
	DB	0CCh,0D1h,0C5h,0D4h,020h,7,8,0

	DB	6,7,020h
	DB	0BDh,0BEh,0BFh," PPA Disk Editor "
	DB	7,8,0
;;
;; "<- дЙУЛ A: 00/0/1: [0000] = 00h = '*' ->"
;;
	DB	6,7," "
	DB	0E4h,0C9h,0D3h,0CBh
	DB	" A: 00/0/1 "
	DB	7,8,09Dh,09Dh,09Dh,09Dh,6,7
	DB	" [0000] = 00 = '*' "
	DB	7,8,0
;;
;; "(C) лБТБЗБОДБ-1993 чЕТУЙС 1.00 ПФ 26 УЕОФСВТС"
;;
	DB	6,7," (C) "
	DB	0EBh,0C1h,0D2h,0C1h,0C7h,0C1h
	DB	0CEh,0C4h,0C1h,"-1993  "
	DB	0F7h,0C5h,0D2h,0D3h,0C9h,0D1h
	DB	" 1.00 "
	DB	0CFh,0D4h
	DB	" 26 "
	DB	0D3h,0C5h,0CEh,0D4h,0D1h
	DB	0C2h,0D2h,0D1h," "
;	DB	0EBh,0C1h,0D2h,0C1h,0C7h
;	DB	0C1h,0CEh,0C4h,0C1h,"-1993 "
	DB	7,8,0
;;
;; " чЕТУЙС 1.00 "
;;		
;	DB	6,7,20h
;	DB	0F7h,0C5h,0D2h,0D3h,0C9h,0D1h
;	DB	" 1.00 "
;	DB	7,8,0
;;
;; рПМЕ РБОЕМЕЛ ХРТБЧМЕОЙС ТЕДБЛФПТПН.
;;
	DB	"1 - ",0F0h,0CFh,0CDh,0CFh
	DB	0DDh,0D8h,020h,15,15
	DB	" 3- ",0F0h,0C5h,0D2h,0C5h
	DB	0C8h,0CFh,0C4h,020h,15,15
	DB	" 5 - ",0F3SAVE_LOOP:	CALL	PUSK		;ЪБРХУЛБЕН ДЧЙЗБФЕМШ ОБЛПРЙФЕМС
		MVI	A,1		;ЧЩВЙТБЕН УЕЛФПТ
		OUT	SEKTOR		;
		LXI	D,TRACKBUFER	;
		LXI	B,0204H		;ЛПОУФБОФЩ
		MVI	A,10100001B	;ЪБРЙУШ УЕЛФПТБ
		OUT	COM		;
LOOP10:		IN	STATUS		;
		RRC			;
		JNC	LOOP10		;
		CALL	SAVES		;ЪБРЙУБФШ УЕЛФПТ

;+----------[ РТПГЕДХТБ ЪБРЙУЙ УЕЛФПТБ ОБ ХТПЧОЕ ЛТ1818ЧЗ93 ]-----------+
;*    ЧИПДОЩЕ ДБООЩЕ:							*
;*			DE-> БДТЕУ ВХЖЕТБ ЪБРЙУЙ			*
;+----------------------------------------------------------------------+
SAVES:		IN	STATUS		;РТПЮЙФБФШ УФБФХУ ЛПОФТПМЕТБ
		ANA	B
		JZ	SAVES
		LDAX	D
		OUT	DATA
		INR	E
		JNZ	SAVES
		INR	D
		DCR	C
		JNZ	SAVES
		RET

	External W_PUTSXY_Z	;
	External W_PUT_HEX	;
	External PUT_CHAR	;
	External PUT_HEX	;
	External PUT_NIBL	;
	External INV_LINE	;
	External KEY_DELAY	;
	External VER_STREL	;
	External SCREEN_CLS	;
;;______________________________
	Public	US_GOTO		;
	Public	US_QUIT		;
	Public	STR_KEY		;
	Public	CC_RIGHT_KEY	;
	Public	RIGHT_KEY	;
	Public	HOME_KEY	;
	Public	CC_LEFT_KEY	;
	Public	LEFT_KEY	;
	Public	F3_KEY		;
	Public	DOWN_KEY	;
	Public	UP_KEY		;
	Public	CC_DOWN_KEY	;
	Public	CC_UP_KEY	;
	Public	Y_N_WRITE	;

	Public	DISK_MASKA	;
	Public	SET_CULIND	;
	Public	DISK_READ	;

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;=================== US + 7 - QUIT ====================;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;	рТПГЕДХТБ ПУХЭЕУФЧМСЕФ ЧЩИПД ЙЪ ТЕДБЛФПТБ.
;;
US_QUIT:
	CALL	Y_N_WRITE	;
	CALL	SCREEN_CLS	;
	MVI	A,KD_CONST	;
	OUT	10h		;
	LHLD	BUF_OF_VECTOR	;
	SHLD	0039h		;
	INT	00h		;

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;==================== US + 3 - GoTo ===================;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;	рТПГЕДХТБ ПУХЭЕУФЧМСЕФ РЕТЕИПД Л  МАВПНХ ДТХЗПНХ
;; ЖЙЪЙЮЕУЛПНХ НЕУФХ ДЙУЛПЧПЗП РТПУФТБОУФЧБ  РП  УТЕДУФ-
;; ДУФЧПН ДЙБМПЗПЧПЗП ЧУР    (C)1993 лБТБЗБОДБ БЧФПТУЛПЕ РТБЧП рЙНЕОПЧ рБЧЕМ.
   PPA Disk Editor (V1.00)
	DE.COM - уЙУФЕНОБС ДЙУЛПЧБС ХФЙМЙФБ РТЕДОБЪОБЮЕОБ
 ДМС  ОЙЪЛПХТПЧОЕЧПЗП ДПУФХРБ Л ЗЙВЛПНХ ДЙУЛХ ( ОБ ХТБЧОЕ
 УЕЛФПТПЧ ).

БЫБ		//
;; ///////////////////////////////////////////////////////
;;
;; зМПВБМШОЩЕ ПРЙУБОЙС ОБИПДСФУС Ч ЛПОГЕ ЖБКМБ.
;;
	Include	MAIN.PPA
; {
;	Include	MACRO.PPA	; нБЛПРПДУФБОПЧЛЙ
;	Include	EQU.PPA		; лПОУФБОФЩ.
;	Include	EXT.PPA		; чЩИПД ОБ ДТБКЧЕТЩ
;	Include DDR.PPA		; дЙУЛПЧЩЕ ЛПОУФБОФЩ.
; }

DE_START:
	LXI	SP,STACK_SEGMENT; хУФБОПЧЙН ХЛБЪБФЕМШ УФЕЛБ
	CALL	START_PPA	; УФБТФХЕН.
	JMP	TMP_DONE	;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;================== US + Servise ======================;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
US_SERVISE:
	LXI	D,0D09h		;
	LXI	H,2A0Bh		;
	MVI	A,00010101b	;
	CALL	ACTIV		;
	LXI	D,0202h		;
	LXI	B,SOOB_20	;
	CALL	W_PUTSXY_Z	;
	DCR	E		;
	CALL	W_PUTSXY_Z	;
	DCR	E		;
	CALL	W_PUTSXY_Z	;
	CALL	Y_N_WRITE	;
	CALL	MENU		;
	ORA	A		;
	JZ	PAINT_SCREEN	; ===== ЧЩВПТ РБМЙФТЩ =====
	DCR	A		;
	JZ	FIND_DONE	; ===== РТПДПМЦЙФШ РПЙУЛ ==

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;  вПМЛ ПВТБВПФЛЙ ОБЮБМБ РПЙУЛБ УФТПЛЙ РП ЧУЕНХ ДЙУЛХ	;;
	LXI	D,0F07h		;
	LXI	H,3808h		;
	MVI	A,00010110b	;
	CALL	ACTIV		;
	MVI	A,082h		;
	MVI	B,40		;
	LXI	D,0100h		;
	CALL	ABS_DE		;
	PUSH	D		;
F_R_LOOP:
	CALL	PUTCXY		;
	INR	D		;
	loop	B,F_R_LOOP	;
	POP	D		;
	INR	E		;
	LXI	B,SOOB_50	;
	CALL	PUTSXY_Z	;
	CALL	KEY_DELAY	;
	CALL	DEACTI		;
	CALL	DEACTI		;
	RET			;
;;
;; оБКФЙ:
;;
SOOB_50:
	DB	0EEh,0C1h,0CAh,0D4h,0C9h,':',000h

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;	вМПЛ ПВТБВПФЛЙ РТДПМЦЕОЙС РПЙУЛБ РП ДЙУЛХ.	;;
FIND_DONE:

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
TMP_DONE:			;
	LXI	H,C_ALT_INV	;
	INX	H		;
	MVI	M,1h		;
	MVI	A,34h		;
	STA	DISK_MASKA	;
	EI			;
	HLT			;
	LDA	CULINDER	;
	DI			;
	CALL	SET_CULIND	;
	CALL	DISK_REA	TITLE	MADD.ASM		;V1.00
;;  рПУМЕДОСС ЛПТТЕЛГЙС НПДХМС: 30.3.1993 З.
;;  ++++++ 16:20 +++++++ чФПТОЙЛ ++++++++++++
;;
;; /*  Welcomme to pace PPA_Soft */
;;
;;    ™ќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќ‹
;;    Љ  (C) 1993  лБТБЗБОДБ  лРФй  ьб-91-2  рЙНЕОПЧ р.б   Љ
;; ™ќќљќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќ‹  Љ
;; Љ     ED.COM  -  Utilite for text editor MAR.COM     Љ  Љ
;; Љ							Љ  Љ
;; Љ ========== 52-81-95 ========= PPA Systems ======== Љ  Љ
;; Љ              Copyright  by  рЙНЕОПЧ р.б            Љ  Љ
;; Љ  ™ќќќќќќќќќќќќќќќќќќ‹    ™ќќќќќќќќќќќќќќќќќќќќќќ‹  њќќЊ
;; ќќ‰ asm file: 0000h  њќќќќ‰ com file: 0000h Byte њќќЊ
;;    ќќќќќќќќќќќќќќќќќќЊ    ќќќќќќќќќќќќќќќќќќќќќќЊ
;;
;;	      /////////////////////////////////////
;;      	   01110010 00100111 00100000
;;	           РТ. зБЗБТЙОБ 01110010/0001
;;	           0010 - 00110000 - 00010100
;;	      /////////////////////////////////////
;;
;; Is problemm !!!  25.03.1993 З.

;;;;;;;;;;		INCLUDE	MACRO.PPA
;;
;;   Header - file   MACRO.PPA:
;;   "уФБОДБТФОЩК ЖБКМ" ДПРПМОЙФЕМШОЩИ НБЛТПРПДУФБОПЧПЛ
;;   ХРТПЭБАЭЙИ ОБРЙУБОЙЕ РПДРТПЗТБНН Ч УТЕДЕ нБЛТПБУУ-
;;   ЕНВМЕТБ M80.COM
;;  //////////////////////////////////////////////////
;;	 PPA Systems   Instal  3.3.1993  чФПТОЙЛ.
;;  //////////////////////////////////////////////////

;;
;;=========================================================
;;	RG_PUSH - лПНБОДБ ЪБЗТХЪЛЙ ХЛБЪБООЩИ ТЕЗЙУФТПЧ
;;	Ч УФЕЛ®
;;

;;
;;=========================================================
;;	INT - ЛПНБОДБ ПТЗБОЙЪБГЙЙ УЙУФЕНОЩИ ЧЩЪПЧПЧ Ч
;;	ПРЕТБГЙПООПК УЙУФЕНЕ CP/M ( нЙЛТП дПУ ).
;;

INT		Macro	SYS_NUM		;
		MVI	C,SYS_NUM	;
		CALL	0005H		;
		Endm			;
;;
;;=========================================================
;;	BH_MOV - лПНБОДБ РЕТЕУЩМЛЙ УППФЧЕФУФЧХАЭЙИ ТЕЗЙУФТ-
;;	ПЧ РБТЩ HL Ч РБТХ BC.
;;
BH_MOV		Macro			;
		MOV	B,H		;
		MOV	C,L		;
		Endm			;
;;
;;=========================================================
;;	HB_MOV - рЕТЕОПУ РБТЩ BC Ч РБТХ HL.
;;
HB_MOV		Macro			;
		MOV	H,B		;
		MOV	L,C		;
		Endm			;
;;
;;=========================================================
;;	BD_MOV - рЕТЕОПУ РБТЩ DE Ч РБТХ BC.
;;
BD_MOV		Macro			;
		MOV	B,D		;
		MOV	C,E		;
		Endm			;
;;
;;=========================================================
;;	DB_MOV - рЕТЕОПУ РБТЩ BC Ч РБТХ DE.
;;
DB_MOV		Macro			;
		MOV	D,B		;
		MOV	E,C		;
		Endm			;


;;;;;;;;;;;		INCLUDE	EDEQU.ASM
;;
;;   Header - file   EDEQU.ASM  :
;;  уПДЕТЦЙФ ЧУЕ ОЕПВИПДЙНЩЕ ЛПОУФБОФЩ ЛБЛ ДМС ТБВПФЩ ЬЛТБООЩИ
;;  РПДРТПЗТБНН ФБЛ ЦЕ УПДЕТЦЙФ РБЛЕФ ПРТЕДЕМЕОЙК ОЕПВИПДЙНЩИ
;;  ДМС ТБВПФЩ У ДЙУЛПЧЩН ОБЛПРЙФЕМЕН
;;    УЕЗПДОС: 17.12.1992З. ++++ 16:47 +++++ ЮЕФЧЕТЗ
;;				/* PPA Systems */
;; РТПЗТБННБ ТБВПФЩ У ДЙУЛПН 26.11.1992

F_FILE0		EQU 81H		;ТБВПФБ У ДЙУЛБНЙ
;K_SUMMA	EQU 101H	;рТПФЙЧ ЧЪМПНБ
;BUF1		EQU 103H	;вХЖЕТ®WD.ASM
;KEYVEKT	EQU 105H	;уФБТЩК ЧЕЛФПТ®

;; ЧЧЕДЕОБ ДМС ЬЛПОПНЙЙ РБНСФЙ

BTEXT 		EQU 3300H	;ОБЮБМП ФЕЛУФБ
MZG		EQU 2300H	;ОБЮБМП ЪОБЛПЗЕОЕТБФПТБ
MEMU		EQU 9800H	;ОБЮБМП ПВМБУФЙ ЬНХМСГЙЙ
MSEK		EQU 9C00H	;ОБЮБМП ВХЖЕТБ ПЛПО
MEND		EQU 9DFFH	;ЛПОЕГ ВХЖЕТБ ПЛПО
STOPBYTE	EQU 1AH		;ЙДЕОФЙЖЕЛБФПТ "ЛПОЕГ ФЕЛУФБ"
ESC		EQU 1BH		;лПД ДМС ESC РПУМЕДПЧБФЕМШОПУФЕК
STACKSEG	EQU 100H	;ХЛБЪБФЕМШ ЧЕТИХЫЛЙ УФЕЛБ
CBEG		EQU 02H		;УНЕЭЕОЙЕ ЛХТУПТБ Ч НБФТЙГЕ
RAZM		EQU 0DH		;ТБЪНЕТ ЛХТУПТБ
TEXT_LIMIT	EQU 97FFH	;ЛПОЕГ ФЕЛУФБ
KD_CONST	EQU 23H		;ЛПОУФБОФБ ПВМБУФЙ нЙЛТПдпу ОБ лд.
;;ыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыы
SYS_MDOS	EQU 5	; system point CP/M
SECSIZ		EQU 80H	; дМЙООБ ЪБРЙУЙ Ч CP/M
CR		EQU 0DH ; лПОЕГ УФТПЛЙ
LF		EQU 0AH	; рЕТЕЧПД УФТПЛЙ
;;ыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыы
DR_OFSET	EQU 0	; уНЕЭЕОЙЕ ОПНЕТБ ОБЛПРЙФЕМС Ч ВМПЛЕ FCB
NM_OFSET	EQU 1	; уНЕЭЕОЙЕ ЙНЕОЙ ЖБКМБ Ч ВМПЛЕ FCB
ET_OFSET	EQU 9	; уНЕЭЕОЙЕ ТБУЫЙТЕОЙС Ч ВМПЛЕ FCB
EX_OFSET	EQU 12	; уНЕЭЕОЙЕ ОПНЕТБ ФЕЛХЭЕЗП ЬЛУФЕОФБ
RC_OFSET	EQU 15	; уНЕЭЕОЙЕ ЮЙУМБ ЪБРЙУЕК ДБООПЗП ЬЛУФЕОФБ
CR_OFSET	EQU 32	; уНЕЭЕОЙЕ ОПНЕТБ ФЕЛХЭЕК ЪБРЙУЙ
;;ыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыы
;;_CONIN	EQU 1	; ЮФЕОЙЕ УЙНЧПМБ У ЛПОУПМЙ
;;_CONOUT	EQU 2	; ЪБРЙУШ УЙНЧПМБ Ч РПФПЛ ЛПОУПМЙ
;;_LSTOUT	EQU 5	; ЧЩЧПД УЙНЧПМБ ОБ РЕЮБФШ
;;_DCONIO	EQU 6	; ПВНЕО У ЛПОУПМША
;;_PSTRING	EQU 9	; ЪБРЙУШ РПУМЕДПЧБФЕМШОПУФЙ
;;			; Ч РПФПЛ ЛПОУПМЙ  (terminated by '$')
;;_GETLIN	EQU 10	; РТЙЕН Ч ВХЖЕТ ЛПОУПМЙ
;;_CSTAT	EQU 11	; РПМХЮЙФШ УФБФХУ ЛПОУПМЙ
_DISK_RESET	EQU 13	; УВТПУ ДЙУЛПЧПК РПДУЙУФЕНЩ
_SELECT		EQU 14	; ЧЩВПТ ДЙУЛБ
_OPENC		EQU 15	; ПФЛТЩФЙЕ ЖБКМБ
_CLOSEC		EQU 16	; ЪБЛТЩФЙЕ ЖБКМБ
_SEARCH_1	EQU 17	; РПЙУЛ РЕТЧПЗП ЧИПДБ
_SEARCH_N	EQU 18	; РПЙУЛ УМЕДХАЭЕЗП ЧИПДБ
_DELC		EQU 19	; ХДБМЕОЙЕ ЖБКМБ
_READS		EQU 20	; ЮЙФБФШ ФЕЛХЭАА ЪБРЙУШ Ч DMA
_WRITS		EQU 21	; ЪБРЙУБФШ ---//----///----
_GREATS		EQU 22	; УПЪДБФШ ЖБКМ ОБ ДЙУЛЕ
_RENC		EQU 23	; РЕТЕЙНЕОПЧБФШ ЖБКМ
_IN_DISK	EQU 25	; РПМХЮЙФШ ФЕЛХЭЙК ДЙУЛ
_SET_DMA	EQU 26	; ХУФБОПЧЙФШ DMA
_GSUSER		EQU 32	; РПМХЮЕОЙЕ/ХУФБОПЧЛБ ЛПДБ РПМШЪПЧ.
_READR		EQU 33	; РТПЙЪЧПМШОПЕ ЮФЕОЙЕ
_WRITR		EQU 34	; РТПЙЪЧПМШОБС ЪБРЙУШ
_SFSIZC		EQU 35	; ПРТЕДЕМЕОЙЕ ТБЪНЕТБ ЖБКМБ
_SRRECC		EQU 36	; ХУФБОПЧЛБ ХЛБЪБФЕМС ДМС РТПЙЪЧПМШОПЗП
			; ПВНЕОБ У ЖБЙМПН
_SETMUL		EQU 44	; ХУФБОПЧЛБ НХМШФЙУЕЛФПТОПК ПВТБВПФЛЙ
;;ыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыы

;;
;;    ™ќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќ‹
;;    Љ  (C) 1993  лБТБЗБОДБ  лРФй  ьб-91-2  рЙНЕОПЧ р.б   Љ
;; ™ќќљќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќ‹  Љ
;; Љ     ED.COM  -  Utilite for text editor MAR.COM     Љ  Љ
;; Љ							Љ  Љ
;; Љ ========== 52-81-95 ========= PPA Systems ======== Љ  Љ
;; Љ              Copyright  by  рЙНЕОПЧ р.б            Љ  Љ
;; Љ  ™ќќќќќќќќќќќќќќќќќќ‹    ™ќќќќќќќќќќќќќќќќќќќќќќ‹  њќќЊ
;; ќќ‰ asm file: 0000h  њќќќќ‰ com file: 0000h Byte њќќЊ
;;    ќќќќќќќќќќќќќќќќќќЊ    ќќќќќќќќќќќќќќќќќќќќќќЊ
;;
;;	      /////////////////////////////////////
;;      	   01110010 00100111 00100000
;;	           РТ. зБЗБТЙОБ 01110010/0001
;;	           0010 - 00110000 - 00010100
;;	      //////////	Title	DE.ASM
	ORG	0000h
;;
;; //////// 15.04.1993 ///////////////////////////////////
;; //  (C) 1993  лБТБЗБОДБ  лРФй  ьб-91-2  рЙНЕОПЧ р.б	//
;; //							//
;; // ====== 52-81-95 ======== PPA Soft Systems ======	//
;; //		Copyright  by  рЙНЕОПЧ рБЫБ		//
;; ////// "ыЕМ ДПЦДШ ОБ ПУФБОПЧЛЙ" ///////////////////////
;;
	Include	MACRO.PPA	; нБЛПРПДУФБОПЧЛЙ
	Include	EQU.PPA		; лПОУФБОФЩ.
;;
;; зМПВБМШОЩЕ ФПЮЛЙ ЧИПДБ Ч НПДХМШ УЕТЧЙУОЩИ РТПГЕДХТ
;;
	Public	PUTSXY_Z	; ЧЩПД ASCIIZ УФТПЛЙ
	Public	W_PUTSXY_Z	;
	Public	SCREEN_CLS	; ЖЙТНЕОБС ПФЮЙУФЛБ.
	Public	CINV		; ЗЕОЕТБГЙС ЛХТУПТБ
	Public	CINV_ABS	; ---//---//---//---
	Public	C_ALT_INV	; ТБЪНЕТ ЛХТУПТБ.
	Public	INV_LINE	; ЙОЧЕТФЙТХЕФ УФТПЛХ.
	Public	GOR_STREL	; ЗПТЙЪПОФБМШОБС УФТЕМЛБ
	Public	VER_STREL	; ЧЕТФЙЛБМШОБС УФТЕМЛБ
	Public	DUMP_WIS	; хнощк ДБНР.
	Public	DUMP_HEX	; ЫЕУФОБДГБФЕТЙЮОЩК ДБНР
	Public	DUMP_TEXT	; --//--
	Public	LINE_HEX	; ---//--- УФТПЛБ
	Public	LINE_TEXT	; --//--
	Public	W_PUT_HEX	; ПЛПООЩК HEX ЧЩЧПД
	Public	PUT_HEX		; БВУПМАФОЩК --//--//--
	Public	PUT_NIBL	; ЧЩЧПД НМБДЫЕЗП ОЙВМБ
	Public	NEW_DUMP	;
	Public	LOAD_OFFSET	;
	Public	RE_PRINT_POS	;
	Public	RE_PR_DISK	;
	Public	RE_DISK_POS	;
	Public	PUT_CHAR	;
	Public	PUT_WORD_HEX	;
	Public	NEG_DE		;

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;	  чЩИПДЩ ОБ ЧОЕЫОЙЕ ЖХОЛГЙЙ ДТБКЧЕТПЧ.		;;
;;							;;

;;///////////// KD.ASM - дТБКЧЕТ ЛМБЧЙБФХТЩ //////////////

	External BEEP	; эЕМЮЕЛ.
	External IN_KEY	; ЧЪСФШ ЛПД ЙЪ ВХЖЕТБ
	External KEY_RESET; УВТПУ ЛМБЧЙБФХТЩ

	External KEY_INT; ХЛБЪБФЕМШ ДТБКЧЕТ

	External FLAGC	; ЖМБЗ ГЧЕФПЗЕОЕТБФПТБ
	External COLOR	; ЛПД ГЧЕФПЧПК РБМЙФТЩ
	External RUSLAT	; УФБФХУ РП БМЖБЧЙФХ
	External SMALL	; УФБФХУ РП ТЕЗЙУФТХ
	External KEY_KOD; ДЙОБНЙЮЕУЛЙК ЛПД ЛМБЧЙЫ
	External SEEK	; ХЛБЪБФЕМШ ЪБРПМОЕОЙС
	External KEY_NUM; БРБТБФОЩК ОПНЕТ ЛМБЧЙЫЙ

;;//////// WD.ASM - дТБКЧЕТ ПЛПООПЗП ЙОФЕТЖЕКУБ //////////

;========= ПУОПЧОБС ФБВМЙГБ РЕТЕИПДПЧ ==========
	External WPUTC1	;ЧЩЧПД УЙНЧПМБ ЛППТД. Ч 'DE'
	External GETC	;ЮФЕОЙЕ УЙНЧПМБ -//-
	External ACTIV	;ПФЛТЩФЙЕ ПЛОБ (DE),(HL),Б-ЖМБЗ
	External DEACTI  ;ЪБЛТЩФЙЕ ПЛОБ
	External BORT	;ОБТЙУПЧБФШ ТБНЛХ
	External HOME	;ПФЮЙУФЛБ ПЛОБ
	External SCROL1	;УЛТПММЙОЗ ПЛОБ ЧЧЕТИ
	External SCROL2	;--//-- ЧОЙЪ
;;	External SCROL3	;--//-- ЧРТБЧП (ОБ 2 УЙНЧПМБ)
;;	External SCROL4	;--//-- ЧМЕЧП --//--
;;
;========== ДПРПМОЙФЕМШОБС ФБВМЙГБ РЕТЕИПДПЧ ==========
;ТЕБМЙЪХЕФ ФЕЦЕ ЖХОЛГЙЙ ОП ЙУРПМШЪХАФ БВУПМАФОЩЕ ЛППТДЙОБФЩ
;;
	External PUTCXY	
	External GETCXY	
	External RAMKA	;ЖМБЗ РЕТЕДПЧБФШ ОЕ ОХЦОП
	External TEN	;
	External CLS	
	External SCRN	
	External SCRV	
;;	External SCRP	
;;	External SCRL	
	External ABS_DE
	External LIIR
	External LDIR
	External ADDREM
	External ADDRSC	

;______________ ТБВПЮЙЕ СЮЕКЛЙ ________________
	External CURSOR
	External WIND1
	External WIND2
	External NUM
	External BUF_SEK
	External FLAGW

;___________ ЙОУФБМСГЙПООЩЕ ЛТОУФБОФЩ __________

	External BUF_ZISE  ; 2 ВБКФБ РПЛБЪЩЧ ТБЪНЕТ ВХЖЕТБ.
	External BUF_BEGIN ;2 ВБКФБ ХЛБЪЩЧБАЭЙЕ ОБ ОБЮБМП
			   ; ВХЖЕТБ ПЛПО.
	External W_ZG	 ; 2 ВБКФБ ХЛБЪЩЧ ОБЮБМП ЪОБЛП ЗЕО.
	External W_EMUL_TXT
			 ; 2 ВБКФБ ХЛБЪЩЧ ОБ ПВМБУФШ ЬНХМ-
			 ; СГЙЙ ФЕЛУФПЧПЗП ЬЛТБОБ ( 1лВБКФ)
	External STACK_SEGMENT;
			 ; ХЛБЪБФЕМШ ЧЕТИХЫЛЙ УФЕЛБ.
	External BUF_DISK;
;____________ ТБВПЮЙЕ СЮЕКЛЙ ______________
	External POSITION	;
	External DE_MODE	;
	External CULINDER	;
	External HEAD		;
	External SECTOR		;
;___________________________________________
	External CC_LEFT_KEY	;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;	    йУИДОЩК ФЕЛУФ УЕТЧЙУОЩИ РТПГЕДХТ.		;;
;;++++++++++++++++++++++++++++++++++++++++++++++++++++++;;


;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;   рТПГЕДХТБ ЙОЧЕТУЙЙ УФТПЛЙ Ч ПЛПООЩИ  ЛППТДЙОБФБИ	;;
;;	B - дмйоб уфтплй.				;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
INV_LINE:
	LXI	H,C_ALT_INV	;
	INX	H		;
	MVI	M,14		;
	PUSH	B		;
	PUSH	D		;
	CALL	ABS_DE		;
I_L_00:
	CALL	CINV_ABS	;
	INR	D		;
	DCR	B		;
	JNZ	I_L_00		;
	POP	D		;
	POP	B		;
	MVI	M,1		;
	RET			;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;	рТПЙЪЧПДЙФ ПВОБЧМЕОЙЕ ПЛОБ ХЛБЪБФЕМС УЕЛФПТБ	;;
;; ЙУРПМШЪХС ДБООЩЕ РПМХЮЕООЩЕ ЙЪ ТБВПЮЙИ СЮЕЕЛ.	;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
RE_DISK_POS:
	CALL	RE_PR_DISK	;
	CALL	CC_LEFT_KEY	;
	LXI	H,BUF_DISK	;
	SHLD	POSITION	;
	BH_MOV			;
	LXI	D,0000h		;
	LXI	H,0807h		;
	SHLD	CURSOR		;
	XCHG			;
	CALL	DUMP_WIS	;
	RET			;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;	рТПГЕДХТБ ПТЗБОЙЪБГЙЙ ЧЩЧПДБ "ХНОПЗП" ДБНРБ	;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
DUMP_WIS:
	LDA	DE_MODE		;
	INR	A		;
	CZ	DUMP_TEXT	;
	CNZ	DUMP_HEX	;
	CALL	KEY_RESET	;
	RET			;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;   рТПГЕДХТБ ПВОПЧМЕОЙС ФЕЛХЭЕЗП УПУФПСОЙС ДЙУЛБ.	;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
RE_PR_DISK:
	LXI	D,170Dh		;
	LDA	CULINDER	;
	CALL	PUT_HEX		;
	INR	D		;
	LDA	HEAD		;
	RRC			;
	RRC			;
	XRI	00000001b	;
	CALL	PUT_NIBL	;
	LDA	SECTOR		;
	INR	D		;
	CALL	PUT_NIBL	;
	RET			;

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;	рТПГЕДХТБ БОБМПЗЙЮОБ PUTSXY_Z ФПМШЛП РТПЙЪЧПДЙФ	;;
;; РТЕПВТБЪПЧБОЙС ПФОПУЙФЕМШОЩИ ЛППТДЙОБФ.		;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
W_PUTSXY_Z:
	PUSH	D		;
	CALL	ABS_DE		;
	CALL	PUTSXY_Z	;
	POP	D		;
	RET			;

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;	 рТПГЕДХТБ   РПДЗПФБЧМЙЧБЕФ  "ПВОПЧМЕОЙЕ"  ПЛОБ ;;
;;  ТЕДБЛФЙТПЧБОЙС  РХФЕН ЪБРПМОЕОЙС ТЕЗЙУФТПЧ ДМС ТБУ-	;;
;; РЕЮБФЛЙ ДБНРБ РБНСФЙ:				;;
;;	BC - ХЛБЪБФЕМШ ОБ ЖЙЪЙЮЕУЛХА РБНСФШ ДБНРБ.	;;
;;	HL - МПЗЙЮЕУЛПЕ УНЕЭЕОЙЕ ( ЛПД УМЕЧБ ДБНРБ.)	;;
;;	DE - ПФОПУЙФЕМШОЩЕ ЛПТДЙОБФЩ ЧЩЧПДБ ДБНРБ.	;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
NEW_DUMP:
	CALL	LOAD_OFFSET	;
	XCHG			;
	LHLD	CURSOR		;
	MOV	A,L		;
	XCHG			; HL - УНЕЭЕОЙЕ БДТЕУБ.
	LXI	D,-16		; "РТЙТБЭЕОЙЕ".
N_D_01:
	CPI	07h		;
	JZ	N_D_00		; РПДОСМЙ ОБ ЛТЩ	TITLE	MADD.ASM		;V1.00
;;  рПУМЕДОСС ЛПТТЕЛГЙС НПДХМС: 30.3.1993 З.
;;  ++++++ 16:20 +++++++ чФПТОЙЛ ++++++++++++
;;
;; /*  Welcomme to pace PPA_Soft */
;;
;;    ™ќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќ‹
;;    Љ  (C) 1993  лБТБЗБОДБ  лРФй  ьб-91-2  рЙНЕОПЧ р.б   Љ
;; ™ќќљќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќ‹  Љ
;; Љ     ED.COM  -  Utilite for text editor MAR.COM     Љ  Љ
;; Љ							Љ  Љ
;; Љ ========== 52-81-95 ========= PPA Systems ======== Љ  Љ
;; Љ              Copyright  by  рЙНЕОПЧ р.б            Љ  Љ
;; Љ  ™ќќќќќќќќќќќќќќќќќќ‹    ™ќќќќќќќќќќќќќќќќќќќќќќ‹  њќќЊ
;; ќќ‰ asm file: 0000h  њќќќќ‰ com file: 0000h Byte њќќЊ
;;    ќќќќќќќќќќќќќќќќќќЊ    ќќќќќќќќќќќќќќќќќќќќќќЊ
;;
;;	      /////////////////////////////////////
;;      	   01110010 00100111 00100000
;;	           РТ. зБЗБТЙОБ 01110010/0001
;;	           0010 - 00110000 - 00010100
;;	      /////////////////////////////////////
;;
;; Is problemm !!!  25.03.1993 З.

;;;;;;;;;;		INCLUDE	MACRO.PPA
;;
;;   Header - file   MACRO.PPA:
;;   "уФБОДБТФОЩК ЖБКМ" ДПРПМОЙФЕМШОЩИ НБЛТПРПДУФБОПЧПЛ
;;   ХРТПЭБАЭЙИ ОБРЙУБОЙЕ РПДРТПЗТБНН Ч УТЕДЕ нБЛТПБУУ-
;;   ЕНВМЕТБ M80.COM
;;  //////////////////////////////////////////////////
;;	 PPA Systems   Instal  3.3.1993  чФПТОЙЛ.
;;  //////////////////////////////////////////////////

;;
;;=========================================================
;;	RG_PUSH - лПНБОДБ ЪБЗТХЪЛЙ ХЛБЪБООЩИ ТЕЗЙУФТПЧ
;;	Ч УФЕЛ®
;;

;;
;;=========================================================
;;	INT - ЛПНБОДБ ПТЗБОЙЪБГЙЙ УЙУФЕНОЩИ ЧЩЪПЧПЧ Ч
;;	ПРЕТБГЙПООПК УЙУФЕНЕ CP/M ( нЙЛТП дПУ ).
;;

INT		Macro	SYS_NUM		;
		MVI	C,SYS_NUM	;
		CALL	0005H		;
		Endm			;
;;
;;=========================================================
;;	BH_MOV - лПНБОДБ РЕТЕУЩМЛЙ УППФЧЕФУФЧХАЭЙИ ТЕЗЙУФТ-
;;	ПЧ РБТЩ HL Ч РБТХ BC.
;;
BH_MOV		Macro			;
		MOV	B,H		;
		MOV	C,L		;
		Endm			;
;;
;;=========================================================
;;	HB_MOV - рЕТЕОПУ РБТЩ BC Ч РБТХ HL.
;;
HB_MOV		Macro			;
		MOV	H,B		;
		MOV	L,C		;
		Endm			;
;;
;;=========================================================
;;	BD_MOV - рЕТЕОПУ РБТЩ DE Ч РБТХ BC.
;;
BD_MOV		Macro			;
		MOV	B,D		;
		MOV	C,E		;
		Endm			;
;;
;;=========================================================
;;	DB_MOV - рЕТЕОПУ РБТЩ BC Ч РБТХ DE.
;;
DB_MOV		Macro			;
		MOV	D,B		;
		MOV	E,C		;
		Endm			;


;;;;;;;;;;;		INCLUDE	EDEQU.ASM
;;
;;   Header - file   EDEQU.ASM  :
;;  уПДЕТЦЙФ ЧУЕ ОЕПВИПДЙНЩЕ ЛПОУФБОФЩ ЛБЛ ДМС ТБВПФЩ ЬЛТБООЩИ
;;  РПДРТПЗТБНН ФБЛ ЦЕ УПДЕТЦЙФ РБЛЕФ ПРТЕДЕМЕОЙК ОЕПВИПДЙНЩИ
;;  ДМС ТБВПФЩ У ДЙУЛПЧЩН ОБЛПРЙФЕМЕН
;;    УЕЗПДОС: 17.12.1992З. ++++ 16:47 +++++ ЮЕФЧЕТЗ
;;				/* PPA Systems */
;; РТПЗТБННБ ТБВПФЩ У ДЙУЛПН 26.11.1992

F_FILE0		EQU 81H		;ТБВПФБ У ДЙУЛБНЙ
;K_SUMMA	EQU 101H	;рТПФЙЧ ЧЪМПНБ
;BUF1		EQU 103H	;вХЖЕТ®WD.ASM
;KEYVEKT	EQU 105H	;уФБТЩК ЧЕЛФПТ®

;; ЧЧЕДЕОБ ДМС ЬЛПОПНЙЙ РБНСФЙ

BTEXT 		EQU 3300H	;ОБЮБМП ФЕЛУФБ
MZG		EQU 2300H	;ОБЮБМП ЪОБЛПЗЕОЕТБФПТБ
MEMU		EQU 9800H	;ОБЮБМП ПВМБУФЙ ЬНХМСГЙЙ
MSEK		EQU 9C00H	;ОБЮБМП ВХЖЕТБ ПЛПО
MEND		EQU 9DFFH	;ЛПОЕГ ВХЖЕТБ ПЛПО
STOPBYTE	EQU 1AH		;ЙДЕОФЙЖЕЛБФПТ "ЛПОЕГ ФЕЛУФБ"
ESC		EQU 1BH		;лПД ДМС ESC РПУМЕДПЧБФЕМШОПУФЕК
STACKSEG	EQU 100H	;ХЛБЪБФЕМШ ЧЕТИХЫЛЙ УФЕЛБ
CBEG		EQU 02H		;УНЕЭЕОЙЕ ЛХТУПТБ Ч НБФТЙГЕ
RAZM		EQU 0DH		;ТБЪНЕТ ЛХТУПТБ
TEXT_LIMIT	EQU 97FFH	;ЛПОЕГ ФЕЛУФБ
KD_CONST	EQU 23H		;ЛПОУФБОФБ ПВМБУФЙ нЙЛТПдпу ОБ лд.
;;ыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыы
SYS_MDOS	EQU 5	; system point CP/M
SECSIZ		EQU 80H	; дМЙООБ ЪБРЙУЙ Ч CP/M
CR		EQU 0DH ; лПОЕГ УФТПЛЙ
LF		EQU 0AH	; рЕТЕЧПД УФТПЛЙ
;;ыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыы
DR_OFSET	EQU 0	; уНЕЭЕОЙЕ ОПНЕТБ ОБЛПРЙФЕМС Ч ВМПЛЕ FCB
NM_OFSET	EQU 1	; уНЕЭЕОЙЕ ЙНЕОЙ ЖБКМБ Ч ВМПЛЕ FCB
ET_OFSET	EQU 9	; уНЕЭЕОЙЕ ТБУЫЙТЕОЙС Ч ВМПЛЕ FCB
EX_OFSET	EQU 12	; уНЕЭЕОЙЕ ОПНЕТБ ФЕЛХЭЕЗП ЬЛУФЕОФБ
RC_OFSET	EQU 15	; уНЕЭЕОЙЕ ЮЙУМБ ЪБРЙУЕК ДБООПЗП ЬЛУФЕОФБ
CR_OFSET	EQU 32	; уНЕЭЕОЙЕ ОПНЕТБ ФЕЛХЭЕК ЪБРЙУЙ
;;ыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыы
;;_CONIN	EQU 1	; ЮФЕОЙЕ УЙНЧПМБ У ЛПОУПМЙ
;;_CONOUT	EQU 2	; ЪБРЙУШ УЙНЧПМБ Ч РПФПЛ ЛПОУПМЙ
;;_LSTOUT	EQU 5	; ЧЩЧПД УЙНЧПМБ ОБ РЕЮБФШ
;;_DCONIO	EQU 6	; ПВНЕО У ЛПОУПМША
;;_PSTRING	EQU 9	; ЪБРЙУШ РПУМЕДПЧБФЕМШОПУФЙ
;;			; Ч РПФПЛ ЛПОУПМЙ  (terminated by '$')
;;_GETLIN	EQU 10	; РТЙЕН Ч ВХЖЕТ ЛПОУПМЙ
;;_CSTAT	EQU 11	; РПМХЮЙФШ УФБФХУ ЛПОУПМЙ
_DISK_RESET	EQU 13	; УВТПУ ДЙУЛПЧПК РПДУЙУФЕНЩ
_SELECT		EQU 14	; ЧЩВПТ ДЙУЛБ
_OPENC		EQU 15	; ПФЛТЩФЙЕ ЖБКМБ
_CLOSEC		EQU 16	; ЪБЛТЩФЙЕ ЖБКМБ
_SEARCH_1	EQU 17	; РПЙУЛ РЕТЧПЗП ЧИПДБ
_SEARCH_N	EQU 18	; РПЙУЛ УМЕДХАЭЕЗП ЧИПДБ
_DELC		EQU 19	; ХДБМЕОЙЕ ЖБКМБ
_READS		EQU 20	; ЮЙФБФШ ФЕЛХЭАА ЪБРЙУШ Ч DMA
_WRITS		EQU 21	; ЪБРЙУБФШ ---//----///----
_GREATS		EQU 22	; УПЪДБФШ ЖБКМ ОБ ДЙУЛЕ
_RENC		EQU 23	; РЕТЕЙНЕОПЧБФШ ЖБКМ
_IN_DISK	EQU 25	; РПМХЮЙФШ ФЕЛХЭЙК ДЙУЛ
_SET_DMA	EQU 26	; ХУФБОПЧЙФШ DMA
_GSUSER		EQU 32	; РПМХЮЕОЙЕ/ХУФБОПЧЛБ ЛПДБ РПМШЪПЧ.
_READR		EQU 33	; РТПЙЪЧПМШОПЕ ЮФЕОЙЕ
_WRITR		EQU 34	; РТПЙЪЧПМШОБС ЪБРЙУШ
_SFSIZC		EQU 35	; ПРТЕДЕМЕОЙЕ ТБЪНЕТБ ЖБКМБ
_SRRECC		EQU 36	; ХУФБОПЧЛБ ХЛБЪБФЕМС ДМС РТПЙЪЧПМШОПЗП
			; ПВНЕОБ У ЖБЙМПН
_SETMUL		EQU 44	; ХУФБОПЧЛБ НХМШФЙУЕЛФПТОПК ПВТБВПФЛЙ
;;ыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыы

;;
;;    ™ќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќ‹
;;    Љ  (C) 1993  лБТБЗБОДБ  лРФй  ьб-91-2  рЙНЕОПЧ р.б   Љ
;; ™ќќљќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќ‹  Љ
;; Љ     ED.COM  -  Utilite for text editor MAR.COM     Љ  Љ
;; Љ							Љ  Љ
;; Љ ========== 52-81-95 ========= PPA Systems ======== Љ  Љ
;; Љ              Copyright  by  рЙНЕОПЧ р.б            Љ  Љ
;; Љ  ™ќќќќќќќќќќќќќќќќќќ‹    ™ќќќќќќќќќќќќќќќќќќќќќќ‹  њќќЊ
;; ќќ‰ asm file: 0000h  њќќќќ‰ com file: 0000h Byte њќќЊ
;;    ќќќќќќќќќќќќќќќќќќЊ    ќќќќќќќќќќќќќќќќќќќќќќЊ
;;
;;	      /////////////////////////////////////
;;      	   01110010 00100111 00100000
;;	           РТ. зБЗБТЙОБ 01110010/0001
;;	           0010 - 00110000 - 00010100
;;	      /////////////////////////////////////
;;
;; Is problemm !!!  25.03.1993 З.
;;
;;
;РПДРТПЗТБННЩ ЧЩЪЩЧБАЭЙЕ РТПГЕДХТХ REGENER ОЕ ДПМЦОЩ ЪБУПТСФШ ДП ЬФПЗП УФЕЛ
;;
		JMP	PPASTART
EDITING:
		CALL	COPYS
		STA	DLINNA
		CALL	DON
		CALL	UP
NOESOPROS:	CALL	CINV
LOOPKEY:	CALL	KEYDELAU
;;
;;   рТПЙЪЧЕДЕН ОБЛБЪБОЙЕ ЧЪМПНЭЙЛБ
;;
KONTR_PPA:
		STA	PPASTART-1
		CALL	CINV
		LXI	H,NOESOPROS
		PUSH	H
; ХРТБЧМСАЭЙЕ ЛМБЧЙЫЙ
		MOV	B,A
		IN	01H	; вЕТЕН УФБФХУ ЙЪ РПТФБ "у"
		MOV	C,A
		ANI	40H	;ЧЩДЕМЙФШ УЛБОЛПД "ХУ"
		MOV	A,B
		JZ	USADDX	;ПВТБВПФБФШ ХУ+
		CPI	10H
		JNC	BYKVA
		MOV	A,C
		ANI	20H	;ЧЩДЕМЙФШ УЛБОЛПД "CC"
		MOV	A,B
		JZ	CCADDX	;ПВТБВПФБФШ CC+...
		ORA	A
		JZ	BYKVA	;фБВХМСГЙС
		CPI	07H	;ЧОЙЪ
		JZ	DON	
		CPI	05H	;ЧЧЕТИ
		JZ	UP	
		CPI	06H	;ЧРТБЧП
		JZ	RIGHT	
		CPI	04H	;ЧМЕЧП
		JZ	LEFT
KEYDONE:	CPI	0CH	;F2-Delete
		JZ	DELETE
		CPI	03H	;ЪБВПК
		JZ	ZABOY
		CPI	08H	;ДПНПК
		JZ	DOMOY
		CPI	2H	;Enter
		JZ	ENTER
		RET	

;%%%%%%%%%%%%% CC + ЛМБЧЙЫЙ %%%%%%%%%%%%%%%

CCADDX:		LXI	H,KEYRESET
		PUSH	H
		CPI	05H	;CC+ЧЧЕТИ
		JZ	CCUP
		CPI	07H	;CC+ЧОЙЪ
		JZ	CCDON
		CPI	04H	;CC+ЧМЕЧП
		JZ	CCLEFT
		CPI	06H	;CC+ЧРТПЧП
		JZ	CCRIGHT
		CPI	0CH	;CC+F2 - ХДБМЕОЙЕ ФЕЛХЭЕК УФТПЛЙ
		JZ	CCDELETE
		JMP	KEYDONE	;ЙОБЮЕ ЖХОЛГЙЙ ОЕ ЙЪНЕОЙМЙУШ


;;
;;ыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыы;;
;;ыыыыыыы (C)  Copyright 1992 by Pimenov Pasha ыыыыыыыы;;
;;ыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыы;;
;;ыыыыыыыыыыыыыы     ыыы     ыыыыы     ыыыыыыыыыыыыыыыы;;
;;ыыыыыыыыыыыыыы  ыы  ыы  ыы  ыыы  ыы  ыыыыыыыыыыыыыыыы;;
;;ыыыыыыыыыыыыыы  ыы  ыы  ыы  ыы  ыыы  ыыыыыыыыыыыыыыыы;;
;;ыыыыыыыыыыыыыы     ыыы     ыыы  ыыы  ыыыыыыыыыыыыыыыы;;
;;ыыыыыыыыыыыыыы  ыыыыыы  ыыыыыы       ыыыыыыыыыыыыыыыы;;
;;ыыыыыыыыыыыыыы  ыыыыыы  ыыыыыы  ыыы  ыыыыыыыыыыыыыыыы;;
;;ыыыыыыыыыыыыыы  ыыыыыы  ыыыыыы  ыыы  ыыыыыыыыыыыыыыыы;;
;;ыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыы;;
;;ыыыыыыы      470075     З.лБТБЗБОДБ           ыыыыыыы;;
;;ыыыыыыы   ХМ. 40 МЕФ лБЪБИУФБОБ Д.39/3 ЛЧ.1   ыыыыыыы;;
;;ыыыыыыы            рЙНЕОПЧ р.б                ыыыыыыы;;
;;ыыыыыыы               Ф.52-81-95              ыыыыыыы;;
;;ыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыы;;
;;
;;==================================================
;; рТПЗТБНОЩК РТПДХЛФ PPA-Editor СЧМСЕФУС БРПТБФОП
;; ЪБЧЙУНПК РТПЗТБННПК (УРЕГЙБМШОП ДМС чЕЛЛФПТ-06г)
;; ОБРЙУБООБ РПМОПУФША ОБ БУУЕНВМЕТЕ РТЙ ЙУРПМШЪП-
;; ЧБОЙЙ РБЛЕФБ НБЛТПБУУЕНВМЕТБ ---------- M80.COM
;;;;;
;;(*) MAIN.ASM    - ПУОПЧОПК НПДХМШ УПДЕТЦЙФ ПУОПЧ-
;;		    ОЩЕ ПРЙУБОЙС РЕТЕНЕООЩИ Й ПРЙ-
;;		    УБОЙЕ include - ЖБКМПЧ.
;;;;;
;;(*) WIND.ASM    - ЙУИПДОЙЛ ХОЙЧЕТУБМШОПЗБ ДТБКЧ-
;;		    ЕТБ "пЛПООПК НЙЛТП-УЙУФЕНЩ" Й
;;		    ЧЩУФХРБЕФ Ч ЛБЮЕУФЧЕ ДТБКЧЕТБ
;;		    ДЙУРМЕС Ч PPA-Editor
;;;;;
;;(*) KEYDRIV.ASM - ХОЙЧЕТУБМШОЩК ДТБКЧЕТ ЛМБЧЙ-
;;		    БФХТЩ ЬНХМЙТХЕФ ЧПЪНПЦОПУФЙ
;;		    УФБОДБТФОПК ЧПУНЙВЙФПЧПК ЛМБ- 
;;		    ЧЙБФХТЩ
;;;;;
;;(*) EDMAIN.ASM - НПДХМШ УПДЕТЦЙФ ДПРПМОЙФЕМШОЩЕ
;;		   РТПГЕДХТЩ РП ЧЩЧПДХ ЙОЖПТНБГЙЙ
;;		   ЙОЖПТНБГЙЙ ОБ ЬЛТБО
;;;;;
;; Й ДТХЗЙЕ ЖБКМЩ
;; ДБООБС РТПЗТБННБ СЧМСЕФУС ПВ'ЕДЙОЕОЙЕН ЬФЙИ ЖБКМПЧ
;;
;;;;;
;; ПВ'ЕДЙОЕОЙЕН ЧУЕИ ЕФЙИ ЖБКМПЧ СЧМСЕФУС
;; MADD.ASM
;;
;; /////// вМПЛ ФЕЛУФПЧЩИ УФТПЛ УППВЭЕОЙК  \\\\\\\\

;; "юФЕОЙЕ ЖБКМБ"
F_S00:		DB	0FEH,0D4H,0C5H,0CEH,0C9H,0C5H
		DB	020H,0C6H,0C1H,0CAH,0CCH,0C1H
		DB	CR
;; "ъБРЙУШ жБКМБ"
		DB	0FAH,0C1H,0D0H,0C9H,0D3H,0D8H
		DB	020H,0C6H,0C1H,0CAH,0CCH,0C1H
		DB	CR
;; "рПДЗТХЪЛБ"
		DB	0F0H,0CFH,0C4H,0C7H,0D2H,0D5H
		DB	0DAH,0CBH,0C1H,CR

F_S10:		DB	'File:',CR
F_S20:		DB	'No file!',CR
F_S30:		DB	'Out of disk !',CR

;;"рТПДПМЦЙФШ ?"
S_SOOBHLP3:	DB	0F0H,0D2H,0CFH,0C4H,0CFH,0CCH,0D6H,0C9H
		DB	0D4H,0D8H,020H,03FH,CR

;;"ХРТБЧМЕОЙЕ: <- ->"
S_SOOBHLP2:	DB	6,7,' ', 0F5H,0D0H,0D2H,0C1H,0D7H,0CCH
		DB	0C5H,0CEH,0C9H,0C5H,03AH,' ',6,7,' ',7,8
		DB	' ',7,8,CR

;;"рТПУНПФТ"
S_SOOBHLP:	DB	0F0H,0D2H,0CFH,0D3H,0CDH,0CFH,0D4H,0D2H
		DB	CR

;;"рТПДПМЦЙФШ РПЙУЛ"
S_SOOB1:	DB	0F0H,0D2H,0CFH,0C4H,0CFH,0CCH,0D6H,0C9H
		DB	0D4H,0D8H,020H,0D0H,0CFH,0C9H,0D3H,0CBH
		DB	CR

;;"ЧЩИПД - F4"
S_SOOBEX:	DB	0F7H,0F9H,0E8H,0EFH,0E4H,' - F4',CR

;;"ъБНЕОЙФШ"
		DB	0FAH,0C1H,0CDH,0C5H,0CEH,0C9H,0D4H,0D8H
		DB	CR

;;"ъБЛПОЮЙФШ РПЙУЛ"
;;		DB	0FAH,0C1H,0CBH,0CFH,0CEH,0DEH,0C9H,0D4H
;;		DB	0D8H,020H,0D0H,0CFH,0C9H,0D3H,0CBH,CR

; ;"оЕ ЪБНЕОСФШ"
S_SOOB2:	DB	0EEH,0C5H,020H,0DAH,0C1H,0CDH,0C5H,0CEH
		DB	0D1H,0D4H,0D8H,CR
	
;"оБКФЙ:"
ETALON:		DB	0EEH,0C1H,0CAH,0D4H,0C9H,03AH,CR

;"ъБНБОБ:"
PODMENA:	DB	0FAH,0C1H,0CDH,0C5H,0CEH,0C1H,03AH,CR

;; "тБЪНЕТ ЖБКМБ:"
I_SOOB1:	DB	0F2H,0C1H,0DAH,0CDH,0C5H,0D2H
		DB	020H,0C6H,0C1H,0CAH,0CCH,0C1H
		DB	03AH,CR

;; "уЧПВПДОП:"
		DB	0F3H,0D7H,0CFH,0C2H,0CFH,0C4H
		DB	0CEH,0CFH,03AH,CR
;; "H вБЙФ"
		DB	048H,0020H,0E2H,0C1H,0CAH,0D4H
		DB	CR


PPAYESNO:	DB	6,7,' Yes/No ',7,8,0
F4ESC:		DB	6,7,' F4-Esc ',7,8,0
SOOBF:		DB	'Out of memory',CR

;"ПЫЙВЛБ РПЧФПТЙФЕ ЧЧПД"
ERROR01:	DB	0EFH,0FBH,0E9H,0E2H,0EBH,0E1H,020H,0F0H,0CFH
		DB	0D7H,0D4H,0CFH,0D2H,0C9H,0D4H,0C5H,020H,0D7H
		DB	0D7H,0CFH,0C4H,CR

;"ЧЩКФЙ ЙЪ ТЕДБЛФПТБ"
QUITPPA:	DB	0F7H,0D9H,0CAH,0D4H,0C9H,020H,0C9H,0DAH,020H
		DB	0D2H,0C5H,0C4H,0C1H,0CBH,0D4H,0CFH,0D2H,0C1H
		DB	020H,3FH,CR

;"ОПНЕТ УФТПЛЙ:"
WARNGOTO:	DB	0EEH,0CFH,0CDH,0C5H,0D2H,020H,0D3H,0D4H,0D2H
		DB	0CFH,0CBH,0C9H,3AH,CR

SOOBL:		DB	'Home',CR
SOOBR:		DB	'End',CR
SOOBD:		DB	'Bottom',CR
SOOBV:		DB	'Top',CR


;; "чЩ ХЧЕТЕОЩ ???"
SV_TS2:		DB	0F7H,0D9H,020H,0D5H,0D7H
		DB	0C5H,0D2H,0C5H,0CEH,0D9H
		DB	020H,'???',CR
;; "пФЛХДБ:"
SV_TS1:		DB	20H,0EFH,0D4H,0CBH,0D5H
		DB	0C4H,0C1H,03AH,20H,CR		
;; "лХДБ:"
		DB	20H,0EBH,0D5H,0C4H,0C1H
		DB	03AH,20H,CR

;; "рТПРЙУОЩЕ"
SV_TS0:		DB	0F0H,0D2H,0CFH,0D0H,0C9H
		DB	0D3H,0CEH,0D9H,0C5H,CR

;; "уФТПЮОЩЕ"
		DB	0F3H,0D4H,0D2H,0CFH,0DEH
		DB	0CEH,0D9H,0C5H,CR
;; "мБФ"
		DB	0ECH,0C1H,0D4H,CR
;; "тХУ"		
		DB	0F2H,0D5H,0D3H,CR

;; "фЕЛХЭЙК ГЧЕФ"
SV_SOOB3:	DB	0F4H,0C5H,0CBH,0D5H,0DDH
			0C9H,0CAH,020H,0C3H,0D7H
			0C5H,0D4H,03AH,CR

;; "фЕЛУФ"
SV_SOOB2:	DB	0F4H,0C5H,0CBH,0D3H,0D4H
		DB	CR

;; "жПО"
		DB	0E6H,0CFH,0CEH,CR

;; "рЕТЕЛПДЙТПЧЛБ"
SV_SOOB1:	DB	0F0H,0C5H,0D2H,0C5H,0CBH
			0CFH,0C4H,0C9H,0D2H,0CFH
			0D7H,0CBH,0C1H,CR
;; "чЩВПТ РБМЙФТЩ"
		DB	0F7H,0D9H,0C2H,0CFH,0D2H
			020H,0D0H,0C1H,0CCH,0C9H
			0D4H,0D2H,0D9H,CR

;;
H_SOOB1:	DB	'No file EDHLP.PPA',CR
;;

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;		INCLUDE	WIND.ASM
;;
;; йУИПДОЙЛ ХОЙЧЕТУБМШОПЗП ДТБКЧЕТБ ПЛПООПК УФТХЛФХТЩ ЬЛТБОБ
;; РТПЗТБННБ РПМОПУФША ОБРЙУБОБ ОБ БУУЕНВМЕТЕ (Intel 8080 )
;; Й РТЕДОБЪОБЮЕОБ ДМС ОБРЙУБОЙС ЗЙВЛЙИ ДЙБМПЗПЧЩИ РТПЗТБНН
;; ( ПЛПООЩЕ ТЕДБЛФПТЩ ФЕЛУФБ , ЙОУФТХНЕОФБМШОЩЕ ХФЙМЙФЩ ,Й Ф.Д.)
;;
;;РПУМЕДОСС НПДЙЖЙЛБГЙС : 12.11.1992  З.лБТБЗБОДБ
;;
;;ыыыыыыы   ХМ. 40 МЕФ лБЪБИУФБОБ Д.39/3 ЛЧ.1   ыыыыыыы;;
;;ыыыыыыы            рЙНЕОПЧ р.б                ыыыыыыы;;
;;ыыыыыыы               Ф.52-81-95              ыыыыыыы;;

;;+----[ 13.10.1992 ]-----------[ ЛБТБЗБОДБ ]---+
;;!  БЧФПТ:	рЙНЕОПЧ р.б.			!
;;!	"дТБКЧЕТ ПЛПООПЗП ЙОФЕТЖЕКУБ"		!
;;! ПВЕУРЕЮЙЧБЕФ ЧЩЧПД УЙНЧПМШОПК ЙОЖПТНБГЙЙ Ч	!
;;! ФБЛ ОБЪЩЧБЕНЩЕ "ПЛОБ" ТЕБМЙЪПЧБОЩ УМЕДХ`ЭЙЕ	!
;;! ПРЕТБГЙЙ:	ЧЩЧПД ПДЙОПЮОПЗП УЙНЧПМБ	!
;;!		ПТЗБОЙЪБГЙС ЧУРМЩЧБАЭЙИ ПЛПО	!
;;!		ПФЮЙУФЛБ ПЛПО (ПВМБУФЕК ЬЛТБОБ)	!
;;!		ЮФЕОЙЕ УЙНЧПМБ Ч ЪБД. РПЪЙГЙЙ	!
;;! ЛППТДЙОБФЩ:	ПЛПООЩЕ	(ПФОПУЙФЕМШОЩЕ)		!
;;!		ЬЛТБООЩЕ (БВУПМАФОЩЕ)		!
;;!   ///  ТБУРТЕДЕМЕОЙЕ ТПО РТПГЕУУПТБ  /////	!
;;!	DE  ->  ЛППТД. ЧЩЧПДБ УЙНЧПМБ МЙВП ХЛБЪ.!
;;!		МЕЧ. ОЙЦОЕЗП ХЗМБ ПЛОБ (ПВМБУФЙ)!
;;!		D -> ЗПТЙЪПОФБМШОБС ЛППТДЙОБФБ	!
;;!		Е -> ЧЕТФЙЛБМШОБС --//-- (Y)	!
;;!	HL  ->	ЛППТД.РТБЧ. ЧЕТИО. ХЗМБ ПЛОБ 	!
;;!	BC  ->	ХЛБЪБФЕМШ ОБ УФТПЛХ УЙНЦПМПЧ	!
;;!	A   ->	ЖМБЗ ПЛОБ			!
;;!	+---+---+---+---+---+---+---+---+	!
;;!	! 7 ! 6 ! 5 ! 4 ! 3 ! 2 ! 1 ! 0 !	!
;;!	+---+---+---+---+---+---+---+---+	!
;;!	ПРЙГБОЙЕ ВЙФПЧ ЖМБЗБ:			!
;;!		(D0-D1):  ЧЙД "ФЕОЙ"		!
;;!			00 -> ПФУХФУФЧХЕФ	!
;;!			01-11 -> 1-3 ФЙРЩ	!
;;!		(D2-D3):  ЧЙД "ТБНЛЙ"		!
;;!			00 -> ПФУХФУФЧХЕФ	!
;;!			01 -> ПДЙОБТОБС		!
;;!			10 -> ДЧПКОБС		!
;;!			11 -> ФПЦЕ ПДЙОБТОБС	!
;;!		   (D4):  РБТЙФЕФ ПЛОБ		!
;;!			0  -> ВЕЪ ЧПУФБОПЧМЕОЙС	!
;;!			1  -> У ЧПУФБОПЧМЕОЙЕН	!
;;+----[ OBJ: 06D0H ]----------[ END REMARK ]---+

K_SUMMA:	DB	"26"
BUF1:		DB	".0"
KEYVEKT:	DB	"9 "

;;//////// ТБВПЮЙЕ СЮЕКЛЙ WINDOW.DRIWE //////////
CURSOR:		DW	000AH	;;СЮЕКЛБ УПИТ. ДМС ЛБЦДПЗП ПЛОБ
WIND1:		DW	0	;; (DE) ЛППТДЙОБФЩ ПЛОБ
WIND2:		DW	3F0FH	;; (HL) ---//----//---
NUM:		DB	0	;;ОПНЕТ ФЕЛХЭЕЗП ПЛОБ
BUFSEK:		DW	MSEK  	;;РМБЧБАЭЙК ХЛБЪБФЕМШ ЪБРПМОЕОЙС ВХЖЕТБ
FLAGW:		DB	0	;;ЖМБЗ ФЕЛХЭЕЗП ПЛОБ
DOUBLE:         DB	98H,99H,8BH,8CH,8AH,9DH
INTEG:		DB	90H,0AAH,8FH,0A9H,83H,94H

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

;+-------------[ OPEN WINDOW ]----------+
;*	ЧИПД:	DE -> М.О ХЗПМ		*
;*		HL -> Р.Ч ХЗПМ		*
;*		A  -> ЖМБЗ ПЛОБ		*
;*	ЧЩИПД:	A  ->   = 0  - ХУРЕЫОП	*
;*			<> 0 - ПЫЙВЛБ	*
;+--------------------------------------+
ACTIV:		DI
		PUSH	B	
		PUSH	D	
		PUSH	H	
		PUSH	PSW	
		LDA	FLAGW	
		STA	BUF1	
		POP	PSW	
		STA	FLAGW	
		MOV	A,H	
		SUB	D	
;		JC	WSQ1	;ВМПЛЙТХА ЪБЭЙФХ ДМС ЬЛПОПНЙЙ
		MOV	B,A	
		MOV	A,L	
		SUB	E	
;		JC	WSQ1	
		MOV	C,A	
		LDA	FLAGW	
		ANI	0FH	
		JNZ	OP1	
		MOV	A,B	
		CPI	3FH	
		JC	OP2	
		MVI	B,3FH	
		MVI	D,0	
		MVI	H,3FH	
OP2:		MOV	A,C	
		CPI	0FH	
		JC	SLED1	
		MVI	C,0FH	
		MVI	E,0	
		MVI	L,0FH	
SLED1:		CALL	WSAVE	;РХУФПЕ ПЛОП
		CALL	CLS	
		JMP	DALHE	
OP1:		CPI	04H	
		JC	OP3	;РЕТЕИПД ЕУМЙ ОЕФ ТБНЛЙ
		ANI	03H	
		JNZ	OP3	
		MOV	A,B	
		CPI	3DH	
		JC	OP4	
		MVI	B,3DH	
		MVI	D,01H	
		MVI	H,3EH	
OP4:		MOV	A,C	
		CPI	0DH	
		JC	SLED2	
		MVI	C,0DH	
		MVI	E,01H	
		MVI	L,0EH	
SLED2:		DCR	D	
		DCR	E	
		INR	H	
		INR	L	
		CALL	WSAVE	
		CALL	CLS	
		CALL	RAMKA	
		DCR	H	
		DCR	L	
		INR	D	
		INR	E	
		JMP	DALHE	
OP3:		MOV	A,B	
		CPI	3CH	
		JC	OP5	
		MVI	B,3CH	
		MVI	D,01H	
		MVI	H,3DH	
OP5:		MOV	A,C	
		CPI	0CH	
		JC	SLED3	
		MVI	C,0CH	
		MVI	E,02H	
		MVI	L,0EH	
SLED3:		DCR	D	
		DCR	E	
		DCR	E	
		INR	H	
		INR	H	
		INR	L	
		CALL	WSAVE	
		INR	E	
		DCR	H	
		CALL	CLS	
		CALL	RAMKA	
		CALL	TEN	
		INR	E	
		INR	D	
		DCR	H	
		DCR	L	
DALHE:		SHLD	WIND2	
		XCHG		
		SHLD	WIND1	
		LXI	H,0	
		SHLD	CURSOR	
		XRA	A	
WSQ1:		POP	H	
		POP	D	
		POP	B	
		EI
		RET		
;+--------[ ФЕОШ ]------+
;* ЧИПД:  DE,HL -WINDOW *
;+----------------------+
TEN:		PUSH	H	
		PUSH	D	
		LDA	FLAGW	
		ANI	3	
		ADD	A	
		ADI	7	
		MOV	B,A	
		INR	H	
		DCR	L	
		DCR	E	
TE1:		MOV	A,B	
		INR	D	
		CALL	PUTCXY	
		MOV	A,D	
		CMP	H	
		JNZ	TE1	
		INR	B	
TE3:		MOV	A,B	
		INR	E	
		CALL	PUTCXY	
		MOV	A,E	
		CMP	L	
		JNZ	TE3	
		POP	D	
		POP	H	
		RET		
;+-------[ WINDOW SAVE ]--------+
;*  РТПГЕДХТБ УПИТБОЕОЙС ЬЛТБОБ *
;+------------------------------+
WSAVE:		PUSH	D	
		PUSH	H	
		LDA	FLAGW	
		ANI	10H	
		JZ	WSQUIT	
		PUSH	H	
		LXI	H,NUM	
		INR	M	
		POP	H	
		CALL	HLSUBDE	
;		PUSH	D	
;		PUSH	B	
;		LXI	H,12	
;		MOV	E,B	
;		MVI	D,0	
;WS1:		DAD	D	
;		DCR	A	
;		JNZ	WS1	
;;
;;	Іґ®ґ®±№№і ХВТБМ ВМПЛ РТПЧЕТЛЙ ОБ РЕТЕРПМОЕОЙЕ
;; ВХЖЕТБ УПИТБОЕОЙС ПЛПО Ф®Л ПО ЪБТБОЕЕ ОЕ РЕТЕРПМОСЕФУС®
;;
;		XCHG		
;		LXI	B,-MEND	
		LHLD	BUFSEK	
;		PUSH	H	
;		DAD	D	
;		DAD	B		; 1.3.1993
;		POP	H	

;		POP	B	
;		POP	D	
;		JC	WSQUIT	
		PUSH	B	
		PUSH	D	
		XRA	A	
		MOV	A,B	
		RAR		
WS4:		PUSH	PSW	
		CALL	WSH2	
		PUSH	D	
		MOV	A,D	
		ADD	B	
		DCR	A	
		MOV	D,A	
		CALL	WSH2	
		POP	D	
		INR	D	
		DCR	B	
		DCR	B	
		POP	PSW	
		DCR	A	
		JNZ	WS4	
		MOV	A,B	
		ORA	A	
		JZ	WS5	
		CALL	WSH2	
WS5:		POP	D	
		POP	B	
		LDA	BUF1	
		MOV	M,A	
		INX	H	
		PUSH	D	
		XCHG		
		LHLD	CURSOR	
		CALL	WSH1	
		LHLD	WIND2	
		CALL	WSH1	
		LHLD	WIND1	
		CALL	WSH1	
		MOV	H,B	
		MOV	L,C	
		CALL	WSH1	
		XCHG		
		POP	D	
		MOV	M,E	
		INX	H	
		MOV	M,D	
		INX	H	
		SHLD	BUFSEK	
WSQUIT:		POP	H	
		POP	D	
		RET		
;+--[ ЧУРПН. РПДРТПЗТ. WINDOW SAVE ]--+
WSH1:		MOV	A,L	
		STAX	D	
		INX	D	
		MOV	A,H	
		STAX	D	
		INX	D	
		RET		
WSH2:		PUSH	B	
		PUSH	D	
WH1:		CALL	GETCXY	
		MOV	M,A	
		INX	H	
		INR	E	
		DCR	C	
		JNZ	WH1	
		POP	D	
		POP	B	
		RET		

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

;+------------[ CLOSE WINDOW ]----------+
;*  ЧЩИПД:   ПФЛТЩЧ. РТЕД ЙДХЭЕЕ ПЛОП   *
;+--------------------------------------+
DEACTI:		DI
		PUSH	B	
		PUSH	D	
		PUSH	H	
		PUSH	PSW	
		LXI	H,NUM		;ХЛБЪБФЕМШ ОБ ЮЙУМП ПФЛТ.
		MOV	A,M		;ПЛПО
		ORA	A
		JZ	MAIN_EXIT	;$$$$$$
		DCR	M
		LHLD	BUFSEK	
		DCX	H	
		MOV	D,M	
		DCX	H	
		MOV	E,M	
		DCX	H	
		MOV	B,M	
		DCX	H	
		MOV	C,M	
		MOV	A,E	
		ADD	C	
		DCR	A	
		MOV	E,A	
		DCX	H	
		PUSH	D	
		XCHG		
		CALL	DEH1	
		SHLD	WIND1	
		CALL	DEH1	
		SHLD	WIND2	
		CALL	DEH1	
		SHLD	CURSOR	
		XCHG		
		DCX	H	
		POP	D	
		XRA	A	
		MOV	A,B	
		RAR		
		PUSH	PSW	
		ADD	D	
		MOV	D,A	
		POP	PSW	
		SHLD	BUF1	
		LXI	H,100H	
		JNC	DE2	
		INR	L	
DE2:		PUSH	H	
		LHLD	BUF1	
		JNC	DE1	
		CALL	DEH2	
		INR	D	
DE1:		CALL	DEH2	
		XTHL		
		MOV	A,D	
		SUB	L	
		SUB	H	
		MOV	D,A	
		INR	H	
		XTHL		
		CALL	DEH2	
		XTHL		
		MOV	A,D	
		ADD	L	
		ADD	H	
		MOV	D,A	
		INR	H	
		MOV	A,H	
		CMP	B	
		XTHL		
		JC	DE1	
		INX	H	
		SHLD	BUFSEK	
		POP	PSW 
		JMP	MAIN_EXIT	;$$$$$$$$$

;////////////////// CLOSE  HELP //////////////////
DEH2:		PUSH	B	
		PUSH	D	
DH21:		MOV	A,M	
		CALL	PUTCXY	
		DCX	H	
		DCR	E	
		DCR	C	
		JNZ	DH21	
		POP	D	
		POP	B	
		RET		
DEH1:		LDAX	D	
		MOV	H,A	
		DCX	D	
		LDAX	D	
		MOV	L,A	
		DCX	D	
		RET		

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

;+--------------[ DRAW BOARD ]----------+
;*	ЧИПД:	DE,HL -> ЛППТД.ПЛОБ	*
;*		A -> ЖМБЗ		*
;+--------------------------------------+
RAMKA:		LDA	FLAGW	
BORT:		PUSH	B	
		PUSH	D	
		PUSH	H	
		PUSH	PSW	
		ANI	4	
		LXI	B,DOUBLE
		JZ	BORT01	
		LXI	B,INTEG	
BORT01:		LDAX	B	
		CALL	PUTCXY	
		PUSH	D	
		MOV	E,L	
		INX	B	
		LDAX	B	
		CALL	PUTCXY	
		XCHG		
		INX	B	
		LDAX	B	
		CALL	PUTCXY	
		XTHL		
		MOV	E,L	
		INX	B	
		LDAX	B	
		CALL	PUTCXY	
		XTHL		
		DCR	L	
		PUSH	D	
		INX	B	
BORT02:		LDAX	B	
		INR	E	
		CALL	PUTCXY	
		MOV	A,E	
		CMP	L	
		JNZ	BORT02	
		POP	D	
		XCHG		
		PUSH	D	
		INR	L	
BORT03:	        LDAX	B	
		CALL	PUTCXY	
		DCR	E	
		MOV	A,E	
		CMP	L	
		JNC	BORT03	
		POP	D	
		POP	PSW	
		INX	B	
		INR	E	
		DCR	L	
CONT:		INR	D	
		DCR	H	
		LDAX	B	
		CALL	PUTCXY	
		PUSH	D	
		MOV	E,L	
		CALL	PUTCXY	
		POP	D	
		XCHG		
		CALL	PUTCXY	
		PUSH	D	
		MOV	E,L	
		CALL	PUTCXY	
		POP	D	
		XCHG		
		MOV	A,D	
		CMP	H	
		JC	CONT	
		JMP	MAIN_EXIT	;$$$$$$$$$$$

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

;-----------[ MAIN HELP ]----------+
;*  ЗМПВБМШОЩЕ ЧУРПНПЗБФ. РПДРТПЗТ.*
;+---------------------------------+
HLSUBDE:	MOV	A,H	
		SUB	D	
		INR	A	
		MOV	B,A	
		MOV	A,L	
		SUB	E	
		INR	A	
		MOV	C,A	
		RET		

HLDEWIND:	LHLD	WIND1	
		XCHG		
		LHLD	WIND2	
		RET		

;+------[ SCROLLING HELP ]-------+
;*		--//--		 *
;+-------------------------------+
SCHELP:		MOV	A,H	
		SUB	D	
		RRC		
		ANI	1FH	
		MOV	C,A	
		INR	C	
		MOV	A,D	
		XRA	H	
		ANI	1	
		JZ	SCS3	
		MOV	A,D	
		ANI	1	
		JZ	SCS3	
		INR	C	
SCS3:		MOV	A,L	
		SUB	E	
		RLC		
		RLC		
		RLC		
		RLC		
		MOV	B,A	
		RET		
SCH1:		PUSH	B	
		PUSH	D	
		PUSH	H	
SH10:		CALL	LDIR	
		DCR	H	
		DCR	D	
		DCR	C	
		JNZ	SH10	
		POP	H	
		POP	D	
		POP	B	
		MOV	A,H	
		ADI	20H	
		MOV	H,A	
		MOV	A,D	
		ADI	20H	
		MOV	D,A	
SH11:		CALL	LDIR	
		DCR	H	
		DCR	D	
		DCR	C	
		JNZ	SH11	
		RET		
SCH2:		PUSH	B	
		PUSH	D	
		PUSH	H	
SH20:		CALL	LIIR	
		INR	H	
		INR	D	
		DCR	C	
		JNZ	SH20	
		POP	H	
		POP	D	
		POP	B	
		MOV	A,H	
		ADI	20H	
		MOV	H,A	
		MOV	A,D	
		ADI	20H	
		MOV	D,A	
SH21:		CALL	LIIR	
		INR	H	
		INR	D	
		DCR	C	
		JNZ	SH21	
		RET		

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

;+----------[ CURSOR ABSOLUTE ]---------+
;*	ЧИПД:	DE -> ПФОПУЙФ.ЛППТД.	*
;*	ЧЩИПД:	DE -> БВУПМ`ФОЩЕ ЛППТД.	*
;+--------------------------------------+

ABSJDE:		PUSH	PSW	
		PUSH	H	
		LHLD	WIND1	
		MOV	A,D	
		ADD	H	
		MOV	D,A	
		MOV	A,E	
		ADD	L	
		MOV	E,A	
		POP	H	
		POP	PSW	
		RET		
;+-----[ РТПХЕДХТБ ПФЮЙУФЛЙ ПЛОБ ]------+
;*	ЧИПД:	DE,HL -> WINDOW COORD	*
;+--------------------------------------+
CLS:		PUSH	B	
		PUSH	D	
		PUSH	H	
		PUSH	PSW	
		JMP	HOMEDH	
HOME:		PUSH	B	
		PUSH	D	
		PUSH	H	
		PUSH	PSW	
		CALL	HLDEWIND	
HOMEDH:		DI
		CALL	HLSUBDE	
		PUSH	B	
		PUSH	D	
		PUSH	H	
		CALL	ADDREM	
HOM7:		PUSH	H	
		PUSH	B	
HOM6:		MVI	M,' '	
		INX	H	
		DCR	B	
		JNZ	HOM6	
		POP	B	
		POP	H	
		LXI	D,40H	
		DAD	D	
		DCR	C	
		JNZ	HOM7	
		POP	H	
		POP	D	
		POP	B	
		MOV	A,C	
		ANI	0FH	
		RLC		
		RLC		
		RLC		
		RLC		
		MOV	B,A	
		MOV	A,D	
		RRC		
		JNC	HOM1	
		CALL	STOLB	
		INR	D	
HOM1:		MOV	A,H	
		RRC		
		JC	HOM2	
		XCHG		
		PUSH	D	
		MOV	E,L	
		CALL	STOLB	
		POP	D	
		XCHG		
		DCR	H	
HOM2:		MOV	A,H	
		SUB	D	
		RAR	
		INR	A	
		MOV	C,A	
		CALL	ADDRSC	
		XRA	A	
		PUSH	B	
		MOV	D,B	
		MOV	E,L	
HOM3:		MOV	M,A	
		INR	L	
		DCR	B	
		JNZ	HOM3	
		MOV	B,D	
		MOV	L,E	
		INR	H	
		DCR	C	
		JNZ	HOM3	
		DCR	H	
		POP	B	
		MOV	A,H	
		ADI	20H	
		MOV	H,A	
		XRA	A	
HOM5:		MOV	M,A	
		INR	L	
		DCR	B	
		JNZ	HOM5	
		MOV	B,D	
		MOV	L,E	
		DCR	H	
		DCR	C	
		JNZ	HOM5	
		JMP	MAIN_EXIT	;$$$$$$$$$$
;+--------[ STOLB ]---------+
STOLB:		PUSH	D	
		PUSH	B	
		MVI	A,' '	
ST1:		CALL	PUTCXY	
		INR	E	
		DCR	C	
		JNZ	ST1	
		POP	B	
		POP	D	
		RET		

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

;+--------[ SCROLL WINDOW ]---------+
;*    РТПГЕДХТЩ УЛТПМЙОЗБ ПЛПО 	    *
;+----------------------------------+
;////////////////////////////  ЧРТБЧП //////////////////////////
SCRP:	;;*;;	PUSH	B	
	;;*;;	PUSH	D	
	;;*;;	PUSH	H	
	;;*;;	PUSH	PSW	
	;;*;;	JMP	SC3P	
SCROL3:		PUSH	B	
		PUSH	D	
		PUSH	H	
		PUSH	PSW	
		CALL	HLDEWIND	
SC3P:		DI
		CALL	HLSUBDE	
		CALL	SCREM3	
		MOV	A,C	
		MOV	C,B	
		PUSH	D	
		PUSH	H	
		ANI	0FH	
		RLC		
		RLC		
		RLC		
		RLC		
		MOV	B,A	
		MOV	A,C	
		RAR		
		DCR	A	
		MOV	C,A	
		XCHG		
		INR	E	
		CALL	ADDRSC	
		DCX	H	
		MOV	D,H	
		MOV	E,L	
		DCR	H	
		CALL	SCH1	
		POP	H	
		POP	D	
		MOV	H,D	
		INR	H	
		CALL	CLS	
		JMP	MAIN_EXIT	;$$$$$$$$

;//////////////////////////// ЧМЕЧП //////////////////////////
SCRL:	;;*;;	PUSH	B	
	;;*;;	PUSH	D	
	;;*;;	PUSH	H	
	;;*;;	PUSH	PSW	
	;;*;;	JMP	SC4L	
SCROL4:		PUSH	B	
		PUSH	D	
		PUSH	H	
		PUSH	PSW	
		CALL	HLDEWIND	
SC4L:		DI
		CALL	HLSUBDE	
		CALL	SCREM4	
		PUSH	D	
		PUSH	H	
		MOV	A,C	
		MOV	C,B	
		ANI	0FH	
		RLC		
		RLC		
		RLC		
		RLC		
		MOV	B,A	
		MOV	A,C	
		RAR		
		DCR	A	
		MOV	C,A	
		CALL	ADDRSC	
		MOV	D,H	
		MOV	E,L	
		INR	H	
		CALL	SCH2	
		POP	H	
		POP	D	
		MOV	D,H	
		DCR	D	
		CALL	CLS	
		JMP	MAIN_EXIT	;$$$$$$
;//////// SCREM4 ////////
SCREM4:		PUSH	B	
		PUSH	D	
		PUSH	H	
		DCR	B	
		DCR	B	
		CALL	ADDREM	
SEM41:		MOV	D,H	
		MOV	E,L	
		INX	H	
		INX	H	
		CALL	LIIR	
		LXI	H,40H	
		DAD	D	
		DCR	C	
		JNZ	SEM41	
		POP	H	
		POP	D	
		POP	B	
		RET		
;////// SCROLEM3 ////////
SCREM3:		PUSH	H	
		PUSH	D	
		PUSH	B	
		XCHG		
		DCR	B	
		DCR	B	
		CALL	ADDREM	
SCE31:		MOV	D,H	
		MOV	E,L	
		DCX	D	
		DCX	D	
		XCHG		
		CALL	LDIR	
		XCHG		
		LXI	D,0FFC0H
		DAD	D	
		DCR	C	
		JNZ	SCE31	
		POP	B	
		POP	D	
		POP	H	
		RET		

;////////////////////////// ЧОЙЪ ////////////////////////////
SCRN:		PUSH	B	
		PUSH	D	
		PUSH	H	
		PUSH	PSW	
		JMP	SCN0	
SCROL2:		PUSH	B	
		PUSH	D	
		PUSH	H	
		PUSH	PSW	
		CALL	HLDEWIND	
SCN0:		DI
		MOV	A,E	
		CMP	L	
		JZ	QS2	
		PUSH	H	
		PUSH	D	
		CALL	HLSUBDE	
		CALL	ADDREM
SCE21:		LXI	D,40H	
		XCHG		
		DAD	D	
		CALL	LIIR	
		DCR	C	
		JNZ	SCE21	
		POP	D	
		POP	H	
		PUSH	H	
		PUSH	D	
		CALL	SCHELP	
		CALL	ADDRSC
		MOV	D,H	
		MOV	A,L	
		ADI	16	
		MOV	E,A	
		XCHG		
		CALL	SCH2	
		POP	D	
		POP	H	
		MOV	E,L	
QS2:		CALL	CLS	
		JMP	MAIN_EXIT	;$$$$$$

;//////////////////////////// ЧЧЕТИ ////////////////////////////
SCRV:		PUSH	B	
		PUSH	D	
		PUSH	H	
		PUSH	PSW	
		JMP	SCV0	
SCROL1:	        PUSH	B	
		PUSH	D	
		PUSH	H	
		PUSH	PSW	
		CALL	HLDEWIND	
SCV0:		DI
		MOV	A,L	
		CMP	E	
		JZ	SCQ1	
		PUSH	H	
		PUSH	D	
		CALL	HLSUBDE	
		XCHG		
	        CALL	ADDREM
SCE1:		LXI	D,0FFC0H
		XCHG		
		DAD	D	
		CALL	LDIR	
		DCR	C	
		JNZ	SCE1	
		POP	D	
		POP	H	
		PUSH	D	
		PUSH	H	
		CALL	SCHELP	
		XCHG		
		CALL	ADDRSC	
		MOV	D,H	
		MOV	A,L	
		ADI	16	
		MOV	E,A	
		DCX	H	
		DCX	D	
		CALL	SCH1	
		POP	H	
		POP	D	
		MOV	L,E	
SCQ1:		CALL	CLS	
		JMP	MAIN_EXIT	;$$$$$$

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

;ЮЮЮЮЮЮЮЮ MOVE PROCEDURE ЮЮЮЮЮЮЮ
LIIR:		PUSH	B
		PUSH	D	
		PUSH	H	
LI1:		MOV	A,M	
		STAX	D	
		INX	D	
		INX	H	
		DCR	B	
		JNZ	LI1	
		POP	H	
		POP	D	
		POP	B	
		RET		

LDIR:	        PUSH	B	
		PUSH	D	
		PUSH	H	
LD1:		MOV	A,M	
		STAX	D	
		DCX	H	
		DCX	D	
		DCR	B	
		JNZ	LD1	
		POP	H	
		POP	D	
		POP	B	
		RET		
;;;;;;;;;;;;;;;
;;
;; рТПГЕДХТБ ЖПТНЙТПЧБОЙС ДПРПМОЙФЕМШОПЗП ЛПДБ
;; Ч ТЕЗЙУФТПЧПК РБТЕ DE
;;
NEG_DE:	
		MOV	A,D		;
		CMA			; ТЕЗЙУФТПЧХА РБТХ: DE
		MOV	D,A		; РЕТЕЧПДЙН Ч ДПРПМОЙФЕМШОЩК
		MOV	A,E		; ЛПД ДМС РТПЙЪЧЕЕОЙС ПРЕТБГЙЙ
		CMA			; ЧЩЮЙФБОЙС
		MOV	E,A		;
		INX	D		;
		RET			;
;;;;;;;;;;;;;;;


;+-----------[ WINDOW GETC ]------------+
;*	ЧИПД:	DE -> ЛППТД.		*
;*	ЧЩИПД:	A  -> УЙНЧПМ		*
;+--------------------------------------+
GETC:		PUSH	H	
		CALL	ABSJDE	
		JMP	GE1	
GETCXY:		PUSH	H	
GE1:		CALL	ADDREM
		MOV	A,M	
		POP	H	
		RET		

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

;+---------[ WINDOW PUTCHAR ]-----------+
;*	ЧИПД:	DE -> ЛППТДЙОБФЩ	*
;*		A  -> УЙНЧПМ		*
;+--------------------------------------+
WPUTC1:		PUSH	D	
		CALL	ABSJDE	
		CALL	PUTCXY	
		POP	D	
		RET		
PUTCXY:   	PUSH	H	
		PUSH	D	
		PUSH	B	
		PUSH	PSW	
		CALL	ADDREM
		MOV	M,A	
		MOV	B,A	
		CALL	ADDRSC	
		XCHG		
		MOV	A,H	
		RRC		
		MOV	A,B	
		MVI	B,16	
		PUSH	PSW
		PUSH	D		;ПРТЕДЕМЕОЙС ОБЮБМБ ЪОБЛПЗЕОЕТБФПТБ
		MVI	H,0
		MOV	L,A	
		DAD	H	
		DAD	H	
		DAD	H	
		DAD	H	
		LXI	D,MZG		;ХЛБЪБФЕМШ ОБ ЪОБЛПЗЕОЕТБФПТ
		DAD	D
		POP	D	
		POP	PSW
		XCHG		
		JC	SHET	
		MVI	C,0FH	
SCA:		MOV	A,M	
		ANA	C	
		MOV	M,A	
		LDAX	D	
		ANI	0F0H	
		ORA	M	
		MOV	M,A	
		INR	L	
		INX	D	
		DCR	B	
		JNZ	SCA	
		MVI	B,16	
		MOV	A,H	
		ADI	20H	
		MOV	H,A	
SCC:		DCX	D	
		DCR	L	
		MOV	A,M	
		ANA	C	
		MOV	M,A	
		LDAX	D	
		ANA	C	
		RLC		
		RLC		
		RLC		
		RLC		
		ORA	M	
		MOV	M,A	
		DCR	B	
		JNZ	SCC	
		JMP	NEXT	
SHET:		MVI	C,0F0H	
SCA0:		MOV	A,M	
		ANA	C	
		MOV	M,A	
		LDAX	D	
		ANA	C	
		RRC		
		RRC		
		RRC		
		RRC		
		ORA	M	
		MOV	M,A	
		INR	L	
		INX	D	
		DCR	B	
		JNZ	SCA0	
		MVI	B,16	
		MOV	A,H	
		ADI	20H	
		MOV	H,A	
SCC0:		DCX	D	
		DCR	L	
		MOV	A,M	
		ANA	C	
		MOV	M,A	
		LDAX	D	
		ANI	0FH	
		ORA	M	
		MOV	M,A	
		DCR	B	
		JNZ	SCC0	
NEXT:		POP	PSW	
		POP	B	
		POP	D	
		POP	H	
		RET		
;+--------[ ЧУРПНПЗБФЕМШОЩЕ РТПГЕДХТЩ ]---------+
;*       ПРТЕДЕМЕОЙЕ ЖЙЪЙЮЕУЛЙИ БДТЕУПЧ		*
;+----------------------------------------------+
;////////////////////////// ADDDR EMUL //////////////////////
ADDREM:		PUSH	B
		LXI	B,MEMU		;ХЛБЪБФЕМШ ОБ ПВМБУФШ ЬНХМСГЙЙ
		MVI	H,0	
		MOV	L,E	
		DAD	H	
		DAD	H	
		DAD	H	
		DAD	H	
		DAD	H	
		DAD	H	
		DAD	B	
		MVI	B,0	
		MOV	C,D	
		DAD	B	
		POP	B	
		RET		
;//////////////////////////// ADDDR SCREEN ////////////////////////
ADDRSC:		PUSH	PSW	
		MOV	A,E	
		ANI	0FH	
		RLC		
		RLC		
		RLC		
		RLC		
		MOV	L,A	
		MOV	A,D	
		RAR		
		ORI	0A0H	
		MOV	H,A	
		POP	PSW	
		RET		

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;
;;   дБООБС РПУМЕДПЧБФЕМШОПУФШ ЗЕОЕТЙТХЕФ УМХЮБК ОЩК БДТЕУ
;; ДМС ОБЛБЪБОЙС ЧЪМПНЭЙЛБ
;;
ER_K_SUMMA:
		LHLD	KONTR_PPA+1	;
		MVI	C,16		;
ER_K_00:				;
		MOV	A,H		;
		DAD	H		;
		ANI	60H		;
		JPE	ER_K_10		;
		INX	H		;
ER_K_10:				;
		DCR	C		;
		JNZ	ER_K_00		;
		MOV	A,H		;
		ANI	1FH		;
		MOV	H,A		;
		SHLD	KONTR_PPA+1	;
		RET			;

;		INCLUDE	KEYDRIV.ASM
;;
;; рБЛЕФ ОБРЙУБО ОБ БУУЕНВМЕТЕ (Intel 8080) Й УМХЦЙФ ДМС РТПЗТБНОПК РПДДЕТ-
;; ЦЛЙ НПДХМС ЛМБЧЙБФХТЩ ,УПДЕТЦЙФ РЕТЕТБВПФБОЩК ДТБКЧЕТ ЛМБЧЙБФХТЩ
;; ПФ Basic Korvet v 2.0
;; РПУМЕДОСС НПДЙЖЙЛБГЙС: 13.11.1992 (РСФОЙГБ - 13 )
;; лБТБЗБОДБ  Ф. 52-81-95
;;

;;////////// ТБВПЮЙЕ СЮЕКЛЙ KEYBOARD.DRIVE ////////
FLAGC:		DB	0	;ЕУМЙ <>0 ФП ГЧЕФПЗЕОЕТБФПТ ОЕ ФТПЗБЕФУС
RAB0:		DB	0	
COLOR:		DW	0000H	
RUSLAT:		DB	0	
SMAL:		DB	0	
KEYKOD:		DB	255	;УПД.ЛПД ЛМБЧЙЫЙ ОБЦ Ч ДБООЩК НПНЕОФ
KOOL:		DB	0	
DREB:		DB	0	
SEEK:		DB	1	
		DB	"PPA Systems"	;ВХЖЕТ ЛМБЧЙБФХТЩ
		DB	CR,LF,0		; 14 - ЬМЕНЕОФПЧ
;+-------[ INKEYJSUMBOL ]-------+
;* ЧЩИ:	A -> ЛПД ЛМБЧЙЫЙ	*
;+------------------------------+
INKEY:		PUSH	B	
		PUSH	D	
		PUSH	H	
		LXI	H,SEEK	
		MVI	C,255	
		DI
		DCR	M	
		JZ	INQ	
		MOV	B,M	
		INX	H	
		MOV	C,M	
		EI
		MOV	D,H	
		MOV	E,L	
IN0:		INX	H	
		MOV	A,M
		STAX	D
		INX	D
		DCR	B
		JNZ	IN0
		DCR	M	
INQ:		EI
		INR	M	
		MOV	A,C	
		POP	H	
		POP	D	
		POP	B	
		RET		
;;
;; нПДЙЖЙЛБГЙС ДТБКЧЕТБ: 21.10.1993 ++++ юЕФЧЕТЗ ++++
;; ================ 21:55 "Good luck "================
;; РТПЙЪЧЕДЕОП ЛПНЕОФЙТПЧБОЙЕ ЙУИПДОПЗП ФЕЛУФБ НПДХМС
;; ДТБКЧЕТБ ЛМБЧЙБФХТЩ У ГЕМША ЙУРПМШЪПЧБОЙС ЕЗП Ч РП-
;; УМЕДХАЭЙИ ТБЪТБВПФЛБИ Б ФБЛЦЕ ЙЪНЕОЕОЩ ОЕЛПФПТЩЕ
;; ХРТБЧМСАЭЙЕ ЛМБЧЙЫЙ:
;;  "F5" - фТЙЗЕТОБС ЛМБЧЙЫБ РЕТЕЛМАЮБЕФ РТЙП-
;;         ТЕФЕФОПЕ УПУФПСОЙЕ ДБФЮЙЛБ РТПРЙУОЩЕ
;;         - УФТПЮОЩЕ ВХЛЧЩ ФЕЛХЭЕЗП БМЖБЧЙФБ
;;  "уу" - лМБЧЙЫБ РТПЙЪЧПДЙФ ЧТЕНЕООПЕ РЕТЕЛМА-
;;         ЮЕОЙЕ НБМЕОШЛЙИ-ВПМШЫЙИ ВХЛЧ

;+---------[ KEYJDRIVER ]-------+
KEY_INT:	PUSH	B	; рТПЙЪЧПЦХ РПМОПЕ УПИТБОЕОЙЕ
		PUSH	D	; УПУФПСОЙС РТПГЕУУПТБ Ч НПНЕОФ
		PUSH	H	; ЧПЪОЙЛОПЧЕОЙС РТЕТЩЧБОЙС
		PUSH	PSW	;
		LXI	H,FLAGC	; юЙФБЕН ЖМБЗ РПДНЕОЩ РБМЙФТЩ
		MOV	A,M	;
		ORA	A	;
		JNZ	KEY_DO0	; ЕУМЙ =0 ФП РЕТЕРТПЗТБНЙТПЧБФШ ФБВМЙГХ
		DCR	M	;
		LHLD	COLOR	; юЙФБА ДЧБ ВБКФБ ЖЙЪЙЮЕУЛЙИ ГЧЕФПЧ
		LXI	D,100FH	; ЖПОБ Й РЕТЕДОЕЗП РМБОБ
KEY_00:		MOV	A,E	; H - ГЧЕФ ретдоезп рмбоб
		OUT	02	; L - ГЧЕФ жпоб
		ANI	06	; Й РЕТЕИПДЙН Л ТБУРТЕДЕМЕОЙА
		MOV	A,L	; ЕФЙИ ВБКФПЧ Ч УППФЧЕФУФЧЙЙ
		JZ	KEY_01	; У НБФЕНБФЕНБФЙЮЕУЛЙНЙ ГЧЕФБНЙ
		MOV	A,H	;
KEY_01:		OUT	0FH	; РТПЙЪЧПДЙН НОПЗПЛТБФОХА ЪБРЙУШ
		DCR	E	; РПМХЮЕОПЗП ЛПДБ Ч УЧСЪЙ У НБМПК
		OUT	0FH	; УЛПТПУФША ТБВПФЩ пъх -л155тх2-
		OUT	0FH	;
		OUT	0FH	;
		DCR	D	;
		OUT	0FH	;
		JNZ	KEY_00	;
KEY_DO0:	MVI	A,8AH	; оБУФТБЙЧБЕН УЙУФЕНОЩК РПТФ ОБ
		OUT	00	; УЛБОЙТПЧБОЙЕ ЛМБЧЙБФХТЩ
		LXI	H,RAB0	;
		IN	01	; РТПЮЙФБФШ УПУФПСОЙЕ РПТФБ "C"
		ANI	80H	; бОБМЙЪЙТХЕН ВЙФ ЛМБЧЙЫЙ "тху/мбф"
		JNZ	M5	; РЕТЕИПД ЕУМЙ ПОБ ОЕ ОБЦБФБ !!!
		MOV	A,M	; РТПЧЕТСЕН УПДЕТЦЙНПЕ ЧУРПНПЗБФЕ-
		ORA	A	; МШОПК СЮЕКЛЙ ЕУМЙ ПОБ ТБЧОБ ОХМА
		JZ	DONE01	; ФП ЛМБЧЙЫБ тху/мбф еЭЕ ОБЦБФБ
		DCR	M	; Й РПЧФПТОХА РЕТЕХУФБОПЧЛХ РТПЙ-
		LDA	RUSLAT	; ЪЧПДЙФШ ОЕ ОБДП
		XRI	08H	; РТПЙЪЧПДЙН ЙОЧЕТУЙА Ч ВЙФЕ УЧЕФП-
		STA	RUSLAT	; ДЙПДБ
		JMP	DONE01	;
M5:		MVI	M,1	; ЖЙЛУЙТХЕН ОЕ ОБЦБФПЕ УПУФПСОЙЕ
DONE01:		XRA	A	; ЧЩДБЕН ОБ НБФТЙГЕ ЪБРТПУ П ОБЦ-
		OUT	03	; БФЩИ ЛМБЧЙЫБИ
		IN	02	; 
		INR	A	; РТПЙЪЧПДЙН РТПЧЕТЛХ ОБ ОБЦБФЙЕ
		JZ	EXIT1	; ХИПДЙН ЕУМЙ ОЕ ОБЦБФБ ОЙ ПДОБ
		LXI	B,0FE08H; ЛМБЧЙЫБ
		LXI	D,0800H	; РЕТЕИПДЙН Л РПДУЮЕФХ НЕУФБ ОБЦБФЙС
		MOV	A,B	; РП УТЕДУФЧПН ЗПОЕТБЮЙЙ ОБ ЧИПДОЩИ
KEY01:		OUT	03	; МЙОЙСИ ЛПДБ : "вЕЗХЭЙК ОПМШ"
		IN	02	; Й БОБМЙЪПН ЛПДБ ОБ ЧЩИПДОЩИ
		INR	A	; МЙОЙСИ НБФТЙГЙ ЛМБЧЙБФХТЩ
		JNZ	KEY010	;
		MOV	A,E	;
		ADD	D	;
		MOV	E,A	;
		MOV	A,B	;
		RLC		;
		MOV	B,A	;
		DCR	C	;
		JNZ	KEY01	;
EXIT1:		CALL	HLP	; РТПЙЪЧЕДЕН ХУФБОПЧЛХ РБТБНЕФТПЧ
		MVI	A,0FFH	; ЬЛТБОБ Й ЪБЧЕТЫЙН РТЕТЩЧБОЙЕ
		STA	KEYKOD	; У ЛПДПН ОЕ ОБЦБФПК ЛМБЧЙЫЙ
		JMP	MAIN_EXIT;

KEY010:		DCR	A	;
KEY00:		RAR		;
		INR	E	;
		JC	KEY00	;
		DCR	E	;
		CALL	HLP	;
		LXI	H,NUMBER;
		MOV	M,E	; УПИТБОСЕН ОПНЕТ ЛМБЧЙЫЙ
		INX	H	; DONEM-LABEL
		PUSH	H	; ЧЕЛФПТ РЕТЕИПДБ УПИТБОСЕН Ч УФЕЛЕ
		IN	01H	; ЮЙФБЕН УФБФХУ ХРТБЧМСАЭЙИ ЛМБЧЙЫ
		LXI	B,1020H	; BC - ТБВПЮЙЕ ЛПОУФБОФЩ
		ANA	C	; ЧЩДЕМСЕН ЛМБЧЙЫХ "уу"
		MOV	D,A	; УПИТБОСЕН Ч ТЕЗЙУФТЕ MPU
		MOV	A,E	; РТПЮЙФБЕН ОПНЕТ ЛМБЧЙЫЙ
		CMP	B	; УТБЧОЙН У ЛПДПН == 10H ===
		JNC	DONE03	; РЕТЕИПД ЕУМЙ ОПНЕТ ВПМШЫЕ 10H
;; рТПЙЪЧПДЙН ПВТБВПФЛХ ОБЦБФЙС ЛМБЧЙЫ УМХЦЕВОПК ЛМБЧЙБФХТЩ
;; ЙНЕАЭЙЕ УМЕДХАЭЙЕ ОПНЕТБ:
;;
		CPI	03H	; ОПНЕТ ЛМБЧЙЫЙ НЕОЙЫЕ 10H
		RNZ		; Ф.Е. ОБЦБФБ ЛМБЧЙЫБ УМХЦЕВОПК
		MOV	A,D	; ЛМБЧЙБФХТЩ ( РЕТЧЩЕ ДЧЕ МЙОЙЙ ОБ
		ORA	A	; УИЕНЕ ОЕПВИПДЙНП РПНЕОСФШ НЕУФБНЙ)
		MOV	A,E	; ЪДЕУШ ОЕПВИПДЙНП РТПЧЕТЙФШ ФПМШЛП
		RNZ		; ЛМБЧЙЫХ "ъв" Ч ЪБЧЙУЙНПУФЙ ПФ
		MVI	A,5FH	; ОБЦБФЙС ЛМБЧЙЫЙ "уу"
		RET		;

DONE03:		CMP	C	; УТБЧОЙН У ЛПДПН == 20H ==
		JNC	DONE05	; РЕТЕИПД ЕУМЙ ВПМЙЫЕ ЙМЙ ТБЧОП
;; пВТБВПФБЕН ЧБТЙБОФ ОБЦБФЙС ЛМБЧЙЫ У ОПНЕТБНЙ
;; ПФ 10H-20H - ГЙЖТЩ Й УРЕГ ЪОБЛЙ
		MOV	A,D	; ЧПЪШНЕН УФБФХУ ЛМБЧЙЫЩ "уу"
		ORA	A	; ЕУМЙ ФБН 0 ФП ЪОБЮЙФ ОБЦБФБ
		MOV	A,E	; ЙОБЮЕ ОЕ ОБЦБФБ
		JZ	KEY02	; 
		ADD	B	;
KEY02:		ADD	B	;
		MOV	L,A	;
		MOV	A,E	;
		CPI	1CH	;
		MOV	A,L	;
		RC		;
		XRA	B	;
		RET		;
;;
;; пВТБВПФБЕН ЧБТЙБОФ ОБЦБФЙС ВХЛЧЕОЩИ ЛМБЧЙЫ
;;
DONE05:		CPI	3FH	; ЕУМЙ ЬФП РТПВЕМ ФП ЧПЪЧТ.
		MOV	A,C	; ЛПД 20H
		RZ		;
		MOV	A,D	;
		ORA	A	;
		LDA	SMAL	; ЮЙФБЕН УФБФХУ СЮЕКЛЙ ТЕЗЙУФТПЧ
		JNZ	D_5_OBH	;
		CMA		;
D_5_OBH:	ORA	A	; РТПЧЕТСЕН ОБ ТБЧЕОУФЧП 0
		MOV	A,E	; ЕУМЙ = 0 ФП РТПРЙУОЩЕ ВХЛЧЩ
		JZ	KEY04	; ЙОБЮЕ УФТПЮОЩЕ ВХЛЧЩ
		ADD	C	;
KEY04:		ADD	C	;
		MOV	E,A	;
		LDA	RUSLAT	;
		ORA	A	;
		MOV	A,E	;
		RZ		;
		ADI	80H	; ЛПТЕЛГЙС ОБ ТХУЛЙЕ ВХЛЧЩ
		XRA	C	;
		RET		;
;###				;
NUMBER:		DB	'P'	;ОПНЕТ ЛМБЧЙЫЙ
;###				;
DONEM:		LXI	H,MAIN_EXIT;	
		PUSH	H	;
		MOV	C,A	;
		LDA	KEYKOD	;
		CMP	C	;
		LXI	H,KOOL	;
		JNZ	M22	;
		MOV	A,M	;
AL1:		CPI	30	;
		JZ	M24	;
M23:		INR	M	;
		RET		;
M22:		MVI	M,0	;
		MVI	A,30	;ЧТЕН.ПЦЙДБОЙС
		STA	AL1+1	;
		INX	H	;DREB
		MOV	A,M	;
		DCR	A	;
		JNZ	M23	;
		DCR	M	;
		DCX	H	;
		JMP	DONE10	;
M24:		MVI	M,0	;
		MVI	A,2	;CONST AUTO
		STA	AL1+1	;
DONE10:		MOV	A,C	;
		DCX	H	;
		MOV	M,A	;
		DCX	H	;
		DCR	B	;
		CMP	B	;
		JNZ	M31	;
		MOV	A,M	;SMAL
		CMA		;
		MOV	M,A	;
M31:		LXI	H,SEEK	;
		MOV	A,M	;
		CMP	B	;
		CALL	BEEP	;
		RZ		;
		INR	M	;
		MOV	C,A	;
		MVI	B,0	;
		DAD	B	;
		LDA	KEYKOD	;
		MOV	M,A	;
		RET		;
MAIN_EXIT:	POP	PSW	;
		POP	H	;
		POP	D	;
		POP	B	;
		EI		;
		RET		;

HLP:		MVI	A,88H	;
		OUT	00H	;
		LDA	RUSLAT	;
		OUT	01	;
		MVI	A,0FFH	;УЛТПМЙОЗ
		OUT	03	;
		MVI	A,10H	;ТЕЦЙН Й ВПТДАТ
		OUT	02	;
		RET		;

BEEP:		PUSH	PSW	;
		MVI	B,8	;
		MVI	E,30H	;
		LDA	RUSLAT	;
		MOV	C,A	;
BIP0:		INR	A	;
		ANI	1	;
		ORA	C	;
		OUT	1	;
		PUSH	D	;
BIP:		DCR	E	;
		JNZ	BIP	;
		POP	D	;
		DCR	B	;
		JNZ	BIP0	;
		POP	PSW	;
		RET		;

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

;		INCLUDE	EDMAIN.ASM
;; 
;; нПДХМШ УПДЕТЦЙФ РБЛЕФ РПДРТПЗТБНН ОБРЙУБООЩИ УРЕГЙБМШОП ДМС
;; "PPA Editor" ,ПОЙ БЛФЙЧОП КУРПМШЪХЩФ РПДРТПЗТБННЩ ПЛПООПЗП 
;; ДТБКЧЕТБ 
;; РПУМЕДОСС НПДЙЖЙЛБГЙС: 12.11.1992 З. лБТБЗБОДБ
;;
;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;
;;ыыыыыыы      470075     З.лБТБЗБОДБ           ыыыыыыы;;
;;ыыыыыыы   ХМ. 40 МЕФ лБЪБИУФБОБ Д.39/3 ЛЧ.1   ыыыыыыы;;
;;ыыыыыыы            рЙНЕОПЧ р.б                ыыыыыыы;;
;;ыыыыыыы               Ф.52-81-95              ыыыыыыы;;
;;
;;ыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыы
;; рТПГЕДХТБ MENU: ПВЕУРЕЮЙЧБЕФ УПЪДБОЙЕ Ч ФЕЛХЭЕН ПЛОЕ НЕОА РП
;; УТЕДУФЧПН РЕТЕНЕЭЕОЙС ЙОЧЕТУОПК РПМПУЛЙ РП ЧУЕНХ ПЛОХ Й ЕУМЙ
;; РТПЙУИПДЙФ РЕТЕИПД ЪБ РТЕДЕМЩ ПЛОБ ФП БЧФПНБФЙЮЕУЛЙ ХЛБЪБФЕМШ
;; РЕТЕИПДЙФ ОБ РТПФЙЧПРПМПЦОХА УФПТПОХ ПЛОБ. рТПГЕДХТБ ОЕ ЙНЕЕФ 
;; ЪБЭЙФЩ ПФ УЙФХБГЙЙ: Ч ПЛОЕ ОЕ РПНЕЭБЕФУС ВПМЕЕ ДЧХИ БМШФЕТОБ- 
;; ФЙЧОЩИ УФТПЛ ( НЕОА ЧЕТФЙЛБМШОПЕ ) Й ДТХЗЙИ ОЕ ЛПТЕЛФОЩИ ЧЩЪП-
;; ЧПЧ.
;; чИПДОЩЕ ДБООЩЕ: ОЕФ
;; чЩИПДОЩЕ ДБООЩЕ: A - ЧПЪЧТБЭБЕФУС РПЪЙГЙС Ч ЛПФПТПК РТПЙЪПЫМП
;;			 ОБЦБФЙЕ ЛМБЧЙЫЙ "чл" ЕУМЙ ВЩМБ ОБЦБФБ ЛМБ-
;;			 ЧЙЫБ "F4" ФП Ч б ЧПЪЧТБЭБЕФУС "0FFH"

MENU:		CALL	HLDEWIND	; ЮЙФБЕН ЛППТДЙОБФЩ ПЛОБ
		CALL	HLSUBDE		; ЧЩЮЙУМСЕН ТБЪНЕТЩ ПЛОБ
		MOV	A,B		; ТБУРТЕДЕМСЕН ТЕЗЙУФТЩ
		DCR	B		;
		DCR	B		;
		MOV	D,B		;
		MOV	L,C		;
		MOV	E,L		;
		MVI	H,0		;
		DCR	L		;
		SHLD	CURSOR		;
M_KEY_LOOP:	CALL	LINE_INV	; ЙОЧЕТФЙТЕХН УФТПЛХ
		CALL	KEYRESET	; УВТБУЩЧБЕН ДТБКЧЕТ ЛМБЧЙБФХТЩ
		CALL	KEYDELAU	; ПЦЙДБЕН ОБЦБФЙС
;;;;		CALL	PLAY		; РЙЛБЕН ( лт580чй53 )
		CALL	LINE_INV	; ЗБУЙН ХЛБЪБФЕМШ
		LXI	H,M_KEY_LOOP	;
		PUSH	H		;
		CPI	05H		; ЛМБЧЙЫБ ЧЧЕТИ
		JZ	M_UP		;
		CPI	07H		; ЛМБЧЙЫБ ЧОЙЪ
		JZ	M_DON		;
		CPI	02H		; "BK"
		JZ	M_EXIT		;
		CPI	0EH		; "F4"
		JZ	M_2EXIT		;
		RET			;
;; РТПГЕДХТБ ПВТБВПФЛЙ ОБЦБФЙС ЛМБЧЙЫЙ ЧЧЕТИ		
M_UP:		LXI	H,CURSOR	;
		INR	M		;
		MOV	A,M		;
		CMP	E		;
		RC			;
		MVI M,0			;
		RET			;
;; РТПГЕДХТБ ПВТБВПФЛЙ ОБЦБФЙС ЛМБЧЙЫЙ ЧОЙЪ
M_DON:		LXI	H,CURSOR	;
		DCR	M		;
		MOV	A,M		;
		INR	A		;
		RNZ			;
		MOV	M,E		; ЕУМЙ ПУХЭЕУФЧМСЕФУС ЛПТЕЛГЙС
		DCR	M		;
		RET			;

M_EXIT:		LDA	CURSOR		; ВЕТЕН ОПНЕТ ФЕЛХЭЕК УФТПЛЙ
M_2EXIT:	LXI	H,0AH		; ЛХТУПТ РПУЩМБЕН ОБ... ДПНПК
		SHLD	CURSOR		; Х ЧЩИПДЙН ЙЪ РТПГЕДХТЩ
		POP	H		; ЪБВЙТБЕН УМПЧП ЙЪ УФЕЛБ
		RET			;

LINE_INV:	LXI	H,CURSOR+1	; ХУФБОБЧМЙЧБЕН ХЛБЪБФЕМШ ОБ
		MVI	M,1		; ЗПТЙЪПОФБМШОХА ЛППТДЙОБФХ
LINE_I_DOP:	CALL	CINV		; Й РТПЙЪЧПДЙН РПУЙНЧПМШОХА
		INR	M		; ЙОЧЕТУЙА ЧУЕЗП ПЛОБ
		DCR	B		;
		JNZ	LINE_I_DOP	;
		MOV	B,D		; ЧПУФБОПЧЙН ДМЙОХ ПЛОБ
		RET			; ЧЩИПД ЙЪ РПДРТПЗТБННЩ

;;ыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыы

;+----------[ WINDOW PUTS ]------------+
;*	ЧИПД:	DE ->ЛППТД.,BC -> ХЛБЪ.*
;+-------------------------------------+

WPUTSDOP:	PUSH	H
		PUSH	D
		PUSH	PSW
		JMP	WDOP
WPUTS1:		PUSH	H	
		PUSH	D	
		PUSH	PSW	
		LDA	OFSET
		PUSH	PSW	
		CALL	MOVE	
		POP	PSW
WDOP:		ANI	7H
		SUI	2H
		LHLD	WIND2	
		INR	H
		MOV	L,A	
		CALL	ABSJDE	
WP01:		LDAX	B	
		CPI	CR	
		JZ	WPQ	
		CPI	9H
		JNZ	WP04	
WP02:		XRA	A	
		CALL	PUTCXY	
		INR	D	
		MOV	A,D
		CMP	H
		JNC	WPQ	
		ADD	L	
		ANI	7H	
		JNZ	WP02	
		JMP	WP03	
WP04:		CALL	PUTCXY	
		INR	D	
WP03:		INX	B	
		MOV	A,D	
		CMP	H
		JC	WP01	
WPQ:		XCHG
		SHLD	ENDLINE		;УПИТБОЙФШ ЛПОЕГ УФТПЛЙ
		POP	PSW	
		POP	D	
		POP	H	
		RET		

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

;+--------[ DESJWRITE ]---------+
;* ЧИПД: HL -> ХЛБЪ.ЮЙУМБ	*
;*	 DE -> ЛППТДЙОБФЩ	*
;*	 B*2+1 -> ЮЙУМП ГЙЖТ	*
;+------------------------------+
JDES:		PUSH	B	
		PUSH	D	
		PUSH	H	
		PUSH	PSW	
		MVI	C,0FH	
JD0:		MOV	A,M	
		CALL	JPUT	
		INX	H	
		MOV	A,M	
		RRC		
		RRC		
		RRC		
		RRC		
		CALL	JPUT	
		DCR	B	
		JNZ	JD0	
		MOV	A,M	
		CALL	JPUT	
		POP	PSW	
		POP	H	
		POP	D	
		POP	B	
		RET		
JPUT:		ANA	C	
		ADI	30H	
		CALL	PUTCXY	
		INR	D	
		RET		

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

;+---------[ HEXJWRITE ]--------+
;* ЧИПД: A -> ЛПД		*
;*	 DE -> ЛППТДЙОБФЩ	*
;* РТЙ ПФОПУ ЛППТД.DE РТЕПВТ.	*
;* Ч БВУПМАФОЩЕ			*
;+------------------------------+
WJHEX:		PUSH	B	
		CALL	ABSJDE	
		POP	B	
JHEX:		PUSH	B	
		MOV	B,A	
		RRC		
		RRC		
		RRC		
		RRC		
		CALL	PR	
		MOV	A,B	
		CALL	PR	
		MOV	A,B	
		POP	B	
		RET		
PR:		ANI	0FH	
		CPI	0AH	
		JC	PR0	
		ADI	7	
PR0:		ADI	30H	
		CALL	PUTCXY	
		INR	D	
		RET		

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

;+-----------[ MOVE ]-----------+
;24.02.1993З. ПФМБДЙМ РТПГЕДХТХ MOVE ТБВПФБЕФ ОП НПЦОП УДЕМБФШ
;МХЮЫЕ Й ВЩУФТЕЕ ...ОХ ЕЕ ОБ ИТЕО ОБДПЕМП

MOVE:		ORA	A	; 24.2.93
		RZ		; --//--
		MOV	H,A
		MVI	L,0
		LDAX	B
		CPI	9H
		JNZ	MV2
		DCX	B
		JMP	MV0
MV2:		MOV	A,L
		CMP	H
		RNC		;РЕТЕИПД ЕУМЙ L>=H
		INR	L
MV3:		LDAX	B	
		CPI	9H
		JZ	MV0	;ПВТБВПФЛБ ФБВХМСГЙЙ
		CPI	CR
		RZ
		INX	B
		JMP	MV2
MV0:		MOV	A,H
		CMP	L
		RC
		MOV	A,L	
		INR	L
		ANI	7	
		JNZ	MV0
		INX	B
		MOV	A,H
		CMP	L
		RC
		LDAX	B
		CPI	09H
		JZ	MV0
		JMP	MV3+1
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

;		INCLUDE	EDLINE.ASM
;$$$$$$$$$$$$$$ SMALL EDITOR LINE $$$$$$$$$$$$[ 17.11.1992 ]
;;
;;УФТПЛБЧЩК ТЕДБЛФПТ РТПЙЪЧПДЙФ ТЕДБЛГЙА УФТПЛЙ Ч ВХЖЕТЕ STR
;;ДП ФПЗП НПНЕОФБ РПЛБ ОЕ ОБЦБФБ ЛМБЧЙЫБ "ЧЛ"
;;ЛМБЧЙЫЩ ХРТБЧМЕОЙС :ЧМЕЧП,ЧРТБЧП,ЪВ,F2
;;ЧИПДОЩЕ ДБООЩЕ: 
;;			Б => ДМЙОБ (НБЛУЙНБМШОБС) ДП ЛПФПТПК ЧПЪНПЦОП
;;			     ТЕДБЛФЙТПЧБФШ УФТПЛХ
;;			DE=> ПФОПУЙФЕМШОЩЕ ЛППТДЙОБФЩ ЗТБЖЙЛЙ УФТПЛЙ
;;			HL=> ХЛБЪБФЕМШ ОБ ТЕДБЛФЙТХЕНХА УФТПЛХ
;;			     УФТПЛБ ЛПРЙТХЕФУС Ч ВХЖЕТ STR
;
;;ыыыыыыы      470075     З.лБТБЗБОДБ           ыыыыыыы;;
;;ыыыыыыы   ХМ. 40 МЕФ лБЪБИУФБОБ Д.39/3 ЛЧ.1   ыыыыыыы;;
;;ыыыыыыы            рЙНЕОПЧ р.б                ыыыыыыы;;
;;ыыыыыыы               Ф.52-81-95              ыыыыыыы;;
;;

EDLINE:		STA	MAXDLINNA
		CALL	COPYSDOP
		MOV	H,A		;УПИТБОЙН ЮЙУМП УЙНЧПМПЧ
		LXI	B,STR		;ВХЖЕТ УФТПЛЙ
		XRA	A
		CALL	WPUTSDOP
		MOV	L,E
		MOV	A,D		;BC -ХЛБЪБФЕМШ ЛПОГБ УФТПЛЙ
		ADD	H
		MOV	H,A
		SHLD	CURSOR		;ХУФБОПЧЙН МПЛБМШОЩК ЛХТУПТ
EDDO:		CALL	CINV
EDKEYLOOP:	CALL	KEYDELAU
		CALL	CINV
		LXI	H,EDDO
		PUSH	H
		CPI	10H
		JNC	SYMBOLS		;ОБЦБФБ ВХЛЧБ
		CPI	04H		;ЧМЕЧП
		JZ	EDLEFT
		CPI	06H		;ЧРТБЧП
		JZ	EDRIGHT
		CPI	0CH		;F2-UDALENIE
		JZ	EDDELETE
		CPI	03H		;ЪБВПК
		JZ	EDZABOY
		CPI	0EH		;F4-ESC
		POP	H
		RZ
		CPI	02H		;BK
		RZ
		PUSH	H
		RET

SYMBOLS:	CALL	EDINSERT
		CZ	EDRIGHT
		RET
;$$$$$$$$$$$$
EDZABOY:	CALL	EDLEFT
		CNZ	EDDELETE
		RET
;$$$$$$$$$$$$
;РТПГЕДХТБ ЧУФБЧЛЙ УЙНЧПМБ Ч УФТЛХ ОБИПДСЭХаУС Ч ВХЖЕТЕ STR
EDINSERT:	LDA	MAXDLINNA
		PUSH	B
		LXI	B,STR
		CALL	MOVE
		LDAX	B
		CPI	CR
		POP	B
		CNZ	PLAY
		RNZ
		CALL	MOVEINS	;РЕТЕОПУ У ДЕЛТЕНЕОФПН
		LDA	KEYKOD
		STAX	B
		PUSH	B
		LXI	B,STR
		XRA	A
		CALL	WPUTSDOP
		POP	B
		RET
;$$$$$$$$$$$
EDDELETE:	LDAX	B
		CPI	CR
		RZ		;ЛПОЕГ УФТПЛЙ ЧЩКФЙ У ЖМБЗПН "Z" Ч ТХЛБИ
		CALL	MOVEDEL		;РЕТЕОПУ У ЙОЛТЕНЕОФПН
		LHLD	ENDLINE
		DCR	H
		PUSH	B
		LXI	B,STR
		XRA	A
		CALL	WPUTSDOP		
		POP	B
		MVI	A,' '
		XCHG
		CALL	PUTCXY
		XCHG
		ORA	A		;УВТПУ ЖМБЗБ
		RET
;$$$$$$$$$$$
;	BC ===> ЛХДБ
;
MOVEDEL:	MOV	H,B
		MOV	L,C
MODE0:		INX	H
		MOV	A,M
		DCX	H
		MOV	M,A
		INX	H
		CPI	CR
		JNZ	MODE0
		RET
;$$$$$$$$$$$
;BC --> ХЛБЪБФЕМШ УФТПЛЙ УЙНЦПМПЧ ЛХДБ ОХЦОП РТПЙЪЧЕУФЙ ЧУФБЧЛХ
MOVEINS:	MOV	H,B
		MOV	L,C
		PUSH	D
		MVI	D,0
MOINS0:		MOV	A,M
		INR	D
		CPI	CR
		INX	H
		JNZ	MOINS0
MOINS1:		DCX	H
		MOV	A,M
		INX	H
		MOV	M,A
		DCX	H
		DCR	D
		JNZ	MOINS1
		POP	D
		RET
;$$$$$$$$$$$
EDLEFT:		DCX	B
		LDAX	B
		CPI	CR
		INX	B
		RZ			;ЧЩИПД ОБЮБМП УФТПЛЙ
		DCX	B
		LXI	H,CURSOR+1
		DCR	M
		INR	A		;УВТПУ ЖМБЗБ
		RET
;$$$$$$$$$$$
EDRIGHT:	LDAX	B
		CPI	CR
		RZ
		INX	B
		LXI	H,CURSOR+1
		INR	M
		INR	A		;УВТПУ ЖМБЗБ
		RET
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

;		INCLUDE	SYMB.ASM
;; РБЛЕФ РТПГЕДХТ РТЕДОБЪОБЮЕО ДМС ПВТБВПФЛЙ
;; ОБЦБФЙК ОБ УЙНЧПМШОЩЕ ЛМБЧЙЫЙ Й ОЕЛПФПТЩЕ 
;; ХРТБЧМСАЭЙЕ УРЕГЙБМШОП ДМС PPA-Editor
;; УЕЗПДОС: 06.12.1992 +++ 14:05 +++ ЧПУЛТЕУЕОШЕ
;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;
;;ыыыыыыы      470075     З.лБТБЗБОДБ           ыыыыыыы;;
;;ыыыыыыы   ХМ. 40 МЕФ лБЪБИУФБОБ Д.39/3 ЛЧ.1   ыыыыыыы;;
;;ыыыыыыы            рЙНЕОПЧ р.б                ыыыыыыы;;
;;ыыыыыыы               Ф.52-81-95              ыыыыыыы;;
;;

;#######################################
BYKVA:		PUSH	PSW
		CALL	NARUSHENIE
		CALL	KEYRESET
		POP	PSW
		JNZ	BYKVA_NORM
;ПВТБВПФБФШ ЧУФБЧЛХ ФБВХМСГЙЙ
		MVI	D,09H
		MVI	A,246
		CALL	INSERTS_DOP
		JZ	RIGERROR
		CALL	BYKVA_HLP
BYKVA_00:	CALL	RIGHT
		ORA	A
		RZ
		DCR	A
		RZ
		JMP	BYKVA_00
		
BYKVA_NORM:	CALL	INSERTS
		JZ	RIGERROR	;УФТПЛБ РЕТЕРПМОЕОБ
		CALL	BYKVA_HLP
		CALL	RIGHT
		RET
;#####################################
BYKVA_HLP:	LHLD	CURSOR
		MVI	H,0
		XCHG
		LXI	B,STR
		CALL	WPUTS1
		RET
				
;$$$$$$$$$$$$$ ЧУФБЧЛБ УЙНЧПМБ $$$$$$$$$$$$
INSERTS:	MOV	D,A
		MVI	A,254
INSERTS_DOP:	LXI	B,STR
		CALL	MOVE
		LDAX	B
		SUI	CR
		JZ	INS_00
		XRA	A
		RET
INS_00:		MVI	E,1
		CALL	INS_INS
		DCR	E
		CNZ	MOVEDEL
		MOV	A,D
		STAX	B
		ORA	A
		RET
»»
;; ДМС ЪБРХФЩЧБОЙС®
;;
;%%%%%%%%%%%%% ХУ + ЛМБЧЙЫЙ %%%%%%%%%%%%%%%

USADDX:		CALL	REGENER		;
		LXI	H,K_SUMMA + 41E1H ;
		LXI	D, -41E1H	;
		DAD	D		;
		MOV	A,M		;
		ORA	A		;
		INX	H		;
		CNZ	ER_K_SUMMA	;
		MOV	A,M		;
		ORA	A		;
		CNZ	ER_K_SUMMA	;
;;
;; РПДУЮЙФБЕН ЛПОФТПМШОХА УХННХ ДМС ХЮБУФЛБ ПУОПЧОПЗП ЛПОФТПМС
;;
		LXI	B,0		;
		LXI	H,PPASTART + 41E1h ;
		DAD	D		;
US_K_PPA_00:
		MOV	A,C		;
		ADD	M		;
		MOV	C,A		;
		INX	H		;
		DCR	B		;
		JNZ	US_K_PPA_00	;
;;
;;  C - оБИПДЙФУС ЛПОФТПМШОБС УХННБ
;; ХЮБУФЛБ ПУХЭЕУФЧМСАЭЕЗП ЛПОФТПМШ ПУОПЧОПЗП НПДХМС
;;
		CPI	0		;
		CNZ	ER_K_SUMMA	;
		LXI	H,100h + 41E1h	;
		DAD	D		;
US_K_PPA_10:
		MOV	A,C		;
		ADD	M		;
		MOV	C,A		;
		INX	H		;
		DCR	B		;
		JNZ	US_K_PPA_10	;
		CPI	00		;
		CNZ	ER_K_SUMMA	;		
		LDA	NUMBER		;ЮЙФБЕН БРБТБФОЩК ОПНЕТ ЛМБЧЙЫЙ
		CPI	14H		;ОПНЕТ "4" ===== SEARCH =====
		JZ	SEARCH		;
		CPI	17H		;ОПНЕТ "7" ====== QUIT ======
		JZ	PPAQUIT		;
		CPI	13H		;ОПНЕТ "3" ====== GOTO ======
		JZ	GOTOLINE	;
		CPI	12H		;ОПНЕТ "2" ====== File ======
		JZ	FILE		;
		CPI	11H		;ОПНЕТ "1" ====== Help ======
		JZ	HELP		;
		CPI	16H		;ОПНЕТ "6" ====== Info ======
		JZ	M_INFO		;
		CPI	15H		;ОПНЕТ "5" ====== Servis ====
		JZ	SERVIS		;
		LDA	KEYKOD		;
		JMP	KEYDONE		;

;;

INS_INS:	LDA	CURHX
		LXI	B,STR
		CALL	MOVE
		CALL	MOVEINS
		LDAX	B
		CPI	CR
		RNZ
		MVI	A,' '
		MOV	E,A
		STAX	B
		JMP	INS_INS

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

;		INCLUDE	UPR.ASM
; ;РТПГЕДХТЩ ПВТБВПФЛЙ ХРТБЧМСАЭЙИ ЛМБЧЙЫ
; ;РПУМЕДОСС НПДЙЖЙЛБГЙС : 17.11.1992 ЛБТБЗБОДБ

;;
;;ыыыыыыы      470075     З.лБТБЗБОДБ           ыыыыыыы;;
;;ыыыыыыы   ХМ. 40 МЕФ лБЪБИУФБОБ Д.39/3 ЛЧ.1   ыыыыыыы;;
;;ыыыыыыы            рЙНЕОПЧ р.б                ыыыыыыы;;
;;ыыыыыыы               Ф.52-81-95              ыыыыыыы;;
;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
; ; РТПГЕДХТБ ХДБМЕОЙС УЙНЧПМБ ОБИПДСЭЕЗПУС РПД ЛХТУПТПН
; ; 16.11.1992 ЛБТБЗБОДБ
DELETE:		CALL	KEYRESET
		LDA	CURHX
		LXI	B,STR
		CALL	MOVE
		LDAX	B
		CPI	CR
		JZ	DEL_ENTER_SYM
		CALL	NARUSHENIE
		CALL	MOVEDEL
		LXI	B,STR
		LHLD	CURSOR
		XCHG
		MVI	D,0
		CALL	WPUTS1
		LHLD	ENDLINE
		XCHG
		MVI	H,3DH
		MOV	A,D
		CMP	H
		MVI	A,' '
		CZ	PUTCXY
		MOV	L,E
		MOV	A,D
		CMP	H
		RNC
		CALL	CLS
		RET

DEL_ENTER_SYM:	CALL	INS_00
		INR	E
		DCR	E
		JZ	DEL_DONE
		MVI	A,1
		STA	FLAGLINE	;РТЙУФХРЙФШ Л ТЕЗЕОЕТБГЙЙ
DEL_DONE:	CALL	MOVEDEL
		CALL	REGENER
		LHLD	POS
		PUSH	H
		CALL	SINC
		LXI	B,SOOBD
		POP	H
		JZ	WARNING
		PUSH	H
		MOV	A,M
		CPI	CR		;УФТПЛБ РХУФБС ???
		JZ	OBHOD_00
		LHLD	POS
		DCX	H
		MVI	M,20H		;ЪБВЙЧБЕН РТЙЪОБЛЙ ЛПОГБ УФТПЛЙ
		DCX	H
		MVI	M,20H
		POP	B
		PUSH	B
		MVI	A,240
		PUSH	H
		CALL	MOVE
		POP	H
		LDAX	B		;HL - ХЛБЪБФЕМШ ОБ ОБЮБМП УГЕРМСЕНПК
		CPI	CR		; УФТПЛЙ УЙНЧПМПЧ
		JNZ	ER_DEL		;РПМХЮЙН УМЙЫЛПН ДМЙООХА УФТПЛХ
		INX	H
		INX	H
OBHOD_00:	LXI	B,0FE00H
		CALL	COPUINC		;ХОЙЮФПЦБЕН УЙНЧПМЩ ЛПОГБ УФТ.
		POP	H
		SHLD	POS
		PUSH	H
		PUSH	H
		LHLD	CURSOR
		MOV	A,L
		PUSH	H
		MVI	H,3DH
		LXI	D,203H
		ADD	D
		MOV	L,A
		CMP	D
		JNZ	DEL_NO_SC	;ЛХТУПТ Ч ПЛОЕ
	;ЛХТУПТ ЧОЙЪХ ЬЛТБОБ
		MVI	L,0DH
		CALL	SCRV
		MVI	A,1
		STA	CURSOR
		MVI	L,4
		CALL	CLS
		LHLD	POS
		MOV	B,H
		MOV	C,L
		LXI	D,1
		CALL	WPUTS1
		XRA	A		;ЖМБЗ Z  ХУФБОПЧ
DEL_NO_SC:	CNZ	SCRV		;УЛТПМЙОЗ ПЛОБ ЧЧЕТИ
		PUSH	PSW
		INR	L
		POP	PSW
		MOV	E,L
		CNZ	CLS
		POP	D
		MVI	D,0
		POP	B
		CNZ	WPUTS1		;ДПРПМОСЕН УФТПЛЙ
		CALL	COPYS
		STA	DLINNA
		LDA	CURSOR		;ЧЩУЧЕФЙН УФТПЛХ РПУМЕ РПДОСФЙС ФЕЛУФБ
		MOV	B,A
DEL_02:		CALL	SINC
		JZ	EX_BOT		; ЛПОЕГ ФЕЛУФБ
		DCR	B
		JNZ	DEL_02
		MOV	D,B		;	DE = 0000H
		MOV	E,D
		MOV	B,H
		MOV	C,L
		CALL	WPUTS1
EX_BOT:		POP	H
		SHLD	POS
		RET

ER_DEL:		XTHL
		SHLD	POS
		POP	H
		MVI	M,CR
		INX	H
		MVI	M,LF
		XRA	A
		JMP	RIGERROR
;;ыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыы
; ; РТПГЕДХТБ ПВТБВПФЛЙ ОБЦБФЙС ОБ ЛМБЧЙЫХ ъбвпк 5.1.1993 
ZABOY:		
		CALL	LEFT
		DCR	A		; ЛХТУПТ Ч ОББМЕ УФТПЛЙ ???
		JNZ	ZAB_00		; РЕТЕИПД ЕУМЙ ОЕФ
		CALL	UP		;РПДОЙНБЕНУС ОБ УФТПЛХ ЧЩЫЕ
		RZ			;ПРЕТБГЙА РТПЧЕУФЙ ОЕ ХДБМПУШ
		CALL	CCRIGHT		;РЕТЕНЕЭБЕНУС Ч ЛПОЕГ
		CALL	DELETE		;УФТПЛЙ Й ХДБМСЕН УЙНЧПМ "Ok"
		RET
ZAB_00:		INR	A		;РЕТЕНЕУФЙМЙУШ ХУРЕЫОП ???
ZAB_10:		ORA	A
		JNZ	EXIT_ZAB
		CALL	LEFT		;ГЙЛМ ОБ УМХЮБК ФБВХМСГЙЙ
		JMP	ZAB_10
EXIT_ZAB:	CALL	DELETE		; ЕУМЙ ДБ ФП ХДБМСЕН УЙНЧПМ
		RET			; Й ЧЩИПДЙН
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
; ;РТПГЕДХТБ РЕТЕИПДБ ОБ ОПЧХА УФТПЛХ 17.11.1992 ЛБТБЗБОДБ
; ;
ENTER:		CALL	REGENER
		LHLD	POS
		MOV	B,H
		MOV	C,L
		LDA	CURHX
		CALL	MOVE
		MOV	H,B
		MOV	L,C
		PUSH	H
		LXI	B,0200H		;2-РТЙТБЭЕОЙЕ УФТПЛЙ
		CALL	COPUDEC
		MVI	M,CR
		INX	H
		MVI	M,LF

		LDA	OFSET
		ORA	A
		LXI	H,3D0DH
		LXI	D,203H
		POP	B		;
		JNZ	ENT_00
;;
;;   пВТБВПФБФШ ЧЕФЧШ ЛПЗДБ ФЕЛХЭЕЕ ПЛОП ОЕ УДЧЙОХФП
;; Й ОБИПДЙФУС Ч NULL РПЪЙГЙЙ
;;
		LDA	CURSOR
		ADD	D		;D=2
		MOV	L,A
		CMP	D		;D=2
		CNZ	SCRN
		INX	B
		INX	B
		PUSH	PSW
		INR	L
		LDA	CURSOR+1
		ADD	D		;D=2 8.2.1993
		MOV	D,A
		MOV	E,L
		CMP	H		;H=3DH  8.2.1993
		CC	CLS		; 8.2.1993
		MVI	A,' '		;
		CNC	PUTCXY		;
		LHLD	CURSOR
		XCHG
		DCR	E
		MVI	D,0
		POP	PSW
		CNZ	WPUTS1
		XRA	A		;
ENT_00:		PUSH	PSW		;
		CALL	COPYS		;
		POP	PSW		;
		CNZ	HOME		;
		CALL	CCLEFT		;
		CALL	DON		;
		RET			;

;#######################################
DOMOY:		CALL	REGENER
		CALL	CCLEFT
		LDA	CURSOR
		CPI	0AH
		CNZ	CCUP
		RET


;%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
; ; РТПГЕДХТЩ DON and UP ОЕ УПИТБОСАФ ТЕЗЙУФТПЧ
; ; Й ЧПЪЧТБЭБАФ ТЕЪХМЙФБФ УЧПЕК ТБВПФЩ Ч ЧЙДЕ ЖМБЗБ Z
; ;	Z = 1  -  ДПУФЙЗОХФ ЛПОЕГ ( ОБЮБМП ) ФЕЛУФБ
; ;	Z = 0  -  РТПЙЪПЫМП ХУРЕЫОПЕ РЕТЕНЕЭЕОЙЕ
; ;
;////// РТПГЕДХТБ ПВТБВПФЛ ЧОЙЪ //////
DON:		CALL	REGENER
		CALL	SINC	
		LXI	B,SOOBD
		JZ	WARNING
		CALL	COPYS	
		STA	DLINNA
		CALL	INCY	
		LHLD	CURSOR	
		DCR	L	
		MOV	A,L	
		INR	A	
		CZ	DONENDWIND	;ЛПОЕГ ПЛОБ
		CALL	TABCOREKT
		CALL	UP_DON_HLP	;
		RET			;
DONENDWIND:	LXI	B,STR
		LXI	D,0	
		CALL	SCROL1	
		CALL	WPUTS1	
		INR	L
		RET	
;; дПРПМОЙФЕМШОБС РПДРТПЗТБННБ ДМС ХУФБОПЧЛЙ ЛХТУПТБ Ч
;; ЛПОЕГ УФТПЛЙ ОБ ЛПФПТХЕ РТПЙЪПЫМП РЕТЕНЕЭЕОЙЕ
UP_DON_HLP:	LXI	B,STR		;
		LDA	CURHX		;
		CALL	MOVE		;
		LDAX	B		;
		CPI	CR		;
		CZ	CCRIGHT		;
		ORI	1		;РЕТЕНЕУФЙМЙУШ ХУРЕЫОП
		RET			;

;%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
UP:		CALL	REGENER
		CALL	SDEC	
		LXI	B,SOOBV
		JNC	WARNING
		CALL	DECY	
		CALL	COPYS
		STA	DLINNA
		LHLD	CURSOR	
		MOV	A,L	
		INR	L
		CPI	0AH	
		CZ	UPENDWIND	;ЛПОЕГ ПЛОБ
		CALL	TABCOREKT
		CALL	UP_DON_HLP	;
		RET	
UPENDWIND:	LXI	B,STR	
		LXI	D,0AH	
		CALL	SCROL2	
		CALL	WPUTS1
		DCR	L
		RET
;%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
; ; РТПГЕДХТЩ ОЕ УПИТБОСАФ ТЕЗЙУФТПЧ РТПГЕУПТБ
; ; ТЕЪХМШФБФ Ч БЛЛБНХМСФПТЕ:
; ; 	A = 0 - РЕТЕИПД ЪБ РТЕДЕМЩ ПЛОБ ("ОЕРПМОЩК фбв")
; ; 	A = 1 - ОБЮБМП (ЛПОЕГ) ПЛОБ
; ; 	б = 2 - РЕТЕНЕЭЕОЙЕ РТПЙЪПЫМП ХУРЕЫОП
; ; 	б = 3 - ЧЩРПМОЕОБ ФБВХМСГЙС ПРЕТБГЙС ЪБЛПОЮЙМБУШ ХУРЕЫОП
; ; 	б = 0FFH - РТПЙЪПЭЕМ ЧЩИПД ЪБ РТЕДЕМЩ ПЛОБ Й ПО ХУРЕЫОП
; ;		   РПДДБМУС ЛПНРЕОУБГЙЙ ( УДЧЙЗ,ЛПТЕЛГЙС Х Ф.Д.)
; ;
; ;
;////// РТПГЕДХТБ ПВТБВПФЛЙ "ЧМЕЧП" //////
LEFT:		LDA	CURHX
		ORA	A
		JZ	LEFBEG		;ЧЩДБФШ УППВЭЕОЙЕ П ОБЮБМЕ
		DCR	A
		LXI	B,STR
		CALL	MOVE
		LXI	H,CURSOR+1
		LDAX	B
		CPI	9H
		LDA	CURHX
		JNZ	LEFDONE
		CALL	LEFTABHELP
		MVI	A,3H		;ФБВХМСГЙС
		RNZ			;ХИПД ЕУМЙ ОЕ ЛПОЕГ ПЛОБ
		INR	B
		INR	B
		MOV	M,B
		CALL	LEFDOP
		XRA	A		;Z=1 ОЕПВИПДЙНП УДЧЙЗБФШ
		RET
LEFDONE:	MOV	A,M
		ORA	A	
		JZ	LEEND	
		DCR	M
		CALL	DECX	
		MVI	A,2H		;РТПУФПК УДЧЙЗ ВЕЪ ПУМПЦОЕОЙК
		RET	
LEFBEG:		LXI	B,SOOBL	
WARNING:	LXI	D,0A01H	
		CALL	MESS	
		CALL	PLAY	
		LHLD	ENDLINE
		CALL	CLS	
		CALL	KEYRESET
		XRA	A		;Z=1
		MOV	A,L	;A=1 ОБЮБМП УФТПЛЙ
		RET		
LEEND:		CALL	LEFENDWIND
		LXI	H,CURSOR+1
		INR	M
		MVI	A,0FFH	;A=255 УДЧЙЗ ЪБ ПЛОП
		RET	
;%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
;////// РТПГЕДХТБ ПВТБВПФЛЙ "ЧРТБЧП" //////
RIGHT:		LDA	CURHX
		CPI	0FFH
RIGERROR:	LXI	B,SOOBR
		JZ	WARNING
		LXI	B,STR
		CALL	MOVE
		LXI	H,CURSOR+1
		LDAX	B
		CPI	9H
		LDA	CURHX
		JZ	RIGTAB
		MOV	A,M
		INR	M
		CPI	3BH
		CNZ	INCX		;РТЙ ПФУХФУФЧЙЕ ЛПОГБ ПЛОБ
		RNZ
RIEND:		DCR	M
		DCR	M
		CALL	RIENDWIND
		RET	
RIGTAB:		MVI	B,0H		;УПИТБОЙН РПМПЦЕОЙЕ ЛХТУПТБ
RITAB1:		MOV	C,A
		MOV	A,M
		INR	M
		CPI	3BH
		MOV	A,C
		JZ	RITAB0		;ЛПОЕГ ПЛОБ ФП РЕТЕИПД
		INR	B
		INR	A
		ANI	7H
		JNZ	RITAB1
RILOOP:		DCR	B
		CALL	INCX
		JNZ	RILOOP
		RET
RITAB0:		MOV	A,M
		SUB	B
		SUI	3H
		MOV	M,A
		LXI	H,CURHX
		MOV	A,M
		PUSH	PSW
		PUSH	H
		ADD	B
		INR	A
		MOV	M,A
		CALL	RIDOP
		POP	H
		POP	PSW
		MOV	M,A
		RET		
;%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
TABCOREKT:	SHLD	CURSOR	
		LDA	CURHX
		MOV	B,A
		ANI	7H
		RZ
		MOV	A,B
		LXI	B,STR
		CALL	MOVE
		LDAX	B
		CPI	9H
		RNZ			;ОБ РПМХ ОЕФ ФБВХМСГЙЙ
		LXI	H,CURHX
COR00:		CALL	LEFT
		ORA	A
		JZ	COR00
		RET	
;%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
RLTOPHELP:	STA	OFSET
		LDA	CURSOR
RLTOPDOP:	INR	A
		CPI	0BH
		RNC	
		PUSH	PSW
		CALL	SDEC
		POP	PSW
		JMP	RLTOPDOP
;%%%%%%%%%%%%%%%%%%%
LEFTABHELP:	MVI	B,0H
LEFTAB1:	MOV	C,A
		MOV	A,M
		DCR	M		;ХНЕОШЫБЕН ЗТБЖЙЛХ ЛХТУПТБ
		ORA	A
		RZ
		INR	B
		DCR	C
		MOV	A,C
		ANI	7H
		JZ	LEFLOOP
		CALL	LEF_T_H_HLP
		JZ	LEFTAB1		;РТПЧЕТЛБ ОБ ЛПОЕГ ФБВХМСГЙЙ
		INR	M
		DCR	B
LEFLOOP:	DCR	B
		CALL	DECX
		JNZ	LEFLOOP
		CALL	LEF_T_H_HLP
		JZ	LEF_T_EXIT_NORM
;;
;; уДЧЙОЕН ОБ ПДОХ РПЪЙГЙА ЧРТБЧП®
;;		
		INR	M
		CALL	INCX
LEF_T_EXIT_NORM:
		ORI	1		;УВТПУ ЖМБЗБ Z
		RET

LEF_T_H_HLP:
		PUSH	H
		LHLD	CURSOR
		XCHG
		CALL	GETC
		ORA	A
		MOV	A,C
		POP	H
		RET

;$$$$$$$$$$$$$$$$$$
LEFENDWIND:	CALL	DECX
LEFDOP:		CALL	REGENER
		CALL	SCROL3
		LHLD	POS
		PUSH	H
		LDA	OFSET
		SUI	2H
		CALL	RLTOPHELP
		MVI	A,3H		;РПДНЕОБ ЗТБОЙГЙ ПЛОБ
		STA	WIND2+1
		LXI	D,000AH		;ЛТЩЫБ ПЛОБ
LEF01:		LHLD	POS
		MOV	B,H
		MOV	C,L
		CALL	WPUTS1		;ДПРПМОСЕН УФТПЛХ
		PUSH	D
		CALL	SINC
		JZ	LEFTEXIT
		POP	D
		DCR	E
		MOV	A,E
		INR	A
		JNZ	LEF01
		PUSH	D
LEFTEXIT:	POP	D
		MVI	A,3DH
		STA	WIND2+1
		POP	H
		SHLD	POS
		RET
;$$$$$$$$$$$$$$$$$$
RIENDWIND:	CALL	INCX
RIDOP:		CALL	REGENER
		CALL	SCROL4
		LHLD	POS		;УПИТБОЙФШ ХЛБЪБФЕМШ
		PUSH	H
		LDA	OFSET
		ADI	2
		CALL	RLTOPHELP	;РПДОЙН` ОБ "ЛТЩЫХ"
		LXI	D,3A0AH		;ЧЕТИХЫЛБ ПЛОБ
RIQ000:		LHLD	POS
		MOV	B,H
		MOV	C,L
		LDA	CURHX
		CALL	MOVE
		LDA	OFSET
		CALL	WPUTSDOP	;ДПРПМОСЕН УФТПЛХ
		PUSH	D
		CALL	SINC
		JZ	RIGEXIT		;ЛПОЕГ ФЕЛУФБ
		POP	D
		DCR	E
		MOV	A,E
		INR	A
		JNZ	RIQ000
		PUSH	D
RIGEXIT:	POP	D
		POP	H
		SHLD	POS
		RET
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

;		INCLUDE	CC.ASM
; ;жБКМ УПДЕТЦЙФ РТПГЕДХТЩ ПВТБВПФЛЙ ОБЦБФЙК ЛМБЧЙЫ ХРТБЧМЕОЙС
; ;УПЧНЕУФОП У ЛМБЧЙЫЕК У уу
; ;РПУМЕДОСС ЛПТЕЛГЙС :  17.11.199 лБТБЗБОДБ
;;
;;ыыыыыыы      470075     З.лБТБЗБОДБ           ыыыыыыы;;
;;ыыыыыыы   ХМ. 40 МЕФ лБЪБИУФБОБ Д.39/3 ЛЧ.1   ыыыыыыы;;
;;ыыыыыыы            рЙНЕОПЧ р.б                ыыыыыыы;;
;;ыыыыыыы               Ф.52-81-95              ыыыыыыы;;

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
; ; РТПГЕДХТБ ХДБМЕОЙС УФТПЛЙ (ФЕЛХЭЕК) 16.11.1992
CCDELETE:	CALL	NARUSHENIE	;
		CALL	CCLEFT		;РЕТЕИПД Л ОБЮБМХ УФТПЛЙ
		LXI	H,STR		;
		MVI	M,CR		;ПВТХВБЕН УФТПЛХ ЧП ЧТЕНЕОПН ВХЖЕТЕ
		CALL	DELETE		;ХДБМСЕН РТЙЪОБЛ ЛПОГБ УФТПЛЙ
		LHLD	POS		;
		INX	H		;
		INX	H		;
		MOV	A,M		;
		CPI	STOPBYTE	;
		PUSH	PSW		;
		LHLD	CURSOR		;
		INR	L		;
		INR	L		;
		INR	L		;
		MVI	D,2		;
		MOV	E,L		;
		MVI	H,03DH		;
		POP	PSW		;
		CZ	CLS		;
		RET			;

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

;#######################################
;; РТПГЕДХТБ ХУФБОПЧЛЙ ЛХТУПТБ Ч ЛПОЕГ УФТПЛЙ
CCRIGHT:	CALL	REGENER		; 8.2.1993
		LDA	OFSET
		PUSH	PSW
		XRA	A
		STA	OFSET
		STA	CURHX
		MOV	H,A
		MOV	L,A
		SHLD	CURDX
		XCHG			; DE =0
CCR_LOOP:	LXI	B,STR
		MOV	A,D
		CALL	MOVE
		LDAX	B
		CPI	CR
		JZ	SET_END_EXIT
		CALL	INCX
		MOV	A,E
		CPI	3BH
		CZ	CCR_HLP
		INR	E
		INR	D
		JMP	CCR_LOOP

SET_END_EXIT:	LHLD	CURSOR
		MOV	H,E
		SHLD	CURSOR
		LHLD	POS
		PUSH	H
		CALL	CCR_TOP		;РПДОСФШ ХЛБЪБФЕМШ ОБ ЛТЩЫХ
		LDA	OFSET
		ORA	A
		CNZ	HOME
		LHLD	POS
		MOV	B,H
		MOV	C,L
		POP	H
		SHLD	POS
		LXI	D,10
		PUSH	B
		CNZ	PRSCREEN
		LDA	CURHX		; дПРПМОЙФЕМЙОБС ЧУФБЧЛБ ОБ
		ORA	A		; УМХЮБК ПВТБВПФЛЙ РХУФПК УФТПЛЙ
		JNZ	CCR_OBHOD	;
		CALL	RIGHT		;
		CALL	LEFT		;
CCR_OBHOD:	POP	B
		POP	PSW
		ORA	A
		RZ
		MVI	E,0AH
		CALL	PRSCREEN
		RET

CCR_HLP:	LXI	H,OFSET
		INR	M
		INR	M
		DCR	E
		DCR	E
		RET

CCR_TOP:	LDA	CURSOR		;РПДОЙНЕБФ ЛХТУПТ ОБ ЛТЩЫХ
		MOV	B,A
		MVI	A,10
		SUB	B
		RZ
		MOV	B,A
CCR_T_00:	CALL	SDEC
		DCR	B
		JNZ	CCR_T_00
		RET
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;; РТПГЕДХТБ ХУФБОПЧЛЙ ЛХТУПТБ Ч ОБЮ. РПЪЙГЙА
;;
CCLEFT:		LDA	OFSET
		ORA	A
		JZ	NO_CLS_WIND
		CALL	REGENER		; 8.2.1993.
		XRA	A
		STA	OFSET
		LHLD	POS
		PUSH	H
		CALL	CCR_TOP
		MOV	B,H
		MOV	C,L
		LXI	D,10
		CALL	PRSCREEN
		POP	H
		SHLD	POS
		XRA	A
NO_CLS_WIND:	STA	CURHX
		MOV	H,A
		MOV	L,A
		SHLD	CURDX
		STA	CURSOR+1
		CALL	INCX		;RIGHT
		CALL	DECX		;LEFT		
		RET

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;		
CCDON:		CALL	REGENER		;
		LDA	CURSOR		;
		ORA	A		;
		JZ	WDONSCR		;
		CPI	1H		; DCR A - оЕМШЪС !!!
		CNZ	BOTTWIND	; ПРХУЛБА ЛХТУПТ
		CALL	COPYS		;
		STA	DLINNA		;
		CALL	DON		;
		RET			;
WDONSCR:	LHLD	POS		;
		PUSH	H		;
		CALL	SINC		;
		LXI	B,901H		;
		JNZ	CCDON00		; ПВПКФЙ ЕУМЙ ОЕ ЛПОЕГ ФЕЛУФБ
		POP	H		; ЪБВЙТБЕН УМПЧП ЙЪ УФЕЛБ
CCWD_DOP:	CALL	COPYS		;
		STA	DLINNA		;
		LXI	B,SOOBD		; РПДЗПФБЧМЙЧБЕН "Bottom"
		XRA	A		;
		JZ	WARNING		; ЛПОЕГ ФЕЛУФБ BOTTOM BOTTOM
CCDON00:	INR	C		;
		CALL	SINC		;
		JZ	CCBOTTEXT	;ЛПОЕГ ФЕЛУФБ
		DCR	B		;
		JNZ	CCDON00		;
		POP	H		;
		PUSH	H		;
		SHLD	POS		;
		MVI	C,0AH		;
		JMP	CCBOTEXIT	;

CCBOTTEXT:	POP	H
		SHLD	POS
		PUSH	H
CCBOT01:	DCR	B
		JZ	CCBOTEXIT
		CALL	SDEC
		JMP	CCBOT01
CCBOTEXIT:	MOV	B,C
		CALL	CCTOPBOT
		POP	H
		SHLD	POS
		CALL	COPYS
		STA	DLINNA
		RET
		
;%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
CCUP:		CALL	REGENER
		LHLD	CURHY
		MOV	A,H
		ORA	L
		LXI	B,SOOBV
		JZ	WARNING		;TOP TOP TOP TOP
		LDA	CURSOR
		CPI	0AH
		JNC	WUPSCR		;УМЕДХАЭЙК ЛХУПЛ
		CPI	09H
		CNZ	TOPWIND		;РПДОСФЙЕ ЛХТУПТБ
		CALL	UP
		MVI	A,0AH
		STA	CURSOR
		RET

WUPSCR:		LHLD	POS
		PUSH	H
		MVI	B,10
CCUP00:		CALL	SDEC
		JNC	CCTOPTEXT	;ОБЮБМП ФЕЛУФБ
		DCR	B
		JNZ	CCUP00
CCTOPTEXT:	CALL	CCTOPBOT
		POP	H
		SHLD	POS
		RET

;$$$$$$$$$$$$$$$$$$$$$$$
CCTOPBOT:	MOV	A,B
		STA	CURSOR
		LXI	D,0AH
		LHLD	POS
		MOV	B,H
		MOV	C,L
		CALL	HOME
		CALL	PRSCREEN
		RET
;$$$$$$$$$$$$$$$$$$$$$$$$
TOPWIND:	PUSH	PSW
		CALL	SDEC
		CALL	DECY
		POP	PSW
		INR	A
		STA	CURSOR
		CPI	09H		;РПДОСФЙЕ ОБ ЧФПТХА УФТПЛХ
		JNZ	TOPWIND
		RET
;##########################
BOTTWIND:	MOV	B,A
		CALL	SINC
		JZ	CCWD_DOP	; ПВПКФЙ
BOT_W0:		CALL	SDEC
		MOV	A,B
BOT01:		STA	CURSOR
		DCR	A
		RZ		;ДПЫМЙ ДП ДОБ ВЕЪ ПУМПЦОЕОЙК
		PUSH	PSW
		CALL	SINC
		JZ	BOTEXIT
		CALL	INCY
		POP	PSW
		JMP	BOT01
BOTEXIT:	POP	PSW
		RET
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

;		INCLUDE	US.ASM
; ;
; ; рТПЗТБНОЩК НПДХМШ ПВТБВПФЛЙ рбоемек ТЕДБЛФПТБ: PPA-Editor
; ; ( ху + ГЙЖТПЧБС ЛМБЧЙЫБ ПУОПЧОПК ЛМБЧЙБФХТЩ )
; ; РПУМЕДОСС ЛПТЕЛГЙС : 5.10.1992 ++++++ 13:16 +++ чПУЛТЕУЕОШЕ
; ;
;;ыыыыыыы      470075     З.лБТБЗБОДБ           ыыыыыыы;;
;;ыыыыыыы   ХМ. 40 МЕФ лБЪБИУФБОБ Д.39/3 ЛЧ.1   ыыыыыыы;;
;;ыыыыыыы            рЙНЕОПЧ р.б                ыыыыыыы;;
;;ыыыыыыы               Ф.52-81-95              ыыыыыыы;;
;;
SERVIS:		LXI	D,0809H		; ПФЛТПЕН ПЛОП Й РТПЙЪЧЕДЕН
		LXI	H,180BH		; ЧЩЧПД УППВЭЕОЙК 
		MVI	A,15H		; РПУМЕ ЬФПЗП РТПЙЪЧПДЙН ЧЩЪПЧ
		CALL	ACTIV		; "ПЖЙГБОФБ"
		CALL	ESCF4		;
		LXI	D,202H		; ЛПФПТЩК ПРТЕДЕМСЕФ РП УТЕДУФЧПН
		LXI	B,SV_SOOB1	; НЕОА ,ФП ЮФП ОЕПВИПДЙНП
		CALL	WPUTSDOP	; РПМШЪПЧБФЕМА
		INX	B		;
		DCR	E		;
		CALL	WPUTSDOP	;
		INX	B		;
		DCR	E		;
		LXI	B,S_SOOBEX	;
		CALL	WPUTSDOP	;
SV_POVT2:	LXI	D,SV_POVT2	;
		PUSH	D		;
		CALL	MENU		;
		ORA	A		; "чЩИПД" ???
		CZ	DEACTI		; ЕУМЙ ДБ ФП ХИПДЙН
		POP	D		;
		RZ			;
		PUSH	D		;
		DCR	A		; "гЧЕФ" ???
		JZ	SV_COLOR	; ЕУМЙ ДБ ФП ====//=====
		DCR	A		; "ФЕЛУФ" ???
 		JZ	SV_TEXT		; ЕУМЙ ДБ ФП ====//=====
		CPI	0CH		; ЛМБЧЙЫБ - F4 ???
		RNZ			;
		CALL	DEACTI		;
		POP	D		;
		RET			;
;;
;; пВТБВПФБЕН ЧЩВПТ ТЕЦЙНБ РЕТЕЛПДЙТПЧЛЙ ЙУИПДОПЗП ФЕЛУФБ
;;

SV_TEXT:	LXI	D,1006H		;
		LXI	H,3209H		;
		MVI	A,1AH		;
		CALL	ACTIV		;
		CALL	ESCF4		;
		LXI	D,2105H		;
		MVI	A,09FH		;
		CALL	PUTCXY		;
		MVI	A,83H		;
		MVI	C,4		;
SV_00:		INR	E		;
		CALL	PUTCXY		;
		DCR	C		;
		JNZ	SV_00		;
		INR	E		;
		MVI	A,0A1H		;
		CALL	PUTCXY		;
		LXI	D,404H		;
		LXI	B,SV_TS1	;
		CALL	WPUTSDOP	;
		INX	B		;
		MVI	D,17H		;
		CALL	WPUTSDOP	;
		LXI	D,203H		;
		LXI	B,SV_TS0	;
		CALL	SV_PRINT	;
		INX	B		;
		LXI	D,201H		;
		CALL	SV_PRINT	;
		INX	B		;
		LXI	D,0C03H		;
		PUSH	B		;
		CALL	SV_PRLR		;
		POP	B		;
		LXI	D,1E03H		;
		CALL	SV_PRLR		;
		LXI	H,2009H		;
		SHLD	WIND2		;
		CALL	MENU		;
		CPI	0EH		;
		CZ	DEACTI		;
		RZ			;
		LXI	D,1006H		;
		PUSH	PSW		;
		ADD	E		;
		MOV	E,A		;
		MVI	A,8		;
		CALL	PUTCXY		;
		LXI	H,3209H		;
		SHLD	WIND2		;
		LXI	H,2206H		;
		SHLD	WIND1		;
		POP	B		;
SV_TLOOP:	PUSH	B		;
		CALL	MENU		;
		CPI	0EH		;
		CZ	DEACTI		;
		POP	B		;
		RZ			;
;;
;;  рПМХЮЙМЙ ДБООЩЕ П РЕТЕЛПДЙТПЧЛЙ ФЕЛУФБ
;;
					; C - РЕТЧЩК ЧЩВПТ
		MOV	C,A 		; B - ЧФПТПК ЧЩВПТ
		CMP	B		;
		JZ	SV_TLOOP	;
		LXI	D,2206H		;
		ADD	E		;
		MOV	E,A		;
		MVI	A,8		;
		CALL	PUTCXY		;
		LXI	H,1006H		;
		SHLD	WIND1		;
		LXI	D,2805H		;
		LXI	H,3905H		;
		CALL	S_ARE_YOU	; чЩ ХЧЕТЕОЩ
		CNZ	DEACTI		;
		RNZ			;
;;
;; рТЙУФХРЙФШ Л РЕТЕЛПДЙТПЧЛЕ ФЕЛУФБ
;;
		MOV	A,C		;
		MOV	C,B		; BC - йОДЕЛУ ЛПДБ РПЙУЛБ
		MVI	B,0		;
		LXI	H,SV_COD	;
		PUSH	H		;
		DAD	B		;
		MOV	D,M		; D - оБЮБМШОЩК ЛПД РПЙУЛБ
		MOV	C,A		;
		POP	H		;
		DAD	B		;
		MOV	E,M		; E - оБЮБМШОЩК ЛПД ЪБНЕОЩ
		MOV	A,D		;
		ADI	20H		;
		MOV	B,A		; B - лПО. ЛПД РПЙУЛБ
		ORA	A		;
		MVI	A,0D2H		; ЛПД ЛПНБОДЩ JNC
		JNZ	SV_02		; ОЕ ЪБНЕОСЕН ЛПНБОДХ
		MVI	A,0DAH		; ЛПД ЛПНБОДЩ JC
SV_02:		STA	SV_ALT		;	
		LXI	H,BTEXT + 1	;
SV_01:		INX	H		;
		MOV	A,M		;
		CPI	STOPBYTE	;
		JZ	SV_1TEXIT	;
		CMP	D		;
		JC	SV_01		;
		CMP	B		;
SV_ALT:		JNC	SV_01		;
		SUB	D		;
		ADD	E		;
		MOV	M,A		;
		JMP	SV_01		;

SV_COD:		DB	0C0H		; УФТПЮОЩЕ ТХУУЛЙЕ
		DB	060H		; УФТПЮОЩЕ МБФЙОУЛЙЕ
		DB	0E0H		; РТПРЙУОЩЕ ТХУУЛЙЕ
		DB	040H		; РТПРЙУОЩЕ МБФЙОУЛЙЕ

SV_1TEXIT:	STA	OFSET		;
		CALL	DEACTI		;
		CALL	DEACTI		;
		POP	PSW		;
		CALL	DOMOY		;
		RET			;
;;
;;  рТПГЕДХТБ ЧЩЧПДБ ЪБРТПУБ: чЩ ХЧЕТЕОЩ ???
;;		
S_ARE_YOU:	PUSH	B		;
		MVI	A,17H		;
		CALL	ACTIV		;
		CALL	YESNO		;
		LXI	D,200H		;
		LXI	B,SV_TS2	;
		CALL	WPUTSDOP	;
		CALL	KEYDELAU	;
		POP	B		;
		LDA	NUMBER		;
		CPI	57		; лМБЧЙЫБ "Y" ???
		CALL	DEACTI		;
		RET			;

SV_PRLR:	PUSH	B		;
		CALL	WPUTSDOP	;
		INX	B		;
		DCR	E		;
		CALL	WPUTSDOP	;
		POP	B		;
		DCR	E		;
		CALL	WPUTSDOP	;
		INX	B		;
		DCR	E		;
		CALL	WPUTSDOP	;
		RET			;

SV_PRINT:	PUSH	B		;
		CALL	WPUTSDOP	;
		POP	B		;
		PUSH	B		;
		MVI	D,14H		;
		CALL	WPUTSDOP	;
		POP	B		;
		PUSH	B		;
		DCR	E		;
		CALL	WPUTSDOP	;
		POP	B		;
		MVI	D,2		;
		CALL	WPUTSDOP	;
		RET			;

;; пВТБВПФБЕН ЧЩВПТ ТЕДБЛФЙТПЧЙОЙС ГЧЕФБ РЕТЕДОЕЗП РМБОБ
;; ДМС ЬФПЗП ДПРПМОЙФЕМШОП ПФЛТПЕН ПЛОП Й РТЙ РПНПЭЙ ЛМБЧЙЫ
;; ХРТБЧМЕОЙС ЛХТУПТПН РТПЙЪЧЕДЕН ЛПТЕЛГЙА СЮЕКЛЙ COLOR
;; ЙЪ ВМПЛБ ТБВПЮЙИ СЮЕЕЛ РПДРТПЗТБННЩ ПВТБВПФЛЙ ЛБДТПЧПЗП
;; РТЕТЩЧБОЙС - ДТБКЧЕТ ЛМБЧЙБФХТЩ.
;;
SV_COLOR:	LXI	D,1207H		;
		LXI	H,1A08H		;
		MVI	A,16H		;
		CALL	ACTIV		;
		LXI	D,201H		;
		LXI	B,SV_SOOB2	;
		CALL	WPUTSDOP	;
		DCR	E		;
		INX	B		;
		CALL	WPUTSDOP	;
SV_POVTOR:	CALL	MENU		;
		CPI	0EH		;
		CZ	DEACTI		;
		RZ			;
		PUSH	PSW		;
		LXI	D,1706H		;
		LXI	H,2A06H		;
		MVI	A,17H		;
		CALL	ACTIV		;
		CALL	ESCF4		;
		LXI	B,SV_SOOB3	;
		LXI	D,100H		;
		CALL	WPUTSDOP	;
		POP	B		; B - БЛЛБНХМСФПТ
		LHLD	COLOR		;
SV_LOOP:	SHLD	COLOR		;
		XRA	A		;
		STA	FLAGC		;
		LXI	D,SV_LOOP	;
		PUSH	D		;
		LXI	D,1000H		;
		MOV	A,B		;
		ORA	A		;
		MOV	A,H		;
		JNZ	$ + 4		;
		MOV	A,L		;
		CALL	WJHEX		;
		CALL	KEYDELAU	;
		MOV	C,A		;
		CPI	0EH		; "F4"
		JZ	SV_EX0		;
		CPI	2H		; "чл"
		JZ	SV_EX0		;
		CPI	05H		;
		JNZ	SV_OBHOD	;
; пВТБВПФБЕН ОБЦБФЙЕ ЛМБЧЙЫЙ ЧЧЕТИ
		MOV	A,B		;
		INR	H		;
		ORA	A		;
		RNZ			;
		DCR	H		;
		INR	L		;		
		RET			;
SV_OBHOD:	MOV	A,C		;
		CPI	07H		;
		RNZ			;
; пВТБВПФБЕН ОБЦБФЙЕ ЛМБЧЙЫЙ ЧОЙЪ
		MOV	A,B		;
		DCR	H		;
		ORA	A		;
		RNZ			;
		INR	H		;
		DCR	L		;
		RET			;

SV_EX0:		CALL	DEACTI		;
		POP	D		;
		JMP	SV_POVTOR	;


;;ыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыы

; ; ========= ху + 3 ======= GOTO =======
GOTOLINE:	LXI	D,50CH
		LXI	H,1A0CH
		MVI	A,15H
		CALL	ACTIV
		CALL	ESCF4
GOTODONE:	LXI	D,100H
		LXI	B,WARNGOTO	;ЧЩДБФШ УППВЭЕОЙЕ
		XRA	A
		CALL	WPUTSDOP
		MVI	D,0FH		;ЛПОЕГ УППВЭЕОЙС
		MVI	A,4H
		MOV	H,B
		MOV	L,C
		CALL	EDLINE
		CPI	0EH		;ЧЩИПД ЕУМЙ F4
		PUSH	PSW
		CZ	COPYS
		POP	PSW
		CZ	DEACTI
		RZ
; РТЙУФХРЙФШ Л РПЙУЛХ УФТПЛЙ				
		DI		;ХЧЕМЙЮЙФШ ВЩУФТПДЕКУФЧЙЕ
		MVI	A,30H
		STA	KEYKOD	;ЬНХМСГЙС ОХМС
		LXI	B,STR
DOPLOOP:	CALL	EDINSERT	;ЧУФБЧЛБ ОХМС
		JZ	DOPLOOP		;ДПРПМОЕОЙЕ ЪБЧЕТЫЕОП ???
		EI
		CALL	KORREKT
		CALL	DEACTI
		CALL	NULL_POS
POLOP1:		LXI	H,CURDY
		LXI	B,KORBUF
		MVI	D,3
POILOOP:	LDAX	B
		CMP	M
		JNZ	POIDONE		;РТПДПМЦБФШ РПЙУЛ
		INX	B
		INX	H
		DCR	D
		JNZ	POILOOP
;ОБКДЕОБ ОХЦОБС УФТПЛБ		
POIEXIT:	CALL	PRINT_POS
		CALL	KEYRESET
		CALL	COPYS
		STA	DLINNA
		RET

POIDONE:	CALL	SINC
		CNZ	INCY
		JNZ	POLOP1
		JMP	POIEXIT
;&&&&&&&&&&&&& KORREKTOR &&&&&&&&&&&&&&&&&
KORREKT:	LXI	B,STR
		LXI	H,KORBUF+2
		CALL	CLEAR3
		MVI	E,5
POVTOR:		LDAX	B
		CPI	30H
		JC	KORERROR
		CPI	3AH
		JNC	KORERROR
		ANI	0FH		;ЧЩДЕМЙФШ ГЙЖТХ
		MOV	D,A
		MOV	A,E
		RRC
		MOV	A,D
		JC	KORNOHET	;ОЕЮЕФ
		RLC
		RLC
		RLC
		RLC
		INX	H		;УЮЕФЮЙЛ ДЕУСФЙЮОПЗП ЮЙУМБ
KORNOHET:	INX	B		;ХЛБЪБФЕМШ УФТПЛЙ
		ORA	M
		MOV	M,A
		DCR	E
		JNZ	POVTOR
		RET

KORERROR:	LXI	D,90BH
		LXI	H,210BH
		MVI	A,17H
		CALL	ACTIV
		LXI	D,200H
		LXI	B,ERROR01
		XRA	A
		CALL	WPUTSDOP
		ADI	40
KOR02:		HLT
		DCR	A
		JNZ	KOR02			
		CALL	DEACTI
		CALL	HOME
		CALL	KEYRESET
		POP	H
		JMP	GOTODONE

;============== ЧУРПНПЗБФЕМШОЩЕ УЕТЧЙУОЩЕ РТПГЕДХТЩ =============
;РТПГЕДХТБ ХУФБОБЧМЙЧБЕФ ЧУЕ ЗМПВБМШОЩЕ РЕТЕНЕООЩЕ Ч ОЕМЕЧПЕ РПМПЦЕОЙЕ

NULL_POS:	CALL	CCLEFT
		LXI	H,BTEXT+2
		SHLD	POS
		LXI	H,0
		SHLD	CURHY
		LXI	H,CURDY+2
		CALL	CLEAR3
		RET

;РТПГЕДХТБ ТБУРЕЮБФЩЧБЕФ ЛБТФЙОЛХ ОБЮЙОБС У ФЕЛХЭЕЗП POS
PRINT_POS:	LXI	H,0AH
		SHLD	CURSOR
		XCHG
		CALL	HOME
		LHLD	POS
		MOV	B,H
		MOV	C,L
		CALL	PRSCREEN
		CALL	DON		;ЛПТЕЛГЙС УЭЕФЮЙЛБ
		CNZ	UP
		RET
; ; ======= ху + 1 ====== Help ========
HELP:		CALL	CCLEFT		;
		LXI	D,0608H		; ПФЛТЩЧБЕН ПЛОП
		LXI	H,2F0BH		;
		MVI	A,15H		;
		CALL	ACTIV		;
		CALL	ESCF4		; ЧЩЧПДЙН УППВЭЕОЙЕ П ЧЩИПДЕ
		XCHG			; ТЙУХЕН ЧЕТФЙЛБМШОХА УФТЕМЛХ
		INR	D		;
		MVI	B,4H		;
		CALL	STL2		; РПДРТПЗТБННБ ТЙУПЧБОЙС
;; пУФБМПУШ РТПДЕМБФШ РТПУФЕКЫЙЕ ПРЕТБГЙЙ:
;; 1) рПМХЮЙФШ ДПУФХР Л СДТХ ПРЕТБГЙПООПК УЙУФЕНЩ
;; 2) рПДЗПФПЧЙФУС Л ЮЕОЙА ЖБКМБ: EDHLP.PPA
;; 3) рП ЛПНБОДЕ ЧПЪЧТБФБ РЕТЕЛМАЮЙФШ ХРТБЧМЕОЙЕ
;;    СДТХ "PPA Editor"
;; РТПЗТБННБ ТБВПФЩ У ДЙУЛПН 26.11.1992
;;
;; ========== пРЙУБОЙЕ ЖБКМБ EDHLP.PPA ===========   
;; ЖБКМ EDHLP.PPA СЧМСЕФУС "ФЕУФПЧЩН ЖБКМПН" ОП ЙНЕАЭЙК
;; ПУПВЕОПУФШ:
;;       ЛБЦДС (ЛТПНЕ ЛБЦДПК ФТЕФЕК) ДПМЦОБ ЙНЕФШ ДМЙОХ
;;       ТБЧОХА: 40 УЙНЧПМПЧ + 2 УЙНЧПМБ CR Й LF
;;       ЛБЦДБС ФТЕФШС УФТПЛБ ДПМЦОБ ЙНЕФШ ОБ 2 УЙНЧПМБ
;;       ВПМШЫЕ ЬФП У ЧСЪБОП УП УФБОДБТФОПК ДМЙООПК ЪБ-
;;       РЙУЙ = 128  вБКФ Ф.Е Ч ПДОПК ЪБРЙУЙ РПНЕУФЙФУС
;;       ТПЧОП 3 ЙОЖПТНБГЙПООЩЕ УФТПЛЙ.
;;         дМС  ПВЕУРЕЮЕОЙС  ДПРПМОЙФЕМШОПК ЪБЭЙФЩ ЬФПЗП
;;       ПО  ЪБЛПДЙТПЧБО  ЛПДЙТПЧЛБ  РТПЙЪЧПДЙФУС УМЕДХ-
;;       АЭЕК РТПЗТБННПК  ОБРЙУБОПК  ОБ  BDS C Compiling
;;
;; /*************************************************************/
;; /*   24.12 1992  рТПЗТБННБ ОЙЪЛПХТПЧОЕЧПК ПВТБВПФЛЙ ЖБКМБ    */
;; /*             KБТБЗБОДБ-1992      PPA Systems               */
;; /*************************************************************/
;; /*
;;  * дБООБС РТПЗТБННБ РТЕДОБЪОБЮЕОБ ДМС ЫЙЖТПЧЛЙ ХЛБЪБООПЗП
;;  * ЖБКМБ ПУОПЧОПК РТПГЕДХТПК СЧМСЕФУС ЖХОЛГЙС:
;;  *    korrect ( *char)
;;  *       ПОБ РТПЙЪЧПДЙФ ЫЙЖТПЧЛХ ВБКФПЧ ЧУЕЗП ЖБКМБ
;;  *       РП УТЕДУФЧПН ПРЕТБГЙЙ "йУЛМАЮБАЭЕЕ ймй"
;;  *       У ОБЮБМШОЩН ЪОБЮЕОЙН :    0xE1
;;  *       ПОП ПВТБЪПЧБОП УХННПК ASCII ЛПДПЧ УФТПЛЙ
;;  *       "PPA" 
;;  */
;;
;; #define INPUT 0		/* пРЕТБГЙС ЮФЕОЙС */
;; #define OUTPUT 1		/* пРЕТБГЙС ЪБРЙУЙ */
;; #define IOPUT 2		/* пРЕТБГЙС ПВНЕОБ */
;;
;; #define ERROR -1	/* лПОУФБОФБ ПЫЙВЛЙ */
;; #define SEEK_SET 0	/* бВУПМАФОПЕ УНЕЭЕОЙЕ ПФ ОБЮБМБ ЖБКМБ */
;; #define SEEK_CUR 1	/* пФОПУЙФЕМШОПЕ УНЕЭЕОЙЕ */
;; #define SEEK_END 2	/* уНЕЭЕОЙЕ ПФОПУЙФЕМШОП ЛПОГБ ЖБКМБ */
;;
;; #define SECSIZ 0x80	/* дМЙООБ ЪБРЙУЙ ДМС CP/M */
;;
;; main(argc,argv)
;; int argc;
;; char **argv;
;;  {
;;   int fd_file;	/* дЕУЛТЙРФПТ ЖБКМБ ПВТБВПФЛЙ */
;;   int count;		/* дМЙООБ ЙУИПДОПЗП ЖБКМБ Ч ЪБРЙУСИ */
;;
;;     puts("(C)  PPA  Systems.Ltd   1992     fone:  52-81-95\n\n" );
;;
;;     if (argc != 2 )
;;       error_exit ("Format: tp <file.ext>\n");
;;
;;     fd_file = open ( argv[1], IOPUT);	  /* пФЛТЩФШ ХЛБЪБОЩК ЖБКМ */
;;     if (fd_file == ERROR)
;;        error_exit ("No file");
;;
;;     count = seek ( fd_file, 0, SEEK_END );/* ДМЙООБ ЖБКМБ Ч ЪБРЙУСИ */
;;     seek (fd_file, 0, SEEK_SET);
;;     printf ("file: %s real bloc = %d\n",argv [1],count);
;;
;;     while (count--)
;;      {
;;         char file_buf [ SECSIZ ];
;;           if (read ( fd_file, file_buf, 1 ) == ERROR )
;;               error_exit ( "Error read file");
;;           korrect ( file_buf );
;;           seek (fd_file, -1, SEEK_CUR);
;;           if (write ( fd_file, file_buf, 1) == ERROR )
;;               error_exit ( "Error write file");
;;      }
;;     puts ("\nProcess complete !!!");
;;     exit (0);
;; }
;; /****************************************************************
;;  * жХОЛГЙС РТЕПВТБЪПЧБОЙС ВМПЛБ ЖБКМБ Ч УПФЧЕФУФЧЙЙ У ЪБДБОЩНЙ  *
;;  * ХУМПЧЙСНЙ Ф.Е. ПУХЭЕУФЧМСЕФ РЕТЕЛПДЙТПЧЛХ ФЕЛУФПЧЩИ ЖБКМПЧ   *
;;  ****************************************************************/
;;
;; korrect ( buf )
;; char *buf;
;; {
;;  int  i;	/* уЮЕФЮЙЛ ВБКФПЧ */
;;  char c;	/* нБУЛБ ЛПДЙТПЧЛЙ */
;;     c = 'P' + 'P' + 'A';
;;      for (i = 0 ; i < SECSIZ ;)
;;          buf [i++] ^= c++;
;; }
;;
;; /***************************************************************/
;;
;; error_exit (str)
;; char *str;
;; {
;;   puts (str);
;;   exit (-1);
;; }
;;

H_READ:		MVI	A,KD_CONST	; йОЙГЙБМЙЪЙТХЕН СДТП УЙУФЕНЩ
		OUT	10H		; Й РПДЗПФБЧМЙЧБЕН ВХЖЕТ FCB
;;
;; УЛПРЙТХЕН ЮБУФШ УФТПЛЙ Ч ВХЖЕТ STR
;;
		LXI	H,H_SOOB1+8	;
		CALL	COPYSDOP	;
		LXI	H,F_FILE0	;
		PUSH	H		;
		CALL	F_DROB_FILE	;
		POP	D		;
		INT	_OPENC		; ЙНС ЖБКМБ (У ХЛБЪ. ОПНЕТБ ДЙУЛБ)
		INR	A		; РТПЧЕТСЕН ОБМЙЮЙЕ ХЛБЪБООПЗП ЖБКМБ
		JZ	H_NOFILE	; ЕУМЙ ОЕФ ЧЩКФЙ ЙЪ ТЕЦЙНБ
;;
;; рТПЙЪПЫМП ХУРЕЫОПЕ ПФЛТЩФЙЕ ЧУРПНПЗБФЕМШОПЗП ЖБКМБ
;; РЕТЕИПДЙН Л ЮФЕОЙА
;;
H_BEG:		CALL	H_LOAD		; рТПЙЪЧПДЙН ЮФЕОЙЕ 2-И ЪБРЙУЕК
		LXI	D,3		; Й ТБУРЕЮБФЩЧБЕН РПМХЮЕООЩК ТЕЪХМШФБФ
		CALL	PRSCREEN	;
		DCX	B		; ХУФБОПЧЙН ХЛБЪБФЕМШ ОБ ОБЮБМП
		DCX	B		; ФЕОЕЧПК УФТПЛЙ
;;
;; РТЙ РТПУНПФТЕ ЧПУРПМШЪХЕНУС ОЕ ЙУРПМШЪХЕНПК СЮЕКЛПК
;; ДМС ЬФПЗП РПДИПДЙФ СЮЕКЛБ: FLAGLINE ОП РТЙ ЧПЪЧТБФЕ Ч
;; ОЕЕ ОХЦОП ЪБРЙУБФШ ФП ЮФП ВЩМП , Б ВЩМП ФБН ЪБРЙУБОП:
;; 00H - Ф.Л. РЕТЕД ЧИПДПН Ч ЬФХ РПДРТПЗТБННХ ВЩМБ РТП-
;; ЙЪЧЕТЕОБ ТЕЗЕОЕТБГЙС ФЕЛУФПЧПЗП НБУЙЧБ
;; 
H_LOOP:		LXI	H,H_LOOP	; ХУФБОПЧЙН ЧЕЛФПТ ЧПЪЧТБФБ
		PUSH	H		; ПРХУЛБЕН Ч УФЕЛ
		CALL	KEYDELAU	; ПЦЙДБЕН ОБЦБФЙС ЛМБЧЙЫЙ
		CPI	0EH		; ОБЦБФБ ЛМБЧЙЫБ "F4" ???
		POP	H		;
		JZ	H_EXIT		; ЕУМЙ дБ ФП ЪБЛТЩЧБЕН ЖБКМ
		PUSH	H		; Й ЧЩИПДЙН ЙЪ ТЕЦЙНБ
		LXI	H,FLAGLINE	; ХУФБОПЧЛБ ХЛБЪБФЕМС ОБ УЮЕФЮЙЛ
		CPI	07H		; ОБЦБЛФБ ЛМБЧЙЫБ "чОЙЪ"
		JNZ	H_DONE0		; ЕУМЙ дБ ФП РТПДПМЦБЕН
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;   ПВТБВПФБЕН ОБЦБФЙЕ ЛМБЧЙЫЙ ЧОЙЪ   ;;
		INR	M		;
		INX	B		;
		INX	B		;
		LDAX	B		;
		CPI	STOPBYTE	;
		RZ			;		
		CALL	SCROL1		;
		MOV	A,M		;
		CPI	3		;
		CZ	H_LOAD		; РТПЪЧЕУФЙ ДПРПМОЙФЕМШОПЕ
		CPI	8		;
		CZ	H_LOAD		;		
		CPI	14		;
		CZ	H_LOAD		;
		LXI	D,0		; УЮЙФЩЧБОЙЕ
		CALL	WPUTSDOP	; 
		RET			;
;;
;; рТПГЕДХТБ РТПЙЪЧПДЙФ ДПЮФЕОЙЕ ЖБКМБ
;;
H_LOAD:		PUSH	PSW		;
;; рТПГЕДХТБ ЮФЕОЙС 2 ВМПЛБ (256 вБКФ) ЙЪ ЖБКМБ РПНПЭЙ
H_R_BLOCK:	MVI	A,KD_CONST	;
		OUT	10H		;
		LXI	D,STR		;
		PUSH	D		;
		INT	_SET_DMA	;
		LXI	D,F_FILE0	; ХЛБЪБФЕМШ ОБ FCB
		PUSH	D		;
		INT	_READS		; ЧЩЪЩЧБЕН УЙУФЕНХ
		LXI	D,STR + SECSIZ	;
		INT	_SET_DMA	;
		POP	D		;
		INT	_READS		;
		XRA	A		;
		OUT	10H		;
;; лПТЕЛГЙС РТПЮЙФБООПЗП ВМПЛБ ДБООЩИ	;
		POP	H		;
		PUSH	H		;
		MOV	D,A		;
H_KOR0:		MVI	E,'P'+'P'+'A'	;
H_KOR1:		MOV	A,M		;
		XRA	E		;
		MOV	M,A		;
		INX	H		;
		INR	E		;
		INR	D		;
		MOV	A,D		;
		CPI	080H		;
		JZ	H_KOR0		;		
		ORA	A		;
		JNZ	H_KOR1		;
		POP	B		;
		POP	PSW		;
		RET			; ЧПЪЧТБФ
;;
;; рТПДПМЦБЕН РТПЧЕТЛХ ОБЦБФЙС ОБ ЛМБЧЙЫХ
;;
H_DONE0:	CPI	05H		; "чЧЕТИ"
		RNZ			;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;  ПВТБВПФБЕН ОБЦБФЙЕ ЛМБЧЙЫЙ  ЧЧЕТИ  ;;
		MVI	M,0		;
		LXI	H,F_FILE0 + CR_OFSET	;
		MVI	M,0		;
		POP	H		;
		CALL	HOME		;
		JMP	H_BEG		;

H_EXIT:		MVI	A,KD_CONST	;
		OUT	10H		;
		LXI	D,F_FILE0	;
		INT	_CLOSEC		;
		XRA	A		;
		OUT	10H		;
		STA	FLAGLINE	;
		CALL	DEACTI		;
		CALL	COPYS		;
		RET			;
;;
H_NOFILE:	OUT	10H		; БЛФЙЧЙТХЕН СДТП ТЕДБЛФПТБ
		LXI	D,2007H		; ПФЛТЩЧБЕН ДПРПМОЙФЕМШОПЕ ПЛОП
		LXI	H,3407H		;
		MVI	A,1AH		;
		CALL	ACTIV		;
		CALL	ESCF4		;
		LXI	B,H_SOOB1	; ЧЩЧПДЙН УППВЭЕОЙЕ П ФПН
		LXI	D,200H		; ЮФП ДБООЩК ЖБЙМ ОЕ ОБКДЕО
		CALL	WPUTSDOP	;
		CALL	KEYDELAU	; ПЦЙДБЕН ПФЧЕФБ
		CPI	0EH		; ЛМБЧЙЫБ "F4"???
		CALL	DEACTI		; ЕУМЙ ДБ ФП ЧЩИПД ЙЪ ТЕЦЙНБ
		JZ	H_EXIT		;
		JMP	H_READ		; ЙОБЮЕ РПЧФПТЙФШ РПРЩФЛХ
;;
;;ыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыы
;;  рТПГЕДХТБ РТПЙЪЧПДЙФ ПФЮЙУФЛХ НБУЙЧБ РБНСФЙ
;;  HL - ОБЮБМШОЩК БДТЕУ
;;  B  - УЛПМШЛП ПФЮЙЭБФШ

CLEAR_MEM:	PUSH	PSW		;
		XRA	A		;
CL_00:		MOV	M,A		;
		INX	H		;
		DCR	B		;
		JNZ	CL_00		;
		POP	PSW		;
		RET			;
;;ыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыы
;; ======== ху + 2 ====== File ========
;;
;;    ™ќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќ‹
;;    Љ  (C) 1993  лБТБЗБОДБ  лРФй  ьб-91-2  рЙНЕОПЧ р.б   Љ
;; ™ќќљќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќ‹  Љ
;; Љ     ED.COM  -  Utilite for text editor MAR.COM     Љ  Љ
;; Љ							Љ  Љ
;; Љ ========== 52-81-95 ========= PPA Systems ======== Љ  Љ
;; Љ              Copyright  by  рЙНЕОПЧ р.б            Љ  Љ
;; Љ  ™ќќќќќќќќќќќќќќќќќќ‹    ™ќќќќќќќќќќќќќќќќќќќќќќ‹  њќќЊ
;; ќќ‰ asm file: 0000h  њќќќќ‰ com file: 0000h byte њќќЊ
;;    ќќќќќќќќќќќќќќќќќќЊ    ќќќќќќќќќќќќќќќќќќќќќќЊ
;;
;;	      /////////////////////////////////////
;;      	   01110010 00100111 00100000
;;	           РТ. зБЗБТЙОБ 01110010/0001
;;	           0010 - 00110000 - 00010100
;;	      /////////////////////////////////////
;;
;;
FILE:		LXI	D,0809H		; ПФЛТЩЧБЕН ТБВПЮЕЕ ПЛОП
		LXI	H,170BH		; ЧЩЧПДЙН РПСУОСАЭЙЕ ОБДРЙУЙ
		MVI	A,15H		;
		CALL	ACTIV		;
		CALL	ESCF4		;
		LXI	D,202H		;
		LXI	B,F_S00		;
		CALL	WPUTSDOP	;
		INX	B		;
		DCR	E		;
		CALL	WPUTSDOP	;
		INX	B		;
		DCR	E		;
		CALL	WPUTSDOP	;

F_MENU:		LXI	H,F_MENU	;
		PUSH	H		;
		CALL	MENU		;
		CPI	0EH		;
		CZ	DEACTI		;
		POP	H		;
		RZ			;
		PUSH	H		;
		ORA	A		; "рПДЗТХЪЛБ"
		JZ	F_MERGE		;
		DCR	A		; "ъБРЙУШ ЖБКМБ"
		JZ	F_SAVE		;
		JMP	F_LOAD		; "юФЕОЙС ЖБКМБ"
					;
;;ыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыы
					;
;;
;;	рТПЙЪЧЕДЕ ЪБНЕОХ РТПГЕДХТ ПВТБВПФЛЙ ЛПНБОД ЮФЕОЙС
;; Й РПДЗТХЪЛЙ ЖБКМБ®
;;
F_F_HELP:
		XRA	A		;
		STA	F_SL_BUF	; A = 0 ЖЙЛУЙТХЕН ЧЩЪПЧ РТПГ.
;;		LXI	H,STR		; ЮФЕОЙС ЖБКМБ У ДЙУЛБ
		SHLD	F_ALT + 1	;
		LXI	H,F_F_ASCII	;
		MOV	B,M		;
		MVI	M,CR		;
		PUSH	B		;
		CALL	F_INPUT_NAME	;
		POP	B		;
		MOV	A,B		;
		RET			;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
F_MERGE:	
		LXI	H,STR		;
		CALL	F_F_HELP	; 22.4.1993
		STA	F_F_ASCII	;
		CZ	COPYS		;
		RZ			;
;;
;;    рТПЙЪЧЕДЕН РПДЗТХЪЛХ ( ЧУФБЧЛХ ) ЖБКМБ Ч ДБООПЕ НЕУФП
;;  1)  ъБРПНОЙН ФЕЛХЭХА РПЪЙГЙА ( POS ) ,Б ИЧПУФ РЕТЕОЕУЕН  
;;      Л РПФПМЛХ ДПУФХРОПК РБНСФЙ
;;  2)  рТПЙЪЧПДЙН РПУМЕДПЧБФЕМШОПЕ ЮФЕОЙЕ ЙЪ ЧИПДОПЗП ЖБК-
;;      МБ ДП ФПЗП  НПНЕОФБ РПЛБ ОЕ  ЪБЛПОЮЙФУС РБНСФШ МЙВП
;;      ДПУФЙЗОЕН  ЛПОГБ  жБКМБ.  ч  РЕТЧПН  УМХЮБЕ  ЧЩДБЕН
;;	РТЕДХРТЕЦДБАЭЕЕ  УППВЭЕОЙЕ  Й  ЧПУФБОБЧМЙЧБЕН РТЕД-
;;      ЙДХЭЙК ЧБТЙБОФ ФЕЛУФБ ,  ЙОБЮЕ  РТПЙЪЧПДЙН  УЛМЕКЛХ
;;	РПМХЮЙЧЫЕЗПУС ПВ'ЕДЙОЕОЙС  Й ЧПЪЧТБЭБЕНУС Ч РПЪЙГЙА
;;	ЧУФБЧЛЙ ЖБКМБ.
;;
		LHLD	POS		; юЙФБЕН ФЕЛХЭЙК ХЛБЪБФЕМШ
		XCHG			; РЕТЕОПУЙН Ч DE
		LHLD	ENDTEXT		; юЙФБЕН ХЛБЪБФЕМШ ОБ ЛПОЕГ
		BH_MOV			; ФЕЛУФБ.
		CALL	NEG_DE		;
		DAD	D		; HL = ENDTEXT - POS
		INX	H		;
		LXI	D,TEXT_LIMIT	;
		PUSH	H		;
;;
;;  ч РБТЕ HL УПДЕТЦЙФУС ЮЙУМП ВБКФ ЛПФПТЩЕ
;; ОЕПВИПДЙНП РЕТЕОЕУФЙ Л РПФПМЛХ ДПУФХРОПК РБНСФЙ
;;
;; DE -> ЛХДБ
;; BC -> ПФЛХДБ
;; HL -> УЛПМШЛП
;;
;; рТПЙЪЧПДЙН РЕТЕОПУ НБУЙЧБ У ДЕЛТЕНЕОФПН ЙОДЕЛУБ
;;
F_M_LOOP0:	LDAX	B		;
		STAX	D		;
		DCX	B		;
		DCX	D		;
		DCX	H		;
		MOV	A,H		;
		ORA	L		;
		JNZ	F_M_LOOP0	;
		INX	B		;
		INX	D		;
		PUSH	B		; фПЮЛБ ЪБЗТХЪЛЙ
		PUSH	D		; фПЮЛБ "ЛПОЕГ РБНСФЙ"
		PUSH	B		;
;;
;; рЕТЕИПДЙН Л ЧУФБЧЛЕ ЖБКМБ
;;				
		LXI	D,STR		; хУФБОПЧЙН ВХЖЕТ ПВНЕОБ У ДЙУЛПН
		INT	_SET_DMA	;
		POP	H		; HL-фПЮЛБ ЪБЗТХЪЛЙ
		LXI	D,F_FILE0	;

F_M_0:		PUSH	D		; уПИТБОЙН ХЛБЪБФЕМШ FCB
		PUSH	H		; УПИТБОЙН ХЛБЪБФЕМШ ЪБРПМОЕОЙС
		INT	_READS		; РТПЮЙФБЕН ЪБРЙУШ
		POP	D		;
		MOV	C,A		;
		CALL	F_PSEVDO	; чЩЪПЧ ЛПТТЕЛФПТБ ЛПДБ
		CALL	LIIR		; РТПЙЪЧЕДЕН РЕТЕОПУ РБНСФЙ
;;
;;	DE - лХДБ
;;	HL - пФЛХДБ
;;	B  - уЛПМШЛП
;;
		DCR	C		; C = 00 ЖБКМ ОЕ РТПЮЙФБО.
					; C = 01 End file.
		JZ	F_M_END_FILE	; рТПЮЙФБМЙ ЧЕУШ ЖБКМ
;;
;;   A - УПДЕТЦЙФ ЛПД ЧПЪЧТБФБ УЙУФЕНОПК ЖХОЛГЙЙ
;;   _READS ЕУМЙ ЧПЪЧТБЭБЕФУС ЛПД 0x01 ФП ПЪОБЮБЕФ
;;   ЮФП РТПЮЙФБО ЧЕУШ ЖБКМ (EOF - file).
;;

		XCHG			; рПМХЮЙФШ ХЛБЪБФЕМШ ЪБЗТХЪЛЙ
		LXI	D,SECSIZ+SECSIZ	; ХЧЕМЙЮЙФШ ОБ ЧЕМЙЮЕОХ ЪБРЙУЙ * 2
		DAD	D		;
		POP	B		; чТЕНЕООП ЧПЪШНЕН FCB* 
		POP	D		; ЧoЪШНЕН РТЕДЕМ ДПУФХРОПК РБНСФЙ
		PUSH	D		; рТПФПМЛОЕН Ч УФЕЛ
		XCHG			; рТЕДЕМ РЕТЕЛЙОЕН Ч HL
		PUSH	D		; Ч DE РПСЧЙФУС ХЛБЪ. ЪБРПМОЕОЙС
		CALL	NEG_DE		; уЗЕОЕТЙТХЕН ДПР. ЛПД ДМС DE РБТЩ
					; Ф.Е. ДМС ХЛБЪБФЕМС ЪБРПМОЕОЙС
		DAD	D		; рТПЙЪЧЕДЕН ЧЩЮЕФБОЙЕ
;;
;;    еУМЙ HL>DE ФП рпдойнефус ЖМБЗ "у"
;; ЬФП ВХДЕФ ПЪОБЮБФШ ЮФП РБНСФШ ЕЭЕ ПУФБМБУШ РП ЛТБКОЕК
;; НЕТЕ ОБ ЮФЕОЙЕ ЕЭЕ ПДОПК ЪБРЙУЙ
;;
		POP	H		; чПУФБОПЧЙН ХЛБЪБФЕМШ ЪБРПМОЕОЙС
		PUSH	PSW		; УПИТБОЙН ТЕЪХМШФБФ РТЕДЩДХЭ.
		LXI	D,-SECSIZ	; ПРЕТБГЙЙ Й ЧПЪЧТБФЙН ХЛБЪ.
		DAD	D		; ОБ ЪБРЙУШ ОБЪБД.
		POP	PSW		; ЧПУФБОПЧЙН ТЕЪХМШФБФ.
		MOV	D,B		;
		MOV	E,C		; 
;;
;;     Ч ТЕЪХМШФБФЕ НЩ РПМХЮБЕН УМЕДХЕЭЕЕ ТБУРТЕДЕМЕОЙЕ ТЕЗЙУФТПЧ
;; HL - ХЛБЪБФЕМШ ЪБРПМОЕОЙС "РХУФПФЩ" 
;; DE - ХЛБЪБФЕМШ ОБ FCB ЖБКМБ ЮФЕОЙС 
;; flag.C - ЕУМЙ ХУФБОПЧМЕО ФП НПЦОП РТПДПМЦБФШ ЪБЗТХЪЛХ
;;	    ЙОБЮЕ ЧПЪОЙЛМБ УЙФХБГЙС "оеичбфлб рбнсфй"

		JC	F_M_0		;
;;
;;
;; чПУФБОПЧЙН РЕТЧПОБЮБМШОЩК ЧБТЙБОФ ФЕЛУФБ. дП ЬФПЗП Ч УФЕЛЕ
;; ВЩМЙ УПИТБОЕОЩ РБТБНЕФТЩ РЕТЕОПУБ  НБУЙЧБ ОБ ЛТЩЫХ РПЬФПНХ
;; ЙЪЧМЕЛБЕН ЙЪ УФЕЛБ ОЕПВИПДЙНЩЕ ДБООЩЕ Й  ЧЩЪЩЧБЕН РТПГЕДХ-
;; ТХ "mem_move_inc" ЛПФПТБС   РТПЙЪЧПДЙФ  ПВТБФОЩК   РЕТЕОПУ
;; ФЕЛУФБ
;;
		XRA	A		;
		OUT	10H		;
		LXI	B,SOOBF		;
		CALL	F_PR_OVER	;
		POP	D		; пФлХДБ
		POP	B		; лХДБ
		POP	H		; уЛПМШЛП
		
		CALL	MEM_MOVE_INC	;
F_M_EXIT:
		XRA	A		;
		OUT	10H		;
		POP	H		;
		CALL	DEACTI		;
		CALL	DEACTI		;
		INR	A		;
		STA	OFSET		;
		CALL	HOME		;
		CALL	CCLEFT		;
		CALL	DON		; 13.4.1993
		CALL	UP		;  /* V1.00 */
		RET			;
;;
;;   пВТБВПФБЕН ЧБТЙБОФ ХУРЕЫОПЗП ЮФЕОЙС ЖБКМБ У ДЙУЛБ,
;; Ф.Е. РТПЮЙФБООЩК ЖБКМ РПНЕУФЙМУС Ч ПФЧЕДЕООПЕ "ПЛОП"
;;

;;
;; рТПЙЪЧЕДЕН РПЙУЛ ЛПОГБ ФЕЛУФПЧПЗП ЖБКМБ.
;;

F_M_END_FILE:
		DCX	D		;
		LDAX	D		;
		CPI	LF		;
		JNZ	F_M_END_FILE	;
		XCHG			;
		INX	H		;
;;
;; HL - ФПЮЛБ УГЕРМЕОЙС ЛХУЛПЧ.
;;		
		POP	D		;
		POP	D		; пФлХДБ
		POP	B		; уФБТЩК "лхдб"
		BH_MOV			; лХДБ
		POP	H		; уЛПМШЛП
		CALL	MEM_MOVE_INC	;
		DCX	B		;
		MOV	H,B		;
		MOV	L,C		;
		SHLD	ENDTEXT		;
		JMP	F_M_EXIT	;


;;;;;;;;;;;;;;;
;;
;; рТПГЕДХТБ РЕТЕОПУБ НБУЙЧБ РБНСФЙ У ЙОЛТЕНЕОФБН ЙОДЕЛУБ
;;   BC - лХДБ
;;   DE - пФЛХДБ
;;   HL - УЛПМШЛП
;;

MEM_MOVE_INC:
F_M_LOOP1:	LDAX	D		;
		STAX	B		;
		INX	D		;
		INX	B		;
		DCX	H		;
		MOV	A,H		;
		ORA	L		;
		JNZ	F_M_LOOP1	;
		RET			;

;;ыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыы

F_SAVE:		
		INR	A		; A=1 ЖЙЛУЙТХЕН ЧЩЪПЧ
		STA	F_SL_BUF	; РТПГЕДХТЩ ЪБРЙУЙ
		LXI	H,STR		;
		SHLD	F_ALT + 1	;
F_S_DUBL:	CALL	F_INPUT_NAME	;
		MOV	B,A		; уПИТБОЙН ЛПД ЧПЪЧТБФБ
		CPI	0EH		;
		CZ	COPYS		;
		RZ			;

		INR	B		; рТПЧЕТЛБ ЛПДБ ЧПЪЧТБФБ
		DCR	B		;
		JNZ	F_S_YES		; ЖБКМ УХЭЕУФЧХЕФ Й УПЪДБЧБФШ
;;
;; жБЙМ У ЪБДБООЩН ЙНЕОЕН ОЕ УХЭЕУФЧХЕФ
;; Ф.Е ОЕПВИПДЙНП УПЪДБФШ ДБООЩК ЖБКМ
;;
		LXI	D,F_FILE0	;
		JMP	F_S_DOP		;
;;
;; рПДФЧЕТДЙФШ РПРЩФЛХ ЪБРЙУЙ ЖБКМБ
;;
F_S_YES:	XRA	A		;
		OUT	10H		;
		LXI	D,2006H		;
		LXI	H,3106H		;
		CALL	S_ARE_YOU	;
		JNZ	F_S_QUIT	;
		MVI	A,KD_CONST	;
		OUT	10H		;
		LXI	D,F_FILE0	;
		PUSH	D		;
		INT	_DELC		;
		POP	D		;
F_S_DOP:
		INT	_GREATS		;
;;
;;     рЕТЕИПДЙН Л ЪБРЙУЙ ЖБКМБ ОБ ДЙУЛ
;;
F_S_SAVE:	MVI	A,KD_CONST	; хРТБЧМЕОЙЕ СДТХ УЙУФЕНЩ
		OUT	10H		;
		LXI	D,STR		; хУФБОПЧЙФШ ВХЖЕТ DMA
		INT	_SET_DMA	;		
		LXI	H,BTEXT+2	;
F_S_LOOP:	LXI	B,1A80H		; B - STOPBYTE ; C - SECSIZ
		LXI	D,STR		; РТПЙЪЧПДЙН ОБЮБМШОХА ХУФБОПЧЛХ
					; РБТБНЕФТПЧ ДМС ЪБРЙУЙ ФЕЛУФБ
;;
;; рЕТЕИПДЙН ОЕРПУТЕДУФЧЕООП Л ЪБРЙУЙ ФЕЛУФБ
;;
F_S_S00:	MOV	A,M		; вЕТЕН ЙЪ ВХЖЕТБ ВБКФ ФЕЛУФБ
		STAX	D		; РПУЩМБЕН Ч ВХЖЕТ DMA
		CMP	B		; рТПЧЕТЛБ ОБ ЛПОЕГ ЖБКМБ
		CZ	F_S_EXIT	; ЪБЛПОЮЙФШ ЕУМЙ ЛПОЕГ ФЕЛУФБ
		INX	H		;
		INX	D		;
		DCR	C		;
		JNZ	F_S_S00		;
;;
;; рТПЙЪЧЕДЕОП ХУРЕЫОПЕ РЕТЕНЕЭЕОЙЕ ПЮЕТЕДОПК РПТГЙЙ
;; Ч ТБВПЮЙК ВХЖЕТ DMA
;;
		LXI	D,F_FILE0	;
		PUSH	H		;
		INT	_WRITS		;
		POP	H		;
		ORA	A		;
		JNZ	F_S_ERROR2	; рТПЙЪПЫМБ ПЫЙВЛБ ПВНЕОБ
		DCX	H		;
		MOV	A,M		;
		INX	H		;
		CPI	STOPBYTE	;
		JNZ	F_S_LOOP	;
;;
;; рТПЙЪЧЕМЙ ЪБРЙУШ ЖБКМБ ОЕПВИПДЙНП ЪБЛТЩФШ
;; ЕЗП Й ЧЩКФЙ Ч ПУОПЧОПЕ ПЛОП ТЕДБЛФПТБ
;;
		LXI	D,F_FILE0	;
		INT	_CLOSEC		;
		JMP	F_S_QUIT	;

;;
;;  пВТБВПФЮЙЛ ПЫЙВЛЙ РТЙ ЪБРЙУЙ ОБ ДЙУЛ У РПУМЕДХАЭЕН
;;       ЧЩИПДПН ЙЪ РТПГЕДХТЩ ЪБРЙУЙ
;;
F_S_ERROR2:	LXI	B,F_S30		; "Out of disk !"
F_S_E_0:	XRA	A		;
		OUT	10H		;
		CALL	F_PR_OVER	;

F_S_QUIT:	XRA	A		;
		OUT	10H		;
		POP	H		;
		CALL	COPYS		;
		CALL	DEACTI		;
		CALL	DEACTI		;
		RET			;
;;;;;;;;;;;
;;    рТПГЕДХТБ ПВТБВПФЛЙ ЛПОГБ ЖБКМБ ПОБ БЧФПНБФЙЮЕУЛЙ
;; ДПРПМОСЕФ ПЮЕТЕДОПК ВМПЛ РТЕДОБЪОБЮЕООЩК ДМС ЪБРЙУЙ
;; ЛПДПН ЛПОГБ ФЕЛУФБ ( STOPBYTE = 1AH )
;;;;;;;;;;;
F_S_EXIT:	XCHG			;
F_S_E_LOOP:	MOV	M,B		;
		INX	H		;
		DCR	C		;
		JNZ	F_S_E_LOOP	;
		INR	C		; C = 1
		DCX	H		; ЧЕТОЕН HL ОБ НЕУФП
		RET			;
;;
;; рТПГЕДХТБ ПВТБВПФЛЙ ОЕИЧБФЛЙ ДЙУЛПЧПЗП РТПУФТБОУФЧБ
;; ДМС ПФЛТЩФЙС ЙМЙ ЪБРЙУЙ ФЕЛУФПЧПЗП ЖБКМБ
;;
;;ыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыы

F_LOAD:		
		LXI	H,F_F_ASCII	;
		CALL	F_F_HELP	;
		CZ	COPYS		;
;;
;;    еУМЙ ЧЩРПМОЙФУС РТПГЕДХТБ COPYS ФП ПОБ РПДОЙНЙФ
;; ЖМБЗ ОХМС Ф.Е. БЧФПНБФЙЮЕУЛЙ РТПГЕДХТБ ЪБЧЕТЫЙФ УЧПА
;; ТБВПФХ УМЕДХАЭЕК ЛПНБОДПК
;;
		RZ			;
;;    йНС ЖБКМБ ЧЧЕДЕОП ЛПТЕЛФОП Й ЖБКМ УХЭЕУФЧХЕФ
;; ПО ПФЛТЩФ ДМС ДПУФХРБ УТЕДУФЧБНЙ нЙЛТП дПУ
;; 
;; РЕТЕИПДЙН Л РТПГЕДХТЕ ЮФЕОЙС ЖБКМБ Й ЛПТЕЛГЙЙ ЕЗП
;; ЛПДБ ОБ РТЙУХФУФЧЙЕ ОЕДПРХУФЙНЩИ УЙНЧПМПЧ Ч РУЕЧДП-
;; ЗТБЖЙЛЙ ФЕЛУФПЧПЗП РТПГЕУУПТБ MAR.COM
;;
F_L_DOP:
		LXI	D,STR		; хУФБОПЧЙН ВХЖЕТ ПВНЕОБ У ДЙУЛПН
		INT	_SET_DMA	;
		LXI	H,BTEXT + 2	;
		LXI	D,F_FILE0	;
		MVI	A,((TEXT_LIMIT-BTEXT+2)/SECSIZ)
F_YES_0:	PUSH	D		;
		PUSH	PSW		;
		PUSH	H		;
		INT	_READS		;
		POP	D		;
		MOV	C,A		;
		CALL	F_PSEVDO	; чЩЪПЧ ЛПТТЕЛФПТБ ЛПДБ
		POP	PSW		;
		DCR	A		;
		JZ	F_OVER		;
		PUSH	PSW		;
		CALL	LIIR		;
		POP	PSW		;
		DCR	C		; ЛПТЕЛГЙС УЮЕФЮЙЛБ
		XCHG			;
		LXI	D,SECSIZ	;
		DAD	D		;
		POP	D		;
		JNZ	F_YES_0		;
		LXI	B,-SECSIZ - SECSIZ - 1;
		DAD	B		;
		MVI	B,0		;
F_YES_EX:	INX	H		;
		MOV	A,M		;
		CPI	STOPBYTE	;
		JZ	F_YES_00	; чЩКФЙ ЙЪ РПЙУЛБ ЛПДБ
		DCR	B		;
		JNZ	F_YES_EX	;
F_YES_00:	DCX	H		;
		MOV	A,M		;
		CPI	LF		;
		INX	H		;
		JZ	F_EXIT		;
		MVI	M,CR		;
		INX	H		;
		MVI	M,LF		;
		INX	H		;
		MVI	M,STOPBYTE	;
F_EXIT:		SHLD	ENDTEXT		;
		PUSH	D		;
		INT	_CLOSEC		;
		XRA	A		;
		OUT	10H		;
		POP	H		; HL - ХЛБЪБФЕМШ ОБ FCB
		POP	D		; ъБВЙТБЕН ЧЕЛФПТ ЧПЪЧТБФБ
;;
;; уЛПТЕЛФЙТХЕН ЙНС ЖБКМБ Ч ПУОПЧОПН ПЛОЕ ТЕДБЛФПТБ
;;
F_L_NAME:
		MOV	A,M		;
		ORA	A		;
		LXI	D,290EH		;
		JNZ	F_EX_00		;
		MVI	A,'*' - 40H	;
F_EX_00:	ADI	40H		;
		CALL	PUTCXY		;
		INR	D		;
		MVI	B,8		;
		CALL	F_EX_PRINT	;
		INR	D		;
		MVI	B,3		;
		CALL	F_EX_PRINT	;
		CALL	DEACTI		;
		CALL	DEACTI		;
		CALL	NULL_POS	;
		CALL	PRINT_POS	;
		CALL	INCY		;
		CALL	DECY		;
		CALL	COPYS		;
		STA	DLINNA		;
		RET			;
;; пВТБВПФБЕН РЕТЕРПМОЕОЙЕ РБНСФЙ
F_OVER:		OUT	10H		;
		XCHG			;
F_OV_0:		DCX	H		;
		MOV	A,M		;
		CPI	LF		;
		JNZ	F_OV_0		;
		INX	H		;
		MVI	M,STOPBYTE	;
		LXI	B,SOOBF		;
		CALL	F_PR_OVER	; чЩЪПЧ РТПГЕДХТЩ ЧЩЧПДБ РТЕДХРТ.
		MVI	A,KD_CONST	; чПЪЧТБФЙФШ ХРТБЧМЕОЙС
		OUT	10H		; СДТХ OS "нЙЛТП дПУ"
		POP	D		;
		JMP	F_EXIT		;
;;;;;;;;;;
;; рТПГЕДХТБ ЧЩЧПДБ РТЕДХРТЕЦДБАЭЕЗП УППВЭЕОЙС
;; Ч ФЕЛХЭЕН (блфйчопн) ПЛОЕ
;;   BC - ХЛБЪБФЕМШ ОБ УЙНЧПМШОХА УФТПЛХ
;;        ЛПФПТХА ОЕПВИПДЙНП ЧЩЧЕУФЙ ОБ
;;        ЬЛТБО Ч ЛБЮЕУФЧЕ РТЕДХРТЕЦДЕОЙС
;;
F_PR_OVER:
		LXI	D,500H		;
		CALL	HOME		; пФЮЙУФЙН ФЕЛХЭЕЕ ПЛОП
		CALL	WPUTSDOP	;
		MVI	A,80H		; пТЗБОЙЪХЕН ЪБДЕТЦЛХ
F_OV0:		HLT			;
		DCR	A		;
		JNZ	F_OV0		;
		RET			;

;;;;;;;;;;
;; рТПГЕДХТБ ТБУРЕЮБФЛЙ ЪБДБООПЗП ЛПМЙЮЕУФЧБ МЙФЕТ
;; Ч БВУПМАФОЩИ ЛППТДЙОБФБИ ЬЛТБОБ
;;
F_EX_PRINT:	
		INR	D		;
		INX	H		;
		MOV	A,M		;
		CALL	PUTCXY		;
		DCR	B		;
		JNZ	F_EX_PRINT	;
		RET			;
;;;;;;;;;
;;   рТПГЕДХТБ ЛПТТЕЛГЙЙ ПДОПК ЪБРЙУЙ ( 128 ВБКФ )
;; ПФ ОЕДПРХУФЙНЩИ ЛПДПЧ РУЕЧДПЗТБЖЙЛЙ Ч ФЕЛУФПЧПН
;; ТЕДБЛФПТЕ MAR.COM
;; БЧФПНБФЙЮЕУЛЙ ЙОЙГЙБМЕЪЙТХАФУС УМЕДХАЭЙЕ ТЕЗЙУФТЩ
;;     HL = STR
;;     B  = SECSIZ
;; рЕТЕЛПДЙТПЧЛБ РТПЙУИПДЙФ ФПМШЛП Ч УМХЮБЕ
;; ое ОБЦБФЙС ЛМБЧЙЫЙ "ху"
;;
F_PSEVDO:
		LXI	H,STR		;
		MVI	B,SECSIZ	;
		IN	01H		;
		ANI	40H		;
		RZ			;
		PUSH	H		; уПИТБОЙН ТЕЗЙУФТЩ
		PUSH	B		;
;;
;;  рТПЙЪЧЕДХН ЛПТЕЛГЙА ЛПДБ УЮЙФБОПК ЪБРЙУЙ
;;  ОБ РТЙУХФУФЧЙЕ УЙНЧПМПЧ "ЪБРТЕФОПК" РУЕЧДПЗТБЖЙЛЙ

F_Y_LOOP:	MOV	A,M		; ЮЙФБЕН ВБКФ ЙЪ ЪБРЙУЙ
		CPI	0A0H		; УТБЧОЙН У ЛПДПН (0AH)
		JC	F_DONE		; РЕТЕИПД ЕУМЙ НЕОШЫЕ
		CPI	0C0H		; --//--//--//--//--
		JNC	F_DONE		; РЕТЕИПД ЕУМЙ >=
;; оЕВИПДЙНП РТПЙЪЧЕУФЙ ЛПТЕЛГЙА ЛПДБ
		SUI	80H		;
		MOV	M,A		;
F_DONE:		INX	H		;
		DCR	B		;
		JNZ	F_Y_LOOP	;
		POP	B		;
		POP	H		;
		RET			;

;;ыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыы
;;
;;   рТПГЕДХТБ РТПЙЪЧПДЙФ ПФЛТЩФЙЕ ДЙБМПЗПЧПЗП ПЛОБ
;; ЪБРТБЫЙЧБЕФ ЙНС ФТЕВХЕНПЗП ЖБКМБ РТЙ ЬФПН
;; РТПЙЪЧПДЙФ УЙОФБЛУЙЮЕУЛЙК БОБМЙЪ.
;;
;;  рПУМЕ ЬФПЗП РЩФБЕФУ ПФЛТЩФШ ХУФБОПЧМЕООЩК ЖБКМ
;; Й Ч УМХЮБЕ ХДБЮЙ ЧПЪЧТБЭБЕФ ХРТБЧМЕОЙЕ УП УВТПЫ-
;; ЕОЩН ЖМБЗПН "Z" РТЙ ЬФПН ПУФБЕФУС ДПУФХРОПК СДТП
;; ПРЕТБГЙПООПК УЙУФЕНЩ Ф.Е :
;;		KD_CONST -> PORT 10H
;;
;; Ч УМХЮБЕ ОЕ ХДБЮЙ ЖМБЗ РПДОЙНБЕФУС Z=1
;; РТЙ ЬФПН PORT 10H <- Zero
;;
;; рЕТЕД ЧИПДПН Ч РПДРТПЗТБННХ ОЕПВИПНП УМЕДЙФШ
;; ЪБ РТБЧЙМШОПУФША ХУФБОПЧЛЙ СЮЕКЛЙ: F_VEKTOR
;; ПОБ ИТБОЙФ БДТЕУ ВХЖЕТБ ASCII ДМС ЧЧЕДЕООПЗП
;; ЙНЕОЙ ЖБКМБ
;;
F_INPUT_NAME:
		LXI	D,1008H		;
		LXI	H,2608H		;
		MVI	A,16H		;
		CALL	ACTIV		;
		CALL	ESCF4		;
F_I_LOOP:	LXI	B,F_S10		;
		LDA	SMAL		;
		MOV	H,A		;
		LDA	RUSLAT		;
		MOV	L,A		;
		PUSH	H		;
		XRA	A		;
		STA	SMAL		;
		STA	RUSLAT		;
		LXI	D,100H		;
		CALL	WPUTSDOP	;
		MVI	D,7		;
		LXI	H,F_F_ASCII	;
		MVI	A,13		;
		CALL	EDLINE		;		
		CPI	0EH		;
		CZ	DEACTI		;
		POP	H		;
		RZ			;
		MOV	A,H		;
		STA	SMAL		;
		MOV	A,L		;
		STA	RUSLAT		;
		LXI	H,F_FILE0	;
		CALL	F_DROB_FILE	;
		CNZ	HOME		;
		JNZ	F_I_LOOP	;
;;
;; рПМХЮЕОЙЕ ЙНЕОЙ ЖБКМБ У ЛПОУПМЙ
;; РТПЫМП ХУРЕЫОП УЛПРЙТХЕН ASCII ЛПД
;; Ч ТБВПЮЙК ВХЖЕТ 
;;
				; чЕЛФПТ ЛПРЙТПЧБОЙС ASCII
				; ЖПТНБФБ ЧП ЧТЕНЕООЩК ВХЖЕТ
				; ОЕПВИПДЙН ДМС ФПЗП ЮФПВЩ
				; РПФПН ЧПУФБОПЧЙФШ FCB ТБВПЮЕЗП
				; ЖБКМБ РПУМЕ ЧУФБЧЛЙ

		MVI	B,15		; рТПЙЪЧПДЙН РЕТЕОПУ
		LXI	H,STR		; ФЕЛУФПЧПК УФТПЛЙ ЧП ЧТЕНЕ-
F_ALT:		LXI	D,0		; ООЩК ВХЖЕТ ДМС РПУМЕДХАЭЕЗП

		CALL	LIIR		; ЙУРПМШЪПЧБОЙС
;;
;; рЕТЕИПДЙН Л ПФЛТЩФЙА ЖБКМБ
;;
		LXI	D,F_FILE0	;
		MVI	A,KD_CONST	;
		OUT	10H		;
		INT	_OPENC		; рЩФБЕНУС ПФЛТЩФШ ЪБДБООЩК ЖБКМ
		INR	A		; ЕУМЙ ОЕ РПМХЮЙМПУШ ОБ РПЧФПТОЩК
		RNZ			; ЪБРТПУ ,ЙОБЮЕ ЧЩИПДЙН
;;
;; пВТБВПФБФШ ЧБТЙБОФ ЕУМЙ ЖБКМ ОЕ ОБКДЕО
;;
		LDA	F_SL_BUF	; рТПЧЕТСЕН ЛБЛХА ПРЕТБГЙА
		DCR	A		; РТПЙЪЧПДЙН ЕУМЙ ЪБРЙУШ
		RZ			; ФП ЧПЪЧТБЭБЕНУС У б=0
		LXI	D,2007H		;
		LXI	H,2D07H		;
		XRA	A		;
		OUT	10H		;
		MVI	A,17H		;
		CALL	ACTIV		;
		CALL	ESCF4		;
		LXI	B,F_S20		;
		LXI	D,300H		;
		CALL	WPUTSDOP	;
		CALL	KEYDELAU	;
		CPI	0EH		;
		CALL	DEACTI		;
		CALL	DEACTI		;
		JNZ	F_INPUT_NAME	; рТПЙЪЧЕУФЙ РПЧФПТОЩК ЧЧПД ЙНЕОЙ
		RET			; ЕУМЙ F4 ФП ЧЩКФЙ ЙЪ ТЕЦЙНБ

;;ыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыы

;;
;; рТПГЕДХТБ ТБЪДТПВМЕОЙС ЙНЕОЙ ЖБКМБ Й ЗЕОЕТБГЙС
;; ВМПЛБ FCB
;;      чИПД:
;;        HL - ХЛБЪБФЕМШ ОБ ВХДХЭЙК FCB
;;      чЩИПД:
;;         Z - РПДОСФ ФП ЧУЕ ОПТНБМШОП
;;         Z - ПРХЭЕО ФП ОЕЛПТЕЛФОПЕ ЙНС ЖБКМБ
;;
F_FCB		SET	36		; дМЙООБ УФБОДБТФОПЗП FCB
F_DROB_FILE:
		MVI	B,F_FCB		;
		PUSH	H		;
		CALL	CLEAR_MEM	; РТПЙЪЧЕДЕН ПФЮЙУФЛХ
		POP	H		; ВХДХЭЕЗП ВМПЛБ FCB
		LXI	B,STR+1		;
		LDAX	B		;
		CPI	':'		; ЕУФШ РТЕЖЙЛУ ЪБНЕОЩ ДЙУЛБ
		DCX	B		;
		JNZ	F_D_00		; ЕУМЙ ОЕФ ФП ПВПКФЙ
		LDAX	B		;
		INX	B		;
		INX	B		;
		SUI	40H		; РПМХЮЙФШ ОПНЕТ ОБЛПРЙФЕМС
		CPI	4		;
		RNC			;
		MOV	M,A		; РПУФБЧЙФШ Ч FCB
F_D_00:		INX	H		;
		MVI	D,9		; уЮЕФЮЙЛ ЙНЕОЙ ЖБКМБ
		CALL	F_D_HLP		;
		CPI	' '		; ЙНС ЖБКМБ ЛПТТЕЛФОП ???
		RNZ			; хИПД ЕУМЙ ОБ ЧЕТОП ЪБДБОП ЙНС
		LDAX	B		;
		CPI	CR		; ЙНС ВЕЪ ТБУЫЙТЕОЙС ???
		JZ	F_D_40		; ЕУМЙ ОЕФ ФП ПВТБВПФБФШ ДБМШЫЕ
		INX	B		;
F_D_40:		MVI	D,4		;
		CALL	F_D_HLP		;
		MOV	M,D		; D = 0 - уЮЕФЮЙЛ ПФТБВПФБМ
		CPI	' '		;
		RET			;

F_D_HLP:	LDAX	B		; ЮЙФБЕН УЙНЧПМ ФЕЛУФБ
		CPI	'?'		;
		RZ			; лПОФТПМШ ОБ НЕФБ-УЙНЧПМЩ
		CPI	CR		; лПОЕГ УФТПЛЙ ???
		JZ	F_D_30		; еУМЙ дБ ФП ПВИПДЙН
		CPI	'.'		; ЕУМЙ ОБЮБМПУШ ТБУЫЙТЕОЙЕ
		JNZ	F_D_10		; ПУФБЧЫЩЕУС НЕУФБ Ч ВМПЛЕ
F_D_30:		DCX	B		; FCB ЪБРПМОСЕН РТПВЕМБНЙ
		MVI	A,' '		;
F_D_10:		MOV	M,A		;
		INX	B		;
		INX	H		;
		DCR	D		;
		JNZ	F_D_HLP		;		
		DCX	H		;
		RET			;		

;; /////// тБВПЮЙЕ ВХЖЕТБ ДМС ТБВПФЩ У ЖБКМБНЙ \\\\\\\\
;;  F_FILE0:	DB	0,0,0,0	; вМПЛ ХРТБЧМЕОЙС ЖБКМПН
;;		DB	0,0,0,0	; уПДЕТЦЙФ 36 ЬМЕНЕОФПЧ.
;;		DB	0,0,0,0	;
;;		DB	0,0,0,0	;
;;		DB	0,0,0,0	;
;;		DB	0,0,0,0	;
;;		DB	0,0,0,0	;
;;		DB	0,0,0,0	;
;;		DB	0,0,0,0	;
;; РЕТЕНЕЭЕО РП БДТЕУХ 81H

F_F_ASCII:	DB	CR	; оБЮБМШОБС ЪБЗМХЫЛБ
				; ЙНС ЖБКМБ Ч ASCII ЖПТНБФЕ
		DB	"A:Filename.ppa",CR

;; ======= ху + 7 ====== Search ======
;;ыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыы
SEARCH:		CALL	S_LINE_INPUT	; ЪБРТПУЙФШ УФТПЛЙ РПЙУЛБ Й ЪБНЕОЩ

; ;ОБЮБФШ РПЙУЛ ЪБДБООПК УФТПЛЙ Й РТЙ ОЕПВИПДЙНПУФЙ ЪБНЕОСФШ
; ;   BUF_ETALON:	--> ВХЖЕТ ДМС ЬФБМПОБ
; ;   BUF_PODM:		--> ВХЖЕТ ДМС ЪБНЕОСЕНПК УФТПЛЙ
; ;   DL_ETALON:	--> ДМЙОБ ЬФБМПОПК УФТПЛЙ
; ;   DL_PODM:		--> ДМЙОБ ЪБНЕОСЕНПК УФТПЛЙ

		CALL	NULL_POS	;ХЛБЪБФЕМШ ОБ ОБЮБМП ФЕЛУФБ
		LDA	DL_ETALON	;ВЕТЕН ДМЙОХ ЬФБМПОБ
		MOV	B,A		;УПИТБОСЕН Ч ТЕЗЙУФТБИ
		MOV	C,A		;
		LHLD	POS		;ЮЙФБЕН ХЛБЪБФЕМШ ОБ УФТПЛХ Ч HL
S_LOOP:		MOV	B,C		;ЧПУФБОБЧМЙЧБЕН "B"
		LXI	D,BUF_ETALON	;
S_LOOP1:	MOV	A,M		;УТБЧОЙЧБЕН У УЙНЧПМПН "ЛПОЕГ УФТПЛЙ"
		CPI	CR		;
		JZ	S_END_LINE	;ЛПОЕГ УФТПЛЙ ???
		LDAX	D		;ЕУМЙ ОЕ ЛПОЕГ ФП РТПЮЙФБЕН ЬФБМПО
		CMP	M		;Й УТБЧОЙН ЕЗП У ФЕЛХЭЙН УЙНЧПМПН ЕУМЙ
		INX	H		;ОЕ ТБЧОЩ ФП ЧПУФБОПЧЙФШ ХЛБЪБФЕМШ
		INX	D		;ЬФБМПОБ Й ДМЙООХ ЬФБМПОБ
		JNZ	S_LOOP		;ЙОБЮЕ ХНЕОШЫЙФШ УЮЕФЮЙЛ ХДБЮОЩИ
		DCR	B		;УТБЧОЕОЙК ЕУМЙ ТБЧОП ОХМА ФП
		JNZ	S_LOOP1		;ОБЫМЙ ЬФБМПООХА РПУМЕДПЧБФЕМШОПУФШ
;
; ; ОБЫМЙ ЙУЛПНХА УФТПЛХ ФЕРЕТШ ОЕПВИПДЙНП ПРТЕДЕМЙФШ
; ; ЮФП У ОЕК ДЕМБФШ Б ФБЛЦЕ ЧЩДБФШ УППФЧЕФУФЧХАЭЙЕ
; ; РПСУОЕОЙС РПМШЪБЧБФЕМА Й РТЙОСФШ ТЕЫЕОЙЕ П ДБМШ-
; ; ОЕЫЕН ИПДЕ ТБВПФЩ МЙВП ЪБЛПОЮЙФШ РПЙУЛ ,МЙВП РТП-
; ; ДПМЦЙФШ РПЙУЛ
; ; УЕЗПДОС: 03.12.1992 ++++++++ 19:08
; 
		PUSH	B		;УПИТБОЙН ТЕЗЙУФТЩ РТПГЕУУПТБ
		PUSH	D		;
		PUSH	H		;
		PUSH	B		;
		CALL	PRINT_POS	;ТБУРЕЮБФБЕН ОБКДЕОХС УФТПЛХ Ч
		POP	B		;
		POP	H		;
		PUSH	H		;
		MOV	A,C		;РПНЕФЙН ЙОЧЕТУОЩН ГЧЕФПН ОБКДЕОПЕ
S_LOOP2:	DCX	H		;УМПЧП
		DCR	C		;дМЙОБ ЬФБМПООПК УФТПЛЙ
		JNZ	S_LOOP2		;
		MOV	B,H		;
		MOV	C,L		;
		LXI	D,000AH		;
		CALL	WPUTS1		;
		MOV	B,A		;
		LHLD	ENDLINE		;
		XCHG			;
		LXI	H,3D0DH		;
		MOV	A,D		;
		CMP	H		;
		CC	CLS		;
		LXI	H,CURSOR + 1	;
		CALL	LINE_I_DOP	;
		MVI	M,0		;
		LXI	D,0508H		;ЧЕТИХ ЬЛТБОБ Й РПДЗПФПЧЙН ДБООЩЕ
		LXI	H,180AH		;ДМС ПФЛТЩФЙС ПЛОБ
		LXI	B,S_SOOB1	;
		LDA	DL_PODM		;
		ORA	A		;
		PUSH	PSW		;
		JZ	S_DONE0		;
		LXI	B,S_SOOB2	;ЕУМЙ ТЕЦЙН РПЙУЛ-ЪБНЕОБ ФП
		DCR	E		;ПЛОП ЙНЕЕФ ФТЙ УФТПЛЙ ЙОБЮЕ ДЧЕ
		MVI	H,13H		;
S_DONE0:	MVI	A,017H		;
		CALL	ACTIV		;
		LXI	D,0201H		;ЧЩЧПДЙН БМШФЕТОБФЙЧОЩЕ УФТПЛЙ
		CALL	WPUTSDOP	;Ч УППФЧЕФУФЧЙЙ У ФЕЛХЭЙН ТЕЦЙНПН
		LXI	B,S_SOOBEX	;Й ЧЩЪЩЧБЕН РТПГЕДХТХ MENU:
		DCR	E		;
		CALL	WPUTSDOP	;
		POP	PSW		;
		MVI	E,2		;
		INX	B		;
		CNZ	WPUTSDOP	;
		LXI	B,S_SOOBHLP	;
		CZ	WPUTSDOP	;
		INR	E		;
		CNZ	WPUTSDOP	;
MEN_LOOP:	CALL	MENU		;
;
; ; рПУМЕ ЧПЪЧТБФБ КЪ РПДРТПТБННЩ Ч БЛБНХМСФПТЕ ОБИПДЙФУС ОПНЕТ
; ; УФТПЛЙ Ч ЛПФПТПК ПУФБМУС ЛХТУПТ РТЙ ОБЦБФЙЙ чл ЕУМЙ
; ; ЧЩИПД РТПЙЪПЫЕМ РПУМЕ ОБЦБФЙС ЛМБЧЙЫЙ F4 ФП Ч б ВХДЕФ
; ; ОБИПДЙФУС ЛПД 0EH (Ф.Е Ч НЕОА ОЕ НПЦЕФ ВЩФШ РПЪЙГЙК
; ; ВПМШЫЕ 15
; ; УЕЗПДОС :03.12.1992 ++++++++++++++++ 18:08
; ; ЪБВЙМММММММММММММММММММ ОБ УБРТПНБФ !!!
;
		ORA	A		; ЕУМЙ ОХМЕЧБС РПЪЙГЙС ФП
		JZ	S_EXIT_REJ	; ЧЩИПД ЙЪ ТЕЦЙНБ РПЙУЛБ (ЪБНЕОЩ)
		CPI	0EH		; ОБЦБФБ ЛМБЧЙЫБ F4 ???
		JZ	S_EXIT_REJ	; ЕУМЙ ДБ ФП ФБЛЦЕ ЧЩИПД
		MOV	B,A		; УПИТБОСЕН РПЪЙГЙА ХЛБЪБФЕМС
		LDA	DL_PODM		; ПРТЕДЕМСЕН ФЕЛХЭЙК ТЕЦЙН
		ORA	A		; ( РПЙУЛ ЙМЙ РПЙУЛ-ЪБНЕОБ)
		JZ	ALT_POISK	; РЕТЕИПДЙН ЕУМЙ рпйул
; ; ПВТБРПФБЕН ПЛОП ДМС рпйулб Й ъбнеощ
		MOV	A,B		; ЧПУФБОПЧЙН ХЛБЪБФЕМШ
		CPI	3H		; "ртпунпфт"
		CZ	PROSMOTR	;
		JZ	MEN_LOOP	; ЧПЪЧТБФЙФУС Ч "НЕОА"
		DCR	A		; "ое ЪБНЕОСФШ"
		JZ	S_OBHOD		;
; рТПЙЪЧПДЙН ЪБНЕОХ ЬФБМПООПЗП УМПЧБ ОБ РПДНЕОСЕНПЕ
		CALL	DEACTI		; ъБЛТЩЧБЕФ ПЛОП ЪБРТПУПЧ
		POP	D		; ЮЙФБЕН ФПЮЛХ ЗДЕ ОБЫМЙ УФТПЛХ
		PUSH	D		; 
		LHLD	POS		; ЮЙФБЕН ОБЮБМП УФТПЛЙ
		XCHG			;
		CALL	NEG_DE		; ЖПТНЙТХЕН ДПРПМОЙФЕМШОЩК
		DAD	D		; ЛПД ДМС ТЕЗЙУФТБ DE
					; (ЮФПВЩ РТПЧЕУФЙ ЧЩЮЙФБОЙЕ)
					; HL - УНЕЭЕОЙЕ УМПЧБ Ч STR
		CALL	COPYS		;
		CPI	200		; РТПЧЕТЛБ ДМЙООЩ УФТПЛЙ
		JNC	S_OVERFLOM	;
		LXI	B,STR		;
		DAD	B		;
		MOV	B,H		;
		MOV	C,L		;
		LDA	DL_ETALON	;
		MOV	D,A		;
S_LOOP4:	DCX	B		; РТПЙЪЧПДЙН ХДБМЕОЙЕ ЙУИПДПК
		CALL	MOVEDEL		; УФТПЛЙ У УППФЧЕФУФЧХАЭЕК
		DCR	D		; ЛПТЕЛГЙЕК ХЛБЪБФЕМС
		JNZ	S_LOOP4		;
		LDA	DL_PODM		;
		LXI	D,BUF_PODM	;
		PUSH	B		;
S_LOOP5:	PUSH	PSW		; РТПЙЪЧПДЙН ЧУФБЧЛХ
		CALL	MOVEINS		; ОПЧПК УФТПЛЙ
		LDAX	D		;
		STAX	B		;
		INX	B		;
		INX	D		;
		POP	PSW		;
		DCR	A		;
		JNZ	S_LOOP5		;		
		POP	B		;
		LXI	D,020DH		; ПФПВТБЦБЕН РТПЙЪЧЕДЕООХА
		LXI	H,3D0DH		; ЪБНЕОХ
		CALL	CLS		;
		LXI	D,10		;
		CALL	WPUTSDOP	;
		CALL	NARUSHENIE	; РТПЙЪЧПДЙН ЙУЛХУФЧ.ТЕЗ. ВХЖЕТБ
		CALL	REGENER		; ФЕЛУФБ
; ; рТПЙЪЧЕДЕОБ ЪБНЕОБ ФЕРЕТШ ЧЩЧПДЙН ПЛОП У ЪБРТПУПН
; ; ОБ РТПДПМЕОЙЕ РПЙУЛБ Й ЪБНЕОЩ

S_ZAPROS:	LXI	D,080AH		;
		LXI	H,150AH		;
		MOV	A,H		; 15-пДЙОБТОПЕ ПЛОП
		CALL	ACTIV		;
		LXI	B,S_SOOBHLP3	;
		LXI	D,0100H		;
		CALL	WPUTSDOP	;
		CALL	ESCF4		;
		CALL	KEYDELAU	;	
		CPI	0EH		; F4
		JZ	S_EXIT_REJ	;
		JMP	S_OBHOD		;

S_OVERFLOM:	LXI	B,SOOBR		;
		CALL	WARNING		;
		JZ	S_ZAPROS	; РТПДПМЦЙФШ РПЙУЛ
; ; ПВТБВПФБЕН ПЛОП рпйул
ALT_POISK:	MOV	A,B		; ЧПУФБОПЧЙН ХЛБЪБФЕМШ
		CPI	2H		; "ртпунпфт"
		CZ	PROSMOTR	; РТПУНПФТЕФШ УФТЛХ
		JZ	MEN_LOOP	; ЧПЪЧТБФЙФУС Ч НЕОА
S_OBHOD:	POP	H		;
		POP	D		;
		POP	B		;
		CALL	DEACTI		;
		JMP	S_LOOP		;
		
S_EXIT_REJ:	CALL	DEACTI		;
		POP	D		;
		POP	D		;
		POP	D		;
		LXI	D,0AH		;
		LHLD	POS		;
		MOV	B,H		;
		MOV	C,L		;
		CALL	WPUTS1		;
		RET			;

;+++++++++++ ртпгедхтб пвтбвпфлй ртпунпфтб уфтплй +++++++++++
PROSMOTR:	PUSH	PSW		;
		LXI	D,0A06H		;
		LXI	H,3606H		;
		MVI	A,16H		;
		CALL	ACTIV		;		
		CALL	ESCF4		;
		LXI	B,S_SOOBHLP2	;
		CALL	WIND_PR_TOP	;
		LHLD	POS		;
		MOV	B,H		;
		MOV	C,L		;
		LXI	D,0		;
		PUSH	B		;
		CALL	WPUTS1		;
		POP	B		;
PROS_LOOP:	LXI	H,PROS_LOOP	;
		PUSH	H		;
		CALL	KEYDELAU	;
		LXI	D,0		;
		CPI	04H		; ЧМЕЧП
		JZ	PROS_LEFT	;
		CPI	06H		; ЧРТПЧП
		JZ	PROS_RIG	;
		CPI	0EH		;
		RNZ			;
		POP	H		;
		XRA	A		;
		STA	OFSET		;
		CALL	DEACTI		;
		POP	PSW		;
		RET			;

PROS_LEFT:	LXI	H,OFSET		;
		INR	M		;
		PUSH	B		;
		CALL	WPUTS1		;
		POP	B		;
		LDA	ENDLINE + 1	;
		MOV	D,A		;
		MVI	E,6H		;
		CPI	37H		;
		MVI	A,' '		;
		CC	PUTCXY		;
		DCR	M		;
		MOV	A,D		;
		CPI	0BH		; ОБЮБМБ ДБООПЗП ПЛОБ
		CZ	PLAY		;
		RZ			;
		INR	M		;
		RET			;

PROS_RIG:	LXI	H,OFSET		;
		XRA	A		;
		ORA	M		;
		CZ	PLAY		;
		RZ			;
		DCR	M		;
		PUSH	B		;
		CALL	WPUTS1		;
		POP	B		;
		RET			;

S_END_LINE:	INX	H		;РЕТЕИПДЙН ОБ УМЕДХАЭХА УФТПЛХ
		INX	H		;Й РТПЧЕТСЕН ОЕ ДПУФЙЗОХФ МЙ ЛПОЕГ
		MVI	A,STOPBYTE	;ФЕЛУФБ ЕУМЙ ДБ ФП Й ОЕ ВЩМП ОБКДЕОП
		CMP	M		;ОЙ ПДОПЗП ЕФБМПОБ ФП ЧЩДБФШ УППВЭЕОЙЕ
		JZ	S_END_TXT	;П ФПН ЮФП РПУМЕДПЧБФЕМШОПУФШ ОЕ
		SHLD	POS		;ОБКДЕОБ (ЛХТУПТ ХУФБОБЧМЙЧБЕФУС
		CALL	INCY		;Ч ЛПОЕГ ФЕЛУФБ !!!!!!!!! )
		JMP	S_LOOP		;РТПДПМЦЙФШ РПЙУЛ У ОПЧПК УФТПЛЙ

		CALL	DEACTI
S_END_TXT:	CALL	PRINT_POS
		RET
		
;ыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыы
WIND_PR_TOP:	CALL	HLDEWIND	;
		PUSH	B		;
		CALL	HLSUBDE		;
		MOV	E,C		;
		MVI	D,1		;
		POP	B		;
		XRA	A		;
		CALL	WPUTSDOP	;
		RET			;

;ыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыы
; ; РТПГЕДХТБ ПФЛТЩЧБЕФ ДПРПМОЙФЕМШОПЕ ПЛОП Й ЪБРТБЫЙЧБЕФ
; ; УФТПЛЙ ДМС РПЙУЛБ Й ЪБНЕОЩ РТЙ РПНПЭЙ ЧУФТПЕООПЗП ТЕ-
; ; ДБЛФПТБ EDLINE РПМХЮЕООЩЕ УФТПЛЙ ЛПРЙТХАФУС ЧП ЧТЕНЕ-
; ; ИЩЕ ВХЖЕТЩ (BUF_ETALON , BUF_PODM) Б ФБЛЦЕ Ч СЮЕКЛЙ
; ; DL_ETALON Й DL_PODM ЪБОПУСФУС ДМЙОЩ ЬФЙИ УФТПЛ ЬФП
; ; ДМС РПУМЕДХАЭЙИ ПРЕТБГЙК РПЙУЛБ Й ЪБНЕОЩ Ч ПУОПЧОПН
; ; ФЕЛУФПЧПН ВХЖЕТЕ
; ; УЕЗПДОС: 03.12.1992 +++++++ 18:53
;

S_LINE_DL   	SET	20		; ЛПОУФБОФБ ДМЙОЩ

S_LINE_INPUT:	LXI	D,50BH		;ПФЛТЩЧБА ПЛОП ДМС ЧЧПДБ
		LXI	H,220CH		;ЬФБМПООЩИ УФТПЛ
		MVI	A,15H		;
		CALL	ACTIV		;
		CALL	ESCF4		;
		LXI	B,ETALON	;РЕЮБФБА РПСУОЙФЕМШОЩЕ
		LXI	D,101H		;ЧЩТБЦЕОЙС
		XRA	A		;
		CALL	WPUTSDOP	;
		MOV	E,A		;
		INX	B		;
		CALL	WPUTSDOP	;
		LXI	H,STR		;РПДЗПФБЧМЙЧБА ДБООЩЕ ДМС ТЕДБЛФПТБ
		MVI	M,CR		;УФТПЛЙ EDLINE
		LXI	D,801H		;
		MVI	A,S_LINE_DL - 1	;
		PUSH	H		;
		CALL	EDLINE		;
		POP	H		;
		CPI	0EH		;ЧПЪЧТБФ РП F4 ???
		JZ	SEA_EXIT	;ЕУМЙ ДБ ФП ЧЩКФЙ ЙЪ ТЕЦЙНБ РПЙУЛБ
		MOV	A,M		;ЕУМЙ ЧПЪЧТБЭБЕНБС ТЕДБЛФПТПН УФТПЛБ
		CPI	CR		;РХУФБС ФП ЧЩКФЙ ЛБЛ РТЙ ОБЦБФЙЙ F4
		JZ	SEA_EXIT	;
		CALL	COPYSDOP	;ПРТЕДЕМСА ДМЙООХ УФТПЛЙ
		MOV	B,A		;
		STA	DL_ETALON	;УПИТБОЙФШ ДМЙООХ УФТПЛЙ ETALON
		LXI	D,BUF_ETALON	;ХЛБЪБФЕМШ ОБ ВХЖЕТ ДМС РЕТЕОПУБ
		CALL	LIIR		;УФТПЛЙ ЙЪ STR
		MVI	M,CR		;
; рТЙУФХРЙФШ Л ЧЧПДХ УФТПЛЙ ЪБНЕОЩ (ЕУМЙ ПОБ РТПЙЪЧПДЙФУС)
		LXI	D,800H		;ЧЧЕУФЙ У ЛПОУПМЙ УФТПЛХ ЪБНЕОЩ
		MVI	A,S_LINE_DL - 1	;
		PUSH	H		;
		CALL	EDLINE		;
		POP	H		;ЕУМЙ ОБЦБФБ F4 ФП ЧЩИПД ХЪ ТЕЦЙНБ
		CPI	0EH		;
		JZ	SEA_EXIT	;
		CALL	COPYSDOP	;
		MOV	B,A		;
		STA	DL_PODM		;УПИТБОЙН ДМЙООХ РПДНЕОСЕНПК УФТПЛЙ
		LXI	D,BUF_PODM	;ХЛБЪБФЕМЙ ОБ ВХЖЕТ ДМС РЕТЕОПУ
		ORA	A		;ЕУМЙ УФТПЛБ ОЕ РХУФБС ФП РПЙУЛ-ЪБН.
		CNZ	LIIR		;УПИТБОСЕН ЧЧЕДЕООХА УФТПЛХ
		CALL	DEACTI		;
		RET			;

SEA_EXIT:	CALL	DEACTI		;
		CALL	COPYS		;
		POP	H		; ВЕТЕН УМПЧП ЙЪ УФЕЛБ
		RET			; ЧЩИПД ЙЪ ТЕЦЙНБ

BUF_ETALON:	DS	S_LINE_DL	;ВХЖЕТ ДМС ЬФБМПОБ
BUF_PODM:	DS	S_LINE_DL	;ВХЖЕТ ДМС ЪБНЕОСЕНПК УФТПЛЙ

DL_ETALON:	DB	0H		;ДМЙОБ ЬФБМПОПК УФТПЛЙ
DL_PODM:	DB	0H		;ДМЙОБ ЪБНЕОСЕНПК УФТПЛЙ



; ; ======= ху + 7 ====== QUIT =======
PPAQUIT:	LXI	D,50CH
		LXI	H,1A0CH
		MVI	A,15H
		CALL	ACTIV
		CALL	YESNO
		LXI	D,100H
		LXI	B,QUITPPA
		XRA	A
		CALL	WPUTSDOP
		CALL	KEYDELAU
		LDA	NUMBER
		CPI	57		;"ЛМБЧЙЫБ Y"
		CALL	DEACTI
		RNZ
		DI
		CALL	SCREENCLS
		MVI	A,KD_CONST
		LHLD	KEYVEKT
		SHLD	39H		;ЧПУФБОПЧЙФШ ЧЕЛФПТ
		OUT	10H
		INT	0		;

;;ыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыы
; ; РТПГЕДХТБ ПВТБВПФЛЙ ЙОЖПТНБГЙПООПЗП ЧЩЪПЧБ
; ; УЕЗПДОС: 05.01.1992
M_INFO:		LXI	D,080AH		;
		LXI	H,220BH		;
		MVI	A,15H		;
		CALL	ACTIV		;
		CALL	ESCF4		;
		LXI	D,101H		;
		LXI	B,I_SOOB1	;
		CALL	WPUTSDOP	;
		DCR	E		;
		INX	B		;
		CALL	WPUTSDOP	;
		INX	B		;
		PUSH	B		;
		MVI	D,13H		;
		CALL	WPUTSDOP	;
		INR	E		;
		POP	B		;
		CALL	WPUTSDOP	;
		LHLD	ENDTEXT		;
		PUSH	H		;
		LXI	D, - BTEXT -2	;
		DAD	D		;
		LXI	D,0F01H		;
		CALL	HL_PRINT	;
		POP	D		;
		LXI	H,TEXT_LIMIT	;
		CALL	NEG_DE		;
		DAD	D		;
		LXI	D,0F00H		;
		CALL	HL_PRINT	;
		CALL	KEYDELAU	;
		CALL	DEACTI		;
		RET			;
;;ыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыы
HL_PRINT:	PUSH	D		;
		MOV	A,H		;
		CALL	WJHEX		;
		MOV	A,L		;
		CALL	JHEX		;
		POP	D		;
		RET			;

;;ыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыы

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;////////////// ТБВПЮЙЕ СЮЕКЛЙ ТЕДБЛФПТБ ////////////////
OFSET:	DB	0	;УНЕЭЕОЙЕ ПЛОБ ПФОПУЙФ.УФТПЛЙ
CURHY:	DW	0	
CURDY:	DB	0,0,0	;РСФЙЪО. ДЕУ. ЙУМП-ОПНЕТ УФТПЛЙ
CURHX:	DB	0	
CURDX:	DB	0,0	;ДЕУ. ОПНЕТ РПЪЙГЙЙ
POS:	DW	BTEXT+2	
;))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))
DLINNA:		DB	0H	;ОБЮБМШОБС ДМЙООБ УФТПЛЙ
FLAGLINE:	DB	0H	;=0 УФТПЛБ ОЕ КЪНЕОСМБУШ <>0 ЙЪН.

F_SL_BUF:
KORBUF:		DB	0,0,0	;ВХЖЕТ ЛПТЕЛФПТБ
ENDLINE:	DW	0000H	;ЛПТД. ЛПОГБ УФТПЛЙ
ENDTEXT:	DW	BTEXT+4	;БДТЕУ ИЧПУФБ ФЕЛУФБ
MAXDLINNA:	DB	0H	;ОБЙВПМШЫБС ДМЙООБ ТЕДБЛФЙТХЕНПК УФТПЛЙ


;$$$$$$$$$ ВБЪПЧЩЕ РТПГЕДХТЩ $$$$$$$$$
REGENER:	LXI	H,FLAGLINE
		MOV	A,M
		ORA	A
		RZ			;ЧЩИПД ТЕЗЕОЕТБГЙС ОЕ ОХЦОБ
		DCR	M		;УВТПУЙФШ ЖМБЗ РТЙУФХРЙФШ Л ТЕЗЕОЕТБГЙЙ
		DCX	H
		MOV	B,M		;УФБТБС ДМЙООБ УФТПЛЙ
		MOV	C,B		;
		LXI	H,STR
		CALL	COPYSDOP
		SUB	B
		MOV	B,A		;ТБЪОПУФШ
		LHLD	POS
		JZ	NOSDVIG		;ДМЙООЩ УФТПЛ ОЕ ЙЪНЕОЙМЙУШ
		CC	COPUINC		;ДМЙОБ ХНЕОШЫЙМБУШ
; ДМЙООБ ХЧЕМЙЮЙМБУШ
		CNC	COPUDEC		;УДЧЙОХФШ ФЕЛУФ Ч ПУОПЧО.ВХЖЕТЕ
NOSDVIG:	MOV	A,C
		ADD	B
		MOV	B,A
		XCHG
		INR	B
		LXI	H,STR
		CALL	LIIR		;ЧУФБЧЛБ  ОПЧПК УФТПЛЙ
		CALL	COPYS
		STA	DLINNA
		RET
;%%%%%%%%%%%%%% COPUINCSTOP %%%%%%%%%%%
COPUINC:	PUSH	B
		PUSH	D
		PUSH	H
		PUSH	PSW
		MOV	A,B
		MVI	B,0
		DAD	B
		MOV	D,H
		MOV	E,L		;DE---> ПФЛХДБ
		MOV	C,A		;HL --> ЛХДБ
		DCR	B		;B=0FFH
		DAD	B
		PUSH	H
		LHLD	ENDTEXT
		DAD	B
		SHLD	ENDTEXT
		POP	H
		MVI	B,STOPBYTE	
COILOP0:	LDAX	D
		MOV	M,A
		CMP	B
		INX	D
		INX	H
		JNZ	COILOP0
		POP	PSW
		POP	H
		POP	D
		POP	B
		RET
;%%%%%%%%%%%%%% COPUDEC %%%%%%%%%%%
;; HL ---> БДТЕУ ФЕЛХЭЕК УФТПЛЙ Ч ФЕЛУФЕ
;; B  ---> ТБЪОПУФШ НБЦДХ УФБТПК Й ОПЧПК УФТПЛПК
;; C  ---> УФБТБС ДМЙООБ УФТПЛЙ
COPUDEC:	PUSH	B
		PUSH	D
		PUSH	H
		PUSH	PSW
		MOV	A,B
		MVI	B,0
		DAD	B		;DE -> ДП ЛХДБ
		DCX	H
		XCHG
		MOV	C,A
		LHLD	ENDTEXT
		PUSH	H
		DAD	B		;HL -> ЛХДБ
		SHLD	ENDTEXT
		PUSH	H
		LXI	B, -TEXT_LIMIT
		DAD	B
		POP	H
		POP	B		;BC -> ПФЛХДБ
		JNC	COLOOP1
		LXI	B,SOOBF		;ОЕФ РБНСФЙ
		CALL	WARNING
		CALL	COPYS
		XRA	A
		STA	FLAGLINE	;ПВПТЧБФШ ТЕЗЕОЕТБГЙА УФТПЛЙ
		INR	A
		STA	OFSET		;ЗЕОЕТБГЙС ДБМЙОЕЗП РЕТЕИПДБ ДПНПК
		CALL	DOMOY
		POP	PSW		
		POP	H
		POP	D
		POP	B
		POP	PSW		;ЪБВПТ ЙЪ УФЕЛБ ДЧХИ БДТЕУПЧ
		POP	PSW		;Й ==> * REGENER
		RET

COLOOP1:	LDAX	B
		MOV	M,A
		DCX	B
		DCX	H
		MOV	A,C
		CMP	E
		JNZ	COLOOP1
		MOV	A,B
		CMP	D
		JNZ	COLOOP1
		POP	PSW
		POP	H
		POP	D
		POP	B
		RET
;$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$
NARUSHENIE:	LXI	H,FLAGLINE
		MOV	A,M
		ORA	A
		RNZ			;УФТБЛБ ЙУРТПЧМСЕФУС
		INR	M		;ЖМБЗ =1 РЕТЧПЕ ЙУРТБЧМЕОЙЕ
		RET

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

;+-----------[ SERVISE ]--------+

;+------[ CURSOR ]------+
CINV:		PUSH	B	
		PUSH	D	
		PUSH	H	
		PUSH	PSW	
		LHLD	CURSOR	
		XCHG		
		CALL	ABSJDE	
		CALL	ADDRSC	
		MVI	B,0	
		MVI	C,CBEG	;УНЕЭ
		DAD	B	
		MVI	E,RAZM
		MOV	B,E	;ЧЩУПФБ
		MOV	A,D	
		RRC		
		MVI	A,0FH	
		JC	CV2	
		CMA		
CV2:		MOV	C,A	
CV0:		MOV	A,M	
		XRA	C	
		MOV	M,A	
		INR	L	
		DCR	B	
		JNZ	CV0	
		DCR	L	
		MOV	B,E	
		MOV	A,H	
		ADI	20H	
		MOV	H,A	
CV1:		MOV	A,M	
		XRA	C	
		MOV	M,A	
		DCR	L	
		DCR	B	
		JNZ	CV1	
		POP	PSW	
		POP	H	
		POP	D	
		POP	B	
		RET		

;+--[ ТЙУ ЧЕТФ.УФТЕМЛХ ]---+
STL2:		PUSH	D	
		PUSH	PSW	
		MVI	A,3	
		CALL	PUTCXY	
		DCR	B	
		DCR	B	
		INR	A	
ST0:		DCR	E	
		CALL	PUTCXY	
		DCR	B	
		JNZ	ST0	
		DCR	E	
		INR	A	
		CALL	PUTCXY	
		POP	PSW	
		POP	D	
		RET	

;+----[ ТЙУ ЗПТ. УФТЕМЛХ ]----+
PAR1:		PUSH	D	
		PUSH	PSW	
		MVI	A,6	
		CALL	PUTCXY	
		INR	A	
		DCR	B	
		DCR	B	
PA0:		INR	D	
		CALL	PUTCXY	
		DCR	B	
		JNZ	PA0	
		INR	A	
		INR	D	
		CALL	PUTCXY	
		POP	PSW	
		POP	D	
		RET		

;%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
KEYRESET:	MVI	A,1
		STA	SEEK
		RET
;//////// УФБОДБТФОЩЕ РТПГЕДХТЩ //////////
;РТПГЕДХТБ PRSCREEN ТБУРЕЮБФЩЧБЕФ ФЕЛХЭЕЕ УПД ВХЖЕТБ ФЕЛУФБ ДП ЛПОГБ ПЛОБ

PRSCREEN:	CALL	WPUTS1	
		PUSH	PSW	
PRINL3:		LDAX	B	
		INX	B	
		CPI	CR	
		JNZ	PRINL3	
		INX	B
		POP	PSW	
		LDAX	B
		CPI	STOPBYTE
		RZ		;ХИПД ЛПОЕГ ФЕЛУФБ
		DCR	E	
		MOV	A,E
		INR	A
		JNZ	PRSCREEN
		RET
;$$$$$$$$$$$$$$$$$$$$$$$$$$$
PLAY:		PUSH	B	
		PUSH	PSW	
		MVI	A,36H	
		OUT	08H	
		LXI	B,200H	
PLJ0:		MOV	A,C	
		OUT	0BH	
		MOV	A,B	
		OUT	0BH	
		INX	B	
		MOV	A,B	
		CPI	13	
		JNZ	PLJ0	
		MVI	A,36H	
		OUT	08H	
		POP	PSW	
		POP	B	
		RET		
;$$$$$$$$$$$$$$$$$$$$$$$$$
MESS:		LXI	H,0	
		SHLD	WIND1	
		XRA	A
		CALL	WPUTSDOP
		LXI	H,203H	
		SHLD	WIND1	
		RET		
;////////////////////////////
COPYSDOP:	PUSH	B
		PUSH	D
		PUSH	H
		JMP	CODOP
COPYS:		PUSH	B	
		PUSH	D	
		PUSH	H	
		LHLD	POS	
CODOP:		XCHG			;ФПЮЛБ ЧИПДБ ДМС ЛПРЙТПЧЙОЙС РП HL
		LXI	H,STR-1	
		LXI	B,0D00H
COJ0:		LDAX	D	
		INX	H	
		INX	D	
		CMP	B	
		JZ	COQ	
		INR	C	;---//----
		JZ	COQ	;ЪБЭЙФБ ПФ РЕТЕРПМОЕОЙС
		MOV	M,A	
		JMP	COJ0	
COQ:		MOV	M,B	
		MOV	A,C	;ЮЙУМП УЛПРЙТПЧБООЩИ УЙНЧПМПЧ
		POP	H
		POP	D
		POP	B
		RET
;////////////////////
DECX:		PUSH	B	
		PUSH	D	
		PUSH	H	
		PUSH	PSW	
		LXI	H,CURHX	
		XRA	A	
		ORA	M	
		JZ	JINQ	
		DCR	M	
		LXI	B,9999H	
		JMP	JXINM	
;////////////////////
INCX:		PUSH	B	
		PUSH	D	
		PUSH	H	
		PUSH	PSW	
		LXI	H,CURHX	
		INR	M	
		JNZ	JXIN0	
		DCR	M	
		JMP	JINQ	
JXIN0:		LXI	B,100H	
JXINM:		INX	H	
		INX	H	
		MOV	A,M	
		ADD	B	
		DAA		
		MOV	M,A	
		DCX	H	
		MOV	A,M	
		ADC	C	
		DAA		
		MOV	M,A	
		MVI	B,1	
		LXI	D,0E0EH	
		CALL	JDES	
		JMP	JINQ	
;//////////////////////
DECY:		PUSH	B	
		PUSH	D	
		PUSH	H	
		PUSH	PSW	
		LHLD	CURHY	
		MOV	A,H	
		ORA	L	
		JZ	JINQ	
		DCX	H	
		SHLD	CURHY	
		LXI	B,9999H	
		JMP	JIN1	
;////////////////////
INCY:		PUSH	B	
		PUSH	D	
		PUSH	H	
		PUSH	PSW	
		LHLD	CURHY	
		INX	H	
		MOV	A,H	
		ORA	L	
		JZ	JINQ	
		SHLD	CURHY	
		LXI	B,100H	
JIN1:		LXI	H,CURDY+2
		MOV	A,M	
		ADD	B	
		DAA		
		MOV	M,A	
		DCX	H	
		MOV	A,M	
		ADC	C	
		DAA		
		MOV	M,A	
		DCX	H	
		MOV	A,M	
		ADC	C	
		DAA		
		MOV	M,A	
JMAI:		MVI	B,2	
		LXI	D,80EH	
		CALL	JDES	
JINQ:		POP	PSW	
		POP	H	
		POP	D	
		POP	B	
		RET		
;#################### ЧУРПНПЗБФЕМШОЩЕ РТПГЕДХТЩ ###################
;$$$$$$$$$$$$ CLEAR 3 BYTE $$$$$$$$$
CLEAR3:		MVI	D,3
CL00:		MVI	M,0
		DCX	H
		DCR	D
		JNZ	CL00
		INX	H
		RET
;$$$$$$$$$$$$ ESC F4 $$$$$$$$$$$$
ESCF4:		LXI	B,F4ESC
		JMP	YESDOP
;$$$$$$$$$$$$ YES NO $$$$$$$$$$$$
YESNO:		LXI	B,PPAYESNO
YESDOP:		CALL	HLDEWIND
		INR	D
		DCR	E
		CALL	WRITE
		RET
;$$$$$$$$$$$$ WRITE $$$$$$$$$$$$$
WRITE:		LDAX	B
		ORA	A
		INX	B
		RZ
		CALL	PUTCXY
		INR	D
		JMP	WRITE
;$$$$$$$$$$$$ KEYDELAY $$$$$$$$$$
KEYDELAU:	CALL	INKEY
		INR	A
		JZ	KEYDELAU
		DCR	A
		RET
;$$$$$$$$$$ CLS.ASM 30.09.1992 $$$$$$$$$$
SCREENCLS:	IN	3
		MOV	L,A
		LXI	B,0
SCRECLS0:	MVI	H,0A0H
SCRECLS:	MOV	M,B
		INR	H
		MOV	A,H
		CPI	0E0H
		JNZ	SCRECLS
		MOV	A,L
		DCR	L
		OUT	3
		INR	C
		JNZ	SCRECLS0
		RET

;$$$$$$$$$$$$$$$$$$
;РТПГЕДХТЩ SINC Й SDEC РПТФСФ ЧУЕ ТЕЗЙУФТБ ЛТПНЕ BC
;ТЕЪХМШФБФ:    
;SINC ->  ЛПОЕГ ФЕЛУФБ ФП "Z=1"
;SDEC ->  ОБЮБМП ФЕЛУФБ ФП "C=0"

SINC:		LHLD	POS	
		MVI	E,CR	
SI1:		MOV	A,M	
		INX	H	
		CMP	E	
		JNZ	SI1	
		INX	H
		MOV	A,M	
		CPI	STOPBYTE
		RZ
SSM:		SHLD	POS	
		RET		

;//////////////
SDEC:		LHLD	POS	
		MVI	E,CR
		DCX	H
		DCX	H	
SD1:		DCX	H	
		MOV	A,M	
		CMP	E	
		JNZ	SD1	
		INX	H	
		LXI	D, -BTEXT	;ОБЮБМП ФЕЛУФБ Ч ДПРПМОЙФ ЛПДЕ
		XCHG		
		DAD	D	
		XCHG		
		INX	H
		JC	SSM	
		RET		
;%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
;   22.10.1992 ВМПЛ ДБООЩИ
;
;(((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((
;РТПГЕДХТБ JBEG Й ДБООЩЕ ЧЩДЕМЕОЩЕ НОПЗПУЛПВЙЕН ОХЦОЩ ФПМШЛП ОБ ОБЮБМКОПН
;ЪБРХУЛЕ ТЕДБЛФПТБ РПУМЕ ЮЕЗП ПОЙ НПЗХФ ВЩФШ ЪБФЕТФЩ
;ПВЭЙК ПВ'ЕН ОЕОХЦОЩИ ВБКФ: 167H
;РПЕФПНХ ОБ ЬФП НЕУФП ХУФБОБЧМЙЧБЕФУС ВХЖЕТ УФТПЛЙ "STR"

;+---------[ BEGIN ]--------+
		DB	CR	;STOP STOP STOP STOP
STR:		
COPY_RIGHT:
		DB	"(C) 1993 KARAGANDA PRESENT BY PIMENOV PAVEL"
		DB	CR,LF,9," PPA TEXT EDITOR V1.02"
		DB	CR,LF,CR,LF,'$'
ER_ARG:		DB	"ERROR",CR,LF,'$'
;;
;; мПЦОБС ОЕ ЪБЛПДЙТПЧБООБС УФТПЛБ
;;
;;ЛБТБЗБОДБ-1992
;;	DB	32,0EBH,0C1H,0D2H,0C1H,0C7H,0C6H,0CEH
;;	DB	0C4H,0C1H,',1993',32
;;PPA-EDITOR
;;	DB	32,0BDH,0BEH,0BFH,32,'PPA-Editor',32
;;
VERSION:	DB	6,7,' Version 1.02 ',7,8,CR
POD1:		DB	6,7,' 00000/000 ',7,8,CR
		DB	6,7,' Edit ',7,8,CR
		DB	6,7,' *:noname  .txt ',7,8,CR
		DB	15,' 1-Help ',15,' 2-File ',15,' 3-Goto '
		DB	15,'4-Search',15,'5-Servis',15,' 6-Info '
		DB	15,' 7-Quit ',18,CR
		DB	'Message:',CR
		DB	6,7,7,8,CR

;;JCOL:		DB	80,82,84,86,88,92,240,242,244,246,248,252,254,0F8H

JBEG:		LXI	H,MEMU
		MVI	D,20H
		LXI	B,400H
EMGLS:		MOV	M,D
		INX	H
		DCX	B
		MOV	A,B
		ORA	C
		JNZ	EMGLS
		LXI	D,102H	
		LXI	H,3E0FH
		CALL	BORT	
		DCR	L	
		CALL	BORT	
		MVI	D,3	
		DCR	L	
		MVI	B,33
		CALL	PAR1	
		XCHG		
		MVI	B,11	
		CALL	STL2	
		MVI	A,9CH	
		LXI	D,10EH
		CALL	PUTCXY	
		MVI	D,3EH	
		MVI	A,89H	
		CALL	PUTCXY	
		LXI	D,2802H
		LXI	B,VERSION
		CALL	WPUTS1
		INX	B
		LXI	D,50EH	
		CALL	WPUTS1	
		INX	B	
		MVI	D,18H	
		CALL	WPUTS1	
		MVI	D,26H	
		INX	B	
		CALL	WPUTS1	
		INX	B	
		MVI	A,0F8H		; ъБЦЗЕН ЙЪПВТБЦ.
		STA	COLOR+1		;
		XRA	A		;
		STA	FLAGC		;
		LXI	H,3F0FH	
		SHLD	WIND2	
		LXI	H,0	
		SHLD	WIND1	
		MOV	D,H	
		MOV	E,L	
		CALL	INFO	
		INX	B	
		PUSH	B	
		LXI	D,50FH	
		CALL	WPUTS1	
		POP	B	
		MVI	D,36H	
		CALL	WPUTS1	
		LXI	H,AVT0	
		PUSH	H	
		LXI	H,AVT+15
		LXI	B,1210H	
BL8:		LXI	D,70FH	
		CALL	SPPAR	
		MOV	A,M	
		INR	A	
		CALL	PUTCXY	
		DCX	H	
		XTHL		
		MVI	D,25H	
		CALL	SPPAL	
		MOV	A,M	
		INR	A	
		MVI	D,37H	
		CALL	PUTCXY	
		INX	H	
		XTHL		
		DCR	C	
		JNZ	BL8	
		POP	H	
		LXI	H,203H	
		SHLD	WIND1	
		LXI	H,3D0DH	
		SHLD	WIND2	
		RET		

;ЛБТБЗБОДБ-1992
AVT:	DB	31,0EAH,0C0H,0D1H,0C0H,0C6H,0C0H,0CDH
	DB	0C3H,0C0H,',0882',31
;+-------[ INVERS ]-----+
;* ЙОЧЕТФЙТХЕФ ЬЛТБО ПФ *
;* (HL) -ЧЩУПФБ:(D)	*
;* 	-ЫЙТЙОБ:(Е)	*
;+----------------------+
INV:		PUSH	B	
		MOV	B,D	
		MOV	C,E	
		CALL	IV2	
		MOV	A,H	
		ADI	20H	
		MOV	H,A	
		CALL	IV2	
		POP	B	
		RET		
IV2:		PUSH	H	
IV1:		PUSH	H	
IV0:		MOV	A,M	
		CMA		
		MOV	M,A	
		INR	L	
		DCR	E	
		JNZ	IV0	
		POP	H	
		MOV	E,C	
		INR	H	
		DCR	D	
		JNZ	IV1	
		MOV	D,B	
		POP	H	
		RET		

;$$$$$$$$$$$$$$$$  УФБТФПЧЩК ВМПЛ $$$$$$$$$$$$
PPASTART:

;;
;;   пРЙУБОЙЕ ТБВПФЩ У  РБТБНЕФТБНЙ РЕТЕДПЧБЕНЩНЙ РТПЗТБННЕ
;; Ч РТПГЕУУЕ ЕЕ БЛФЙЧЙЪБГЙЙ:
;; 1) ч РПМЕ (0080H)  ОБИПДЙФУС  ЮЙУМП ХЛБЪЩЧБАЭЕЕ ОБ ДМЙОХ
;;    УФТПЛЙ ЧЧЕДЕООПК УТБЪХ РПУМЕ ЙНЕОЙ РПТПЦДБЕНПЗП  РТП-
;;    ГЕУУБ (ЧЛМАЮБС РТПВЕМ НЕЦДХ ЙНЕОЕН Й РБТБНЕФТБНЙ),  Ч
;;    ПУФБМШОПН РТПЗТБННБ ДПМЦОБ БОБМЙЪЙТПЧБФШ  ЬФХ  УФТПЛХ
;;    ЛБЛ  УФТПЛХ РБТБНЕФТПЧ РЕТЕДБООЩИ  РТПЗТБННЕ  ( ЙНЕОБ 
;;    ЖБКМПЧ РПУМЕДПЧБФЕМШОПУФШ ПРГЙК Й ДТ.) УФТПЛБ УМЕДХЕФ
;;    ПФ БДТЕУБ 0081H.
;;
;; 2) Ч РПМЕ 5CH - ОБЦПДЙФУС ТБУВТПУБООБС РП ЮБУФСН ( FCB )
;;    ХЛБЪБООПЗП ЖБКМБ Ч ЛБЮЕУФЧЕ РБТБНЕФТБ.
;;


;;
;; чЩЧЕДЕН УППВЭЕОЙЕ ХЧЕДПНМСАЭЕЕ ПВ БЧФПТУЛПН РТБЧЕ
;;

;;
;;    рЕТЕИПДЙН ОБ БОБМЙЪ РБТБНЕФТПЧ РПУФХРЙЧЫЙИ
;; РТЙ ЪБРХУЛЕ ТЕДБЛФПТБ.
;;
		LXI	D,COPY_RIGHT	;
		MVI	C,9		;
		CALL	SYS_MDOS	;
;;
;;   пУХЭЕУФЧМСЕН ЛПОФТПМШ ЛПОФТПМШОПК УХННЩ ЖБКМБ
;;
		LXI	H,100H		;
		BH_MOV			;
		LXI	D,(BTEXT-7FH) AND 0FFFEH ;
PPA_S_10:
		MOV	A,M		;
		ADD	B		;
		MOV	B,A		;
		INX	H		;
		MOV	A,M		;
		SUB	C		;
		MOV	C,A		;
		INX	H		;
		DCX	D		;
		DCX	D		;
		MOV	A,D		;
		ORA	E		;
		JNZ	PPA_S_10	;
		PUSH	B		;
		POP	H		;
		NOP			;
		NOP			;
		NOP			;
		SHLD	K_SUMMA		;
		LXI	H,80H		;
		MOV	A,M		; РТПЮЙФБЕН ТБЪНЕТ
		CPI	16		; ВХЖЕТБ УФТПЛЙ
		JC	PPA_2_START	; УТБЧОЙН У НБЛУЙНХНПН
;;
;;   пВТБВПФБЕН ЧБТЙБОФ ЛПЗДБ ЖПТНБФ РТЕЧЩЫБЕФ 16 УЙНЧПМПЧ
;;
		LXI	D,ER_ARG	;
		MVI	C,9		;
		CALL	SYS_MDOS	;
		RET			;
PPA_2_START:
		DI
		LHLD	39H
		SHLD	KEYVEKT		;УПИТБОСЕН ЧЕЛФПТ РТЕТЩЧБОЙС
		LXI	SP,STACKSEG	;
		XRA	A		;
		OUT	10H		;
		CALL	SCREENCLS	;
		EI			;
		LXI	H,KEY_INT	;
		SHLD	0039H		;
		CALL	JBEG		;
;;
;;    бОБМЙЪЙТХЕН ЮЙУМП УЙНЧПМПЧ РПУФХРЙЧЫЙИ РТЙ
;; РПТПЦДЕОЙЙ РТПГЕУУБ
;;
		LXI	H,80H		;
		MOV	A,M		;
		CPI	2		;
		JC	EDITING		;
		MOV	E,A		;
		INR	E		;
		MVI	D,0		;
		DAD	D		;
		MVI	M,CR		;

		LXI	H,82H		;
		CALL	COPYSDOP	;
		LXI	H,F_FILE0	;
		CALL	F_DROB_FILE	;
		JNZ	EDITING		; оЕЛПТЕЛФОПЕ ЙНС ЖБКМБ

		MVI	B,15		; рТПЙЪЧПДЙН РЕТЕОПУ
		LXI	H,STR		; ФЕЛУФПЧПК УФТПЛЙ ЧП ЧТЕНЕ-
		LXI	D,F_F_ASCII	; ООЩК ВХЖЕТ ДМС РПУМЕДХАЭЕЗП
		CALL	LIIR		; ЙУРПМШЪПЧБОЙС
;;
;; рЕТЕИПДЙН Л ПФЛТЩФЙА ЖБКМБ
;;
		MVI	A,KD_CONST	;
		OUT	10H		;
		LXI	D,F_FILE0	;
		INT	_OPENC		; рЩФБЕНУС ПФЛТЩФШ ЪБДБООЩК ЖБКМ
		INR	A		; ЕУМЙ ОЕ РПМХЮЙМПУШ ОБ РПЧФПТОЩК
;;
;;   ьФБ "УФТБООБС" РПУМЕДПЧБФЕМШОПУФШ ОЕПВИПДЙНБ
;; ДМС ФПЗП ЮФПВЩ ПУХЭЕУФЧЙФШ РТБЧЙМШОЩК ЧПЪЧТБФ
;; ЙЪ РТПГЕДХТЩ: F_L_DOP (ПОБ РТПРХУЛБЕФ УМПЧП Ч
;; БРБТБФОПН УФЕЛЕ)
;;
		LXI	H,ED_00_RETURN	;
		PUSH	H		;
		JZ	ED_RETURN	;
		CALL	F_L_DOP		;
ED_00_RETURN:
		ORI	1		;
		PUSH	H		;
ED_RETURN:
		POP	H		;
		MVI	A,0		; XRA A  --->> оемшъс
		OUT	10H		;
		LXI	H,F_FILE0	;
		CZ	F_L_NAME	;		
		MVI	D,STOPBYTE	;
		LXI	H,BTEXT+2	;
		MOV	A,M		;
		CMP	D		;ЕУМЙ ЖБКМ РХУФПК УДЕМБФШ 1 РХУФХА
		JNZ	SET_END		;УФТПЛХ
		MVI	M,CR		;
		INX	H		;
		MVI	M,LF		;
		INX	H		;
		MOV	M,D		;
		DCX	H		;
		DCX	H		;
SET_END:				;
CONOOP0:	MOV	A,M		;
		INX	H		;
		CMP	D		;
		JNZ	CONOOP0		;
		DCX	H		;
		SHLD	ENDTEXT		;
		JMP	EDITING		;
;+-------[ INFO ]-------+
;* ЧЩДБЕФ 'РПДЧБМ'	*
;+----------------------+
INFO:		CALL	WPUTS1	
		INR	E
		MVI	D,1	
		INX	B	
		CALL	WPUTS1	
		LXI	H,0A002H
		LXI	D,200CH	
		CALL	INV	
		RET		
;PPA-EDITOR
AVT0:		DB	31,0BCH,0BDH,0BEH,31,'OO@,Dchsnq',31
;+------[ SPPAR ]-------+
;* УДЧЙЗБЕФ ПФ (DE) (B)	*
;* ЬМЕН. УФТПЛЙ Ч РТБЧП *
;+----------------------+
SPPAR:		PUSH	D	
		PUSH	B	
		PUSH	PSW	
		MOV	A,D	
		ADD	B	
		DCR	A	
		MOV	D,A	
SP0:		DCR	D	
		CALL	GETCXY	
		INR	D	
		CALL	PUTCXY	
		DCR	D	
		DCR	B	
		JNZ	SP0	
		POP	PSW	
		POP	B	
		POP	D	
		RET		
;+-----[ SPPAL ]--------+
SPPAL:		PUSH	D	
		PUSH	B	
		PUSH	PSW	
SL0:		INR	D	
		CALL	GETCXY	
		DCR	D	
		CALL	PUTCXY	
		INR	D	
		DCR	B	
		JNZ	SL0	
		POP	PSW	
		POP	B	
		POP	D	
		RET		
;)))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))
	END
H		;
		SHLD	ENDTEXT		;
		JMP	EDITING		;
;+-------[ INFO ]-------+
;* ЧЩДБЕФ 'РПДЧБМ'	*
;+----------------------+
INFO:		CALL	WPUTS1	
		INR	E
		MVI	D,1	
		INX	B	
		CALL	WPUTS1	
		LXI	H,0A002H
		LXI	D,200CH	
		CALL	INV	
		RET		
;PPA-EDITOR
AVT0:		DB	31,0BCH,0BDH,0BEH,31,'OO@,Dchsnq',31
;+------[ SPPAR ]-------+
;* УДЧЙЗБЕФ ПФ (DE) (B)	*
;* ЬМЕН. УФТПЛЙ Ч РТБЧП *
;+----------------------+
SPPAR:		PUSH	D	
		PUSH	B	
		PUSH	PSW	
		MOV	A,D	
		ADD	B	
		DCR	A	
		MOV	D,A	
SP0:		DCR	D	
		CALL	GETCXY	
		INR	D	
		CALL	PUTCXY	
		DCR	D	
		DCR	B	
		JNZ	SP0	
		POP	PSW	
		POP	B	
		POP	D	
		RET		
;+-----[ SPPAL ]--------+
SPPAL:		PUSH	D	
		PUSH	B	
		PUSH	PSW	
SL0:		INR	D	
		CALL	GETCXY	
		DCR	D	
		CALL	PUTCXY	
		INR	D	
		DCR	B	
		JNZ	SL0	
		POP	PSW	
		POP	B	
		POP	D	
		RET		
;))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))ееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееее	Title	KEY.ASM
;;////////////////////////////////////////////////////////
;;	рБЛЕФ РПДРТПЗТБНН ДМС ПВТБВПФЛЙ ЧОЕЫОЙИ ЧПЪНХ-
;; ЭЕОЙК (ОБЦБФЙС ЛМБЧЙЫ).
;;/////////////////////////////// 2.5.1993 ///////////////
	Include	MAIN.PPA

;;	Include	MACRO.PPA
;;	Include	EXT.PPA
;;	Include	EQU.PPA
;;	Include	DDR.PPA

;;________________________________
	External POSITION	;
	External BUF_OF_VECTOR	;
	External DE_MODE	;
	External MODE_NIBL	;
	External HEAD		;
	External CULINDER	;
	External SECTOR		;
	External FATAL		;

;;______________________________
	External RE_PRINT_POS	;
	External RE_DISK_POS	;
	External LINE_TEXT	;
	External LINE_HEX	;
	External DUMP_HEX	;
	External DUMP_TEXT	;
	External LOAD_OFFSET	;
	External NEW_DUMP	;
	External W_PUTSXY_Z	;
	External W_PUT_HEX	;
	External PUT_CHAR	;
	External PUT_HEX	;
	External PUT_NIBL	;
	External INV_LINE	;
	External KEY_DELAY	;
	External VER_STREL	;
	External SCREEN_CLS	;
;;______________________________
	Public	US_GOTO		;
	Public	US_QUIT		;
	Public	US_HELP		;
	Public	STR_KEY		;
	Public	CC_RIGHT_KEY	;
	Public	RIGHT_KEY	;
	Public	HOME_KEY	;
	Public	CC_LEFT_KEY	;
	Public	LEFT_KEY	;
	Public	F3_KEY		;
	Public	DOWN_KEY	;
	Public	UP_KEY		;
	Public	CC_DOWN_KEY	;
	Public	CC_UP_KEY	;
	Public	Y_N_WRITE	;
	Public	DA_NET		;
	Public	PTR_SET		;
	Public	PAINT_SCREEN	;
	Public	MENU		;

	Public	DISK_MASKA	;
	Public	SET_CULIND	;
	Public	DISK_READ	;
	Public	DISK_INC	;
	Public	PUSK		;
	Public	DISK_COMMAND	;

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;; пВТБВПФБЕН ЧЩВПТ ТЕДБЛФЙТПЧЙОЙС ГЧЕФБ РБМЙФТЩ ЬЛТБОБ	;;
;; ДМС  ЬФПЗП  ДПРПМОЙФЕМШОП  ПФЛТПЕН ПЛОП Й РТЙ РПНПЭЙ	;;
;; ЛМБЧЙЫ  ХРТБЧМЕОЙС  ЛХТУПТПН   РТПЙЪЧЕДЕН   ЛПТЕЛГЙА	;;
;; СЮЕКЛЙ  COLOR ЙЪ ВМПЛБ ТБВПЮЙИ СЮЕЕЛ ДТБКЧЕТБ ЛМБЧЙ-	;;
;; БФХТЩ.						;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
PAINT_SCREEN:
	LXI	D,1207H		;
	LXI	H,3008H		;
	MVI	A,00010110b	;
	CALL	ACTIV		;
	LXI	B,SOOB_40	;
	LXI	D,0201h		;
	CALL	W_PUTSXY_Z	;
	DCR	E		;
	CALL	W_PUTSXY_Z	;
	INR	E		;
	DCR	D		;
P_SC_LOOP:
	MVI	A,8		;
	MVI	B,23		;
	CALL	PTR_SET		;
P_SC_LOOP2:
	CALL	RE_COLOR_POS	;
	CALL	KEY_DELAY	;
	CPI	0Eh		; ======= F4 ========
P_SC_EXIT:
	CZ	DEACTI		;
	CZ	DEACTI		;
	RZ			;
	CPI	02h		; ====== Enter =======
	JZ	P_SC_EXIT	;
	LXI	H,P_SC_LOOP2	;
	PUSH	H		;
	CPI	06h		;
	JZ	P_SC_RIGHT	; ====== RIGHT =======
	CPI	04h		;
	JZ	P_SC_LEFT	; ====== LEFT ========
	LXI	H,P_SC_LOOP	;
	XTHL			;
	CPI	07h		;
	JZ	P_SC_DOWN	; ====== DOWN  =======
	CPI	05h		;
	JZ	P_SC_UP		; ====== UP ==========
	RET			;

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;	  вМПЛ ПВТБВПФЛЙ ОБЦБФЙС ЛМБЧЙЫЙ "чойъ"		;;
P_SC_DOWN:
	XRA	A		;
	CALL	PTR_SET		;
	MOV	A,E		;
	ORA	A		;
	RZ			;
	DCR	E		;
	RET			;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;	  ВМПЛ ПВТБВПФЛЙ ОБЦБФЙС ЛМБЧЙЫЙ "ччети"	;;
P_SC_UP:
	XRA	A		;
	CALL	PTR_SET		;
	MOV	A,E		;
	DCR	A		;
	RZ			;
	INR	E		;
	RET			;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;	вМПЛ ПВТБВПФЛЙ ХНЕОШЫЕОЙС ГЧЕФБ			;;
P_SC_LEFT:
	LHLD	COLOR		;
	MOV	A,E		;
	DCR	H		;
	ORA	A		;
	JNZ	P_S_L_DONE	;
	DCR	L		;
	INR	H		;
P_S_L_DONE:
	SHLD	COLOR		;
	XRA	A		;
	STA	FLAGC		;
	RET			;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;	вМПЛ ПВТБВПФЛЙ ХЧЕМЙЮЕОЙС ГЧЕФБ			;;
P_SC_RIGHT:
	LHLD	COLOR		;
	MOV	A,E		;
	INR	H		;
	ORA	A		;
	JNZ	P_S_L_DONE	;
	INR	L		;
	DCR	H		;
	JMP	P_S_L_DONE	;

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;	рТПГЕДХТБ ПУХЭЕУФЧМСЕФ РПЛБЪ ФЕЛХЭЕЗП УПУФПСОЙС	;;
;; СЮЕКЛЙ "color"					;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
RE_COLOR_POS:
	PUSH	D		;
	LXI	D,1A01h		;
	LHLD	COLOR		;
	MOV	A,H		;
	CALL	W_PUT_HEX	;
	DCR	E		;
	MOV	A,L		;
	DCR	D		;
	DCR	D		;
	CALL	PUT_HEX		;
	POP	D		;
	RET			;

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;; рТПГЕДХТБ MENU ПВЕУРЕЮЙЧБЕФ УПЪДБОЙЕ Ч ФЕЛХЭЕН ПЛОЕ	;;
;; НЕОА  РПУТЕДУФЧПН  РЕТЕНЕЭЕОЙС ЙОЧЕТУОПК РПМПУЛЙ РП	;;
;; ЧУЕНХ ПЛОХ. рТПГЕДХТБ  ОЕ ЙНЕЕФ ЪБЭЙФЩ  ПФ УЙФХБГЙЙ:	;;
;; Ч ПЛОЕ ОЕ РПНЕЭБЕФУС ВПМЕЕ ДЧХИ БМШФЕТОБФЙЧОЩИ УФТПЛ	;;
;; ( НЕОА ЧЕТФЙЛБМШОПЕ ) Й ДТХЗЙИ ОЕ ЛПТЕЛФОЩИ ЧЩЪПЧПЧ.	;;
;; чИПДОЩЕ ДБООЩЕ: ОЕФ					;;
;; чЩИПДОЩЕ ДБООЩЕ:					;;
;; A -	ЧПЪЧТБЭБЕФУС РПЪЙГЙС Ч ЛПФПТПК РТПЙЪПЫМП	;;
;;	ОБЦБФЙЕ ЛМБЧЙЫЙ "чл" ЕУМЙ ВЩМБ ОБЦБФБ ЛМБ-	;;
;;	ЧЙЫБ "F4" ФП Ч б ЧПЪЧТБЭБЕФУС "00EH"		;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

MENU:
	CALL	HL_DE_WIND	; ЮЙФБЕН ЛППТДЙОБФЩ ПЛОБ
	CALL	HL_SUB_DE	; ЧЩЮЙУМСЕН ТБЪНЕТЩ ПЛОБ
	XCHG			; ТБУРТЕДЕМСЕН ТЕЗЙУФТЩ
	DCR	B		;
	DCR	B		;
	INR	D		;
	MOV	H,B		;
	MOV	B,C		;
	CALL	VER_STREL	;
	MOV	B,H		;
	DCR	C		;
	MOV	E,C		; чЩУПФБ ПЛОБ.
	MVI	D,1		;
M_KEY_LOOP:			;
	CALL	INV_LINE	; ЙОЧЕТФЙТЕХН УФТПЛХ
	CALL	KEY_DELAY	; ПЦЙДБЕН ОБЦБФЙС
	CALL	INV_LINE	; ЗБУЙН ХЛБЪБФЕМШ
	LXI	H,M_KEY_LOOP	;
	PUSH	H		;
	CPI	05H		; ЛМБЧЙЫБ ЧЧЕТИ
	JZ	M_UP		;
	CPI	07H		; ЛМБЧЙЫБ ЧОЙЪ
	JZ	M_DOWN		;
	CPI	02H		; "BK"
	JZ	M_EXIT		;
	CPI	0EH		; "F4"
	JZ	M_EXIT2		;
	RET			;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;; РТПГЕДХТБ ПВТБВПФЛЙ ОБЦБФЙС ЛМБЧЙЫЙ ЧЧЕТИ		;;
M_UP:
	MOV	A,E		;
	INR	E		;
	CMP	C		;
	RC			;
	DCR	E		;
	RET			;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;	 РТПГЕДХТБ ПВТБВПФЛЙ ОБЦБФЙС ЛМБЧЙЫЙ ЧОЙЪ	;;
M_DOWN:
	MOV	A,E		;
	DCR	E		;
	ORA	A		;
	RNZ			;
	INR	E		;
	RET			;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
M_EXIT:
	MOV	A,E		;
M_EXIT2:			;
	POP	H		; ЪБВЙТБЕН УМПЧП ЙЪ УФЕЛБ
	RET			;

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;==================== US + Help =======================;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;	рТПГЕДХТБ ПУХЭЕУФЧМСЕФ ЧЩЧПД РПДУЛБЪЛЙ
;; Ч ТБВПЮЕЕ ПЛОП ТЕДБЛФПТБ У РПУМЕДХАЭЕК РЕТЕ-
;; ТЙУПЧЛПК ТЕДБЛФЙТХЕНПК ЙОЖПТНБГЙЙ.
;;
US_HELP:
	LXI	D,0B05h		;
	LXI	H,3B0Ch		;
	PUSH	H		;
	PUSH	D		;
	CALL	CLS		;
	LXI	D,0707h		;
	LXI	B,SOOB_HLP	;
U_H_00:
	CALL	W_PUTSXY_Z	;
	DCR	E		;
	MOV	A,E		;
	INR	A		;
	JNZ	U_H_00		;
	CALL	KEY_DELAY	;
	POP	D		;
	POP	H		;
	CALL	CLS		;
	CALL	RE_DISK_POS	;
	RET			;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;=================== US + 7 - QUIT ====================;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;	рТПГЕДХТБ ПУХЭЕУФЧМСЕФ ЧЩИПД ЙЪ ТЕДБЛФПТБ.
;;
US_QUIT:
	CALL	Y_N_EXIT	;
	RZ			;
	CALL	SCREEN_CLS	;
	MVI	A,KD_CONST	;
	OUT	10h		;
	LHLD	BUF_OF_VECTOR	;
	SHLD	0039h		;
	INT	00h		;

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;==================== US + 3 - GoTo ===================;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;	рТПГЕДХТБ ПУХЭЕУФЧМСЕФ РЕТЕИПД Л  МАВПНХ ДТХЗПНХ
;; ЖЙЪЙЮЕУЛПНХ НЕУФХ ДЙУЛПЧПЗП РТПУФТБОУФЧБ  РП  УТЕДУФ-
;; ДУФЧПН ДЙБМПЗПЧПЗП ЧУРМЩЧБАЭЕЗП ПЛОБ.
;;
US_GOTO:
	LXI	D,0C09h		;
	LXI	H,2A0Bh		;
	MVI	A,00010101b	;
	CALL	ACTIV		;
	LXI	D,2B0Bh		;
	MVI	B,3		;
	CALL	VER_STREL	;
	LXI	D,0102h		;
	LXI	B,SOOB_10	;
	CALL	W_PUTSXY_Z	;
	DCR	E		;
	CALL	W_PUTSXY_Z	;
	DCR	E		;
	CALL	W_PUTSXY_Z	;
	CALL	Y_N_WRITE	;
	LXI	D,0002h		;
	MVI	A,8		;
	CALL	R_S_PTR_GOTO	; ХУФБОПЧЙН ХЛБЪБФЕМШ
U_G_LOOP:
	CALL	RE_GOTO_POS	;
	CALL	KEY_DELAY	;
	CPI	02h		;
	JZ	U_G_EXIT	;
	LXI	H,U_G_LOOP	;
	PUSH	H		;
	CPI	05h		;
	JZ	U_G_UP		;
	CPI	07h		;
	JZ	U_G_DOWN	;
	CPI	04h		;
	JZ	U_G_LEFT	;
	CPI	06h		;
	RNZ			;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;; вМПЛ ПВТБВПФЛЙ ОБЦБФЙС чртбчп
U_G_RIGHT:
	MOV	A,E		;
	ORA	A		;
	JZ	U_G_RL_HEAD	; ЛПТТЕЛГЙС УФПТПОЩ.
	DCR	A		;
	JZ	U_G_R_SECTOR	; ЛПТТЕЛГЙС УЕЛФПТБ.
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;; вМПЛ ПВТБВПФЛЙ ХЧЕМЙЮЕОЙС ОПНЕТБ ДПТПЦЛЙ.		;;
	LDA	CULINDER	;
	INR	A		;
	CPI	80		;
	JC	U_G_R_CUL_00	;
	XRA	A		;
U_G_R_CUL_00:			;
	STA	CULINDER	;
	RET			;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;; вМПЛ ПВТБВПФЛЙ ХЧЕМЙЮЕОЙС УЕЛФПТБ.			;;
U_G_R_SECTOR:
	LDA	SECTOR		;
	INR	A		;
	CPI	6		;
	JC	U_G_R_SEC_00	;
	MVI	A,1		;
U_G_R_SEC_00:
	STA	SECTOR		;
	RET			;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;; вМПЛ ПВТБВПФЛЙ ХЧЕМЙЮЕОЙС УФПТПОЩ.			;;
U_G_RL_HEAD:
	LDA	HEAD		;
	XRI	00000100b	;
	STA	HEAD		;
	RET			;
	RET			;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;; вМПЛ ПВТБВПФЛЙ ОБЦБФЙС чмечп
U_G_LEFT:
	MOV	A,E		;
	ORA	E		;
	JZ	U_G_RL_HEAD	;
	DCR	A		;
	JZ	U_G_L_SECTOR	;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;; вМПЛ ПВТБВПФЛЙ ХНЕОШЫЕОЙС ОПНЕТБ ГЙМЙОДТБ.		;;
	LDA	CULINDER	;
	ORA	A		;
	JNZ	U_G_L_CUL_00	;
	MVI	A,80		;
U_G_L_CUL_00:
	DCR	A		;
	STA	CULINDER	;
	RET			;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;; вМПЛ ПВТБВПФЛЙ ХНЕОШЫЕОЙС УЕЛФПТБ.			;;
U_G_L_SECTOR:
	LDA	SECTOR		;
	DCR	A		;
	JNZ	U_G_L_SEC_00	;
	MVI	A,5		;
U_G_L_SEC_00:
	STA	SECTOR		;
	RET			;

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;; вМПЛ ПВТБВПФЛЙ ОБЦБФЙС  чойъ
U_G_DOWN:
	DCR	E		;
	INR	E		;
	RZ			; == U_G_LOOP
	XRA	A		;
	CALL	R_S_PTR_GOTO	; УВТПУЙН ХЛБЪБФЕМШ.
	DCR	E		;
	MVI	A,8		;
	CALL	R_S_PTR_GOTO	; ХУФБОПЧЙН ХЛБЪБФЕМШ
	RET			; == U_G_LOOP	;

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;; вМПЛ ПВТБВПФЛЙ ОБЦБФЙС ччети
U_G_UP:
	MOV	A,E		;
	CPI	2		;
	RNC			;
	XRA	A		;
	CALL	R_S_PTR_GOTO	;
	INR	E		;
	MVI	A,8		;
	CALL	R_S_PTR_GOTO	;
	RET			;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
U_G_EXIT:
	DI			;
	LDA	CULINDER	;
	CALL	SET_CULIND	;
	CALL	DISK_READ	;
	EI			;
	CALL	DEACTI		;
	CALL	RE_DISK_POS	;
	RET			;

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;	рТПГЕДХТБ ЖПТНЙТПЧБОЙС УРЙУЛБ ЗМПВБМШОЩИ РЕТЕН.	;;
;; Ч ПЛОЕ РЕТЕИПДБ Л ДТХЗПНХ УЕЛФПТХ.			;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
RE_GOTO_POS:
	PUSH	D		;
	LXI	D,0C02h		;
	CALL	ABS_DE		;
	LDA	CULINDER	;
	CALL	PUT_HEX		;
	DCR	E		;
	DCR	D		;
	DCR	D		;
	LDA	SECTOR		;
	CALL	PUT_NIBL	;
	DCR	E		;
	DCR	D		;
	LDA	HEAD		;
	RRC			;
	RRC			;
	XRI	00000001b	;
	CALL	PUT_NIBL	;
	POP	D		;
	RET			;

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;	рТПГЕДХТБ УВТПУБ/ХУФБОПЧЛЙ ХЛБЪБФЕМС.		;;
;;	A = 8 -   хуфбопчлб уфтемлй.			;;
;;	б = 20h - увтпу уфтемлй.			;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
R_S_PTR_GOTO:
	MVI	B,9		; УРЕГЙБМЙОП ДМС "Goto".
PTR_SET:			; ХОЙЧЕТУБМШОЩК ЧИПД.
	PUSH	D		; B - дМЙОБ ХЛБЪБФЕМС.
	PUSH	B		;
	CALL	INV_LINE	;
	POP	B		;
	MOV	D,B		;
	CALL	ABS_DE		;
	CALL	PUTCXY		;
	POP	D		;
	RET			;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;	рТПГЕДХТЛБ РЕТЕЛМАЮЕОЙС ЗПМПЧЛЙ ОБЛПРЙФЕМС	;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
CASE_HEAD:
	LDA	HEAD		;
	XRI	00000100b	;
	STA	HEAD		;
	RET			;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;		рТПГЕДХТБ ПВТБВПФЛЙ уу + чети		;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
CC_UP_KEY:
	LXI	H,BUF_DISK	;
	SHLD	POSITION	;
	LXI	H,0807h		;
	SHLD	CURSOR		;
	CALL	UP_KEY		;
	RET			;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;	рТПГЕДХТБ ПВТБВПФЛЙ ОБЦБФЙС ЛМБЧЙЫЙ "ччети"	;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
UP_KEY:
	LHLD	CURSOR		;
	MOV	A,L		;
	CPI	07h		;
	JNC	U_K_END_WIND	; ЛПОЕГ ПЛОБ.
	INR	L		;
	SHLD	CURSOR		;
	LHLD	POSITION	;
	LXI	D,-16		;
	JMP	DU_EXIT_00	;
U_K_END_WIND:
	CALL	LOAD_OFFSET	;
	MOV	A,H		;
	ORA	A		;
	JNZ	U_K_NO_END_SECTOR;
	MOV	A,L		;
	ANI	11110000b	;
	JNZ	U_K_NO_END_SECTOR;

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;	вМПЛ ПВТБВПФЛЙ ОБЮБМБ УЕЛФПТБ.
U_K_BEG_SECTOR:
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;; рТПЙЪЧЕДЕН ЪБРТПУ ОБ ЪБРЙУШ УЕЛФПТБ
;; Ф.Л. Ч ОЕН НПЗМЙ РТПЙЪПКФЙ ЙЪНЕОЕОЙС.
	CALL	Y_N_WRITE	;
	LDA	SECTOR		;
	DCR	A		;
	STA	SECTOR		;
	JNZ	D_K_DONE_PRINT	;
;; пВТБВПФБФШ "ПЛПОЮБОЙЕ" УЕЛФПТПЧ ОБ ДПТПЦЛЕ.
	MVI	A,5		;
	STA	SECTOR		;
	CALL	CASE_HEAD	; УНЕОЙН ОПНЕТ УФПТПОЩ.
	JNZ	D_K_DONE_PRINT	;
;; ЫБЗОХФШ ПДЙО ТБЪ ( ЕУМЙ НПЦОП )
	LDA	CULINDER	;
	ORA	A		;
	JZ	U_K_EXIT	; чщипд еумй оеф дптпцел.
	DCR	A		;
	STA	CULINDER	;
	DI			;
	CALL	PUSK		;
	MVI	A,01111000b	;
	CALL	DISK_COMMAND	; ыБЗБЕН "ОБЪБД" .
	JMP	D_K_DONE_PRINT	; хИПДЙН ОБ ЮФЕОЙЕ УЕЛФПТБ.
U_K_EXIT:
	MVI	A,5		;
	STA	SECTOR		;
	MVI	A,79		;
	STA	CULINDER	;
	DI			;
	CALL	SET_CULIND	;
	JMP	D_K_DONE_PRINT	;

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
U_K_NO_END_SECTOR:		;
	CALL	SCROL2		;
	LHLD	CURSOR		;
	DCR	L		;
	SHLD	CURSOR		;
	CALL	UP_KEY		;
	LHLD	POSITION	;
	MOV	B,H		;
	MOV	A,L		;
	ANI	11110000b	;
	MOV	C,A		;
	CALL	LOAD_OFFSET	;
	LXI	D,0007h		;
	JMP	DU_PRINT_LINE	;

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;		рТПГЕДХТБ ПВТБВПФЛЙ уу+чойъ		;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
CC_DOWN_KEY:
	LXI	H,BUF_DISK	;
	LXI	D,3FFh		;
	DAD	D		;
	SHLD	POSITION	;
	LXI	H,0800h		;
	SHLD	CURSOR		;
	CALL	DOWN_KEY	;
	RET			;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;	рТПГЕДХТБ ПВТБВПФЛЙ ОБЦБФЙС ЛМБЧЙЫЙ "чойъ"	;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
DOWN_KEY:
	LHLD	CURSOR		;
	MOV	A,L		;
	ORA	A		;
	JZ	D_K_END_WIND	; ЛПОЕГ ПЛОБ.
	DCR	L		;
	SHLD	CURSOR		;
	LHLD	POSITION	;
	LXI	D,16		;
DU_EXIT_00:			; ПВЭЙК ЧЩИПД.
	DAD	D		;
	SHLD	POSITION	;
	CALL	RE_PRINT_POS	;
	RET			;
D_K_END_WIND:			;
	CALL	LOAD_OFFSET	; РПМХЮЙФШ УНЕЭЕОЙЕ.
	MOV	A,H		;
	CPI	03h		;
	JC	D_K_NO_END_SECTOR; ХИПД ЕУМЙ УЕЛФПТ ОЕ 
	MOV	A,L		; ЛПОЮЙМУС.
	ANI	11110000b	;
	CPI	11110000b	;
	JNZ	D_K_NO_END_SECTOR;

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;; вМПЛ ПВТБВПФЛЙ ПЛБОЮБОЙС ФЕЛХЭЕЗП УЕЛФПТБ.
;;
D_K_END_SECTOR:
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;; рТПЙЪЧЕДЕН ЪБРТПУ ОБ ЪБРЙУШ УЕЛФПТБ
;; Ф.Л. Ч ОЕН НПЗМЙ РТПЙЪПКФЙ ЙЪНЕОЕОЙС.
	CALL	Y_N_WRITE	;
	CALL	DISK_INC	; хЧЕМЙЮЙЧБЕН УЕЛФПТ.
	JC	D_K_DONE_PRINT	;
;; пУФБЕНУС ОБ РПУМЕДОЕН УЕЛФПТЕ.

	XRA	A		;
	STA	CULINDER	;
	DI			;
	CALL	SET_CULIND	;
D_K_DONE_PRINT:
	DI			;
	CALL	DISK_READ	;
	EI			;
	LHLD	POSITION	;
	CALL	RE_DISK_POS	;
	RET			;

D_K_NO_END_SECTOR:
	CALL	SCROL1		;
	LHLD	CURSOR		;
	INR	L		;
	SHLD	CURSOR		;
	CALL	DOWN_KEY	;
	LHLD	POSITION	;
	MOV	B,H		;
	MOV	A,L		;
	ANI	11110000b	;
	MOV	C,A		;
	CALL	LOAD_OFFSET	;
	LXI	D,0		;
DU_PRINT_LINE:
	MOV	A,L		;
	ANI	11110000b	;
	MOV	L,A		;
	LDA	DE_MODE		;
	ORA	A		;
	CNZ	LINE_TEXT	;
	CZ	LINE_HEX	;
	CALL	KEY_RESET	;
	RET			;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;	рТПГЕДХТБ ЙОЛТЕНЕОФОПЗП ДЧЙЦЕОЙЕ РП УЕЛФПТБН	;;
;; ФЕЛХЭЕЗП ДЙУЛБ.					;;
;;	еумй б > 80 - пЛПОЮБОЙЕ ДЙУЛБ.			;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
DISK_INC:
	LDA	SECTOR		;
	INR	A		;
	STA	SECTOR		;
	CPI	6h		;
	RC			; C=1
;; пВТБВПФБФШ ПЛПОЮБОЙЕ УЕЛФПТПЧ ОБ ДПТПЦЛЕ.
	MVI	A,1		;
	STA	SECTOR		;
	CALL	CASE_HEAD	; УНЕОЙН ОПНЕТ УФПТПОЩ.
	STC			; C=1
	RZ			;
;; ЫБЗОХФШ ПДЙО ТБЪ ( ЕУМЙ НПЦОП )
	LDA	CULINDER	;
	INR	A		;
	CPI	80		; C!=1
	RNC			; чщипд еумй оеф дптпцел.
	STA	CULINDER	;
	DI			;
	CALL	PUSK		;
	MVI	A,01011000b	;
	CALL	DISK_COMMAND	; ыБЗБЕН.
	EI			;
	STC			;
	RET			;

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;   рТПГЕДХТБ ЪБРТПУБ ОБ ЧЩИПД Ч УЙУФЕНХ ЙЪ ТЕДБЛФПТБ	;;
;;  ТЕЪХМШФБФ ЧПЪЧТБЭБЕФУС Ч ЧЙДЕ ЖМБЗБ "Z"		;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
Y_N_EXIT:
	LXI	D,1209h		;
	LXI	H,2C0Ah		;
	MVI	A,00010111b	;
	CALL	ACTIV		;
	CALL	Y_N_WRITE	;
	LXI	D,0401h		;
	LXI	B,SOOB_30	;
	CALL	W_PUTSXY_Z	;
	LXI	B,SOOB_YN	;
	LXI	D,0900h		;
	CALL	DA_NET		;
	CALL	DEACTI		;
	ORA	A		;
	RET			;

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;  рТПГ. ПВТБВПФЛЙ ЪБРТПУБ ОБ ЪБРЙУШ ПФЛТЕЛФЙТПЧБОПЗП	;;
;; УЕЛФПТБ						;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
Y_N_WRITE:
	LDA	FATAL		;
	INR	A		;
	RNZ			;
	XRA	A		;
	STA	FATAL		;
	LXI	B,SOOB_00	;
	LXI	D,1408h		;
	LXI	H,2E09h		;
	MVI	A,00010110b	;
	CALL	ACTIV		;
	LXI	D,0101h		;
	CALL	W_PUTSXY_Z	;
	LXI	D,0900h		;
	CALL	DA_NET		;
	ORA	A		;
	CNZ	DISK_SAVE	;
	CALL	DEACTI		;
	RET			;

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;	рТПГЕДХТБ ПТЗБОЙЪБГЙЙ ЪБРТПУБ ФЙРБ дб оеф	;;
;; чЩИПД:	A = 0	- NO				;;
;;		A !=0	- YES				;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
DA_NET:
	CALL	W_PUTSXY_Z	;
	MVI	C,0FFh		; жмбз "дб"
DA_N_02:
	MVI	D,07h		;
DA_N_03:
	MVI	B,6		;
	CALL	INV_LINE	;
DA_N_LOOP:
	CALL	KEY_DELAY	;
	CPI	0Eh		; =;;
;; ///////// 8.03.1993 /////////////////////////////////////
;; //	(C) 1993  лБТБЗБОДБ  лРФй  ьб-91-2  рЙНЕОПЧ р.б   //
;; //							  //
;; //  RD.ASM - рТПЗТБННБ ДМС ЮФЕОЙС ДЙУЛБ ЖПТНБФБ IBM	  //
;; //		  ОБ "ЖЙЪЙЮЕУЛПН" ХТБПЧОЕ.		  //
;; // ========= 52-81-95 ========= PPA Systems ========	  //
;; //		Copyright  by  рЙНЕОПЧ рБЫБ		  //
;; /////////////////////////////////////////////////////////
;;

RD_BUFER	EQU	0200H		;
START_CULIND	EQU	0		;
COUNT_TRACK	EQU	4		;

	INCLUDE	MACRO.PPA		;
	INCLUDE	VG.EQU			;
;;
;;////////// лТБФЛЙК БМЗПТЙФН ТБВПФЩ РТПЗТБННЩ: ////////////
;;    рТПЙЪЧПДЙН ХУФБОПЧЛХ ВМПЛБ ЗПМПЧПЛ ОБ ОХМЕЧПК ГЙМЙОДТ
;; ПФЛТЩЧБЕН ОБ ДЙУЛЕ "C" ЖБКМ: TMP.TMP.
;; рТПЙЪЧПДЙН  ЮФЕОЙЕ  ЙОЖПТНБГЙЙ  У  ДЧХИ  УФПТПО ДЙУЛБ,
;; УЛЙДЩЧБЕН РТПЮЙФБООЩК НБУЙЧ Ч ЖБКМ, ФБЛЙН ПВТБЪПН ЮЙФБЕН
;; 20 ДПТПЦЕЛ ЮФП Ч ЖПТНБФЕ 360 лВБКФ УППФЧЕФУФЧХЕФ 180 л.
;;
;;
RD_START:
	MVI	A,34H		; хУФБОПЧЙН НБУЛХ ЧЩВПТБ
	STA	DISK_MASKA	; ТБВПЮЕЗП ОБЛПРЙФЕМС.
	MVI	A,START_CULIND	; хУФБОПЧЙН ОБЮБМШОЩК ГЙМЙОДТ
	DI			; ЪБРТЕФЙН РТЕТЩЧБОЙС
	CALL	SET_CULIND	; РЕТЕНЕУФЙН ЗПМПЧХ
;;
;;  рТПЙЪЧЕДЕН ЮФЕОЙЕ ФЕЛХЭЕК ДПТПЦЛЙ Ч ТБВПЮЙК ВХЖЕТ
;;
	LXI	D,RD_BUFER	;
	MVI	A,COUNT_TRACK;
RD_LOOP_1:
	CALL	RD_CULINDR	;
	CALL	RD_IBM_STEP	;
	DCR	A		;
	JNZ	RD_LOOP_1	;

	HLT			;

;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;   RD_IBM_STEP - рТПГЕДХТБ ЫБЗБОЙС РП 360 лВБКФОПНХ
;; ДЙУЛХ ТБЪНЕЮЕОПНХ ОБ IBM PC.
;;
RD_IBM_STEP:
	PUSH	PSW		;
	MVI	A,01000000B	; лПНБОДБ - ыбз чРЕТЕД.
	OUT	DS_COM		; ЧЩРПМОЙН 2 ТБЪБ.
	CALL	DS_WAIT		;
	OUT	DS_COM		;
	CALL	DS_WAIT		;
	IN	DS_TRACK	; ОП ТЕЗЙУФТ ДПТПЦЛЙ ХЧЕМЙЮЙН
	INR	A		; ОБ ЕДЙОЙГХ.
	OUT	DS_TRACK	;
	POP	PSW		;
	RET			;

;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;   рТПГЕДХТБ ПУХЭЕУФЧМСЕФ ЮФЕОЙЕ ФЕЛХЭЕЗП ГЙМЙОДБ
;; ТБЪНЕТ ДПТПЦЛЙ ЖЙЛУЙТПЧБООЩК: 9 УЕЛФПТПЧ РП 512 ВБКФ.
;;

RD_CULINDR:
	PUSH	PSW		;
	DI			; пВСЪБФЕМШОП ОЕПВИПДЙНП
				; ЪБРТЕЭБФШ РТЕТЩЧБОЙЕ РПУМЕ
				; ЧЩЪПЧБ УЙУФЕНОПК ЖХОЛГЙЙ.
	MVI	A,34H		; ХУФБОПЧЙН ЧЩВПТ ОПМЕЧПК ЗПМПЧЩ
	STA	DISK_MASKA	;
	CALL	RD_PPA		; РТПЮФЕН ДПТПЦЛХ
	MVI	A,30H		; УНЕОЙН ЗПМПЧЛХ
	STA	DISK_MASKA	;
	CALL	RD_PPA		; РПЧФПТЙН ЮФЕОЙЕ
	POP	PSW		;
	RET			; ЧПЪЧТБФ.

;;
;;ыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыы
;;
;;   рПДРТПЗТБННБ  ЮФЕОЙС РПУМЕДПЧБФЕМШОПНФЙ ЙЪ 9-Й УЕЛФПТПЧ
;; ( РПДТБЪХНЕЧБЕФУС ЮФП ЖБТНБФ ДЙУЛБ УППФЧЕФУФЧХЕФ 360 лВ.)
;; ДМС ВПМЕЕ ДЕФБМШОПЗП БОБМЙЪБ УФТХЛФХТЩ ДЙУЛБ Й ЙОДЕЖЙЛБГЙЙ
;; ЖПТНБФБ ОЕПВИПДЙНП БОБМЙЪЙТПЧБФШ Boot sector.
;;

RD_PPA:
	PUSH	PSW		;
	PUSH	H		;
	MVI	L,1		; ХУФБОПЧЙН ОБЮБМШОЩК УЕЛФПТ
	MVI	H,9		; ХУФБОПЧЙН УЮЕФЮЙЛ
	CALL	PUSK		; ЪБРХУФЙН ДЧЙЗБФЕМШ
RD_LOOP:
	MOV	A,L		; РТПЮЙФБФШ ФЕЛ ОПНЕТ УЕЛФПТБ
	OUT	DS_SECTOR	; УЛЙОХФШ ЕПОФТПМЕТХ
	CALL	DISK_READ	; РТПЮЙФБФШ ХЛБЪБООЩК УЕЛФПТ
	INR	L		; ХЧЕМЙЮЙФШ ОПНЕТ
	DCR	H		; ЛПТЕЛГЙ УЮЕФЮЙЛБ
	JNZ	RD_LOOP		; ХКФЙ ЕУМЙ ЧУЕ РТПЮЙФБМЙ
	POP	PSW		;
	POP	H		;
	RET			;

;;ыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыы
;; рТПГЕДХТБ ЮФЕОЙС УЕЛФПТБ Ч МАВПЕ РТПЙЪЧПМШОПЕ НЕУФП РБНСФЙ
;; ХЛБЪБФЕМЕН ЛПФПТПК УМХЦЙФ РБТБ: DE
;; РТПЙЪЧПДЙФУС ЮФЕОЙЕ ПДОПЗП ФЕЛХЭЕЗП УЕЛФПТБ У ФЕЛХЭЕК
;; ДПТПЦЛЙ Й ФЕЛХЭЕК УФПТПОЩ
;;
DISK_READ:	
	MVI	A,10000000B	; ЮФЕОЙЕ УЕЛФПТБ
	OUT	DS_COM		; РПДБФШ ЛПНБОДХ Й РПДПЦДБФШ
D_LOOP1:
	IN	DS_STATUS	; РПЛБ ЛПОФТПМЕТ РПДЗПФПЧЙФУС
	RRC			; РЕТЕДБЧБФШ ДБООЩЕ
	JNC	D_LOOP1		; 
	CALL	READ_SEC	; РТПЮЙФБФШ УЕЛФПТ
	RET			; ЧПЪЧТБФ Ч ПУОПЧОПК НПДХМШ

;;
;; /////////////////////////////////////////////////////////
;; //	(C) 1993  лБТБЗБОДБ  лРФй  ьб-91-2  рЙНЕОПЧ р.б   //
;; //							  //
;; //	    рБЛЕФ РТПДРТПЗТБНН ДМС ТБВПФЩ У ознд	  //
;; //		  ОБ "ЖЙЪЙЮЕУЛПН" ХТБПЧОЕ.		  //
;; // ========= 52-81-95 ========= PPA Systems ========	  //
;; //		Copyright  by  рЙНЕОПЧ рБЫБ		  //
;; /////////////////////////////////////////////////////////
;;
;;   чУЕ ЧИПДСЭЙЕ Ч ЖБКМ РТПГЕДХТЩ УИТБОСАФ ЧУЕ ТЕЗЙ-
;; УФТЩ РТПГЕУУПТБ !!!
;;

;;______________________________________________________
;;		пРЙУБОЙС ЗМПВБМШОЩИ РТПГЕДХТ		
;;______________________________________________________
;;

	PUBLIC	READ_SEC
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;							;;
;;							;;
;;							;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

	PUBLIC	SET_CULIND
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;   рТПГЕДХТБ SET_CULIND РТПЙЪЧПДЙФ ОЕРПУТЕДУФЧЕООПЕ 	;;
;; РПЪЙГЙТПЧБОЙЕ ЗПМПЧПЛ ФЕЛХЭЕЗП ОБЛПРЙФЕМС РТЙ ЬФПН 	;;
;; ОЕ РТПЙЪЧПДЙФУС ЛПОФТПМШ ОБ ОПНЕТ ФЕЛХЭЕК  ДПТПЦЛЙ 	;;
;; Ф.Е  РЕТЕНЕЭЕОЙЕ  ЧПЪНПЦОП РП  ОЕПФЖПТНБФЙТПЧБОПНХ 	;;
;; ДЙУЛХ.						;;
;;  фБЛ ЛБЛ БМЗПТЙФН ХУФБОПЧЛЙ ОЕ ПРЙТБЕФУС ОБ ЮФЕОЙЕ 	;;
;; ОПНЕТБ  ДПТПЦЛЙ У ДЙУЛБ ФП РЕТЕНЕЭЕОЙЕ  РТПЙУИПДЙФ 	;;
;; ЮЕТЕЪ  "чПУФБОПЧМЕОЙЕ"  ЗПМПЧПЛ ( ОБ 0-К ГЙМЙОДТ )	;;
;; Й  РПУМЕДХАЭЙН  РЕТЕНЕЭЕОЙЕН  ЗПМПЧПЛ  ОБ ЪБДБООЩК	;;
;; ГЙМЙОДТ РТЙ РПНПЭЙ ЛПНБОДЩ "рПЙУЛ"  ПРСФШ  ЦЕ  ВЕЪ	;;
;; ЛПОФТПМС ОПНЕТБ ДПТПЦЛЙ				;;
;;   рТПГЕДХТХ   ОЕПВИПДЙНП  ЧЩЪЩЧБФШ  РТЙ  ОБЮБМШОПК	;;
;; ЙОЙГЙБМЙЪБГЙЙ ЛПОФТПМЕТБ Й ознд.			;;
;; йУРПМШЪХЕНЩЕ РТПГЕДХТЩ:				;;
;;	PUSK - ъБРХУЛ ДЧЙЗБФЕМС Й ЧЩВПТ ОБЛПРЙФЕМС.	;;
;;	DS_WAIT - ПЦЙДБОЙЕ ЗПФПЧОПУФЙ ЛПОФТПМЕТБ.	;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;; 

	PUBLIC	DS_WAIT
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;   рТПГЕДХТБ DS_WAIT РТПЙЪЧПДЙФ ПЦЙДБОЙЕ ЗПФПЧОПУФЙ	;;
;; ЛПОФТПМЕТБ РХФЕН ГЙЛМЙЮЕУЛПЗП ЮФЕОЙС ВБКФБ УФБФХУБ	;;
;; Й БОБМЙЪБ НМБДЫЕЗП ВЙФБ.				;;
;;   рТПГЕДХТХ ОЕПВИПДЙНП ЧЩЪЩЧБФШ ДМС ПЦЙДБОЙС ЧЩРПМ-	;; 
;; ПМОЕОЙС ЛБЛПК МЙВП ПРЕТБГЙЙ.				;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
	PUBLIC	PUSK
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;   рТПГЕДХТБ PUSK РТПЙЪЧПДЙФ ЧЩВПТ ЪБДБООПЗП  ОБЛП-	;;
;; РЙФЕМС (  ознд  чЩВЙТБЕФУС  ЙУИПДС  ЙЪ УПДЕТЦЙНПЗП	;;
;; ЗМПВБМШОПК СЮЕКЛЙ DISK_MASKA).			;;
;;   рТПЮЕДХТХ ЧЩЪЩЧБАФ ОЕРПУТЕДУФЧЕООП РЕТЕД ОБЮБМПН	;;
;; ЧЩРПМООЕЙС ЛБЛПК МЙВП  ПРЕТБГЙЙ У ДЙУЛПН ( юФЕОЙЕ,	;;
;; ЪБРЙУШ, Й Ф.Д.).					;;
;;   йУРПМШЪХЕНЩЕ РТПГЕДХТЩ:				;;
;;	DS_TIME - фЙРПЧБС РПДРТПЗТБННБ ЪБДЕТЦЛЙ		;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
	PUBLIC	DS_TIME
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;   рТПГЕДХТБ ЧТЕНЕООПК ЪБДЕТЦЛЙ. "ЙОФЕТЧБМ ЧТЕНЕОЙ"	;;
;; ЪБДБЕФУС ЮЕТЕЪ ТЕЗЙУФТПЧХА РБТХ "BC"			;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

;;______________________________________________________
;;		пРЙУБОЙЕ ЗМПВБМШОЩИ РЕТЕНЕООЩИ
;;______________________________________________________
;;
	PUBLIC	DISK_MASKA
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;   рЕТЕНЕООБС  DISK_MASKA СЧМСЕФУС ВБКФПЧЩН ЬМЕНЕО-	;;
;; ФПН ХРТБЧМЕОЙЕН ЧЩВПТБ ОБЛПРЙФЕМШ РТЙ ЧУЕИ  ПРЕТБ-	;;
;; ГЙСИ ЧЧПДБ-ЧЩЧПДБ:					;;
;;	D0 - "0" - оБЛПРЙФЕМШ "б"			;;
;;	     "1" - оБЛПРЙФЕМШ "B"			;;
;;	D2 - "0" - зПМПЧЛБ 0				;;
;;	     "1" - зПМПЧЛБ 1				;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

;;=======================================================
;;   рТПГЕДХТБ ЮФЕОЙС ЙОЖПТНБГЙЙ РПУФХРБЕНПК ПФ ЛПОФТ.
;;
READ_SEC:
	IN	DS_STATUS	; РТПЮЙФБФШ УФБФХУ ЛПОФТПМЕТБ
	RRC			;
	RNC			; УЕЛФПТ РТПЮФБО ??? 
	RRC			; ЕУМЙ ДБ ФП ХИПД
	JNC	READ_SEC	; ПЦЙДБЕН ЗПФПЧОПУФЙ ДБООЩИ
	IN	DS_DATA		; ВЕТЕН ДБООЩЕ
	STAX	D		; УПИТБОСЕН Ч ВХЖЕТЕ
	INX	D		;
	JMP	READ_SEC	;

;;========================================================
;;РТПГЕДХТБ ХУФБОПЧЛЙ ЗПМПЧЩ ОБЛПРЙФЕМС ОБ ХЛБЪБОХА ДПТПЦЛХ
;;чИПД:	б - ОПНЕТ ДПТПЦЛЙ
;;
SET_CULIND:
	PUSH	PSW		;
	PUSH	PSW		; УПИТБОСЕН ТЕЗЙУФТ PSW
	CALL	PUSK		; ЪБРХУЛБЕН ДЧЙЗБФЕМШ ОБ
	MVI	A,00000000B	; ФЕЛХЭЕН ОБЛПРЙФЕМЕ Й
	OUT	DS_COM		; РТПЙЪЧПДЙН ЧПУФБОПЧМЕОЙЕ
	CALL	DS_WAIT		; ЗПМПЧЩ ( 0-Culinder )
	POP	PSW		; ЧПУФБОБЧМЙЧБЕН ОХЦОХА
	CALL	PUSK		; ОБН ДПТПЦЛХ Й РТПЙЪЧПДЙН
	OUT	DS_DATA		; РЕТЕНЕЭЕОЙЕ ЗПМПЧЩ
	MVI	A,00011000B	; 
	OUT	DS_COM		;
	CALL	DS_WAIT		; ПЦЙДБЕН ЗПФПЧОПУФШ
	XRA	A		; ВМПЛ ЛПТЕЛГЙЙ ОПНЕТБ ДПТ-
	IN	DS_TRACK	; ПЦЛЙ ЧЧЕДЕО ДМС ЧПЪНПЦОПУФЙ
	RAR			; ПВТБВБФЩЧБФШ 40-ДПТПЦЕЮОХА
	OUT	DS_TRACK	; ЪБРЙУШ.
	POP	PSW		;
	RET			; ЧПЪЧТБФ ЙЪ РТПГЕДХТЩ
;;========================================================
DS_WAIT:
	PUSH	PSW		;РТПГЕДХТБ ПЦЙДБОЙС ЗПФПЧОПУФЙ
DS_WAIT_00:			;
	IN	DS_STATUS	;ЛПОФТПМЕТБ ознд
	RRC			;
	JC	DS_WAIT_00	;ЪБОСФП ЙДЕФ ЙУРПМОЕОЙЕ ЛПНБОДЩ
	POP	PSW		;
	RET			;
;;========================================================
PUSK:
	PUSH	PSW		; РТПГЕДХТБ ЪБРХУЛБ ДЧЙЗБФЕМС
PUSK_00:			;
	LDA	DISK_MASKA	; РП ЪБДБОПК НБУЛЕ
	OUT	DS_MOTOR	; Ч РПТФ ХРТБЧМЕОЙС
	LXI	B,2000H		; ЛПОУФБОФБ ЪБДЕТЦЛЙ
	IN	DS_STATUS	;
	CALL	DS_TIME		; ДЕМБЕН РБХЪХ
	RLC			;
	JC	PUSK_00		; ЕУМЙ ОЕ ЗПФПЧ ФП РПЧФПТЙФШ
	POP	PSW		; ЧПУФБОПЧЙН ЖМБЗЙ
	RET			; ЧПЪЧТБФ
;;
DISK_MASKA:
	DB	00H	;НБУЛБ ЧЩВПТБ ТБВПЮЕЗП ОБЛПРЙФЕМС
			; D2 - ВЙФ ПФЧЕЮБЕФ ЪБ "УФПТПОХ"
			; ДЙУЛБ (РТЙ ПВНЕОЕ) ЕУМЙ ЬФПФ
			; ВЙФ = 1 ФП ЧЩВЕТБАФУС ЮЕФОЩЕ
			; ДПТПЦЛЙ ( РП ХФЙМЙФЕ DD.COM )
			; ЕУМЙ = 0 ФП ОЕ ЮЕФОЩЕ

;;
;;========================================================
DS_TIME:
	PUSH	PSW		; фЙРПЧБС РТПЗТБННБ ЧТЕНЕООПК
	PUSH	B		; ЪБДЕТЦЛЙ
DS_T0:				;
	DCX	B		; РХУФПК ГЙЛМ
	MOV	A,B		; ---//----
	ORA	C		; ---//----
	JNZ	DS_T0		; ---//----
	POP	B		; ЧПУФБОБЧМЙЧБЕФ ТЕЗЙУФТЩ
	POP	PSW		; Й ЧПЪЧТБЭБЕНУС
	RET			;
;;========================================================
	END

========================================
PUSK:
	PUSH	PSW		; РТПГЕДХТБ ЪБРХУЛБ ДЧЙЗБФЕМС
PUSK_00:			;
	LDA	DISK_MASKA	; РП ЪБДБОПК НБУЛЕ
	OUT	DS_MOTOR	; Ч РПТФ ХРТБЧМЕОЙС
	LXI	B,2000H		; ЛПОУФБОФБ ЪБДЕТЦЛЙ
	IN	DS_STATUS	;
	CALL	DS_TIME		; ДЕМБЕН РБХЪХ
	RLC			;
	JC	PUSK_00		; ЕУМЙ ОЕ ЗПФПЧ ФП РПЧФПТЙФШ
	POP	PSW		; ЧПУФБОПЧЙН ЖМБЗЙ
	RET			; ЧПЪЧТБФ
;;
DISK_MASKA:
	DB	00H	;НБУЛБ ЧЩВПТБ ТБВПЮЕЗП ОБЛПРЙФЕМС
			; D2 - ВЙФ ПФЧЕЮБЕФ ЪБ "УФПТПОХ"
			; ДЙУЛБ (РТЙ ПВНЕОЕ) ЕУМЙ ЬФПФ
			; ВЙФ = 1 ФП ЧЩВЕТБАФУС ЮЕФОЩЕ
			; ДПТПЦЛЙ ( РП ХФЙМЙФЕ DD.COM )
			; ЕУМЙ = 0 ФП ОЕ ЮЕФОЩЕ

;;
;;========================================================
DS_TIME:
	PUSH	PSW		; фЙРПЧБС РТПЗТБННБ ЧТЕНЕООПК
	PUSH	B		; ЪБДЕТЦЛЙ
DS_T0:				;
	DCX	B		; РХУФПК ГЙЛМ
	MOV	A,B		; ---//----
	ORA	C		; ---//----
	JNZ	DS_T0		; ---//----
	POP	B		; ЧПУФБОБЧМЙЧБЕФ ТЕЗЙУФТЩ
	POP	PSW		; Й ЧПЪЧТБЭБЕНУ;;
;;	ТЕЛМБНБ 
;;
BUFER_PPA	EQU	PPA_END	;

	ORG	4100H

	XRA	A		;
	OUT	10H		;
	DI			;
	LXI	SP,100H		;
	CALL	SCREENCLS	;
	LXI	H,INTERUPT	;
	SHLD	39H		;
	MVI	A,0C3H		;
	STA	38H		;
	EI			;
	LXI	D,BUFER_PPA	;ХЛБЪБФЕМШ ОБ ВХЖЕТ.
	LXI	H,0C8C0H	;ХЛБЪБФЕМШ ОБ ЬЛТБО.
PPA_00:
	CALL	PRINT_BOX	;
	DCR	L		;
	MOV	A,L		;
	CPI	50H		;
	JNZ	PPA_00		;
PPA_LOOP:
	LDA	KEY_KOD_PPA	;
	INR	A		;
	JZ	PPA_LOOP	;
	CALL	SCREENCLS	;
	NOP			;
	NOP			;
	NOP			;
	JMP	$		;

;;$$$$$$$$$$ CLS.ASM 30.09.1992 $$$$$$$$$$
SCREENCLS:
	IN	3		;
	MOV	L,A		;
	LXI	B,0		;
SCRECLS0:			;
	MVI	H,0A0H		;
SCRECLS:			;
	MOV	M,B		;
	INR	H		;
	MOV	A,H		;
	CPI	0E0H		;
	JNZ	SCRECLS		;
	MOV	A,L		;
	DCR	L		;
	OUT	3		;
	INR	C		;
	JNZ	SCRECLS0	;
	RET			;

KEY_KOD_PPA:	DB	0H	;

TEXT:		DB	'(C)1993 PPA Soft Systems  '

INTERUPT:
	PUSH	B		;
	PUSH	D		;
	PUSH	H		;
	PUSH	PSW
	MVI	A,8AH		;
	OUT	0		;
	XRA	A		;
	OUT	3		;
	IN	2		;
	STA	KEY_KOD_PPA	;
	MVI	A,88H		;
	OUT	0		;
	XRA	A		;
	OUT	2		;
	POP	PSW		;
	POP	H		;
	POP	D		;
	POP	B		;
	EI			;
	RET			;

;;
;;	РТПГЕДХТБ ТБУРЕЮБФЛЙ ВМПЛБ ЗТБЖЙЛЙ.
;; ЧИПД:	HL - ХЛБЪБФЕМШ ОБ ОБЮБМП ЗТБЖЙЛЙ 
;;		( ЕУМЙ Ч "L" ОБИПДЙФУС ЮЙУМП 0C0H ФП
;;		ПЪОБЮБЕФ ЮФП ЛПОЕГ ЧЩЧПДБ).
;;
PRINT_BOX:			;
	PUSH	D		;
	PUSH	H		;
PR_BOX_00:
	CALL	PRINT_LINE	;
	MOV	A,L		;
	INR	L		;
	INX	D		;
	CPI	0C0H		;
	JNZ	PR_BOX_00	;
	POP	H		;
	POP	D		;
	RET			;

	
;;
;; 	 РТГЕДХТБ  ТЙУПЧБОЙС  ПДОПК ЗТБЖЙЮЕУЛПК МЙОЕКЛЙ ЙЪ
;;  ЪБДБОПЗП ХЛБЪБФЕМ ОБ ВХЖЕТ ЖЙЛУЙТЧБОПЗП ТБЪНЕТБ.
;;	ЧИПД:   HL - ЬЛТБООЩК ХЛБЪБФЕМШ.
;;		DE - ХЛБЪБФЕМШ ОБ ВХЖЕТ.
;;
PRINT_LINE:
	PUSH	D		;
	PUSH	H		;
PR_LINE_00:			;
	LDAX	D		;
	MOV	M,A		;
	PUSH	H		;
	LXI	H,70H		;
	DAD	D		;
	XCHG			;
	POP	H		;
	INR	H		;
	MOV	A,H		;
	CPI	0C8H+11H	;
	JNZ	PR_LINE_00	;
	POP	H		;
	POP	D		;
	RET			;
PPA_END:

	END


	OUT	0		;
	XRA	A		;
	OUT	3		;
	IN	2		;
	STA	KEY_KOD_PPA	;
	MVI	A,88H		;
	OUT	0		;
	XRA	A		;
	OUT	2		;
	POP	PSW		;
	PO///////////////////////////
;;
;; Is problemm !!!  25.03.1993 З.
;;
;;
;РПДРТПЗТБННЩ ЧЩЪЩЧБАЭЙЕ РТПГЕДХТХ REGENER ОЕ ДПМЦОЩ ЪБУПТСФШ ДП ЬФПЗП УФЕЛ
;;
		JMP	PPASTART
EDITING:
		CALL	COPYS
		STA	DLINNA
		CALL	DON
		CALL	UP
NOESOPROS:	CALL	CINV
LOOPKEY:	CALL	KEYDELAU
;;
;;   рТПЙЪЧЕДЕН ОБЛБЪБОЙЕ ЧЪМПНЭЙЛБ
;;
KONTR_PPA:
		STA	PPASTART-1
		CALL	CINV
		LXI	H,NOESOPROS
		PUSH	H
; ХРТБЧМСАЭЙЕ ЛМБЧЙЫЙ
		MOV	B,A
		IN	01H	; вЕТЕН УФБФХУ ЙЪ РПТФБ "у"
		MOV	C,A
		ANI	40H	;ЧЩДЕМЙФШ УЛБОЛПД "ХУ"
		MOV	A,B
		JZ	USADDX	;ПВТБВПФБФШ ХУ+
		CPI	10H
		JNC	BYKVA
		MOV	A,C
		ANI	20H	;ЧЩДЕМЙФШ УЛБОЛПД "CC"
		MOV	A,B
		JZ	CCADDX	;ПВТБВПФБФШ CC+...
		ORA	A
		JZ	BYKVA	;фБВХМСГЙС
		CPI	07H	;ЧОЙЪ
		JZ	DON	
		CPI	05H	;ЧЧЕТИ
		JZ	UP	
		CPI	06H	;ЧРТБЧП
		JZ	RIGHT	
		CPI	04H	;ЧМЕЧП
		JZ	LEFT
KEYDONE:	CPI	0CH	;F2-Delete
		JZ	DELETE
		CPI	03H	;ЪБВПК
		JZ	ZABOY
		CPI	08H	;ДПНПК
		JZ	DOMOY
		CPI	2H	;Enter
		JZ	ENTER
		RET	

;%%%%%%%%%%%%% CC + ЛМБЧЙЫЙ %%%%%%%%%%%%%%%

CCADDX:		LXI	H,KEYRESET
		PUSH	H
		CPI	05H	;CC+ЧЧЕТИ
		JZ	CCUP
		CPI	07H	;CC+ЧОЙЪ
		JZ	CCDON
		CPI	04H	;CC+ЧМЕЧП
		JZ	CCLEFT
		CPI	06H	;CC+ЧРТПЧП
		JZ	CCRIGHT
		CPI	0CH	;CC+F2 - ХДБМЕОЙЕ ФЕЛХЭЕК УФТПЛЙ
		JZ	CCDELETE
		JMP	KEYDONE	;ЙОБЮЕ ЖХОЛГЙЙ ОЕ ЙЪНЕОЙМЙУШ


;;
;;ыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыы;;
;;ыыыыыыы (C)  Copyright 1992 by Pimenov Pasha ыыыыыыыы;;
;;ыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыы;;
;;ыыыыыыыыыыыыыы     ыыы     ыыыыы     ыыыыыыыыыыыыыыыы;;
;;ыыыыыыыыыыыыыы  ыы  ыы  ыы  ыыы  ыы  ыыыыыыыыыыыыыыыы;;
;;ыыыыыыыыыыыыыы  ыы  ыы  ыы  ыы  ыыы  ыыыыыыыыыыыыыыыы;;
;;ыыыыыыыыыыыыыы     ыыы     ыыы  ыыы  ыыыыыыыыыыыыыыыы;;
;;ыыыыыыыыыыыыыы  ыыыыыы  ыыыыыы       ыыыыыыыыыыыыыыыы;;
;;ыыыыыыыыыыыыыы  ыыыыыы  ыыыыыы  ыыы  ыыыыыыыыыыыыыыыы;;
;;ыыыыыыыыыыыыыы  ыыыыыы  ыыыыыы  ыыы  ыыыыыыыыыыыыыыыы;;
;;ыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыы;;
;;ыыыыыыы      470075     З.лБТБЗБОДБ           ыыыыыыы;;
;;ыыыыыыы   ХМ. 40 МЕФ лБЪБИУФБОБ Д.39/3 ЛЧ.1   ыыыыыыы;;
;;ыыыыыыы            рЙНЕОПЧ р.б                ыыыыыыы;;
;;ыыыыыыы               Ф.52-81-95              ыыыыыыы;;
;;ыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыы;;
;;
;;==================================================
;; рТПЗТБНОЩК РТПДХЛФ PPA-Editor СЧМСЕФУС БРПТБФОП
;; ЪБЧЙУНПК РТПЗТБННПК (УРЕГЙБМШОП ДМС чЕЛЛФПТ-06г)
;; ОБРЙУБООБ РПМОПУФША ОБ БУУЕНВМЕТЕ РТЙ ЙУРПМШЪП-
;; ЧБОЙЙ РБЛЕФБ НБЛТПБУУЕНВМЕТБ ---------- M80.COM
;;;;;
;;(*) MAIN.ASM    - ПУОПЧОПК НПДХМШ УПДЕТЦЙФ ПУОПЧ-
;;		    ОЩЕ ПРЙУБОЙС РЕТЕНЕООЩИ Й ПРЙ-
;;		    УБОЙЕ include - ЖБКМПЧ.
;;;;;
;;(*) WIND.ASM    - ЙУИПДОЙЛ ХОЙЧЕТУБМШОПЗБ ДТБКЧ-
;;		    ЕТБ "пЛПООПК НЙЛТП-УЙУФЕНЩ" Й
;;		    ЧЩУФХРБЕФ Ч ЛБЮЕУФЧЕ ДТБКЧЕТБ
;;		    ДЙУРМЕС Ч PPA-Editor
;;;;;
;;(*) KEYDRIV.ASM - ХОЙЧЕТУБМШОЩК ДТБКЧЕТ ЛМБЧЙ-
;;		    БФХТЩ ЬНХМЙТХЕФ ЧПЪНПЦОПУФЙ
;;		    УФБОДБТФОПК ЧПУНЙВЙФПЧПК ЛМБ- 
;;		    ЧЙБФХТЩ
;;;;;
;;(*) EDMAIN.ASM - НПДХМШ УПДЕТЦЙФ ДПРПМОЙФЕМШОЩЕ
;;		   РТПГЕДХТЩ РП ЧЩЧПДХ ЙОЖПТНБГЙЙ
;;		   ЙОЖПТНБГЙЙ ОБ ЬЛТБО
;;;;;
;; Й ДТХЗЙЕ ЖБКМЩ
;; ДБООБС РТПЗТБННБ СЧМСЕФУС ПВ'ЕДЙОЕОЙЕН ЬФЙИ ЖБКМПЧ
;;
;;;;;
;; ПВ'ЕДЙОЕОЙЕН ЧУЕИ ЕФЙИ ЖБКМПЧ СЧМСЕФУС
;; MADD.ASM
;;
;; /////// вМПЛ ФЕЛУФПЧЩИ УФТПЛ УППВЭЕОЙК  \\\\\\\\

;; "юФЕОЙЕ ЖБКМБ"
F_S00:		DB	0FEH,0D4H,0C5H,0CEH,0C9H,0C5H
		DB	020H,0C6H,0C1H,0CAH,0CCH,0C1H
		DB	CR
;; "ъБРЙУШ жБКМБ"
		DB	0FAH,0C1H,0D0H,0C9H,0D3H,0D8H
		DB	020H,0C6H,0C1H,0CAH,0CCH,0C1H
		DB	CR
;; "рПДЗТХЪЛБ"
		DB	0F0H,0CFH,0C4H,0C7H,0D2H,0D5H
		DB	0DAH,0CBH,0C1H,CR

F_S10:		DB	'File:',CR
F_S20:		DB	'No file!',CR
F_S30:		DB	'Out of disk !',CR

;;"рТПДПМЦЙФШ ?"
S_SOOBHLP3:	DB	0F0H,0D2H,0CFH,0C4H,0CFH,0CCH,0D6H,0C9H
		DB	0D4H,0D8H,020H,03FH,CR

;;"ХРТБЧМЕОЙЕ: <- ->"
S_SOOBHLP2:	DB	6,7,' ', 0F5H,0D0H,0D2H,0C1H,0D7H,0CCH
		DB	0C5H,0CEH,0C9H,0C5H,03AH,' ',6,7,' ',7,8
		DB	' ',7,8,CR

;;"рТПУНПФТ"
S_SOOBHLP:	DB	0F0H,0D2H,0CFH,0D3H,0CDH,0CFH,0D4H,0D2H
		DB	CR

;;"рТПДПМЦЙФШ РПЙУЛ"
S_SOOB1:	DB	0F0H,0D2H,0CFH,0C4H,0CFH,0CCH,0D6H,0C9H
		DB	0D4H,0D8H,020H,0D0H,0CFH,0C9H,0D3H,0CBH
		DB	CR

;;"ЧЩИПД - F4"
S_SOOBEX:	DB	0F7H,0F9H,0E8H,0EFH,0E4H,' - F4',CR

;;"ъБНЕОЙФШ"
		DB	0FAH,0C1H,0CDH,0C5H,0CEH,0C9H,0D4H,0D8H
		DB	CR

;;"ъБЛПОЮЙФШ РПЙУЛ"
;;		DB	0FAH,0C1H,0CBH,0CFH,0CEH,0DEH,0C9H,0D4H
;;		DB	0D8H,020H,0D0H,0CFH,0C9H,0D3H,0CBH,CR

; ;"оЕ ЪБНЕОСФШ"
S_SOOB2:	DB	0EEH,0C5H,020H,0DAH,0C1H,0CDH,0C5H,0CEH
		DB	0D1H,0D4H,0D8H,CR
	
;"оБКФЙ:"
ETALON:		DB	0EEH,0C1H,0CAH,0D4H,0C9H,03AH,CR

;"ъБНБОБ:"
PODMENA:	DB	0FAH,0C1H,0CDH,0C5H,0CEH,0C1H,03AH,CR

;; "тБЪНЕТ ЖБКМБ:"
I_SOOB1:	DB	0F2H,0C1H,0DAH,0CDH,0C5H,0D2H
		DB	020H,0C6H,0C1H,0CAH,0CCH,0C1H
		DB	03AH,CR

;; "уЧПВПДОП:"
		DB	0F3H,0D7H,0CFH,0C2H,0CFH,0C4H
		DB	0CEH,0CFH,03AH,CR
;; "H вБЙФ"
		DB	048H,0020H,0E2H,0C1H,0CAH,0D4H
		DB	CR


PPAYESNO:	DB	6,7,' Yes/No ',7,8,0
F4ESC:		DB	6,7,' F4-Esc ',7,8,0
SOOBF:		DB	'Out of memory',CR

;"ПЫЙВЛБ РПЧФПТЙФЕ ЧЧПД"
ERROR01:	DB	0EFH,0FBH,0E9H,0E2H,0EBH,0E1H,020H,0F0H,0CFH
		DB	0D7H,0D4H,0CFH,0D2H,0C9H,0D4H,0C5H,020H,0D7H
		DB	0D7H,0CFH,0C4H,CR

;"ЧЩКФЙ ЙЪ ТЕДБЛФПТБ"
QUITPPA:	DB	0F7H,0D9H,0CAH,0D4H,0C9H,020H,0C9H,0DAH,020H
		DB	0D2H,0C5H,0C4H,0C1H,0CBH,0D4H,0CFH,0D2H,0C1H
		DB	020H,3FH,CR

;"ОПНЕТ УФТПЛЙ:"
WARNGOTO:	DB	0EEH,0CFH,0CDH,0C5H,0D2H,020H,0D3H,0D4H,0D2H
		DB	0CFH,0CBH,0C9H,3AH,CR

SOOBL:		DB	'Home',CR
SOOBR:		DB	'End',CR
SOOBD:		DB	'Bottom',CR
SOOBV:		DB	'Top',CR


;; "чЩ ХЧЕТЕОЩ ???"
SV_TS2:		DB	0F7H,0D9H,020H,0D5H,0D7H
		DB	0C5H,0D2H,0C5H,0CEH,0D9H
		DB	020H,'???',CR
;; "пФЛХДБ:"
SV_TS1:		DB	20H,0EFH,0D4H,0CBH,0D5H
		DB	0C4H,0C1H,03AH,20H,CR		
;; "лХДБ:"
		DB	20H,0EBH,0D5H,0C4H,0C1H
		DB	03AH,20H,CR

;; "рТПРЙУОЩЕ"
SV_TS0:		DB	0F0H,0D2H,0CFH,0D0H,0C9H
		DB	0D3H,0CEH,0D9H,0C5H,CR

;; "уФТПЮОЩЕ"
		DB	0F3H,0D4H,0D2H,0CFH,0DEH
		DB	0CEH,0D9H,0C5H,CR
;; "мБФ"
		DB	0ECH,0C1H,0D4H,CR
;; "тХУ"		
		DB	0F2H,0D5H,0D3H,CR

;; "фЕЛХЭЙК ГЧЕФ"
SV_SOOB3:	DB	0F4H,0C5H,0CBH,0D5H,0DDH
			0C9H,0CAH,020H,0C3H,0D7H
			0C5H,0D4H,03AH,CR

;; "фЕЛУФ"
SV_SOOB2:	DB	0F4H,0C5H,0CBH,0D3H,0D4H
		DB	CR

;; "жПО"
		DB	0E6H,0CFH,0CEH,CR

;; "рЕТЕЛПДЙТПЧЛБ"
SV_SOOB1:	DB	0F0H,0C5H,0D2H,0C5H,0CBH
			0CFH,0C4H,0C9H,0D2H,0CFH
			0D7H,0CBH,0C1H,CR
;; "чЩВПТ РБМЙФТЩ"
		DB	0F7H,0D9H,0C2H,0CFH,0D2H
			020H,0D0H,0C1H,0CCH,0C9H
			0D4H,0D2H,0D9H,CR

;;
H_SOOB1:	DB	'No file EDHLP.PPA',CR
;;

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;		INCLUDE	WIND.ASM
;;
;; йУИПДОЙЛ ХОЙЧЕТУБМШОПЗП ДТБКЧЕТБ ПЛПООПК УФТХЛФХТЩ ЬЛТБОБ
;; РТПЗТБННБ РПМОПУФША ОБРЙУБОБ ОБ БУУЕНВМЕТЕ (Intel 8080 )
;; Й РТЕДОБЪОБЮЕОБ ДМС ОБРЙУБОЙС ЗЙВЛЙИ ДЙБМПЗПЧЩИ РТПЗТБНН
;; ( ПЛПООЩЕ ТЕДБЛФПТЩ ФЕЛУФБ , ЙОУФТХНЕОФБМШОЩЕ ХФЙМЙФЩ ,Й Ф.Д.)
;;
;;РПУМЕДОСС НПДЙЖЙЛБГЙС : 12.11.1992  З.лБТБЗБОДБ
;;
;;ыыыыыыы   ХМ. 40 МЕФ лБЪБИУФБОБ Д.39/3 ЛЧ.1   ыыыыыыы;;
;;ыыыыыыы            рЙНЕОПЧ р.б                ыыыыыыы;;
;;ыыыыыыы               Ф.52-81-95              ыыыыыыы;;

;;+----[ 13.10.1992 ]-----------[ ЛБТБЗБОДБ ]---+
;;!  БЧФПТ:	рЙНЕОПЧ р.б.			!
;;!	"дТБКЧЕТ ПЛПООПЗП ЙОФЕТЖЕКУБ"		!
;;! ПВЕУРЕЮЙЧБЕФ ЧЩЧПД УЙНЧПМШОПК ЙОЖПТНБГЙЙ Ч	!
;;! ФБЛ ОБЪЩЧБЕНЩЕ "ПЛОБ" ТЕБМЙЪПЧБОЩ УМЕДХ`ЭЙЕ	!
;;! ПРЕТБГЙЙ:	ЧЩЧПД ПДЙОПЮОПЗП УЙНЧПМБ	!
;;!		ПТЗБОЙЪБГЙС ЧУРМЩЧБАЭЙИ ПЛПО	!
;;!		ПФЮЙУФЛБ ПЛПО (ПВМБУФЕК ЬЛТБОБ)	!
;;!		ЮФЕОЙЕ УЙНЧПМБ Ч ЪБД. РПЪЙГЙЙ	!
;;! ЛППТДЙОБФЩ:	ПЛПООЩЕ	(ПФОПУЙФЕМШОЩЕ)		!
;;!		ЬЛТБООЩЕ (БВУПМАФОЩЕ)		!
;;!   ///  ТБУРТЕДЕМЕОЙЕ ТПО РТПГЕУУПТБ  /////	!
;;!	DE  ->  ЛППТД. ЧЩЧПДБ УЙНЧПМБ МЙВП ХЛБЪ.!
;;!		МЕЧ. ОЙЦОЕЗП ХЗМБ ПЛОБ (ПВМБУФЙ)!
;;!		D -> ЗПТЙЪПОФБМШОБС ЛППТДЙОБФБ	!
;;!		Е -> ЧЕТФЙЛБМШОБС --//-- (Y)	!
;;!	HL  ->	ЛППТД.РТБЧ. ЧЕТИО. ХЗМБ ПЛОБ 	!
;;!	BC  ->	ХЛБЪБФЕМШ ОБ УФТПЛХ УЙНЦПМПЧ	!
;;!	A   ->	ЖМБЗ ПЛОБ			!
;;!	+---+---+---+---+---+---+---+---+	!
;;!	! 7 ! 6 ! 5 ! 4 ! 3 ! 2 ! 1 ! 0 !	!
;;!	+---+---+---+---+---+---+---+---+	!
;;!	ПРЙГБОЙЕ ВЙФПЧ ЖМБЗБ:			!
;;!		(D0-D1):  ЧЙД "ФЕОЙ"		!
;;!			00 -> ПФУХФУФЧХЕФ	!
;;!			01-11 -> 1-3 ФЙРЩ	!
;;!		(D2-D3):  ЧЙД "ТБНЛЙ"		!
;;!			00 -> ПФУХФУФЧХЕФ	!
;;!			01 -> ПДЙОБТОБС		!
;;!			10 -> ДЧПКОБС		!
;;!			11 -> ФПЦЕ ПДЙОБТОБС	!
;;!		   (D4):  РБТЙФЕФ ПЛОБ		!
;;!			0  -> ВЕЪ ЧПУФБОПЧМЕОЙС	!
;;ЫХ.
	INR	A		;
	DAD	D		;
	JMP	N_D_01		;
N_D_00:
	MOV	A,L		;
	ANI	11110000b	;
	MOV	L,A		;
	LXI	D,0009h		;
	LXI	B,BUF_DISK	;
	PUSH	H		;
	DAD	B		;
	BH_MOV			;
	POP	H		;
	RET			;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;	рТПГЕДХТБ РПМХЮЕОЙС ПФОПУЙФЕМШОПЗП БДТЕУБ ВБКФБ	;;
;; HL - УНЕЭЕОЙЕ ПФОПУЙФЕМШОП BUF_DISK			;;
;; DE - ЖЙЪЙЮЕУЛЙК БДТЕУ ВХЖЕТБ BUF_DISK		;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
LOAD_OFFSET:
	LHLD	POSITION	; ЮЙФБЕН ЖЙЪЙЮЕУЛЙК БДТЕУ.
	LXI	D,BUF_DISK	; ЧЩЮЙФБЕН УНЕЭЕОЙЕ.
	CALL	NEG_DE		; ТЕЪХМЙФБФ Ч HL
	DAD	D		;
	RET			;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;	чУРПНПЗБФЕМШОБС РТПГЕДХТБ РТПЙЪЧПДЙФ ЧЩЧПД ЪБ-	;;
;; ЗПМПЧЛБ ДБНРПЧПК УФТПЛЙ (xxxx: |)			;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
ADDR_DUMP_HLP:
	MVI	D,1		;
	CALL	ABS_DE		; РПМХЮЙН БВУПМАФОЩЕ ЛППТ.
	MOV	A,H		;
	CALL	PUT_HEX		;
	MOV	A,L		;
	CALL	PUT_HEX		;
	MVI	A,':'		;
	CALL	PUTCXY		;
	INR	D		;
	MVI	A,83h		;
	CALL	PUTCXY		;
	INR	D		;
	INR	D		;
	MVI	H,10H		;
	RET			;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;	рТПГЕДХТБ ПУХЭЕУФЧМСЕФ РЕЮБФШ УФТПЛЙ ФЕЛУФБ Ч	;;
;; ЖПТНБФЕ ТЕДБЛФПТБ. ========= TEXT =========		;;
;;	BC - ХЛБЪБФЕМШ ОБ РПУМЕДПЧБФЕМШОПУФШ 16 ВБКФ.	;;
;;	E  - ЧЕТФЙЛБМШОБС ЛППТДЙОБФБ ТБУРЕЮБФЛЙ.	;;
;;	HL - МПЗЙЮЕУЛЙК БДТЕУ ЛПМПОЛЙ.			;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
LINE_TEXT:
	PUSH	D		; УПИТБОЙН ТЕЗЙУФТЩ
	PUSH	H		; Ч УФЕЛЕ.
	PUSH	PSW		;
	CALL	ADDR_DUMP_HLP	;
L_T_00:				;
	LDAX	B		;
	INX	B		;
	CALL	PUT_CHAR	;
	INR	D		;
	DCR	H		;
	JNZ	L_T_00		;
	POP	PSW		;
	POP	H		;
	POP	D		;
	RET			;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;	рТПГЕДХТБ ЧЩЧПДЙФ РПМОЩК "ДБНР" Ч ПУОПЧОПЕ ПЛОП ;;
;; ДЙУЛПЧПЗП  ТЕДБЛФПТБ Ч ЖПТНБФЕ ======== TEXT =======	;;
;;	BC - ХЛБЪБФЕМШ ОБ ДБНР РБНСФЙ.			;;
;;	HL - "БДТЕУ" ЧЕТИОЕК УФТПЛЙ ДБНРБ.		;;
;;	DE - ЛППТДЙОБФБ ЧЩЧПДБ (++ РП ЧЕТОЙЛБМЙ.)	;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
DUMP_TEXT:			;
	PUSH	D		;
	PUSH	PSW		;
	LXI	D,0008h		;
D_T_00:				;
	DCR	E		;
	CALL	LINE_TEXT	;
	MOV	A,E		;
	MVI	E,010h		;
	DAD	D		;
	MOV	E,A		;
	JNZ	D_T_00		;
	POP	PSW		;
	POP	D		;
	RET			;

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;	рТПГЕДХТБ ПУХЭЕУФЧМСЕФ ПВОПЧМЕОЙЕ ХЛБЪБФЕМС ТЕ-	;;
;; ДБЛФЙТПЧБОЙС У ХЮЕФПН РБТБНЕФТa POSITION		;;
;; Ч HL ДПМЦОП РЕТЕДПЧБФУС БДТЕУ РПЪЙГЙЙ.		;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
RE_PRINT_POS:			;
	MOV	B,M		;
	PUSH	D		;
	LXI	D,BUF_DISK	;
	CALL	NEG_DE		;
	DAD	D		;
	LXI	D,280Dh		;
	CALL	PUT_WORD_HEX	;
	MOV	A,B		;
	INR	D		;
	INR	D		;
	INR	D		;
	INR	D		;
	CALL	PUT_HEX		;
	INR	D		;
	INR	D		;
	INR	D		;
	INR	D		;
	CALL	PUT_CHAR	;
	POP	D		;
	RET			;

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;	рТПГЕДХТБ ТБУРЕЮБФЩЧБЕФ УЙНЧПМ У ХЮЕФПН УРЕГЙ-	;;
;; ЛЙ ТЕДБЛФПТБ HEX ЛПДБ.				;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
PUT_CHAR:			;
	PUSH	PSW		;
	CPI	20h		;
	JNC	P_C_0		;
	MVI	A,'.'		;
P_C_0:
	CPI	80h		;
	JC	P_C_1		;
	CPI	0C0h		;
	JNC	P_C_1		;
	MVI	A,'.'		;
P_C_1:
	CALL	PUTCXY		;
	POP	PSW		;
	RET			;

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;	рТПГЕДХТБ ЧЩЧПДБ УМПЧБ УПДЕТЦБЭЕЗПУС Ч HL 	;;
;; Ч ЬЛТБО РП ЛППТДЙОБФБН ЪБДБЧБЕНЩН РБТПК DE		;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
PUT_WORD_HEX:
	PUSH	PSW		;
	MOV	A,H		;
	CALL	PUT_HEX		;
	MOV	A,L		;
	CALL	PUT_HEX		;
	POP	PSW		;
	RET			;

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;	рТПГЕДХТБ РПМХЮЕОЙС ДПРПМОЙФЕМШОПЗП ЛПДБ ДМС	;;
;; ТЕЗЙУФТПЧПК РБТЩ: DE					;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
NEG_DE:			;
	MOV	A,D	;
	CMA		;
	MOV	D,A	;
	MOV	A,E	;
	CMA		;
	MOV	E,A	;
	INX	D	;
	RET		;

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;	рТПГЕДХТБ ЧЩЧПДЙФ ДБНР Ч УФБОДБТФОПН ЖПТНБФЕ	;;
;; ДЙУЛПЧПЗП  ТЕДБЛФПТБ Ч ЖПТНБФЕ ======== HEX ========	;;
;;	BC - ХЛБЪБФЕМШ ОБ ДБНР РБНСФЙ.			;;
;;	HL - "БДТЕУ" ЧЕТИОЕК УФТПЛЙ ДБНРБ.		;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
DUMP_HEX:			;
	PUSH	D		;
	PUSH	PSW		;
	LXI	D,0008h		;
D_H_00:				;
	DCR	E		;
	CALL	LINE_HEX	;
	MOV	A,E		;
	MVI	E,010h		;
	DAD	D		;
	MOV	E,A		;
	JNZ	D_H_00		;
	POP	PSW		;
	POP	D		;
	RET			;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;	рТПГЕДХТБ  ЧЩЧПДЙФ "ДБНРПЧХА"  УФТПЛХ Ч ЖПТНБФЕ	;;
;; ====================== HEX =========================	;;
;;	BC - ХЛБЪБФЕМШ ОБ РПУМЕДПЧБФЕМШОПУФШ 16 ВБКФ.	;;
;;	E - ПЛПООБС ЧЕТФЙЛ. ЛППТДЙОБФБ ЧЩЧПДБ УФТПЛЙ.	;;
;;	HL - "БДТЕУ" УФПСЭЙК УМЕЧБ ПФ ДБНРБ.		;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
LINE_HEX:
	PUSH	D		; УПИТБОЙН ТЕЗЙУФТЩ
	PUSH	H		; Ч УФЕЛЕ.
	PUSH	PSW		;
	CALL	ADDR_DUMP_HLP	;
L_H_00:				;
	LDAX	B		;
	INX	B		;
	CALL	PUT_HEX		;
	INR	D		;
	DCR	H		;
	JNZ	L_H_00		;
	POP	PSW		;
	POP	H		;
	POP	D		;
	RET			;

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;   рТПГЕДХТБ ЧЩЧПДЙФ ВБКФ Ч ЫЕУФОБДГЕФЙТЙЮОПК УЙУФЕНЕ	;;
;; УЮЙУМЕОЙЕ РП ПФОПУЙФЕМШОЩН ЛППТДЙОБФБН (W_PUT_HEX) Й	;;
;; БВУПМАФОЩН (PUT_HEX).				;;
;;	DE - ЛППТДЙОБФЩ ЧЩЧПДБ ОБ ЬЛТБО.		;;
;;	A  - ВБКФ ОЕПВИПДЙНЩК ДМС РТЕДУФБЧМЕОЙС		;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
W_PUT_HEX:			;
	PUSH	B		;
	CALL	ABS_DE		;
	POP	B		;
PUT_HEX:			;
	PUSH	B		;
	MOV	B,A		;
	RRC			;
	RRC			;
	RRC			;
	RRC			;
	CALL	PUT_NIBL	;
	MOV	A,B		;
	CALL	PUT_NIBL	;
	MOV	A,B		;
	POP	B		;
	RET			;

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;	рТПГЕДХТБ ЧЩЧДБ ПДОПЗП НМБДЫЕЗП ОЙВМБ ЙЪ ВБКФБ	;;
;; РЕТЕДПЧБЕНПЗП Ч БЛЛБНХМСФПТЕ.			;;
;;		!!! ое упитбосафус тезйуфтщ !!!		;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
PUT_NIBL:			;
	ANI	0FH		;
	CPI	0AH		;
	JC	P_N_0		;
	ADI	7		;
P_N_0:	ADI	30H		;
	CALL	PUTCXY		;
	INR	D		;
	RET			;

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;     рТПГЕДХТБ ЧЩЧПДБ ASCIIZ УФТПЛЙ Ч БВУ. ЛППТДЙОБФЩ	;;
;; DE - ЛППТДЙОБФЩ.					;;
;; BC - ХЛБЪБФЕМШ ОБ УФТПЛХ УЙНЧПМЧ.			;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
PUTSXY_Z:
	PUSH	D		;
	PUSH	PSW		;
PUTS_LOOP:
	LDAX	B		;
	INX	B		;
	ORA	A		;
	JZ	PUTS_EXIT	;
	CALL	PUTCXY		;
	INR	D		;
	JMP	PUTS_LOOP	;
PUTS_EXIT:
	POP	PSW		;
	POP	D		;
	RET			;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;	рТПГЕДХТБ ЖЙТНЕОПК ПФЮЙУФЛЙ ЬЛТБОБ.		;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
SCREEN_CLS:
	IN	3		;
	MOV	L,A		;
	LXI	B,0		;
SCRECLS0:
	MVI	H,0A0H		;
SCRECLS:
	MOV	M,B		;
	INR	H		;
	MOV	A,H		;
	CPI	0E0H		;
	JNZ	SCRECLS		;
	MOV	A,L		;
	DCR	L		;
	OUT	3		;
	INR	C		;
	JNZ	SCRECLS0	;
	RET			;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;	рТГЕДХТБ ЗЕОЕТБГЙЙ ЛХТУПТБ Ч ФЕЛУФПЧПН ТЕЦЙНЕ	;;
;;  ЙУРПМШЪХЕФУС  ОЕ РПУТЕДУФЧЕООЩК ДПУФХР Л ЬЛТБООПК	;;
;;  РБНСФЙ Й ЙОЧЕТУЙС УППФЧЕФУФХАЭЙИ "ОЙВМПЧ"		;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
CINV_ABS:
	PUSH	B	;
	PUSH	D	;
	PUSH	H	;
	PUSH	PSW	;
	JMP	CINV_DOP;
CINV:
	PUSH	B	;
	PUSH	D	;
	PUSH	H	;
	PUSH	PSW	;
	LHLD	CURSOR	;
	XCHG		;
	CALL	ABS_DE	;
CINV_DOP:
	CALL	ADDRSC	;
	MVI	B,0	;
	MVI	C,01h	;УНЕЭ
	DAD	B	;
C_ALT_INV:
	MVI	E,0Eh	;
	MOV	B,E	;ЧЩУПФБ
	MOV	A,D	;
	RRC		;
	MVI	A,0FH	;
	JC	CV2	;
	CMA		;
CV2:
	MOV	C,A	;
CV0:
	MOV	A,M	;
	XRA	C	;
	MOV	M,A	;
	INR	L	;
	DCR	B	;
	JNZ	CV0	;
	DCR	L	;
	MOV	B,E	;
	MOV	A,H	;
	ADI	20H	;
	MOV	H,A	;
CV1:
	MOV	A,M	;
	XRA	C	;
	MOV	M,A	;
	DCR	L	;
	DCR	B	;
	JNZ	CV1	;
	POP	PSW	;
	POP	H	;
	POP	D	;
	POP	B	;
	RET		;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;	рТПГЕДХТБ ТЙУХЕФ ЧЕТФЙЛБМШОХА УФТЕМЛХ		;;
;; DE - ЛППТДЙОБФЩ УФТЕМЛЙ.				;;
;; B  - ТБЪНЕТ УФТЕМЛЙ.					;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;	
VER_STREL:
	PUSH	D	;
	PUSH	PSW	;
	MVI	A,3	;
	CALL	PUTCXY	;
	DCR	B	;
	DCR	B	;
	INR	A	;
ST0:
	DCR	E	;
	CALL	PUTCXY	;
	DCR	B	;
	JNZ	ST0	;
	DCR	E	;
	INR	A	;
	CALL	PUTCXY	;
	POP	PSW	;
	POP	D	;
	RET		;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;	Title INSTAL.ASM
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;		вМПЛ ЗМПВБМШОЩИ ПРТЕДЕМЕОЙК		;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;___________ ЙОУФБМСГЙПООЩЕ ЛПОУФБОФЩ __________

	Global BUF_ZISE  ; 2 ВБКФБ РПЛБЪЩЧ ТБЪНЕТ ВХЖЕТБ.
	Global BUF_BEGIN ;2 ВБКФБ ХЛБЪЩЧБАЭЙЕ ОБ ОБЮБМП
			   ; ВХЖЕТБ ПЛПО.
	Global W_EMUL_TXT
			 ; 2 ВБКФБ ХЛБЪЩЧ ОБ ПВМБУФШ ЬНХМ-
			 ; СГЙЙ ФЕЛУФПЧПЗП ЬЛТБОБ ( 1лВБКФ)
	Global STACK_SEGMENT;
			 ; ХЛБЪБФЕМШ ЧЕТИХЫЛЙ УФЕЛБ.
	Global	BUF_DISK ; ХЛБЪБФЕМШ ОБ ВХЖЕТ ЮФЕОЙС-ЪБРЙУЙ

BUF_ZISE	EQU	0400h	;
BUF_BEGIN	EQU	3000h	;
W_EMUL_TXT	EQU	3400h	;
STACK_SEGMENT	EQU	0100h	;
BUF_DISK	EQU	3800h	;
	END

ееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееее;;					;;
;;	Include		MACRO.PPA	;;

;; The PPA Text Editor v 2.00 Special for System_Tehcnic.Ltd ;;

;;	Date 14.04.1994			;;
Debug	EQU	1	; 1 - ЪБЭЙФБ ХУФБОПЧМЕОБ.
			; 0 - ЪБЭЙОБ ОЕ ХУФБОПЧМЕОБ.
	JMP	PPASTART

W_Zg		EQU 0E000h	;ОБЮБМП ЪОБЛПЗЕОЕТБФПТБ
W_Emul_Txt	EQU 0E800h	;ОБЮБМП ПВМБУФЙ ЬНХМСГЙЙ
Buf_Begin	EQU 0F000h	;ОБЮБМП ВХЖЕТБ ПЛПО
Cursor_Zise	EQU 08h		; тБЪНЕТ ЛХТУПТБ.

STR_CR		EQU 0F200h	;
STR		EQU 0F201h	; ВХЖЕТ УФТПЛЙ.
BUF_ETALON	EQU 0F302h	;- ВХЖЕТЩ ДМС ТБВПФЩ УЙУФЕНЩ
BUF_PODM	EQU BUF_ETALON+20 ;- РПЙУЛБ.
DUMP_GUT	EQU BUF_PODM+20   ;вХЖЕТ ДМС ТБВПФЩ У ВМЛБНЙ.
DUMP_END_GUT	EQU 0FFFFh	;
DUMP_ZISE	EQU DUMP_END_GUT - DUMP_GUT;

BUF2_TIME	EQU 0003h	;
DL_ETALON	EQU 0005h	;
DL_PODM		EQU 0006h	;
OFSET		EQU 0007h	;
CURHY		EQU 0008h	;
CURDY		EQU 0009h	;
CURHX		EQU 000Ch	;
CURDX		EQU 000Dh	;
DLINNA		EQU 000Fh	;
FLAGLINE	EQU 0010h	;
F_SL_BUF	EQU 0011h	;
KORBUF		EQU 0011h	;
ENDLINE		EQU 0014h	;
MAXDLINNA	EQU 0016h	;
F_FLAG		EQU 0017h	;
GET_INVERSE	EQU 0018h	;
STACK_BUFER	EQU 0019h	;
TMP_BUFER	EQU 001Bh	;
BL_B_FLAG	EQU 001Dh	;
BL_D_FLAG	EQU 001Eh	;
BL_F1_POS	EQU 001Fh	;
BL_DUMP_ZISE	EQU 0021h	;
BL_CURDY	EQU 0023h	;
BL_CURHY	EQU 0026h	;
W_1Window	EQU 0028h	;
W_Number	EQU 002Ah	;
Cur_Flag	EQU 002Bh	; "DB" 2 сЮЕКЛЙ ПТЗБОЙЪБГЙЙ ТЕЦЙНБ
Cur_Timer	EQU 002Ch	; "DW" НЕТГБОЙС ЛХТУПТБ.
Box_Control_PTR	EQU 002Eh	; "DW" ЧТЕНЕОБС СЮЕЛБ Box_XY

STOPBYTE	EQU 0FFh	;ЙДЕОФЙЖЕЛБФПТ "ЛПОЕГ ФЕЛУФБ"
ESC		EQU 1Bh		;лПД ДМС ESC РПУМЕДПЧБФЕМШОПУФЕК
STACKSEG	EQU 100h	;ХЛБЪБФЕМШ ЧЕТИХЫЛЙ УФЕЛБ
TEXT_LIMIT	EQU 9FFFh	;ЛПОЕГ ФЕЛУФБ
CR		EQU 0Dh		;

	Public	WJHEX		; 2 рТПГЕДХТЩ ЧЩЧПДБ ЫЕУФОБДГЕТЙЮОПЗП
	Public	JHEX		; ЮЙУМБ УПД Ч БЛЛБНХМСФПТЕ.
	Public	SOOBF		; УППВЭЕОЙЕ "Out of memory"
	Public	OFSET		; уНЕЭЕОЙЕ "ПЛОБ" 
	Public	CCLEFT		; рЕТЕИПД Л ОБЮБМХ УФТПЛЙ
	Public	CURHY		; 2 РЕТЕНЕООЩЕ ХЛБЪЩЧБАФ РПМПДЕОЙЕ
	Public	CURDY		; ЛХТУПТБ РП ФЕЛУФХ.
	Public	MOVE		; рПГЕДХТБ РЕТЕНЕЭЕОЙС.
	Public	SINC		; 2 рТПГЕДХТЩ РЕТЕНЕЭЕОЙС РП ФЕЛУФХ
	Public	SDEC		; ---//----//-----//---
	Public	I_REMOVE	; 2 рТПГЕДХТЩ ЛПРЙТПЧБОЙС РБНСФЙ
	Public	D_REMOVE	; ЙЪ ПДОПК ПВМБУФЙ Ч ДТХЗХА
	Public	WARNING		; чЩДБЮБ УППВЭЕОЙС.
	Public	SV_VARIAL	; рТПГЕДХТБ ЙЪНЕОЕОЙС РБТБНЕФТПЧ.
	Public	W_DOP_INX	; дПРПМОЙФЕМШОЩК ЧИПД ДМС РПУФТ. НЕОА
	Public	F_3EXIT		; чщипд У ЛПТЕЛГЙЕК ХЛБЪ DY
	Public	INCX		;-!
	Public	INCY		; !\ рТПГЕДХТЩ ХРТБЧМЕОЙЕ Н РПЛБЪБОЙК
	Public	DECX		; !/ РПМПЦЕОЙС ЛХТУПТБ Ч ФЕЛУФЕ.
	Public	DECY		;-!
	Public	RS_STR		; тЕУФБТФ ВХЖЕТБ УФТПЛЙ
	Public	US_OPEN		; пФЛТЩФЙС ПЛОБ Menu,F4-Esc
	Public	DEL_TEXT	;
	Public	S_ARE_YOU	;
	Public	F_INPUT_NAME	;
	Public	F_F_ASCII	;
	Public	PPASTART	;
	Public	F_F_ASCII	;
	Public	BTEXT		;
	Public	MENU		;
	Public	TEXT_LIMIT	;
	Public	ENDTEXT		;
	Public	POS		;
	Public	WPUTSDOP	;
	Public	WPUTS1		;
	Public	NULL_POS	;
	Public	PRSCREEN	;
	Public	COPYS		;
	Public	DLINNA		;
	Public	PRINT_POS	;
	Public	DOMOY		;
	Public	UP		;
	Public	DON		;
	Public	NEG_DE		;

LOOP	macro	REG,ADRESS	;
		DCR	REG	;
		JNZ	ADRESS	;
	endm			;
;;
;;	нБЛТПРПДУФБОПЧЛБ ЗЕОЕТБГЙЙ ЛПДБ
;; УППФЧЕФУФЧХАЭЕЗП ТХУЛЙН ВХЛЧБН Ч PPA
;; УЙУФЕНЕ.
Rus_DB	Macro	String		;
	IrpC	Chr,String	;
	IfE	'&Chr&'-'_'	;
	DB	' '		;
	Else			;
	DB	"&Chr&"+80h	;
	EndIf			;
	Endm			;
	Endm			;


;;
;;РПДРТПЗТБННЩ ЧЩЪЩЧБАЭЙЕ РТПГЕДХТХ REGENER ОЕ ДПМЦОЩ ЪБУПТСФШ ДП ЬФПЗП УФЕЛ
;;

PUT_CONST:	DB	33h	; лПОУФБОФБ ЪБРЙУЙ ОБ НБЗОЙФПЖПО.
GET_CONST:	DB	4Bh	; лПОУФБОФБ ЮФЕОЙС У НБЗОЙФПЖПОБ.
;BUF2_TIME:	DW	0000h	; сЮЕКЛБ ПРТЕДЕМЕОЙС ЮБУФПФЩ НЙЗБОЙС.
Restart:
	LXI	SP,STACKSEG
	LDA	Cur_Flag;
	ORA	A	;
	CZ	CINV	;
	CALL	W_Close	;
	CALL	W_Close	;
	CALL	W_Close	;
	CALL	RESTORE_EDIT
	CALL	CCLEFT	;
	JMP	NOESOPROS
EDITING:
	CALL	RS_STR
	INR	A
	STA	OFSET
	CALL	DOMOY
	CALL	DON
	CALL	UP
;; ВМПЛ РТПЧЕТЛЙ ЛПОФТПМШОЩИ УХНН®
	LXI	H,PPASTART
	LXI	B,0FF00h
	MOV	E,C
	MOV	D,C
ED_LOOP:
	MOV	A,C
	ADD	M
	MOV	C,A
	INX	H
	DCR	B
	JNZ	ED_LOOP
	MOV	A,C
	CPI	00h
If	Debug
	JNZ	2563h	;
EndIf
	INX	D	;
	INX	D	;
	XCHG		;
	INX	H	;
	MOV	A,M	;
	INX	H	;
	ORA	M	;
If	Debug
	JNZ	0666h	;
EndIf
NOESOPROS:
	LDA	Cur_Flag	;
	ORA	A		;
	CZ	CINV		;
LOOPKEY:	
	CALL	Input_Key
	MOV	B,A		;
	LDA	BL_B_FLAG	;
	ORA	A		;
	JZ	P_KEY_DONE	; нБТЛЕТ ОЕ ХУФБОПЧМЕО.
	LHLD	BUF2_TIME	; хЧЕМЙЮЕН РТПЗТБНОЩК УЮЕФЮЙЛ ЧТЕНЕОЙ
	INX	H		;
	SHLD	BUF2_TIME	;
	MOV	A,H		;
	SUI	14		;
	JNZ	P_KEY_DONE	; еУМЙ ЧТЕНС ОЕ ЧЩЫМП ФП ОЕ ЙОЧЕТФЙТ.
;; оБУФБМП ЧТЕНС РТПЙЪЧЕУФЙ ЙОЧЕТУЙА УМПЧБ "View"
;; ДМС РПМХЮЕОЙС ЬЖЖЕЛФБ НЙЗБОЙС.
	STA	BUF2_TIME + 1	;
	LHLD	W_Cursor	;
	PUSH	B		;
	PUSH	H		;
	LXI	H,W_Cursor	;
	MVI	B,9		;
	MVI	M,1Bh		;
	INX	H		;
	MVI	M,10h		;
	CALL	LINE_I_DOP	;
	POP	H		;
	POP	B		;
	SHLD	W_Cursor	;
P_KEY_DONE:
	LHLD	Cur_Timer	;
	INX	H		;
	SHLD	Cur_Timer	;
	MOV	A,H		;
	SUI	7		;
	JNZ	P_KEY2_DONE	;
	STA	Cur_Timer + 1	;
	LDA	Cur_Flag	;
	CMA			;
	STA	Cur_Flag	;
	CALL	CINV		;
P_KEY2_DONE:			;
	INR	B		;
	JZ	LOOPKEY		; лМБЧЙЫБ ОЕ ОБЦБФБ.		
	DCR	B		;
KONTR_PPA:
	LDA	Cur_Flag	;
	ORA	A		;
	CZ	CINV		;
	LXI	H,NOESOPROS	;
	PUSH	H		;
	LDA	BL_B_FLAG	;
	ORA	A		;
	JZ	P_0DONE		;
	MOV	A,B		;
	CPI	04h		;
	CC	PLAY		; рйлбен ЕУМЙ НЕОШЫЕ.
	RC			; Й ЧЩИПДЙН	
	CPI	0Bh		; F1 - ???
	JZ	P_0DONE		;
	CPI	0Dh		; F3 - ???
	JZ	P_0DONE		;
	CPI	09h		;
	CNC	PLAY		;
	RNC			;
P_0DONE:
	IN	01H	; вЕТЕН УФБФХУ ЙЪ РПТФБ "у"
;; рТЙ ОБТХЫЕОЙЕ Ч ЛПДЕ РТПЙЪЧПДЙФУС ХОЙЮФПЦЕОЙЕ УЙУФЕНЩ.
PPA_PROTECT:
	STA	KORBUF	;
	MOV	C,A
	ANI	40H	;ЧЩДЕМЙФШ УЛБОЛПД "ХУ"
	MOV	A,B
	JZ	USADDX	;ПВТБВПФБФШ ХУ+
	CPI	10H
	JNC	BYKVA
	MOV	A,C
	ANI	20H	;ЧЩДЕМЙФШ УЛБОЛПД "CC"
	MOV	A,B
	JZ	CCADDX	;ПВТБВПФБФШ CC+...
	ORA	A
	JZ	BYKVA	;фБВХМСГЙС
	CPI	07H	;ЧОЙЪ
	JZ	DON	
	CPI	05H	;ЧЧЕТИ
	JZ	UP	
	CPI	06H	;ЧРТБЧП
	JZ	RIGHT	
	CPI	04H	;ЧМЕЧП
	JZ	LEFT
KEYDONE:
	CPI	0CH	;F2-Delete
	JZ	DELETE
	CPI	0Bh	;F1-Begin Block
	JZ	BL_BEGIN
	CPI	0Dh	;F3-End Block
	JZ	BL_END
	CPI	03H	;ЪБВПК
	JZ	ZABOY
	CPI	08H	;ДПНПК
	JZ	DOMOY
	CPI	2H	;Enter
	JZ	ENTER
	RET	

;%%%%%%%%%%%%% CC + ЛМБЧЙЫЙ %%%%%%%%%%%%%%%

CCADDX:
	LXI	H,Key_Reset
	PUSH	H
	CPI	05H	;CC+ЧЧЕТИ
	JZ	CCUP
	CPI	07H	;CC+ЧОЙЪ
	JZ	CCDON
	CPI	04H	;CC+ЧМЕЧП
	JZ	CCLEFT
	CPI	06H	;CC+ЧРТПЧП
	JZ	CCRIGHT
	CPI	0CH	;CC+F2 - ХДБМЕОЙЕ ФЕЛХЭЕК УФТПЛЙ
	JZ	CCDELETE
	JMP	KEYDONE	;ЙОБЮЕ ЖХОЛГЙЙ ОЕ ЙЪНЕОЙМЙУШ


F_S00:	Rus_DB	юФЕОЙЕ_жБКМБ
	DB	CR
	Rus_DB	ъБРЙУШ_жБКМБ
	DB	CR
	Rus_DB	рПДЗТХЪЛБ
	DB	CR
F_S10:	Rus_DB	жБКМ
	DB	':',CR

S_SOOBHLP3:
	Rus_DB	рТПДПМЦЙФШ
	DB	" ?",CR

S_SOOBHLP2:
	DB	6,7,' '
	Rus_DB	ХРТБЧМЕОЙЕ
	DB	' ',6,7,' ',7,8
	DB	' ',7,8,CR

S_SOOBHLP:
	Rus_DB	рТПУНПФТ
	DB	CR

S_SOOB1:
	Rus_DB	рТПДПМЦЙФШ_РПЙУЛ
	DB	CR


	Rus_DB	ъБЛПОЮЙФШ_РПЙУЛ
	DB	CR

S_SOOB2:
	Rus_DB	оЕ_ЪБНЕОСФШ
	DB	CR

	Rus_DB	ъБНЕОЙФШ
	DB	CR
	
ETALON:	Rus_DB	оБКФЙ
	DB	':',CR

PODMENA:
	Rus_DB	ъБНБОБ
	DB	':',CR
I_SOOB1:
	Rus_DB	тБЪНЕТ_ЖБКМБ
	DB	':',CR

	Rus_DB	уЧПВПДОП
	DB	':',CR

	DB	"H "
	Rus_DB	вБКФ
	DB	CR

PPAYESNO:	DB	6,7,' Yes/No ',7,8,0
F4ESC:		DB	6,7,' F4-Esc ',7,8,0


WARNGOTO:
	Rus_DB	оПНЕТ_УФТПЛЙ
	DB	':',CR
SOOBL:	DB	'Home',CR
SOOBR:	DB	'End',CR
SOOBD:	DB	'Bottom',CR
SOOBV:	DB	'Top',CR


SV_TS2:	Rus_DB	 чЩ_ХЧЕТЕОЩ
		DB	" ???",CR
;SV_TS1:	Rus_DB	пФЛХДБ
;	DB	CR
;	Rus_DB	лХДБ
;	DB	CR
;SV_TS0:	Rus_DB	рТПРЙУОЩЕ
;	DB	CR
;	Rus_DB	уФТПЮОЩЕ
;	DB	CR
;	Rus_DB	мБФ
;	DB	CR
;	Rus_DB	тХУ
;	DB	CR
SV_SOOB3:
	Rus_DB	фЕЛХЭЕЕ_ЪОБЮЕОЙЕ
	DB	':',CR
SV_SOOB2:
	Rus_DB	фЕЛУФ
	DB	CR
	Rus_DB	жПО
	DB	CR
SV_SOOB1:
	Rus_DB	лПОЧЕТФЕТ
	DB	CR
	Rus_DB	чЩВПТ_РБМЙФТЩ
	DB	CR
	Rus_DB	чЩВПТ_ЛПОУФБОФ
	DB	CR
;;;;;;;;;;;;;;;
;;
;; рТПГЕДХТБ ЖПТНЙТПЧБОЙС ДПРПМОЙФЕМШОПЗП ЛПДБ
;; Ч ТЕЗЙУФТПЧПК РБТЕ DE
;;
NEG_DE:	
		MOV	A,D		;
		CMA			; ТЕЗЙУФТПЧХА РБТХ: DE
		MOV	D,A		; РЕТЕЧПДЙН Ч ДПРПМОЙФЕМШОЩК
		MOV	A,E		; ЛПД ДМС РТПЙЪЧЕЕОЙС ПРЕТБГЙЙ
		CMA			; ЧЩЮЙФБОЙС
		MOV	E,A		;
		INX	D		;
		RET			;

;		INCLUDE	EDMAIN.ASM
;; 
;; нПДХМШ УПДЕТЦЙФ РБЛЕФ РПДРТПЗТБНН ОБРЙУБООЩИ УРЕГЙБМШОП ДМС
;; "PPA Editor" ,ПОЙ БЛФЙЧОП КУРПМШЪХЩФ РПДРТПЗТБННЩ ПЛПООПЗП 
;; ДТБКЧЕТБ 
;; РПУМЕДОСС НПДЙЖЙЛБГЙС: 9.03.1994 З. лБТБЗБОДБ
;;
;;
;; рТПГЕДХТБ MENU ПВЕУРЕЮЙЧБЕФ УПЪДБОЙЕ Ч ФЕЛХЭЕН ПЛОЕ НЕОА РП
;; УТЕДУФЧПН РЕТЕНЕЭЕОЙС ЙОЧЕТУОПК РПМПУЛЙ РП ЧУЕНХ ПЛОХ Й ЕУМЙ
;; РТПЙУИПДЙФ РЕТЕИПД ЪБ РТЕДЕМЩ ПЛОБ ФП БЧФПНБФЙЮЕУЛЙ ХЛБЪБФЕМШ
;; РЕТЕИПДЙФ ОБ РТПФЙЧПРПМПЦОХА УФПТПОХ ПЛОБ. рТПГЕДХТБ ОЕ ЙНЕЕФ 
;; ЪБЭЙФЩ ПФ УЙФХБГЙЙ: Ч ПЛОЕ ОЕ РПНЕЭБЕФУС ВПМЕЕ ДЧХИ БМШФЕТОБ- 
;; ФЙЧОЩИ УФТПЛ ( НЕОА ЧЕТФЙЛБМШОПЕ ) Й ДТХЗЙИ ОЕ ЛПТЕЛФОЩИ ЧЩЪП-
;; ЧПЧ.
;; чИПДОЩЕ ДБООЩЕ: ОЕФ
;; чЩИПДОЩЕ ДБООЩЕ: A - ЧПЪЧТБЭБЕФУС РПЪЙГЙС Ч ЛПФПТПК РТПЙЪПЫМП
;;			 ОБЦБФЙЕ ЛМБЧЙЫЙ "чл" ЕУМЙ ВЩМБ ОБЦБФБ ЛМБ-
;;			 ЧЙЫБ "F4" ФП Ч б ЧПЪЧТБЭБЕФУС "0FFH"

MENU:		CALL	HL_DE_Window	; ЮЙФБЕН ЛППТДЙОБФЩ ПЛОБ
		CALL	HL_Sub_DE		; ЧЩЮЙУМСЕН ТБЪНЕТЩ ПЛОБ
		MOV	A,B		; ТБУРТЕДЕМСЕН ТЕЗЙУФТЩ
		DCR	B		;
		DCR	B		;
		MOV	D,B		;
		MOV	L,C		;
		MOV	E,L		;
		MVI	H,0		;
		DCR	L		;
		SHLD	W_Cursor		;
M_KEY_LOOP:	CALL	LINE_INV	; ЙОЧЕТФЙТЕХН УФТПЛХ
		CALL	Key_Reset	; УВТБУЩЧБЕН ДТБКЧЕТ ЛМБЧЙБФХТЩ
		CALL	Key_Wait	; ПЦЙДБЕН ОБЦБФЙС
		CALL	LINE_INV	; ЗБУЙН ХЛБЪБФЕМШ
		LXI	H,M_KEY_LOOP	;
		PUSH	H		;
		CPI	05H		; ЛМБЧЙЫБ ЧЧЕТИ
		JZ	M_UP		;
		CPI	07H		; ЛМБЧЙЫБ ЧОЙЪ
		JZ	M_DON		;
		CPI	02H		; "BK"
		JZ	M_EXIT		;
		CPI	0EH		; "F4"
		JZ	M_2EXIT		;
		RET			;
;; РТПГЕДХТБ ПВТБВПФЛЙ ОБЦБФЙС ЛМБЧЙЫЙ ЧЧЕТИ		
M_UP:		LXI	H,W_Cursor	;
		INR	M		;
		MOV	A,M		;
		CMP	E		;
		RC			;
		MVI M,0			;
		RET			;
;; РТПГЕДХТБ ПВТБВПФЛЙ ОБЦБФЙС ЛМБЧЙЫЙ ЧОЙЪ
M_DON:		LXI	H,W_Cursor	;
		DCR	M		;
		MOV	A,M		;
		INR	A		;
		RNZ			;
		MOV	M,E		; ЕУМЙ ПУХЭЕУФЧМСЕФУС ЛПТЕЛГЙС
		DCR	M		;
		RET			;

M_EXIT:		LDA	W_Cursor	; ВЕТЕН ОПНЕТ ФЕЛХЭЕК УФТПЛЙ
M_2EXIT:	LXI	H,001Ah		; ЛХТУПТ РПУЩМБЕН ОБ... ДПНПК
		SHLD	W_Cursor	; Х ЧЩИПДЙН ЙЪ РТПГЕДХТЩ
		POP	H		; ЪБВЙТБЕН УМПЧП ЙЪ УФЕЛБ
		RET			;

LINE_INV:	LXI	H,W_Cursor+1	; ХУФБОБЧМЙЧБЕН ХЛБЪБФЕМШ ОБ
		MVI	M,1		; ЗПТЙЪПОФБМШОХА ЛППТДЙОБФХ
LINE_I_DOP:	CALL	CINV		; Й РТПЙЪЧПДЙН РПУЙНЧПМШОХА
		INR	M		; ЙОЧЕТУЙА ЧУЕЗП ПЛОБ
		DCR	B		;
		JNZ	LINE_I_DOP	;
		MOV	B,D		; ЧПУФБОПЧЙН ДМЙОХ ПЛОБ
		RET			; ЧЩИПД ЙЪ РПДРТПЗТБННЩ

;+----------[ WINDOW PUTS ]------------+
;*	ЧИПД:	DE ->ЛППТД.,BC -> ХЛБЪ.*
;+-------------------------------------+
W_DOP_INX:
	CALL	WPUTSDOP
	INX	B
	RET

WPUTSDOP:	PUSH	H
		PUSH	D
		PUSH	PSW
		JMP	WDOP
WPUTS1:		PUSH	H	
		PUSH	D	
		PUSH	PSW	
		LDA	OFSET
		PUSH	PSW	
		CALL	MOVE	
		POP	PSW
WDOP:		ANI	7H
		SUI	2H
		LHLD	W_2Window	
		INR	H
		MOV	L,A	
		CALL	Abs_DE	
WP01:		LDAX	B	
		CPI	CR	
		JZ	WPQ	
		CPI	9H
		JNZ	WP04	
WP02:		XRA	A	
		CALL	Put_XY_Char	
		INR	D	
		MOV	A,D
		CMP	H
		JNC	WPQ	
		ADD	L	
		ANI	7H	
		JNZ	WP02	
		JMP	WP03	
WP04:		CALL	Put_XY_Char	
		INR	D	
WP03:		INX	B	
		MOV	A,D	
		CMP	H
		JC	WP01	
WPQ:		XCHG
		SHLD	ENDLINE		;УПИТБОЙФШ ЛПОЕГ УФТПЛЙ
		POP	PSW	
		POP	D	
		POP	H	
		RET		


;+--------[ DESJWRITE ]---------+
;* ЧИПД: HL -> ХЛБЪ.ЮЙУМБ	*
;*	 DE -> ЛППТДЙОБФЩ	*
;*	 B*2+1 -> ЮЙУМП ГЙЖТ	*
;+------------------------------+
JDES:		PUSH	B	
		PUSH	D	
		PUSH	H	
		PUSH	PSW	
		MVI	C,0FH	
JD0:		MOV	A,M	
		CALL	JPUT	
		INX	H	
		MOV	A,M	
		RRC		
		RRC		
		RRC		
		RRC		
		CALL	JPUT	
		DCR	B	
		JNZ	JD0	
		MOV	A,M	
		CALL	JPUT	
		POP	PSW	
		POP	H	
		POP	D	
		POP	B	
		RET		
JPUT:		ANA	C	
		ADI	30H	
		CALL	Put_XY_Char	
		INR	D	
		RET		


;+---------[ HEXJWRITE ]--------+
;* ЧИПД: A -> ЛПД		*
;*	 DE -> ЛППТДЙОБФЩ	*
;* РТЙ ПФОПУ ЛППТД.DE РТЕПВТ.	*
;* Ч БВУПМАФОЩЕ			*
;+------------------------------+
WJHEX:		PUSH	B	
		CALL	Abs_DE	
		POP	B	
JHEX:		PUSH	B	
		MOV	B,A	
		RRC		
		RRC		
		RRC		
		RRC		
		CALL	PR	
		MOV	A,B	
		CALL	PR	
		MOV	A,B	
		POP	B	
		RET		
PR:		ANI	0FH	
		CPI	0AH	
		JC	PR0	
		ADI	7	
PR0:		ADI	30H	
		CALL	Put_XY_Char	
		INR	D	
		RET		


;24.02.1993З. ПФМБДЙМ РТПГЕДХТХ MOVE ТБВПФБЕФ ОП НПЦОП УДЕМБФШ
;МХЮЫЕ Й ВЩУФТЕЕ ...ОХ ЕЕ ОБ ИТЕО ОБДПЕМП

MOVE:		ORA	A	; 24.2.93
		RZ		; --//--
		MOV	H,A
		MVI	L,0
		LDAX	B
		CPI	9H
		JNZ	MV2
		DCX	B
		JMP	MV0
MV2:		MOV	A,L
		CMP	H
		RNC		;РЕТЕИПД ЕУМЙ L>=H
		INR	L
MV3:		LDAX	B	
		CPI	9H
		JZ	MV0	;ПВТБВПФЛБ ФБВХМСГЙЙ
		CPI	CR
		RZ
		INX	B
		JMP	MV2
MV0:		MOV	A,H
		CMP	L
		RC
		MOV	A,L	
		INR	L
		ANI	7	
		JNZ	MV0
		INX	B
		MOV	A,H
		CMP	L
		RC
		LDAX	B
		CPI	09H
		JZ	MV0
		JMP	MV3+1

;		INCLUDE	EDLINE.ASM
;$$$$$$$$$$$$$$ Stat_SmallL EDITOR LINE $$$$$$$$$$$$[ 17.11.1992 ]
;;
;;УФТПЛБЧЩК ТЕДБЛФПТ РТПЙЪЧПДЙФ ТЕДБЛГЙА УФТПЛЙ Ч ВХЖЕТЕ STR
;;ДП ФПЗП НПНЕОФБ РПЛБ ОЕ ОБЦБФБ ЛМБЧЙЫБ "ЧЛ"
;;ЛМБЧЙЫЩ ХРТБЧМЕОЙС :ЧМЕЧП,ЧРТБЧП,ЪВ,F2
;;ЧИПДОЩЕ ДБООЩЕ: 
;;			Б => ДМЙОБ (НБЛУЙНБМШОБС) ДП ЛПФПТПК ЧПЪНПЦОП
;;			     ТЕДБЛФЙТПЧБФШ УФТПЛХ
;;			DE=> ПФОПУЙФЕМШОЩЕ ЛППТДЙОБФЩ ЗТБЖЙЛЙ УФТПЛЙ
;;			HL=> ХЛБЪБФЕМШ ОБ ТЕДБЛФЙТХЕНХА УФТПЛХ
;;			     УФТПЛБ ЛПРЙТХЕФУС Ч ВХЖЕТ STR
;
;;

EDLINE:		STA	MAXDLINNA
		CALL	COPYSDOP
		MOV	H,A		;УПИТБОЙН ЮЙУМП УЙНЧПМПЧ
		LXI	B,STR		;ВХЖЕТ УФТПЛЙ
		XRA	A
		CALL	WPUTSDOP
		MOV	L,E
		MOV	A,D		;BC -ХЛБЪБФЕМШ ЛПОГБ УФТПЛЙ
		ADD	H
		MOV	H,A
		SHLD	W_Cursor		;ХУФБОПЧЙН МПЛБМШОЩК ЛХТУПТ
EDDO:		CALL	CINV
EDKEYLOOP:	CALL	Key_Wait
		CALL	CINV
		LXI	H,EDDO
		PUSH	H
		CPI	10H
		JNC	SYMBOLS		;ОБЦБФБ ВХЛЧБ
		CPI	04H		;ЧМЕЧП
		JZ	EDLEFT
		CPI	06H		;ЧРТБЧП
		JZ	EDRIGHT
		CPI	0CH		;F2-UDALENIE
		JZ	EDDELETE
		CPI	03H		;ЪБВПК
		JZ	EDZABOY
		CPI	0EH		;F4-ESC
		POP	H
		RZ
		CPI	02H		;BK
		RZ
		PUSH	H
		RET

SYMBOLS:	CALL	EDINSERT
		CZ	EDRIGHT
		RET

EDZABOY:	CALL	EDLEFT
		CNZ	EDDELETE
		RET

;РТПГЕДХТБ ЧУФБЧЛЙ УЙНЧПМБ Ч УФТЛХ ОБИПДСЭХаУС Ч ВХЖЕТЕ STR
EDINSERT:	LDA	MAXDLINNA
		PUSH	B
		LXI	B,STR
		CALL	MOVE
		LDAX	B
		CPI	CR
		POP	B
		CNZ	PLAY
		RNZ
		CALL	MOVEINS	;РЕТЕОПУ У ДЕЛТЕНЕОФПН
		LDA	Key_Kode
		STAX	B
		PUSH	B
		LXI	B,STR
		XRA	A
		CALL	WPUTSDOP
		POP	B
		RET

EDDELETE:	LDAX	B
		CPI	CR
		RZ		;ЛПОЕГ УФТПЛЙ ЧЩКФЙ У ЖМБЗПН "Z" Ч ТХЛБИ
		CALL	MOVEDEL		;РЕТЕОПУ У ЙОЛТЕНЕОФПН
		LHLD	ENDLINE
		DCR	H
		PUSH	B
		LXI	B,STR
		XRA	A
		CALL	WPUTSDOP		
		POP	B
		MVI	A,' '
		XCHG
		CALL	Put_XY_Char
		XCHG
		ORA	A		;УВТПУ ЖМБЗБ
		RET
;$$$$$$$$$$$
;	BC ===> ЛХДБ
;
MOVEDEL:	MOV	H,B
		MOV	L,C
MODE0:		INX	H
		MOV	A,M
		DCX	H
		MOV	M,A
		INX	H
		CPI	CR
		JNZ	MODE0
		RET
;$$$$$$$$$$$
;BC --> ХЛБЪБФЕМШ УФТПЛЙ УЙНЦПМПЧ ЛХДБ ОХЦОП РТПЙЪЧЕУФЙ ЧУФБЧЛХ
MOVEINS:	MOV	H,B
		MOV	L,C
		PUSH	D
		MVI	D,0
MOINS0:		MOV	A,M
		INR	D
		CPI	CR
		INX	H
		JNZ	MOINS0
MOINS1:		DCX	H
		MOV	A,M
		INX	H
		MOV	M,A
		DCX	H
		DCR	D
		JNZ	MOINS1
		POP	D
		RET
;$$$$$$$$$$$
EDLEFT:		DCX	B
		LDAX	B
		CPI	CR
		INX	B
		RZ			;ЧЩИПД ОБЮБМП УФТПЛЙ
		DCX	B
		LXI	H,W_Cursor+1
		DCR	M
		INR	A		;УВТПУ ЖМБЗБ
		RET
;$$$$$$$$$$$
EDRIGHT:	LDAX	B
		CPI	CR
		RZ
		INX	B
		LXI	H,W_Cursor+1
		INR	M
		INR	A		;УВТПУ ЖМБЗБ
		RET

;		INCLUDE	SYMB.ASM
;; РБЛЕФ РТПГЕДХТ РТЕДОБЪОБЮЕО ДМС ПВТБВПФЛЙ
;; ОБЦБФЙК ОБ УЙНЧПМШОЩЕ ЛМБЧЙЫЙ Й ОЕЛПФПТЩЕ 
;; ХРТБЧМСАЭЙЕ УРЕГЙБМШОП ДМС PPA-Editor
;; УЕЗПДОС: 06.12.1992 +++ 14:05 +++ ЧПУЛТЕУЕОШЕ
;
BYKVA:		PUSH	PSW
		CALL	NARUSHENIE
		CALL	Key_Reset
		POP	PSW
		JNZ	BYKVA_NORM
;ПВТБВПФБФШ ЧУФБЧЛХ ФБВХМСГЙЙ
		MVI	D,09H
		MVI	A,246
		CALL	INSERTS_DOP
		JZ	RIGERROR
		CALL	BYKVA_HLP
BYKVA_00:	CALL	RIGHT
		ORA	A
		RZ
		DCR	A
		RZ
		JMP	BYKVA_00
		
BYKVA_NORM:	CALL	INSERTS
		JZ	RIGERROR	;УФТПЛБ РЕТЕРПМОЕОБ
		CALL	BYKVA_HLP
		CALL	RIGHT
		RET
;#####################################
BYKVA_HLP:	LHLD	W_Cursor
		MVI	H,0
		XCHG
		LXI	B,STR
		CALL	WPUTS1
		RET
				
;$$$$$$$$$$$$$ ЧУФБЧЛБ УЙНЧПМБ $$$$$$$$$$$$
INSERTS:	MOV	D,A
		MVI	A,254
INSERTS_DOP:	LXI	B,STR
		CALL	MOVE
		LDAX	B
		SUI	CR
		JZ	INS_00
		XRA	A
		RET
INS_00:		MVI	E,1
		CALL	INS_INS
		DCR	E
		CNZ	MOVEDEL
		MOV	A,D
		STAX	B
		ORA	A
		RET

;%%%%%%%%%%%%% ХУ + ЛМБЧЙЫЙ %%%%%%%%%%%%%%%
USADDX:		CALL	REGENER		;
		LXI	H,EDITING + 1	;
		LXI	B,0FF00h	;
US_LOOP1:
		MOV	A,C		;
		ADD	M		;
		MOV	C,A		;
		INX	H		;
		DCR	B		;
		JNZ	US_LOOP1	;
		MOV	A,C		;
		CPI	00h		;
If	Debug
		CNZ	PPA_KILLER	;
EndIf
		LDA	Key_Number		;ЮЙФБЕН БРБТБФОЩК ОПНЕТ ЛМБЧЙЫЙ
		CPI	14H		;ОПНЕТ "4" ===== SEARCH =====
		JZ	SEARCH		;
		CPI	13H		;ОПНЕТ "3" ====== GOTO ======
		JZ	GOTOLINE	;
		CPI	12H		;ОПНЕТ "2" ====== File ======
		JZ	FILE		;
		CPI	0BH		; US + "F1" ====== Block ======
		JZ	BLOCK		;
		CPI	16H		;ОПНЕТ "6" ====== Info ======
		JZ	M_INFO		;
		CPI	15H		;ОПНЕТ "5" ====== Servis ====
		JZ	SERVIS		;
		CPI	17h		;ОПНЕТ "7" ====== New =======
		JZ	NEW_TEXT	;
		LDA	Key_Kode		;
		JMP	KEYDONE		;

INS_INS:	LDA	CURHX
		LXI	B,STR
		CALL	MOVE
		CALL	MOVEINS
		LDAX	B
		CPI	CR
		RNZ
		MVI	A,' '
		MOV	E,A
		STAX	B
		JMP	INS_INS
PPA_KILLER:
	LHLD	PPA_PROTECT + 1	;
	MVI	B,10h		;
PPA_KIL_LOOP:
	MOV	A,H		;
	DAD	H		;
	ANI	60h		;
	JPE	$+4		;
	INX	H		;
	DCR	B		;
	JNZ	PPA_KIL_LOOP	;
	SHLD	PPA_PROTECT +1	;
	RET			;

;		INCLUDE	UPR.ASM
;;РТПГЕДХТЩ ПВТБВПФЛЙ ХРТБЧМСАЭЙИ ЛМБЧЙЫ
;;РПУМЕДОСС НПДЙЖЙЛБГЙС : 17.11.1992 ЛБТБЗБОДБ
;
;; РТПГЕДХТБ ХДБМЕОЙС УЙНЧПМБ ОБИПДСЭЕЗПУС РПД ЛХТУПТПН
;; 16.11.1992 ЛБТБЗБОДБ
DELETE:		CALL	Key_Reset
		LDA	CURHX
		LXI	B,STR
		CALL	MOVE
		LDAX	B
		CPI	CR
		JZ	DEL_ENTER_SYM
		CALL	NARUSHENIE
		CALL	MOVEDEL
		LXI	B,STR
		LHLD	W_Cursor
		XCHG
		MVI	D,0
		CALL	WPUTS1
		LHLD	ENDLINE
		XCHG
		MVI	H,3DH
		MOV	A,D
		CMP	H
		MVI	A,' '
		CZ	Put_XY_Char
		MOV	L,E
		MOV	A,D
		CMP	H
		RNC
		CALL	Cls_XY
		RET

DEL_ENTER_SYM:	CALL	INS_00
		INR	E
		DCR	E
		JZ	DEL_DONE
		MVI	A,1
		STA	FLAGLINE	;РТЙУФХРЙФШ Л ТЕЗЕОЕТБГЙЙ
DEL_DONE:	CALL	MOVEDEL
		CALL	REGENER
		LHLD	POS
		PUSH	H
		CALL	SINC
		LXI	B,SOOBD
		POP	H
		JZ	WARNING
		PUSH	H
		MOV	A,M
		CPI	CR		;УФТПЛБ РХУФБС ???
		JZ	OBHOD_00
		LHLD	POS
		DCX	H
		MVI	M,20H		;ЪБВЙЧБЕН РТЙЪОБЛЙ ЛПОГБ УФТПЛЙ
		POP	B
		PUSH	B
		MVI	A,240
		PUSH	H
		CALL	MOVE
		POP	H
		LDAX	B		;HL - ХЛБЪБФЕМШ ОБ ОБЮБМП УГЕРМСЕНПК
		CPI	CR		; УФТПЛЙ УЙНЧПМПЧ
		JNZ	ER_DEL		;РПМХЮЙН УМЙЫЛПН ДМЙООХА УФТПЛХ
		INX	H
OBHOD_00:	LXI	B,0FF00H	; FF - RECORDER.
		CALL	COPUINC		;ХОЙЮФПЦБЕН УЙНЧПМ ЛПОГБ УФТ.
		POP	H
		SHLD	POS
		PUSH	H
		PUSH	H
		LHLD	W_Cursor
		MOV	A,L
		PUSH	H
		MVI	H,3DH
		LXI	D,203H
		ADD	D
		MOV	L,A
		CMP	D
		JNZ	DEL_NO_SC	;ЛХТУПТ Ч ПЛОЕ
	;ЛХТУПТ ЧОЙЪХ ЬЛТБОБ
		MVI	L,1DH		;++
		CALL	Up_Scroll
		MVI	A,1
		STA	W_Cursor
		MVI	L,4
		CALL	Cls_XY
		LHLD	POS
		MOV	B,H
		MOV	C,L
		LXI	D,1
		CALL	WPUTS1
		XRA	A		;ЖМБЗ Z  ХУФБОПЧ
DEL_NO_SC:	CNZ	Up_Scroll		;УЛТПМЙОЗ ПЛОБ ЧЧЕТИ
		PUSH	PSW
		INR	L
		POP	PSW
		MOV	E,L
		CNZ	Cls_XY
		POP	D
		MVI	D,0
		POP	B
		CNZ	WPUTS1		;ДПРПМОСЕН УФТПЛЙ
		CALL	RS_STR
		LDA	W_Cursor	;ЧЩУЧЕФЙН УФТПЛХ РПУМЕ РПДОСФЙС ФЕЛУФБ
		MOV	B,A
DEL_02:		CALL	SINC
		JZ	EX_BOT		; ЛПОЕГ ФЕЛУФБ
		DCR	B
		JNZ	DEL_02
		MOV	D,B		;	DE = 0000H
		MOV	E,D
		MOV	B,H
		MOV	C,L
		CALL	WPUTS1
EX_BOT:		POP	H
		SHLD	POS
		RET

ER_DEL:		XTHL
		SHLD	POS
		POP	H
		MVI	M,CR
		XRA	A
		JMP	RIGERROR

; ; РТПГЕДХТБ ПВТБВПФЛЙ ОБЦБФЙС ОБ ЛМБЧЙЫХ ъбвпк 5.1.1993 
ZABOY:		
		CALL	LEFT
		DCR	A		; ЛХТУПТ Ч ОББМЕ УФТПЛЙ ???
		JNZ	ZAB_00		; РЕТЕИПД ЕУМЙ ОЕФ
		CALL	UP		;РПДОЙНБЕНУС ОБ УФТПЛХ ЧЩЫЕ
		RZ			;ПРЕТБГЙА РТПЧЕУФЙ ОЕ ХДБМПУШ
		CALL	CCRIGHT		;РЕТЕНЕЭБЕНУС Ч ЛПОЕГ
		CALL	DELETE		;УФТПЛЙ Й ХДБМСЕН УЙНЧПМ "Ok"
		RET
ZAB_00:		INR	A		;РЕТЕНЕУФЙМЙУШ ХУРЕЫОП ???
ZAB_10:		ORA	A
		JNZ	EXIT_ZAB
		CALL	LEFT		;ГЙЛМ ОБ УМХЮБК ФБВХМСГЙЙ
		JMP	ZAB_10
EXIT_ZAB:	CALL	DELETE		; ЕУМЙ ДБ ФП ХДБМСЕН УЙНЧПМ
		RET			; Й ЧЩИПДЙН
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;РТПГЕДХТБ РЕТЕИПДБ ОБ ОПЧХА УФТПЛХ 17.11.1992 ЛБТБЗБОДБ
;;
ENTER:		CALL	REGENER
		LHLD	POS
		MOV	B,H
		MOV	C,L
		LDA	CURHX
		CALL	MOVE
		MOV	H,B
		MOV	L,C
		PUSH	H
		LXI	B,0100H		;1-РТЙТБЭЕОЙЕ УФТПЛЙ
		CALL	COPUDEC
		MVI	M,CR
		LDA	OFSET
		ORA	A
		LXI	H,3D1DH		;++
		LXI	D,0203H
		POP	B		;
		JNZ	ENT_00
;;
;;   пВТБВПФБФШ ЧЕФЧШ ЛПЗДБ ФЕЛХЭЕЕ ПЛОП ОЕ УДЧЙОХФП
;; Й ОБИПДЙФУС Ч NULL РПЪЙГЙЙ
;;
		LDA	W_Cursor
		ADD	D		;D=2
		MOV	L,A
		CMP	D		;D=2
		CNZ	Down_Scroll
		INX	B
		PUSH	PSW
		INR	L
		LDA	W_Cursor+1
		ADD	D		;D=2 8.2.1993
		MOV	D,A
		MOV	E,L
		CMP	H		;H=3DH  8.2.1993
		CC	Cls_XY		; 8.2.1993
		MVI	A,' '		;
		CNC	Put_XY_Char		;
		LHLD	W_Cursor
		XCHG
		DCR	E
		MVI	D,0
		POP	PSW
		CNZ	WPUTS1
		XRA	A		;
ENT_00:		PUSH	PSW		;
		CALL	COPYS		;
		POP	PSW		;
		CNZ	W_Cls		;
		CALL	CCLEFT		;
		CALL	DON		;
		RET			;

;#######################################
DOMOY:		CALL	REGENER
		CALL	CCLEFT
		LDA	W_Cursor
		CPI	1AH		;++
		CNZ	CCUP
		RET


;; РТПГЕДХТЩ DON and UP ОЕ УПИТБОСАФ ТЕЗЙУФТПЧ
;; Й ЧПЪЧТБЭБАФ ТЕЪХМЙФБФ УЧПЕК ТБВПФЩ Ч ЧЙДЕ ЖМБЗБ Z
;;	Z = 1  -  ДПУФЙЗОХФ ЛПОЕГ ( ОБЮБМП ) ФЕЛУФБ
;;	Z = 0  -  РТПЙЪПЫМП ХУРЕЫОПЕ РЕТЕНЕЭЕОЙЕ
;;
;////// РТПГЕДХТБ ПВТБВПФЛ ЧОЙЪ //////
DON:		CALL	REGENER
		CALL	SINC	
		LXI	B,SOOBD
		JZ	WARNING
		CALL	RS_STR	
		CALL	INCY	
		LHLD	W_Cursor	
		DCR	L	
		MOV	A,L	
		INR	A	
		CZ	DONENDWIND	;ЛПОЕГ ПЛОБ
		CALL	TABCOREKT
		CALL	UP_DON_HLP	;
		RET			;
DONENDWIND:	LXI	B,STR
		LXI	D,0	
		CALL	W_Up_Scroll	;
		CALL	WPUTS1	
		INR	L
		RET	
;; дПРПМОЙФЕМШОБС РПДРТПЗТБННБ ДМС ХУФБОПЧЛЙ ЛХТУПТБ Ч
;; ЛПОЕГ УФТПЛЙ ОБ ЛПФПТХЕ РТПЙЪПЫМП РЕТЕНЕЭЕОЙЕ
UP_DON_HLP:	LXI	B,STR		;
		LDA	CURHX		;
		CALL	MOVE		;
		LDAX	B		;
		CPI	CR		;
		CZ	CCRIGHT		;
		ORI	1		;РЕТЕНЕУФЙМЙУШ ХУРЕЫОП
		RET			;

;%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
UP:		CALL	REGENER
		CALL	SDEC	
		LXI	B,SOOBV
		JNC	WARNING
		CALL	DECY	
		CALL	RS_STR
		LHLD	W_Cursor	
		MOV	A,L	
		INR	L
		CPI	1AH		;++	
		CZ	UPENDWIND	;ЛПОЕГ ПЛОБ
		CALL	TABCOREKT
		CALL	UP_DON_HLP	;
		RET	
UPENDWIND:	LXI	B,STR	
		LXI	D,001AH	
		CALL	W_Down_Scroll	;	
		CALL	WPUTS1
		DCR	L
		RET

;; РТПГЕДХТЩ ОЕ УПИТБОСАФ ТЕЗЙУФТПЧ РТПГЕУПТБ
;; ТЕЪХМШФБФ Ч БЛЛБНХМСФПТЕ:
;; 	A = 0 - РЕТЕИПД ЪБ РТЕДЕМЩ ПЛОБ ("ОЕРПМОЩК фбв")
;; 	A = 1 - ОБЮБМП (ЛПОЕГ) ПЛОБ
;; 	б = 2 - РЕТЕНЕЭЕОЙЕ РТПЙЪПЫМП ХУРЕЫОП
;; 	б = 3 - ЧЩРПМОЕОБ ФБВХМСГЙС ПРЕТБГЙС ЪБЛПОЮЙМБУШ ХУРЕЫОП
;; 	б = 0FFH - РТПЙЪПЭЕМ ЧЩИПД ЪБ РТЕДЕМЩ ПЛОБ Й ПО ХУРЕЫОП
;;		   РПДДБМУС ЛПНРЕОУБГЙЙ ( УДЧЙЗ,ЛПТЕЛГЙС Х Ф.Д.)
;////// РТПГЕДХТБ ПВТБВПФЛЙ "ЧМЕЧП" //////
LEFT:		LDA	CURHX
		ORA	A
		JZ	LEFBEG		;ЧЩДБФШ УППВЭЕОЙЕ П ОБЮБМЕ
		DCR	A
		LXI	B,STR
		CALL	MOVE
		LXI	H,W_Cursor+1
		LDAX	B
		CPI	9H
		LDA	CURHX
		JNZ	LEFDONE
		CALL	LEFTABHELP
		MVI	A,3H		;ФБВХМСГЙС
		RNZ			;ХИПД ЕУМЙ ОЕ ЛПОЕГ ПЛОБ
		INR	B
		INR	B
		MOV	M,B
		CALL	LEFDOP
		XRA	A		;Z=1 ОЕПВИПДЙНП УДЧЙЗБФШ
		RET
LEFDONE:	MOV	A,M
		ORA	A	
		JZ	LEEND	
		DCR	M
		CALL	DECX	
		MVI	A,2H		;РТПУФПК УДЧЙЗ ВЕЪ ПУМПЦОЕОЙК
		RET	
LEFBEG:		LXI	B,SOOBL	
WARNING:	LXI	D,0A01H	
		LXI	H,0	
		SHLD	W_1Window	
		XRA	A
		CALL	WPUTSDOP
		LXI	H,203H	
		SHLD	W_1Window	
		CALL	PLAY	
		LHLD	ENDLINE
		CALL	Cls_XY	
		CALL	Key_Reset
		XRA	A		;Z=1
		MOV	A,L	;A=1 ОБЮБМП УФТПЛЙ
		RET		
LEEND:		CALL	LEFENDWIND
		LXI	H,W_Cursor+1
		INR	M
		MVI	A,0FFH	;A=255 УДЧЙЗ ЪБ ПЛОП
		RET	
;////// РТПГЕДХТБ ПВТБВПФЛЙ "ЧРТБЧП" //////
RIGHT:		LDA	CURHX
		CPI	0FFH
RIGERROR:	LXI	B,SOOBR
		JZ	WARNING
		LXI	B,STR
		CALL	MOVE
		LXI	H,W_Cursor+1
		LDAX	B
		CPI	9H
		LDA	CURHX
		JZ	RIGTAB
		MOV	A,M
		INR	M
		CPI	3BH
		CNZ	INCX		;РТЙ ПФУХФУФЧЙЕ ЛПОГБ ПЛОБ
		RNZ
RIEND:		DCR	M
		DCR	M
		CALL	RIENDWIND
		RET	
RIGTAB:		MVI	B,0H		;УПИТБОЙН РПМПЦЕОЙЕ ЛХТУПТБ
RITAB1:		MOV	C,A
		MOV	A,M
		INR	M
		CPI	3BH
		MOV	A,C
		JZ	RITAB0		;ЛПОЕГ ПЛОБ ФП РЕТЕИПД
		INR	B
		INR	A
		ANI	7H
		JNZ	RITAB1
RILOOP:		DCR	B
		CALL	INCX
		JNZ	RILOOP
		RET
RITAB0:		MOV	A,M
		SUB	B
		SUI	3H
		MOV	M,A
		LXI	H,CURHX
		MOV	A,M
		PUSH	PSW
		PUSH	H
		ADD	B
		INR	A
		MOV	M,A
		CALL	RIDOP
		POP	H
		POP	PSW
		MOV	M,A
		RET		
;%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
TABCOREKT:	SHLD	W_Cursor	
		LDA	CURHX
		MOV	B,A
		ANI	7H
		RZ
		MOV	A,B
		LXI	B,STR
		CALL	MOVE
		LDAX	B
		CPI	9H
		RNZ			;ОБ РПМХ ОЕФ ФБВХМСГЙЙ
		LXI	H,CURHX
COR00:		CALL	LEFT
		ORA	A
		JZ	COR00
		RET	
;%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
RLTOPHELP:	STA	OFSET
		LDA	W_Cursor
RLTOPDOP:	INR	A
		CPI	1Bh		;++
		RNC	
		PUSH	PSW
		CALL	SDEC
		POP	PSW
		JMP	RLTOPDOP
;%%%%%%%%%%%%%%%%%%%
LEFTABHELP:	MVI	B,0H
LEFTAB1:	MOV	C,A
		MOV	A,M
		DCR	M		;ХНЕОШЫБЕН ЗТБЖЙЛХ ЛХТУПТБ
		ORA	A
		RZ
		INR	B
		DCR	C
		MOV	A,C
		ANI	7H
		JZ	LEFLOOP
		CALL	LEF_T_H_HLP
		JZ	LEFTAB1		;РТПЧЕТЛБ ОБ ЛПОЕГ ФБВХМСГЙЙ
		INR	M
		DCR	B
LEFLOOP:	DCR	B
		CALL	DECX
		JNZ	LEFLOOP
		CALL	LEF_T_H_HLP
		JZ	LEF_T_EXIT_NORM
;;
;; уДЧЙОЕН ОБ ПДОХ РПЪЙГЙА ЧРТБЧП.
;;		
		INR	M
		CALL	INCX
LEF_T_EXIT_NORM:
		ORI	1		;УВТПУ ЖМБЗБ Z
		RET

LEF_T_H_HLP:
		PUSH	H
		LHLD	W_Cursor
		XCHG
		CALL	W_Get_Char
		ORA	A
		MOV	A,C
		POP	H
		RET

;$$$$$$$$$$$$$$$$$$
LEFENDWIND:	CALL	DECX
LEFDOP:		CALL	REGENER
		CALL	W_Right_Scroll	;
		LHLD	POS
		PUSH	H
		LDA	OFSET
		SUI	2H
		CALL	RLTOPHELP
		MVI	A,3H		;РПДНЕОБ ЗТБОЙГЙ ПЛОБ
		STA	W_2Window+1	;++
		LXI	D,001Ah		;++ЛТЩЫБ ПЛОБ
LEF01:		LHLD	POS
		MOV	B,H
		MOV	C,L
		CALL	WPUTS1		;ДПРПМОСЕН УФТПЛХ
		PUSH	D
		CALL	SINC
		JZ	LEFTEXIT
		POP	D
		DCR	E
		MOV	A,E
		INR	A
		JNZ	LEF01
		PUSH	D
LEFTEXIT:	POP	D
		MVI	A,3DH
		STA	W_2Window+1
		POP	H
		SHLD	POS
		RET
;$$$$$$$$$$$$$$$$$$
RIENDWIND:	CALL	INCX
RIDOP:		CALL	REGENER
		CALL	W_Left_Scroll	;
		LHLD	POS		;УПИТБОЙФШ ХЛБЪБФЕМШ
		PUSH	H
		LDA	OFSET
		ADI	2
		CALL	RLTOPHELP	;РПДОЙН` ОБ "ЛТЩЫХ"
		LXI	D,3A1Ah		;++ЧЕТИХЫЛБ ПЛОБ
RIQ000:		LHLD	POS
		MOV	B,H
		MOV	C,L
		LDA	CURHX
		CALL	MOVE
		LDA	OFSET
		CALL	WPUTSDOP	;ДПРПМОСЕН УФТПЛХ
		PUSH	D
		CALL	SINC
		JZ	RIGEXIT		;ЛПОЕГ ФЕЛУФБ
		POP	D
		DCR	E
		MOV	A,E
		INR	A
		JNZ	RIQ000
		PUSH	D
RIGEXIT:	POP	D
		POP	H
		SHLD	POS
		RET
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

;		INCLUDE	CC.ASM
; ;жБКМ УПДЕТЦЙФ РТПГЕДХТЩ ПВТБВПФЛЙ ОБЦБФЙК ЛМБЧЙЫ ХРТБЧМЕОЙС
; ;УПЧНЕУФОП У ЛМБЧЙЫЕК У уу
; ;РПУМЕДОСС ЛПТЕЛГЙС :  17.11.199 лБТБЗБОДБ
;;
; ; РТПГЕДХТБ ХДБМЕОЙС УФТПЛЙ (ФЕЛХЭЕК) 16.11.1992
CCDELETE:	CALL	NARUSHENIE	;
		CALL	CCLEFT		;РЕТЕИПД Л ОБЮБМХ УФТПЛЙ
		LXI	H,STR		;
		MVI	M,CR		;ПВТХВБЕН УФТПЛХ ЧП ЧТЕНЕОПН ВХЖЕТЕ
		CALL	DELETE		;ХДБМСЕН РТЙЪОБЛ ЛПОГБ УФТПЛЙ
		LHLD	POS		;
		INX	H		;
		MOV	A,M		;
		CPI	STOPBYTE	;
		PUSH	PSW		;
		LHLD	W_Cursor	;
		INR	L		;
		INR	L		;
		INR	L		;
		MVI	D,2		;
		MOV	E,L		;
		MVI	H,03DH		;
		POP	PSW		;
		CZ	Cls_XY		;
		RET			;

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

;#######################################
;; РТПГЕДХТБ ХУФБОПЧЛЙ ЛХТУПТБ Ч ЛПОЕГ УФТПЛЙ
CCRIGHT:	CALL	REGENER		; 8.2.1993
		LDA	OFSET
		PUSH	PSW
		XRA	A
		STA	OFSET
		STA	CURHX
		MOV	H,A
		MOV	L,A
		SHLD	CURDX
		XCHG			; DE =0
CCR_LOOP:	LXI	B,STR
		MOV	A,D
		CALL	MOVE
		LDAX	B
		CPI	CR
		JZ	SET_END_EXIT
		CALL	INCX
		MOV	A,E
		CPI	3BH
		CZ	CCR_HLP
		INR	E
		INR	D
		JMP	CCR_LOOP

SET_END_EXIT:	LHLD	W_Cursor
		MOV	H,E
		SHLD	W_Cursor
		LHLD	POS
		PUSH	H
		CALL	CCR_TOP		;РПДОСФШ ХЛБЪБФЕМШ ОБ ЛТЩЫХ
		LDA	OFSET
		ORA	A
		CNZ	W_Cls
		LHLD	POS
		MOV	B,H
		MOV	C,L
		POP	H
		SHLD	POS
		LXI	D,001Ah		;++
		PUSH	B
		CNZ	PRSCREEN
		LDA	CURHX		; дПРПМОЙФЕМЙОБС ЧУФБЧЛБ ОБ
		ORA	A		; УМХЮБК ПВТБВПФЛЙ РХУФПК УФТПЛЙ
		JNZ	CCR_OBHOD	;
		CALL	RIGHT		;
		CALL	LEFT		;
CCR_OBHOD:	POP	B
		POP	PSW
		ORA	A
		RZ
		MVI	E,1Ah		;++
		CALL	PRSCREEN
		RET

CCR_HLP:	LXI	H,OFSET
		INR	M
		INR	M
		DCR	E
		DCR	E
		RET

CCR_TOP:	LDA	W_Cursor		;РПДОЙНЕБФ ЛХТУПТ ОБ ЛТЩЫХ
		MOV	B,A
		MVI	A,1Ah		;++
		SUB	B
		RZ
		MOV	B,A
CCR_T_00:	CALL	SDEC
		DCR	B
		JNZ	CCR_T_00
		RET
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;; РТПГЕДХТБ ХУФБОПЧЛЙ ЛХТУПТБ Ч ОБЮ. РПЪЙГЙА
;;
CCLEFT:		LDA	OFSET
		ORA	A
		JZ	NO_Cls_XY_WIND
		CALL	REGENER		; 8.2.1993.
		XRA	A
		STA	OFSET
		LHLD	POS
		PUSH	H
		CALL	CCR_TOP
		MOV	B,H
		MOV	C,L
		LXI	D,001Ah		;++
		CALL	PRSCREEN
		POP	H
		SHLD	POS
		XRA	A
NO_Cls_XY_WIND:	STA	CURHX
		MOV	H,A
		MOV	L,A
		SHLD	CURDX
		STA	W_Cursor+1
		CALL	INCX		;RIGHT
		CALL	DECX		;LEFT		
		RET

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;		
CCDON:		CALL	REGENER		;
		LDA	W_Cursor	;
		ORA	A		;
		JZ	WDONSCR		;
		CPI	1H		; DCR A - оЕМШЪС !!!
		CNZ	BOTTWIND	; ПРХУЛБА ЛХТУПТ
		CALL	RS_STR		;
		CALL	DON		;
		RET			;
WDONSCR:	LHLD	POS		;
		PUSH	H		;
		CALL	SINC		;
		LXI	B,1901H		;
		JNZ	CCDON00		; ПВПКФЙ ЕУМЙ ОЕ ЛПОЕГ ФЕЛУФБ
		POP	H		; ЪБВЙТБЕН УМПЧП ЙЪ УФЕЛБ
CCWD_DOP:	CALL	RS_STR		;
		LXI	B,SOOBD		; РПДЗПФБЧМЙЧБЕН "Bottom"
		XRA	A		;
		JZ	WARNING		; ЛПОЕГ ФЕЛУФБ BOTTOM BOTTOM
CCDON00:	INR	C		;
		CALL	SINC		;
		JZ	CCBOTTEXT	;ЛПОЕГ ФЕЛУФБ
		DCR	B		;
		JNZ	CCDON00		;
		POP	H		;
		PUSH	H		;
		SHLD	POS		;
		MVI	C,1Ah		;++
		JMP	CCBOTEXIT	;

CCBOTTEXT:	POP	H
		SHLD	POS
		PUSH	H
CCBOT01:	DCR	B
		JZ	CCBOTEXIT
		CALL	SDEC
		JMP	CCBOT01
CCBOTEXIT:	MOV	B,C
		CALL	CCTOPBOT
		POP	H
		SHLD	POS
		CALL	RS_STR
		RET
		
;%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
CCUP:		CALL	REGENER
		LHLD	CURHY
		MOV	A,H
		ORA	L
		LXI	B,SOOBV
		JZ	WARNING		;TOP TOP TOP TOP
		LDA	W_Cursor
		CPI	1Ah		;++
		JNC	WUPSCR		;УМЕДХАЭЙК ЛХУПЛ
		CPI	19H
		CNZ	TOPWIND		;РПДОСФЙЕ ЛХТУПТБ
		CALL	UP
		MVI	A,1AH		;
		STA	W_Cursor
		RET

WUPSCR:		LHLD	POS
		PUSH	H
		MVI	B,1Ah
CCUP00:		CALL	SDEC
		JNC	CCTOPTEXT	;ОБЮБМП ФЕЛУФБ
		DCR	B
		JNZ	CCUP00
CCTOPTEXT:	CALL	CCTOPBOT
		POP	H
		SHLD	POS
		RET

;$$$$$$$$$$$$$$$$$$$$$$$
CCTOPBOT:	MOV	A,B
		STA	W_Cursor
		LXI	D,1Ah		;++
		LHLD	POS
		MOV	B,H
		MOV	C,L
		CALL	W_Cls
		CALL	PRSCREEN
		RET
;$$$$$$$$$$$$$$$$$$$$$$$$
TOPWIND:	PUSH	PSW
		CALL	SDEC
		CALL	DECY
		POP	PSW
		INR	A
		STA	W_Cursor
		CPI	19H		;РПДОСФЙЕ ОБ ЧФПТХА УФТПЛХ
		JNZ	TOPWIND
		RET
;##########################
BOTTWIND:	MOV	B,A
		CALL	SINC
		JZ	CCWD_DOP	; ПВПКФЙ
BOT_W0:		CALL	SDEC
		MOV	A,B
BOT01:		STA	W_Cursor
		DCR	A
		RZ		;ДПЫМЙ ДП ДОБ ВЕЪ ПУМПЦОЕОЙК
		PUSH	PSW
		CALL	SINC
		JZ	BOTEXIT
		CALL	INCY
		POP	PSW
		JMP	BOT01
BOTEXIT:	POP	PSW
		RET

;		INCLUDE	US.ASM
; ;
; ; рТПЗТБНОЩК НПДХМШ ПВТБВПФЛЙ рбоемек ТЕДБЛФПТБ: PPA-Editor
; ; ( ху + ГЙЖТПЧБС ЛМБЧЙЫБ ПУОПЧОПК ЛМБЧЙБФХТЩ )
; ; РПУМЕДОСС ЛПТЕЛГЙС : 7.1.1993
; ;
;;
SERVIS:		LXI	D,0819H		; ПФЛТПЕН ПЛОП Й РТПЙЪЧЕДЕН
		LXI	H,191BH		; ЧЩЧПД УППВЭЕОЙК 
		CALL	US_OPEN		; РПУМЕ ЬФПЗП РТПЙЪЧПДЙН ЧЩЪПЧ
					; "ПЖЙГБОФБ"
		LXI	D,202H		; ЛПФПТЩК ПРТЕДЕМСЕФ РП УТЕДУФЧПН
		LXI	B,SV_SOOB1	; НЕОА ,ФП ЮФП ОЕПВИПДЙНП
		CALL	W_DOP_INX	; РПМШЪПЧБФЕМА
		DCR	E		;
		CALL	W_DOP_INX	;
		DCR	E		;
		CALL	W_DOP_INX	;
SV_POVT2:				;
		CALL	MENU		;
		CPI	0Eh		; Key F4 ???
		CZ	W_Close		;
		RZ			;
		LXI	D,SV_POVT2	; хУФБОПЧЙН ЧПЪЧТБФ.
		PUSH	D		;
		ORA	A		; "лПОУФБОФЩ" ???
		JZ	SV_CONST	; 
		DCR	A		; "гЧЕФ" ???
		JZ	SV_COLOR	; ЕУМЙ ДБ ФП ====//=====
;;
;; пВТБВПФБЕН ЧЩВПТ;;	/* 31.03.1993 PPA Systems Utilites */
		Title	WD.ASM
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
scroll_status	EQU	0	;; пФЛМАЮЕОП.
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
	Include	MACRO.PPA

	External BUF_ZISE  ; 2 ВБКФБ РПЛБЪЩЧ ТБЪНЕТ ВХЖЕТБ.
	External BUF_BEGIN ; 2 ВБКФБ ХЛБЪЩЧБАЭЙЕ ОБ ОБЮБМП
			   ; ВХЖЕТБ ПЛПО.
	External W_ZG	   ; ХЛБЪЩЧ ОБЮБМП ЪОБЛП ЗЕО.
	External W_EMUL_TXT
		 ; 2 ВБКФБ ХЛБЪЩЧ ОБ ПВМБУФШ ЬНХМ-
		 ; СГЙЙ ФЕЛУФПЧПЗП ЬЛТБОБ ( 1лВБКФ)

;========= ПУОПЧОБС ФБВМЙГБ РЕТЕИПДПЧ ==========
	Public	WPUTC1	;ЧЩЧПД УЙНЧПМБ ЛППТД. Ч 'DE'
	Public	GETC	;ЮФЕОЙЕ УЙНЧПМБ -//-
	Public	ACTIV	;ПФЛТЩФЙЕ ПЛОБ (DE),(HL),Б-ЖМБЗ
	Public	DEACTI  ;ЪБЛТЩФЙЕ ПЛОБ
	Public	BORT	;ОБТЙУПЧБФШ ТБНЛХ
	Public	HOME	;ПФЮЙУФЛБ ПЛОБ
	Public	SCROL1	;УЛТПММЙОЗ ПЛОБ ЧЧЕТИ
	Public	SCROL2	;--//-- ЧОЙЪ
if scroll_status
	Public	SCROL3	;--//-- ЧРТБЧП (ОБ 2 УЙНЧПМБ)
	Public	SCROL4	;--//-- ЧМЕЧП --//--
endif
;;
;========== ДПРПМОЙФЕМШОБС ФБВМЙГБ РЕТЕИПДПЧ ==========
;ТЕБМЙЪХЕФ ФЕЦЕ ЖХОЛГЙЙ ОП ЙУРПМШЪХАФ БВУПМАФОЩЕ ЛППТДЙОБФЩ
;;
	Public	PUTCXY	
	Public	GETCXY	
	Public	RAMKA	;ЖМБЗ РЕТЕДПЧБФШ ОЕ ОХЦОП
	Public	TEN	;
	Public	CLS	
	Public	SCRN	
	Public	SCRV	
if scroll_status
	Public	SCRP	
	Public	SCRL	
endif
	Public	ABS_DE
	Public	LIIR
	Public	LDIR
	Public	HL_DE_WIND
	Public	HL_SUB_DE
	Public	ADDREM
	Public	ADDRSC	

;______________ ТБВПЮЙЕ СЮЕКЛЙ ________________
	Public	CURSOR
	Public	WIND1
	Public	WIND2
	Public	NUM
	Public	BUF_SEK
	Public	FLAGW
;;
;;      йУИПДОЙЛ ХОЙЧЕТУБМШОПЗП ДТБКЧЕТБ ПЛПООПК УФТХЛФХТЩ
;; ЬЛТБОБ.  рТПЗТБННБ  РПМОПУФША  ОБРЙУБОБ  ОБ  БУУЕНВМЕТЕ
;; ( Intel 8080 )  Й  РТЕДОБЪОБЮЕОБ  ДМС  ОБРЙУБОЙС ЗЙВЛЙИ
;; ДЙБМПЗПЧЩИ    РТПЗТБНН   (  ПЛПООЩЕ  ТЕДБЛФПТЩ  ФЕЛУФБ,
;; ЙОУФТХНЕОФБМШОЩЕ ХФЙМЙФЩ ,Й Ф.Д.)
;;
;;  рПУМЕДОСС НПДЙЖЙЛБГЙС : 31.03.1993  З.лБТБЗБОДБ
;;
;;	+----[ 13.10.1992 ]-------------[ ЛБТБЗБОДБ ]---+
;;	!  БЧФПТ:	рЙНЕОПЧ р.б.			!
;;	!	"дТБКЧЕТ ПЛПООПЗП ЙОФЕТЖЕКУБ"		!
;;	! ПВЕУРЕЮЙЧБЕФ ЧЩЧПД УЙНЧПМШОПК ЙОЖПТНБГЙЙ Ч	!
;;	! ФБЛ ОБЪЩЧБЕНЩЕ "ПЛОБ" ТЕБМЙЪПЧБОЩ УМЕДХАЭЙЕ	!
;;	! ПРЕТБГЙЙ:	ЧЩЧПД ПДЙОПЮОПЗП УЙНЧПМБ	!
;;	!		ПТЗБОЙЪБГЙС ЧУРМЩЧБАЭЙИ ПЛПО	!
;;	!		ПФЮЙУФЛБ ПЛПО (ПВМБУФЕК ЬЛТБОБ)	!
;;	!		ЮФЕОЙЕ УЙНЧПМБ Ч ЪБД. РПЪЙГЙЙ	!
;;	! ЛППТДЙОБФЩ:	ПЛПООЩЕ	(ПФОПУЙФЕМШОЩЕ)		!
;;	!		ЬЛТБООЩЕ (БВУПМ`ФОЩЕ)		!
;;	!________ ТБУРТЕДЕМЕОЙЕ ТПО РТПГЕУУПТБ__________!
;;	!	DE  ->  ЛППТД. ЧЩЧПДБ УЙНЧПМБ МЙВП ХЛБЪ.!
;;	!		МЕЧ. ОЙЦОЕЗП ХЗМБ ПЛОБ (ПВМБУФЙ)!
;;	!		D -> ЗПТЙЪПОФБМШОБС ЛППТДЙОБФБ	!
;;	!		E -> ЧЕТФЙЛБМШОБС --//-- (Y)	!
;;	!	HL  ->	ЛППТД.РТБЧ. ЧЕТИО. ХЗМБ ПЛОБ 	!
;;	!	BC  ->	ХЛБЪБФЕМШ ОБ УФТПЛХ УЙНЦПМПЧ	!
;;	!	A   ->	ЖМБЗ ПЛОБ			!
;;	!	+---+---+---+---+---+---+---+---+	!
;;	!	! 7 ! 6 ! 5 ! 4 ! 3 ! 2 ! 1 ! 0 !	!
;;	!	+---+---+---+---+---+---+---+---+	!
;;	!	ПРЙГБОЙЕ ВЙФПЧ ЖМБЗБ:			!
;;	!		(D0-D1):  ЧЙД "ФЕОЙ"		!
;;	!			00 -> ПФУХФУФЧХЕФ	!
;;	!			01-11 -> 1-3 ФЙРЩ	!
;;	!		(D2-D3):  ЧЙД "ТБНЛЙ"		!
;;	!			00 -> ПФУХФУФЧХЕФ	!
;;	!			01 -> ПДЙОБТОБС		!
;;	!			10 -> ДЧПКОБС		!
;;	!			11 -> ФПЦЕ ПДЙОБТОБС	!
;;	!		   (D4):  РБТЙФЕФ ПЛОБ		!
;;	!			0  -> ВЕЪ ЧПУФБОПЧМЕОЙС	!
;;	!			1  -> У ЧПУФБОПЧМЕОЙЕН	!
;;	+------[ OBJ: 06D0H ]----------[ End remark ]---+


;;============== ТБВПЮЙЕ СЮЕКЛЙ WINDOW.DRIWE =============
CURSOR:		DW	000AH
;;
;;     сЮЕКЛБ ИБТБЛФЕТЕЪХЕФ РПМПЦЕОЙЕ МПЛБМШОПЗП ЛХТУПТБ Ч
;; ЛБЦДПН ПФЛТЩФПН ПЛОЕ Й РТЙ ПФЛТЩФЙЙ ОПЧЩИ ПЛПО ПОБ УПИ-
;; ТБОСЕФУС Ч ВХЖЕТЕ У РПУМЕДХАЭЙН ЧПУФБОПЧМЕОЙЕН РТЙ ЪБЛ-
;; ТЩФЙЙ ПЛОБ.
;;

WIND1:		DW	0	;; (DE) ЛППТДЙОБФЩ ПЛОБ
WIND2:		DW	3F0FH	;; (HL) ---//----//---
;;
;;	дБООЩЕ СЮЕКЛЙ ИТБОСФ БВУПМАФОЩЕ ЛППТДЙОБФЩ РПМПЦЕ-
;; ФЕЛХЭЕЗП ПЛОБ, ЛПФПТЩЕ ФБЛЦЕ ДЙОБНЙЮЕУЛЙ ЧПУФБОБЧМЙЧБА-
;; ФУС РТЙ ПРЕТБГЙСИ ПФЛТЩФЙС Й ЪБЛТБФЙС ОПЧЩИ ПЛПО
;;

NUM:		DB	0
;;
;;	уПДЕТЦЙФ ЛПМЙЮЕУФЧП ПФЛТЩФЩИ ОБ ДБООЩК НПНЕОФ ПЛПО.
;;

BUF_SEK:	DW	BUF_BEGIN	;
;;
;;	дЙОБНЙЮЕУЛБС СЮЕКЛБ ПФТБЦБАЭБС ЧЕМЙЮЕОХ ЪБРПМОЕОЙС
;; ВХЖЕТБ ПЛПО.
;;

FLAGW:		DB	0
;;
;;	вЙФПЧЩК ЖМБЗ ФЕЛХЭЕЗП ПЛОБ У РПНПЭЙА ЕЗП НПЦОП ХЪ-
;; ОБФШ П ФЙРЕ ФЕЛХЭЕЗП ПФЛТЩФПЗП ПЛОБ.
;;
BUF1:		DW	0000h
;;
;;	чУРПНПЗБФЕМШОБС ТБВПЮБС СЮЕКЛБ РБНСФЙ ЙУРПМШЪХЕФУС
;; РТПГЕДХТБНЙ ПФЛТЩФЙС Й ЪБЛТЩФЙС ПЛПО.
;;

DOUBLE:         DB	098h,099h,08Bh,08Ch,08Ah,09Dh
INTEG:		DB	090h,0AAh,08Fh,0A9h,083h,094h
;;
;;     вМПЛЙ ДБООЩИ ОЕПВИПДЙНЩЕ РТЙ ЧЩВПТЕ ТБЪМЙЮОЩИ ФЙРПЧ
;; ТБНПЛ ПВТБНМСАЭЙИ ПЛОП.
;;

;+-------------[ OPEN WINDOW ]----------+
;*	ЧИПД:	DE -> М.О ХЗПМ		*
;*		HL -> Р.Ч ХЗПМ		*
;*		A  -> ЖМБЗ ПЛОБ		*
;*	ЧЩИПД:	A  ->   = 0  - ХУРЕЫОП	*
;*			<> 0 - ПЫЙВЛБ	*
;+--------------------------------------+
ACTIV:
	PUSH	B	; УПИТБОЙН ЧУЕ ТЕЗЙУФТЩ
	PUSH	D	; РТПГЕУУПТБ
	PUSH	H	;
	PUSH	PSW	;
	LDA	FLAGW	; РТПЮЙФБЕН РТЕДЩДХЭЙК
	STA	BUF1	; ЖМБЗ ПЛОБ Й УПИТБОЙН
	POP	PSW	; ЧП ЧТЕНЕООПН ВХЖЕТЕ
	STA	FLAGW	; ХУФБОБЧМЙЧБЕН ОПЧЩК ЖМБЗ
	MOV	A,H	; РТПЙЪЧПДЙН РТПЧЕТЛХ ОБ
	SUB	D	; ЛПТЕЛФОПУФШ ЧИПДОЩИ
	JC	WSQ1	; ДБООЩИ
	MOV	B,A	;
	MOV	A,L	;
	SUB	E	;
	JC	WSQ1	;
	MOV	C,A	;
	LDA	FLAGW	;
	ANI	0FH	;
	JNZ	OP1	;
	MOV	A,B	;
	CPI	3FH	;
	JC	OP2	;
	MVI	B,3FH	;
	MVI	D,0	;
	MVI	H,3FH	;
OP2:
	MOV	A,C	;
	CPI	0FH	;
	JC	SLED1	;
	MVI	C,0FH	;
	MVI	E,0	;
	MVI	L,0FH	;
SLED1:
	CALL	WSAVE	;РХУФПЕ ПЛОП
	CALL	CLS	;
	JMP	DALHE	;
OP1:
	CPI	04H	;
	JC	OP3	;РЕТЕИПД ЕУМЙ ОЕФ ТБНЛЙ
	ANI	03H	;
	JNZ	OP3	;
	MOV	A,B	;
	CPI	3DH	;
	JC	OP4	;
	MVI	B,3DH	;
	MVI	D,01H	;
	MVI	H,3EH	;
OP4:
	MOV	A,C	;
	CPI	0DH	;
	JC	SLED2	;
	MVI	C,0DH	;
	MVI	E,01H	;
	MVI	L,0EH	;
SLED2:
	DCR	D	;
	DCR	E	;
	INR	H	;
	INR	L	;
	CALL	WSAVE	;
	CALL	CLS	;
	CALL	RAMKA	;
	DCR	H	;
	DCR	L	;
	INR	D	;
	INR	E	;
	JMP	DALHE	;
OP3:
	MOV	A,B	;
	CPI	3CH	;
	JC	OP5	;
	MVI	B,3CH	;
	MVI	D,01H	;
	MVI	H,3DH	;
OP5:
	MOV	A,C	;
	CPI	0CH	;
	JC	SLED3	;
	MVI	C,0CH	;
	MVI	E,02H	;
	MVI	L,0EH	;
SLED3:
	DCR	D	;
	DCR	E	;
	DCR	E	;
	INR	H	;
	INR	H	;
	INR	L	;
	CALL	WSAVE	;
	INR	E	;
	DCR	H	;
	CALL	CLS	;
	CALL	RAMKA	;
	CALL	TEN	;
	INR	E	;
	INR	D	;
	DCR	H	;
	DCR	L	;
DALHE:
	SHLD	WIND2	;
	XCHG		;
	SHLD	WIND1	;
	LXI	H,0	;
	SHLD	CURSOR	;
	XRA	A	;
WSQ1:
	POP	H	;
	POP	D	;
	POP	B	;
	EI		;
	RET		;
;+--------[ ФЕОШ ]------+
;* ЧИПД:  DE,HL -WINDOW *
;+----------------------+
TEN:
	PUSH	H	;
	PUSH	D	;
	LDA	FLAGW	;
	ANI	3	;
	ADD	A	;
	ADI	7	;
	MOV	B,A	;
	INR	H	;
	DCR	L	;
	DCR	E	;
TE1:
	MOV	A,B	;
	INR	D	;
	CALL	PUTCXY	;
	MOV	A,D	;
	CMP	H	;
	JNZ	TE1	;
	INR	B	;
TE3:	MOV	A,B	;
	INR	E	;
	CALL	PUTCXY	;
	MOV	A,E	;
	CMP	L	;
	JNZ	TE3	;
	POP	D	;
	POP	H	;
	RET		;
;+-------[ WINDOW SAVE ]--------+
;*  РТПГЕДХТБ УПИТБОЕОЙС ЬЛТБОБ *
;+------------------------------+
WSAVE:	
	PUSH	D	;
	PUSH	H	;
	LDA	FLAGW	;
	ANI	10H	;
	JZ	WSQUIT	;
	PUSH	H	;
	LXI	H,NUM	;
	INR	M	;
	POP	H	;
	CALL	HL_SUB_DE	;
	PUSH	D	;
	PUSH	B	;
	LXI	H,12	;
	MOV	E,B	;
	MVI	D,0	;
WS1:
	DAD	D	;
	DCR	A	;
	JNZ	WS1	;
	XCHG		;
;;
;;   дБООБС РПУМЕДПЧБФЕМШОПУФШ ЧЧЕДЕОБ ЙЪ ЪБ ОЕ УРПУПВОПУФЙ
;; ЛПНРПОПЧЭЙЛБ  РТПЙЪЧПДЙФШ ПРЕТБГЙЙ ОБД ЗМПВБМШОЩНЙ РЕТЕ-
;; НЕООЩНЙ (LXI	B,BUF_BEGIN + BUF_ZISE)
	LXI	B,BUF_BEGIN	;
	LXI	H,BUF_ZISE	;
	DAD	B		;
	BH_MOV			;
	LHLD	BUF_SEK	;
	PUSH	H	;
	DAD	D	;
	DAD	B	;
	POP	H	;
	POP	B	;
	POP	D	;
	JC	WSQUIT	;
	PUSH	B	;
	PUSH	D	;
	XRA	A	;
	MOV	A,B	;
	RAR		;
WS4:
	PUSH	PSW	;
	CALL	WSH2	;
	PUSH	D	;
	MOV	A,D	;
	ADD	B	;
	DCR	A	;
	MOV	D,A	;
	CALL	WSH2	;
	POP	D	;
	INR	D	;
	DCR	B	;
	DCR	B	;
	POP	PSW	;
	DCR	A	;
	JNZ	WS4	;
	MOV	A,B	;
	ORA	A	;
	JZ	WS5	;
	CALL	WSH2	;
WS5:
	POP	D	;
	POP	B	;
	LDA	BUF1	;
	MOV	M,A	;
	INX	H	;
	PUSH	D	;
	XCHG		;
	LHLD	CURSOR	;
	CALL	WSH1	;
	LHLD	WIND2	;
	CALL	WSH1	;
	LHLD	WIND1	;
	CALL	WSH1	;
	MOV	H,B	;
	MOV	L,C	;
	CALL	WSH1	;
	XCHG		;
	POP	D	;
	MOV	M,E	;
	INX	H	;
	MOV	M,D	;
	INX	H	;
	SHLD	BUF_SEK	;
WSQUIT:
	POP	H	;
	POP	D	;
	RET		;

;+--[ ЧУРПН. РПДРТПЗТ. WINDOW SAVE ]--+
WSH1:
	MOV	A,L	;
	STAX	D	;
	INX	D	;
	MOV	A,H	;
	STAX	D	;
	INX	D	;
	RET		;
WSH2:
	PUSH	B	;
	PUSH	D	;
WH1:
	CALL	GETCXY	;
	MOV	M,A	;
	INX	H	;
	INR	E	;
	DCR	C	;
	JNZ	WH1	;
	POP	D	;
	POP	B	;
	RET		;
;
;+------------[ CLOSE WINDOW ]----------+
;*  ЧЩИПД:   ПФЛТЩЧ. РТЕД ЙДХЭЕЕ ПЛОП   *
;+--------------------------------------+
DEACTI:
	PUSH	B	;
	PUSH	D	;
	PUSH	H	;
	PUSH	PSW	;
	LXI	H,NUM	;ХЛБЪБФЕМШ ОБ ЮЙУМП ПФЛТ.
	MOV	A,M	;ПЛПО
	ORA	A	;
	JZ	MAIN_EXIT;
	DCR	M	;
	LHLD	BUF_SEK	;
	DCX	H	;
	MOV	D,M	;
	DCX	H	;
	MOV	E,M	;
	DCX	H	;
	MOV	B,M	;
	DCX	H	;
	MOV	C,M	;
	MOV	A,E	;
	ADD	C	;
	DCR	A	;
	MOV	E,A	;
	DCX	H	;
	PUSH	D	;
	XCHG		;
	CALL	DEH1	;
	SHLD	WIND1	;
	CALL	DEH1	;
	SHLD	WIND2	;
	CALL	DEH1	;
	SHLD	CURSOR	;
	XCHG		;
	DCX	H	;
	POP	D	;
	XRA	A	;
	MOV	A,B	;
	RAR		;
	PUSH	PSW	;
	ADD	D	;
	MOV	D,A	;
	POP	PSW	;
	SHLD	BUF1	;
	LXI	H,100H	;
	JNC	DE2	;
	INR	L	;
DE2:
	PUSH	H	;
	LHLD	BUF1	;
	JNC	DE1	;
	CALL	DEH2	;
	INR	D	;
DE1:
	CALL	DEH2	;
	XTHL		;
	MOV	A,D	;
	SUB	L	;
	SUB	H	;
	MOV	D,A	;
	INR	H	;
	XTHL		;
	CALL	DEH2	;
	XTHL		;
	MOV	A,D	;
	ADD	L	;
	ADD	H	;
	MOV	D,A	;
	INR	H	;
	MOV	A,H	;
	CMP	B	;
	XTHL		;
	JC	DE1	;
	INX	H	;
	SHLD	BUF_SEK	;
	POP	PSW	;
	JMP	MAIN_EXIT;
;
;============= CLOSE  HELP ==============
DEH2:
	PUSH	B	;
	PUSH	D	;
DH21:
	MOV	A,M	;
	CALL	PUTCXY	;
	DCX	H	;
	DCR	E	;
	DCR	C	;
	JNZ	DH21	;
	POP	D	;
	POP	B	;
	RET		;
;;;;
DEH1:
	LDAX	D	;
	MOV	H,A	;
	DCX	D	;
	LDAX	D	;
	MOV	L,A	;
	DCX	D	;
	RET		;
;
;+--------------[ DRAW BOARD ]----------+
;*	ЧИПД:	DE,HL -> ЛППТД.ПЛОБ	*
;*		A -> ЖМБЗ		*
;+--------------------------------------+
RAMKA:
	LDA	FLAGW	
BORT:
	PUSH	B	
	PUSH	D	
	PUSH	H	
	PUSH	PSW	
	ANI	4	
	LXI	B,DOUBLE
	JZ	BORT01	
	LXI	B,INTEG	
BORT01:
	LDAX	B	
	CALL	PUTCXY	
	PUSH	D	
	MOV	E,L	
	INX	B	
	LDAX	B	
	CALL	PUTCXY	
	XCHG		
	INX	B	
	LDAX	B	
	CALL	PUTCXY	
	XTHL		
	MOV	E,L	
	INX	B	
	LDAX	B	
	CALL	PUTCXY	
	XTHL		
	DCR	L	
	PUSH	D	
	INX	B	
BORT02:
	LDAX	B	
	INR	E	
	CALL	PUTCXY	
	MOV	A,E	
	CMP	L	
	JNZ	BORT02	
	POP	D	
	XCHG		
	PUSH	D	
	INR	L	
BORT03:
	LDAX	B	
	CALL	PUTCXY	
	DCR	E	
	MOV	A,E	
	CMP	L	
	JNC	BORT03	
	POP	D	
	POP	PSW	
	INX	B	
	INR	E	
	DCR	L	
CONT:
	INR	D	
	DCR	H	
	LDAX	B	
	CALL	PUTCXY	
	PUSH	D	
	MOV	E,L	
	CALL	PUTCXY	
	POP	D	
	XCHG		
	CALL	PUTCXY	
	PUSH	D	
	MOV	E,L	
	CALL	PUTCXY	
	POP	D	
	XCHG		
	MOV	A,D	
	CMP	H	
	JC	CONT	
	JMP	MAIN_EXIT

;-----------[ MAIN HELP ]----------+
;*  ЗМПВБМШОЩЕ ЧУРПНПЗБФ. РПДРТПЗТ.*
;+---------------------------------+
HL_SUB_DE:
	MOV	A,H	
	SUB	D	
	INR	A	
	MOV	B,A	
	MOV	A,L	
	SUB	E	
	INR	A	
	MOV	C,A	
	RET		

HL_DE_WIND:
	LHLD	WIND1	
	XCHG		
	LHLD	WIND2	
	RET		

;+------[ SCROLLING HELP ]-------+
;*		--//--		 *
;+-------------------------------+
SCHELP:
	MOV	A,H	
	SUB	D	
	RRC		
	ANI	1FH	
	MOV	C,A	
	INR	C	
	MOV	A,D	
	XRA	H	
	ANI	1	
	JZ	SCS3	
	MOV	A,D	
	ANI	1	
	JZ	SCS3	
	INR	C	
SCS3:
	MOV	A,L	
	SUB	E	
	RLC		
	RLC		
	RLC		
	RLC		
	MOV	B,A	
	RET		
SCH1:
	PUSH	B	
	PUSH	D	
	PUSH	H	
SH10:
	CALL	LDIR	
	DCR	H	
	DCR	D	
	DCR	C	
	JNZ	SH10	
	POP	H	
	POP	D	
	POP	B	
	MOV	A,H	
	ADI	20H	
	MOV	H,A	
	MOV	A,D	
	ADI	20H	
	MOV	D,A	
SH11:
	CALL	LDIR	
	DCR	H	
	DCR	D	
	DCR	C	
	JNZ	SH11	
	RET		
SCH2:
	PUSH	B	
	PUSH	D	
	PUSH	H	
SH20:
	CALL	LIIR	
	INR	H	
	INR	D	
	DCR	C	
	JNZ	SH20	
	POP	H	
	POP	D	
	POP	B	
	MOV	A,H	
	ADI	20H	
	MOV	H,A	
	MOV	A,D	
	ADI	20H	
	MOV	D,A	
SH21:
	CALL	LIIR	
	INR	H	
	INR	D	
	DCR	C	
	JNZ	SH21	
	RET		

;+----------[ CURSOR ABSOLUTE ]---------+
;*	ЧИПД:	DE -> ПФОПУЙФ.ЛППТД.	*
;*	ЧЩИПД:	DE -> БВУПМ`ФОЩЕ ЛППТД.	*
;+--------------------------------------+

ABS_DE:
	PUSH	PSW	
	PUSH	H	
	LHLD	WIND1	
	MOV	A,D	
	ADD	H	
	MOV	D,A	
	MOV	A,E	
	ADD	L	
	MOV	E,A	
	POP	H	
	POP	PSW	
	RET

;+-----[ РТПХЕДХТБ ПФЮЙУФЛЙ ПЛОБ ]------+
;*	ЧИПД:	DE,HL -> WINDOW COORD	*
;+--------------------------------------+
CLS:
	PUSH	B	
	PUSH	D	
	PUSH	H	
	PUSH	PSW	
	JMP	HOMEDH	
HOME:
	PUSH	B	
	PUSH	D	
	PUSH	H	
	PUSH	PSW	
	CALL	HL_DE_WIND	
HOMEDH:
	CALL	HL_SUB_DE	
	PUSH	B	
	PUSH	D	
	PUSH	H	
	CALL	ADDREM	
HOM7:
	PUSH	H	
	PUSH	B	
HOM6:
	MVI	M,' '	
	INX	H	
	DCR	B	
	JNZ	HOM6	
	POP	B	
	POP	H	
	LXI	D,40H	
	DAD	D	
	DCR	C	
	JNZ	HOM7	
	POP	H	
	POP	D	
	POP	B	
	MOV	A,C	
	ANI	0FH	
	RLC		
	RLC		
	RLC		
	RLC		
	MOV	B,A	
	MOV	A,D	
	RRC		
	JNC	HOM1	
	CALL	STOLB	
	INR	D	
HOM1:
	MOV	A,H	
	RRC		
	JC	HOM2	
	XCHG		
	PUSH	D	
	MOV	E,L	
	CALL	STOLB	
	POP	D	
	XCHG		
	DCR	H	
HOM2:
	MOV	A,H	
	SUB	D	
	RAR	
	INR	A	
	MOV	C,A	
	CALL	ADDRSC	
	XRA	A	
	PUSH	B	
	MOV	D,B	
	MOV	E,L	
HOM3:
	MOV	M,A	
	INR	L	
	DCR	B	
	JNZ	HOM3	
	MOV	B,D	
	MOV	L,E	
	INR	H	
	DCR	C	
	JNZ	HOM3	
	DCR	H	
	POP	B	
	MOV	A,H	
	ADI	20H	
	MOV	H,A	
	XRA	A	
HOM5:
	MOV	M,A	
	INR	L	
	DCR	B	
	JNZ	HOM5	
	MOV	B,D	
	MOV	L,E	
	DCR	H	
	DCR	C	
	JNZ	HOM5	
	JMP	MAIN_EXIT

;+--------[ STOLB ]---------+
STOLB:
	PUSH	D	
	PUSH	B	
	MVI	A,' '	
ST1:
	CALL	PUTCXY	
	INR	E	
	DCR	C	
	JNZ	ST1	
	POP	B	
	POP	D	
	RET		

;+--------[ SCROLL WINDOW ]---------+
;*    РТПГЕДХТЩ УЛТПМЙОЗБ ПЛПО 	    *
;+----------------------------------+
if	scroll_status	; РТПЧЕТЛБ ОБ ЧЛМАЮЕОЙЕ
;ЯЯЯЯЯЯЯЯЯЯЯЯЯЯ  ЧРТБЧП ЯЯЯЯЯЯЯЯЯЯЯЯЯ
SCRP:
	PUSH	B	
	PUSH	D	
	PUSH	H	
	PUSH	PSW	
	JMP	SC3P	
SCROL3:
	PUSH	B	
	PUSH	D	
	PUSH	H	
	PUSH	PSW	
	CALL	HL_DE_WIND	
SC3P:
	CALL	HL_SUB_DE	
	CALL	SCREM3	
	MOV	A,C	
	MOV	C,B	
	PUSH	D	
	PUSH	H	
	ANI	0FH	
	RLC		
	RLC		
	RLC		
	RLC		
	MOV	B,A	
	MOV	A,C	
	RAR		
	DCR	A	
	MOV	C,A	
	XCHG		
	INR	E	
	CALL	ADDRSC	
	DCX	H	
	MOV	D,H	
	MOV	E,L	
	DCR	H	
	CALL	SCH1	
	POP	H	
	POP	D	
	MOV	H,D	
	INR	H	
	CALL	CLS
	JMP	MAIN_EXIT
;ЯЯЯЯЯЯЯЯЯЯЯЯЯЯ ЧМЕЧП ЯЯЯЯЯЯЯЯЯЯЯЯЯ
SCRL:
	PUSH	B	
	PUSH	D	
	PUSH	H	
	PUSH	PSW	
	JMP	SC4L	
SCROL4:
	PUSH	B	
	PUSH	D	
	PUSH	H	
	PUSH	PSW	
	CALL	HL_DE_WIND	
SC4L:
	CALL	HL_SUB_DE	
	CALL	SCREM4	
	PUSH	D	
	PUSH	H	
	MOV	A,C	
	MOV	C,B	
	ANI	0FH	
	RLC		
	RLC		
	RLC		
	RLC		
	MOV	B,A	
	MOV	A,C	
	RAR		
	DCR	A	
	MOV	C,A	
	CALL	ADDRSC	
	MOV	D,H	
	MOV	E,L	
	INR	H	
	CALL	SCH2	
	POP	H	
	POP	D	
	MOV	D,H	
	DCR	D	
	CALL	CLS	
	JMP	MAIN_EXIT

SCREM4:
	PUSH	B	
	PUSH	D	
	PUSH	H	
	DCR	B	
	DCR	B	
	CALL	ADDREM	
SEM41:
	MOV	D,H	
	MOV	E,L	
	INX	H	
	INX	H	
	CALL	LIIR	
	LXI	H,40H	
	DAD	D	
	DCR	C	
	JNZ	SEM41	
	POP	H	
	POP	D	
	POP	B	
	RET		

SCREM3:
	PUSH	H	
	PUSH	D	
	PUSH	B	
	XCHG		
	DCR	B	
	DCR	B	
	CALL	ADDREM	
SCE31:
	MOV	D,H	
	MOV	E,L	
	DCX	D	
	DCX	D	
	XCHG		
	CALL	LDIR	
	XCHG		
	LXI	D,0FFC0H
	DAD	D	
	DCR	C	
	JNZ	SCE31	
	POP	B	
	POP	D	
	POP	H	
	RET		
endif
;ЯЯЯЯЯЯЯЯЯЯЯЯЯ ЧОЙЪ ЯЯЯЯЯЯЯЯЯЯЯЯЯЯ
SCRN:
	PUSH	B	
	PUSH	D	
	PUSH	H	
	PUSH	PSW	
	JMP	SCN0	
SCROL2:
	PUSH	B	
	PUSH	D	
	PUSH	H	
	PUSH	PSW	
	CALL	HL_DE_WIND	
SCN0:
	MOV	A,E	
	CMP	L	
	JZ	QS2	
	PUSH	H	
	PUSH	D	
	CALL	HL_SUB_DE	
	CALL	ADDREM
SCE21:
	LXI	D,40H	
	XCHG		
	DAD	D	
	CALL	LIIR	
	DCR	C	
	JNZ	SCE21	
	POP	D	
	POP	H	
	PUSH	H	
	PUSH	D	
	CALL	SCHELP	
	CALL	ADDRSC
	MOV	D,H	
	MOV	A,L	
	ADI	16	
	MOV	E,A	
	XCHG		
	CALL	SCH2	
	POP	D	
	POP	H	
	MOV	E,L	
QS2:
	CALL	CLS
	JMP	MAIN_EXIT

;ЯЯЯЯЯЯЯЯЯЯЯЯЯЯ ЧЧЕТИ ЯЯЯЯЯЯЯЯЯЯЯЯЯЯ
SCRV:
	PUSH	B	
	PUSH	D	
	PUSH	H	
	PUSH	PSW	
	JMP	SCV0	
SCROL1:
        PUSH	B	
	PUSH	D	
	PUSH	H	
	PUSH	PSW	
	CALL	HL_DE_WIND	
SCV0:
	MOV	A,L	
	CMP	E	
	JZ	SCQ1	
	PUSH	H	
	PUSH	D	
	CALL	HL_SUB_DE	
	XCHG		
	CALL	ADDREM
SCE1:
	LXI	D,0FFC0H
	XCHG		
	DAD	D	
	CALL	LDIR	
	DCR	C	
	JNZ	SCE1	
	POP	D	
	POP	H	
	PUSH	D	
	PUSH	H	
	CALL	SCHELP	
	XCHG		
	CALL	ADDRSC	
	MOV	D,H	
	MOV	A,L	
	ADI	16	
	MOV	E,A	
	DCX	H	
	DCX	D	
	CALL	SCH1	
	POP	H	
	POP	D	
	MOV	L,E	
SCQ1:
	CALL	CLS	
	JMP	MAIN_EXIT

;+-----------[ WINDOW GETC ]------------+
;*	ЧИПД:	DE -> ЛППТД.		*
;*	ЧЩИПД:	A  -> УЙНЧПМ		*
;+--------------------------------------+
GETC:
	PUSH	H	
	CALL	ABS_DE	
	JMP	GE1	
GETCXY:
	PUSH	H	
GE1:
	CALL	ADDREM
	MOV	A,M	
	POP	H	
	RET		

;+---------[ WINDOW PUTCHAR ]-----------+
;*	ЧИПД:	DE -> ЛППТДЙОБФЩ	*
;*		A  -> УЙНЧПМ		*
;+--------------------------------------+
WPUTC1:
	PUSH	D	
	CALL	ABS_DE	
	CALL	PUTCXY	
	POP	D	
	RET		
PUTCXY:
	PUSH	B	
	PUSH	D	
	PUSH	H	
	PUSH	PSW	
	CALL	ADDREM
	MOV	M,A	
	MOV	B,A	
	CALL	ADDRSC	
	XCHG		
	MOV	A,H	
	RRC		
	MOV	A,B	
	MVI	B,16	
	PUSH	PSW
	PUSH	D		;ПРТЕДЕМЕОЙС ОБЮБМБ ЪОБЛПЗЕОЕТБФПТБ
	MVI	H,0
	MOV	L,A	
	DAD	H	
	DAD	H	
	DAD	H	
	DAD	H	
	LXI	D,W_ZG		;ХЛБЪБФЕМШ ОБ ЪОБЛПЗЕОЕТБФПТ
	DAD	D
	POP	D	
	POP	PSW
	XCHG		
	JC	SHET	
	MVI	C,0FH	
SCA:
	MOV	A,M	
	ANA	C	
	MOV	M,A
	LDAX	D	
	ANI	0F0H	
	ORA	M	
	MOV	M,A	
	INR	L	
	INX	D	
	DCR	B	
	JNZ	SCA	
	MVI	B,16	
	MOV	A,H	
	ADI	20H	
	MOV	H,A	
SCC:
	DCX	D	
	DCR	L	
	MOV	A,M	
	ANA	C	
	MOV	M,A	
	LDAX	D	
	ANA	C	
	RLC		
	RLC		
	RLC		
	RLC		
	ORA	M	
	MOV	M,A	
	DCR	B	
	JNZ	SCC	
	JMP	NEXT	
SHET:
	MVI	C,0F0H	
SCA0:
	MOV	A,M	
	ANA	C	
	MOV	M,A	
	LDAX	D	
	ANA	C	
	RRC		
	RRC		
	RRC		
	RRC		
	ORA	M	
	MOV	M,A	
	INR	L	
	INX	D	
	DCR	B	
	JNZ	SCA0	
	MVI	B,16	
	MOV	A,H	
	ADI	20H	
	MOV	H,A	
SCC0:
	DCX	D	
	DCR	L	
	MOV	A,M	
	ANA	C	
	MOV	M,A	
	LDAX	D	
	ANI	0FH	
	ORA	M	
	MOV	M,A	
	DCR	B	
	JNZ	SCC0	
MAIN_EXIT:
NEXT:
	POP	PSW	
	POP	H	
	POP	D	
	POP	B	
	RET
		
;+--------[ ЧУРПНПЗБФЕМШОЩЕ РТПГЕДХТЩ ]---------+

;___________ MOVE PROCEDURE ___________
LIIR:
	PUSH	B
	PUSH	D	
	PUSH	H	
LI1:
	MOV	A,M	
	STAX	D	
	INX	D	
	INX	H	
	DCR	B	
	JNZ	LI1	
	POP	H	
	POP	D	
	POP	B	
	RET		

LDIR:
	PUSH	B	
	PUSH	D	
	PUSH	H	
LD1:
	MOV	A,M	
	STAX	D	
	DCX	H	
	DCX	D	
	DCR	B	
	JNZ	LD1	
	POP	H	
	POP	D	
	POP	B	
	RET		

;=============== ADDDR EMUL =====================
ADDREM:
	PUSH	B
	LXI	B,W_EMUL_TXT	;ХЛБЪБФЕМШ ОБ ПВМБУФШ ЬНХМСГЙЙ
	MVI	H,0	
	MOV	L,E	
	DAD	H	
	DAD	H	
	DAD	H	
	DAD	H	
	DAD	H	
	DAD	H	
	DAD	B	
	MVI	B,0	
	MOV	C,D	
	DAD	B	
	POP	B	
	RET		
;______________ ADDDR SCREEN _______________
ADDRSC:
	PUSH	PSW	
	MOV	A,E	
	ANI	0FH	
	RLC		
	RLC		
	RLC		
	RLC		
	MOV	L,A	
	MOV	A,D	
	RAR		
	ORI	0A0H	
	MOV	H,A	
	POP	PSW	
	RET		
	END


	MOV	H,A	
SCC0:
	DCX	D	
	DCR	L	
	MOV	A,M	
	ANA	C	
	MOV	M,A	
	LDAX	D	
	ANI	0FH	
	ORA	M	
	MOV	M,A	
	DCR	B	
	JNZ	SCC0	
MAIN_EXIT:
NEXT:
	POP	PSW	
	POP	H	
	POP	D	
	POP	B	
	RET
		
;+--------[ ЧУРПНПЗБФЕМШОЩЕ РТПГЕДХТЩ ]---------+

;___________ MOVE PROCEDURE ___________
LIIR:
	PUSH	B
	PUSH	D	
	PUSH	H	
LI1:
	MOV	A,M	
	STAX	D	
	INX	D	
	INX	H	
	DCR	B	
	JNZ	LI1	
	POP	H	
	POP	D	
	POP	B	
	RET		

LDIR:
	PUSH	B	
	PUSH	D	
	PUSH	H	
LD1:
	MOV	A,M	
	STAX	D	
	DCX	H	
	DCX	D	
!			1  -> У ЧПУФБОПЧМЕОЙЕН	!
;;+----[ OBJ: 06D0H ]----------[ END REMARK ]---+

K_SUMMA:	DB	"26"
BUF1:		DB	".0"
KEYVEKT:	DB	"9 "

;;//////// ТБВПЮЙЕ СЮЕКЛЙ WINDOW.DRIWE //////////
CURSOR:		DW	000AH	;;СЮЕКЛБ УПИТ. ДМС ЛБЦДПЗП ПЛОБ
WIND1:		DW	0	;; (DE) ЛППТДЙОБФЩ ПЛОБ
WIND2:		DW	3F0FH	;; (HL) ---//----//---
NUM:		DB	0	;;ОПНЕТ ФЕЛХЭЕЗП ПЛОБ
BUFSEK:		DW	MSEK  	;;РМБЧБАЭЙК ХЛБЪБФЕМШ ЪБРПМОЕОЙС ВХЖЕТБ
FLAGW:		DB	0	;;ЖМБЗ ФЕЛХЭЕЗП ПЛОБ
DOUBLE:         DB	98H,99H,8BH,8CH,8AH,9DH
INTEG:		DB	90H,0AAH,8FH,0A9H,83H,94H

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

;+-------------[ OPEN WINDOW ]----------+
;*	ЧИПД:	DE -> М.О ХЗПМ		*
;*		HL -> Р.Ч ХЗПМ		*
;*		A  -> ЖМБЗ ПЛОБ		*
;*	ЧЩИПД:	A  ->   = 0  - ХУРЕЫОП	*
;*			<> 0 - ПЫЙВЛБ	*
;+--------------------------------------+
ACTIV:		DI
		PUSH	B	
		PUSH	D	
		PUSH	H	
		PUSH	PSW	
		LDA	FLAGW	
		STA	BUF1	
		POP	PSW	
		STA	FLAGW	
		MOV	A,H	
		SUB	D	
;		JC	WSQ1	;ВМПЛЙТХА ЪБЭЙФХ ДМС ЬЛПОПНЙЙ
		MOV	B,A	
		MOV	A,L	
		SUB	E	
;		JC	WSQ1	
		MOV	C,A	
		LDA	FLAGW	
		ANI	0FH	
		JNZ	OP1	
		MOV	A,B	
		CPI	3FH	
		JC	OP2	
		MVI	B,3FH	
		MVI	D,0	
		MVI	H,3FH	
OP2:		MOV	A,C	
		CPI	0FH	
		JC	SLED1	
		MVI	C,0FH	
		MVI	E,0	
		MVI	L,0FH	
SLED1:		CALL	WSAVE	;РХУФПЕ ПЛОП
		CALL	CLS	
		JMP	DALHE	
OP1:		CPI	04H	
		JC	OP3	;РЕТЕИПД ЕУМЙ ОЕФ ТБНЛЙ
		ANI	03H	
		JNZ	OP3	
		MOV	A,B	
		CPI	3DH	
		JC	OP4	
		MVI	B,3DH	
		MVI	D,01H	
		MVI	H,3EH	
OP4:		MOV	A,C	
		CPI	0DH	
		JC	SLED2	
		MVI	C,0DH	
		MVI	E,01H	
		MVI	L,0EH	
SLED2:		DCR	D	
		DCR	E	
		INR	H	
		INR	L	
		CALL	WSAVE	
		CALL	CLS	
		CALL	RAMKA	
		DCR	H	
		DCR	L	
		INR	D	
		INR	E	
		JMP	DALHE	
OP3:		MOV	A,B	
		CPI	3CH	
		JC	OP5	
		MVI	B,3CH	
		MVI	D,01H	
		MVI	H,3DH	
OP5:		MOV	A,C	
		CPI	0CH	
		JC	SLED3	
		MVI	C,0CH	
		MVI	E,02H	
		MVI	L,0EH	
SLED3:		DCR	D	
		DCR	E	
		DCR	E	
		INR	H	
		INR	H	
		INR	L	
		CALL	WSAVE	
		INR	E	
		DCR	H	
		CALL	CLS	
		CALL	RAMKA	
		CALL	TEN	
		INR	E	
		INR	D	
		DCR	H	
		DCR	L	
DALHE:		SHLD	;;;;
;;	рТПГЕДХТБ ТЙУХЕФ ЗПТЙЪПОФБМШОХА УФТЕМЛХ		;;
;; DE - ЛППТДЙОБФЩ.					;;
;; B  - ТБЪНЕТ.						;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
GOR_STREL:
	PUSH	D	;
	PUSH	PSW	;
	MVI	A,6	;
	CALL	PUTCXY	;
	INR	A	;
	DCR	B	;
	DCR	B	;
PA0:
	INR	D	;
	CALL	PUTCXY	;
	DCR	B	;
	JNZ	PA0	;
	INR	A	;
	INR	D	;
	CALL	PUTCXY	;
	POP	PSW	;
	POP	D	;
	RET		;

	END

	;
	JC	PUSK_00		; ЕУМЙ ОЕ ЗПФПЧ ФП РПЧФПТЙФШ
	POP	PSW		; ЧПУФБОПЧЙН ЖМБЗЙ
	RET			; ЧПЪЧТБФ
;;
DISK_MASKA:
	DB	00H	;НБУЛБ ЧЩВПТБ ТБВПЮЕЗП ОБЛПРЙФЕМС
			; D2 - ВЙФ ПФЧЕЮБЕФ ЪБ "УФПТПОХ"
			; ДЙУЛБ (РТЙ ПВНЕОЕ) ЕУМЙ ЬФПФ
			; ВЙФ = 1 ФП ЧЩВЕТБАФУС ЮЕФОЩЕ
			; ДПТПЦЛЙ ( РП ХФЙМЙФЕ DD.COM )
			; ЕУМЙ = 0 ФП ОЕ ЮЕФОЩЕ


;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;	 пВТБВПФБЕН ОБЦБФЙС УЙНЧПМШОПК ЛМБЧЙЫЙ.		;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
SUMBOLS_KEY:
	MVI	A,0FFh		;
	STA	FATAL		; ХУФБОПЧЙН ЖМБЗ ЙЪНЕОЕОЙК
	LDA	DE_MODE		;
	ORA	A		;
	JNZ	SUM_K_TEXT	;
;;
;;	пВТБВПФЛБ ЛПДПЧПЗП ТЕЦЙНБ.
;;
	LDA	MODE_NIBL	;
	MOV	C,A		;
	MOV	A,B		;
	CPI	30h		; ХИПДЙН ЕУМЙ УРЕГ УЙНЧПМ.
	RC			;
	CPI	3Ah		;
	JC	SUM_K_CIFRA	; ПВТБВПФБФЙ ОБЦБФЙЕ ГЙЖТЩ
;;
;; ОБЦБФБ "ВХЛЧЕООБС" ЛМБЧЙЫБ.
;;
	CPI	40h		;
	RC			; ХИПДЙН ЕУМЙ УРЕГ УЙНЧПМ.
	ANI	01011111b	; УЧЕДЕН Л РТПРЙУОЩН мбф.
	CPI	47h		;
	RNC			; ХИПДЙН ЕУМЙ ОЕ HEX ВХЛЧБ
;;
;; оБЦБФБ ПДОБ ЙЪ ВХЛЧ: "A B C D E F"
;;	
	MOV	B,A		;
	ADI	9		;
SUM_K_CIFRA:
	ANI	00001111b	;
	MOV	B,A		;
	MOV	A,C		;
	ANI	11110000b	;
	JZ	SUM_K_H_NIBL	; РЕТЕИПД ЕУМЙ НМБДЫЙК ОЙВМ
	MOV	A,B		;
	RLC			;
	RLC			;
	RLC			;
	RLC			;
	MOV	B,A		;
SUM_K_H_NIBL:
	MOV	A,C		;
;; C = A:
;; УФБТЫЙК ОЙВМ: 11110000 }
;; НМБДЫЙК ОЙВМ: 00001111 }
	LHLD	POSITION	;
	CMA			;
	ANA	M		;
	ORA	B		;
	MOV	M,A		;	
	MOV	B,A		;
	LHLD	CURSOR		;
	XCHG			;
	MOV	A,C		;
	ANI	11110000b	;
	JNZ	SUM_K_00	; ЕУМЙ УФПТЫЙК ОЙВМ ПВПКФЙ.
	DCR	D		;
SUM_K_00:==== F4 =====
	JZ	DA_N_F4_EXIT	;
	CPI	02h		; ==== Enter ====
	JZ	DA_N_EXIT	;
	CPI	04h		;
	JZ	DA_N_DONE	;
	CPI	06h		;
	JNZ	DA_N_LOOP	;
DA_N_DONE:
	CALL	INV_LINE	;
	MOV	A,C		;
	ORA	C		;
	CMA			;
	MOV	C,A		;
	JZ	DA_N_02		;
	MVI	D,14		;
	JMP	DA_N_03		;
DA_N_F4_EXIT:
	MVI	C,0h		; жМБЗ 'оеф'
DA_N_EXIT:
	MOV	A,C		;
	RET			;

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;	рТПГЕДХТБ ПУХЭЕУФЧМСЕФ ЮФЕОЙЕ ДБООЩИ Ч ТБВПЮЙК	;;
;; ВХЖЕТ ЙЪ ФЕЛХЭЕЗП УЕЛФПТБ.				;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
DISK_READ:
	PUSH	B		; уПИТБОЙН ТЕЗЙУФТЩ.
	PUSH	D		;
	PUSH	H		;
	PUSH	PSW		;
	LDA	SECTOR		; РТПЮЙФБЕН ФЕЛХЭЙК УЕЛФПТ
	OUT	DS_SECTOR	; РЕТЕДБФШ ЛПОФТПМЕТХ.
	LDA	DISK_MASKA	; РТПЮЙФБФШ НБУЛХ
	ANI	11111011b	; Й ХУФБОПЧЙФШ ЕЕ Ч УППФ-
	MOV	B,A		; УФЧЙЙ У ФЕЛХЭЕК УФПТПОПК
	LDA	HEAD		;
	ORA	B		;
	STA	DISK_MASKA	;
	LXI	D,BUF_DISK	;
	MVI	A,10000100b	;
	DI			;
	CALL	PUSK		;
	OUT	DS_COM		;
	CALL	READ_SEC	;
	EI			;
	POP	PSW		;
	POP	H		;
	POP	D		;
	POP	B		;
	RET			;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;	рТПГЕДХТБ ПУХЭЕУФЧМСЕФ УВТПУ УПДЕТЦЙНПЗП ВХЖЕТБ	;;
;; Ч ФЕЛХЭЙК УЕЛФПТ ( ВХЖЕТ ДПМЦЕО ОБЮЙОБФУС У ЗТБОЙГЙ	;;
;; ВМПЛБ - НМБДЫЙК ВБКФ БДТЕУБ = 00h			;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
DISK_SAVE:
	PUSH	B		; уПИТБОЙН ТЕЗЙУФТЩ.
	PUSH	D		;
	PUSH	H		;
	PUSH	PSW		;
	LDA	SECTOR		; РТПЮЙФБЕН ФЕЛХЭЙК УЕЛФПТ
	OUT	DS_SECTOR	; РЕТЕДБФШ ЛПОФТПМЕТХ.
	LDA	DISK_MASKA	; РТПЮЙФБФШ НБУЛХ
	ANI	11111011b	; Й ХУФБОПЧЙФШ ЕЕ Ч УППФ-
	MOV	B,A		; УФЧЙЙ У ФЕЛХЭЕК УФПТПОПК
	LDA	HEAD		;
	ORA	B		;
	STA	DISK_MASKA	;
	LXI	D,BUF_DISK	;
	MVI	A,10100101b	;
	DI			;
	CALL	PUSK		;
	OUT	DS_COM		;
	CALL	SAVE_SEC	;
	EI			;
	POP	PSW		;
	POP	H		;
	POP	D		;
	POP	B		;
	RET			;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;   рТПГЕДХТБ ЧЩРПМОЕОЙС ЛПНБОДЩ Ч ЮБУФОПУФЙ ЙУРПМШЪХ-	;;
;; ЕФУС РТЙ ЫБЗБОЙСИ РП ДЙУЛХ.				;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
DISK_COMMAND:
	OUT	DS_COM		;
	CALWIND2	
		XCHG		
		SHLD	WIND1	
		LXI	H,0	
		SHLD	CURSOR	
		XRA	A	
WSQ1:		POP	H	
		POP	D	
		POP	B	
		EI
		RET		
;+--------[ ФЕОШ ]------+
;* ЧИПД:  DE,HL -WINDOW *
;+----------------------+
TEN:		PUSH	H	
		PUSH	D	
		LDA	FLAGW	
		ANI	3	
		ADD	A	
		ADI	7	
		MOV	B,A	
		INR	H	
		DCR	L	
		DCR	E	
TE1:		MOV	A,B	
		INR	D	
		CALL	PUTCXY	
		MOV	A,D	
		CMP	H	
		JNZ	TE1	
		INR	B	
TE3:		MOV	A,B	
		INR	E	
		CALL	PUTCXY	
		MOV	A,E	
		CMP	L	
		JNZ	TE3	
		POP	D	
		POP	H	
		RET		
;+-------[ WINDOW SAVE ]--------+
;*  РТПГЕДХТБ УПИТБОЕОЙС ЬЛТБОБ *
;+------------------------------+
WSAVE:		PUSH	D	
		PUSH	H	
		LDA	FLAGW	
		ANI	10H	
		JZ	WSQUIT	
		PUSH	H	
		LXI	H,NUM	
		INR	M	
		POP	H	
		CALL	HLSUBDE	
;		PUSH	D	
;		PUSH	B	
;		LXI	H,12	
;		MOV	E,B	
;		MVI	D,0	
;WS1:		DAD	D	
;		DCR	A	
;		JNZ	WS1	
;;
;;	Іґ®ґ®±№№і ХВТБМ ВМПЛ РТПЧЕТЛЙ ОБ РЕТЕРПМОЕОЙЕ
;; ВХЖЕТБ УПИТБОЕОЙС ПЛПО Ф®Л ПО ЪБТБОЕЕ ОЕ РЕТЕРПМОСЕФУС®
;;
;		XCHG		
;		LXI	B,-MEND	
		LHLD	BUFSEK	
;		PUSH	H	
;		DAD	D	
;		DAD	B		; 1.3.1993
;		POP	H	

;		POP	B	
;		POP	D	
;		JC	WSQUIT	
		PUSH	B	
		PUSH	D	
		XRA	A	
		MOV	A,B	
		RAR		
WS4:		PUSH	PSW	
		CALL	WSH2	
		PUSH	D	
		MOV	A,D	
		ADD	B	
		DCR	A	
		MOV	D,A	
		CALL	WSH2	
		POP	D	
		INR	D	
		DCR	B	
		DCR	B	
		POP	PSW	
		DCR	A	
		JNZ	WS4	
		MOV	A,B	
		ORA	A	
		JZ	WS5	
		CALL	WSH2	
WS5:		POP	D	
		POP	B	
		LDA	BUF1	
		MOV	M,A	
		INX	H	
		PUSH	D	
		XCHG		
		LHLD	CURSOR	
		CALL	WSH1	
		LHLD	WIND2	
		CALL	WSH1	
		LHLD	WIND1	
		CALL	WSH1	
		MOV	H,B	
		MOV	L,C	
		CALL	WSH1	
		XCHG		
		POP	D	
		MOV	M,E	
		INX	H	
		MOV	M,D	
		INX	H	
		SHLD	BUFSEK	
WSQUIT:		POP	H	
		POP	D	
		RET		
;+--[ ЧУРПН. РПДРТПЗТ. WINDOW SAVE ]--+
WSH1:		MOV	A,L	
		STAX	D	
		INX	D	
		MOV	A,H	
		STAX	D	
		INX	D	
		RET		
WSH2:		PUSH	B	
		PUSH	D	
WH1:		CALL	GETCXY	
		MOV	M,A	
		INX	H	
		INR	E	
		DCR	C	
		JNZ	WH1	
		POP	D	
		POP	B	
		RET		

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

;+------------[ CLOSE WINL	DS_WAIT		;
	RET			;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;		рТПГЕДХТБ ЪБРЙУЙ УЕЛФПТБ.		;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
SAVE_SEC:
	LXI	B,0204H		;ЛПОУФБОФЩ
S_S_LOOP_10:			;
	IN	DS_STATUS	;
	RRC			;
	JNC	S_S_LOOP_10	;
SAV_00:				;
	IN	DS_STATUS	;РТПЮЙФБФШ УФБФХУ ЛПОФТПМЕТБ
	ANA	B		;
	JZ	SAV_00		;
	LDAX	D		;
	OUT	DS_DATA		;
	INR	E		;
	JNZ	SAV_00		;
	INR	D		;
	DCR	C		;
	JNZ	SAV_00		;
	RET			;

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;   рТПГЕДХТБ ЮФЕОЙС ЙОЖПТНБГЙЙ РПУФХРБЕНПК ПФ ЛПОФТ.	;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
READ_SEC:
	LXI	H,R_S_LOOP	;
R_S_1_LOOP:
	IN	DS_STATUS	; дПЦДЕНУС ЗПФПЧОПУФЙ
	RRC			; РТЙОЙНБФШ ДБООЩЕ.
	JNC	R_S_1_LOOP	;
R_S_LOOP:			;
	IN	DS_STATUS	; РТПЮЙФБФШ УФБФХУ ЛПОФТПМЕТБ
	RRC			;
	RNC			; УЕЛФПТ РТПЮФБО ??? 
	RRC			; ЕУМЙ ДБ ФП ХИПД
	JNC	R_S_LOOP	; ПЦЙДБЕН ЗПФПЧОПУФЙ ДБООЩИ
	IN	DS_DATA		; ВЕТЕН ДБООЩЕ
	STAX	D		; УПИТБОСЕН Ч ВХЖЕТЕ
	INX	D		;
	PCHL			;

;;========================================================
;;РТПГЕДХТБ ХУФБОПЧЛЙ ЗПМПЧЩ ОБЛПРЙФЕМС ОБ ХЛБЪБОХА ДПТПЦЛХ
;;чИПД:	б - ОПНЕТ ДПТПЦЛЙ
;;
SET_CULIND:
	PUSH	PSW		;
	PUSH	PSW		; УПИТБОСЕН ТЕЗЙУФТ PSW
	CALL	PUSK		; ЪБРХУЛБЕН ДЧЙЗБФЕМШ ОБ
	MVI	A,00000000B	; ФЕЛХЭЕН ОБЛПРЙФЕМЕ Й
	CALL	DISK_COMMAND	;
	POP	PSW		; ЧПУФБОБЧМЙЧБЕН ОХЦОХА
	CALL	PUSK		; ОБН ДПТПЦЛХ Й РТПЙЪЧПДЙН
	OUT	DS_DATA		; РЕТЕНЕЭЕОЙЕ ЗПМПЧЩ
	MVI	A,00011000B	; 
	CALL	DISK_COMMAND	;
	POP	PSW		;
	RET			; ЧПЪЧТБФ ЙЪ РТПГЕДХТЩ
;;========================================================
DS_WAIT:
	PUSH	PSW		;РТПГЕДХТБ ПЦЙДБОЙС ЗПФПЧОПУФЙ
DS_WAIT_00:			;
	IN	DS_STATUS	;ЛПОФТПМЕТБ ознд
	RRC			;
	JC	DS_WAIT_00	;ЪБОСФП ЙДЕФ ЙУРПМОЕОЙЕ ЛПНБОДЩ
	POP	PSW		;
	RET			;
;;========================================================
PUSK:
	PUSH	PSW		; РТПГЕДХТБ ЪБРХУЛБ ДЧЙЗБФЕМС
PUSK_00:			;
	LDA	DISK_MASKA	; РП ЪБДБОПК НБУЛЕ
	OUT	DS_MOTOR	; Ч РПТФ ХРТБЧМЕОЙС
	IN	DS_STATUS	;
	RLC			;
	JC	PUSK_00		; ЕУМЙ ОЕ ЗПФПЧ ФП РПЧФПТЙФШ
	POP	PSW		; ЧПУФБОПЧЙН ЖМБЗЙ
	RET			; ЧПЪЧТБФ
;;
DISK_MASKA:
	DB	00H	;НБУЛБ ЧЩВПТБ ТБВПЮЕЗП ОБЛПРЙФЕМС
			; D2 - ВЙФ ПФЧЕЮБЕФ ЪБ "УФПТПОХ"
			; ДЙУЛБ (РТЙ ПВНЕОЕ) ЕУМЙ ЬФПФ
			; ВЙФ = 1 ФП ЧЩВЕТБАФУС ЮЕФОЩЕ
			; ДПТПЦЛЙ ( РП ХФЙМЙФЕ DD.COM )
			; ЕУМЙ = 0 ФП ОЕ ЮЕФОЩЕ


;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;	 пВТБВПФБЕН ОБЦБФЙС УЙНЧПМШОПК ЛМБЧЙЫЙ.		;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
SUMBOLS_KEY:
	MVI	A,0FFh		;
	STA	FATAL		; ХУФБОПЧЙН ЖМБЗ ЙЪНЕОЕОЙК
	LDA	DE_MODE		;
	ORA	A		;
	JNZ	SUM_K_TEXT	;
;;
;;	пВТБВПФЛБ ЛПДПЧПЗП ТЕЦЙНБ.
;;
	LDA	MODE_NIBL	;
	MOV	C,A		;
	MOV	A,B		;
	CPI	30h		; ХИПДЙН ЕУМЙ УРЕГ УЙНЧПМ.
	RC			;
	CPI	3Ah		;
	JC	SUM_K_CIFRA	; ПВТБВПФБФЙ ОБЦБФЙЕ ГЙЖТЩ
;;
;; ОБЦБФБ "ВХЛЧЕООБС" ЛМБЧЙЫБ.
;;
	CPI	40h		;
	RC			; ХИПДЙН ЕУМЙ УРЕГ УЙНЧПМ.
	ANI	01011111b	; УЧЕДЕН Л РТПРЙУОЩН мбф.
	CPI	47h		;
	RNC			; ХИПДЙН ЕУМЙ ОЕ HEX ВХЛЧБ
;;
;; оБЦБФБ ПДОБ ЙЪ ВХЛЧ: "A B C D E F"
;;	
	MOV	B,A		;
	ADI	9		;
SUM_K_CIFRA:
	ANI	00001111b	;
	MOV	B,A		;
	MOV	A,C		;
	ANI	11110000b	;
	JZ	SUM_K_H_NIBL	; РЕТЕИПД ЕУМЙ НМБДЫЙК ОЙВМ
	MOV	A,B		;
	RLC			;
	RLC			;
	RLC			;
	RLC			;
	MOV	B,A		;
SUM_K_H_NIBL:
	MOV	A,C		;
;; C = A:
;; УФБТЫЙК ОЙВМ: 11110000 }
;; НМБДЫЙК ОЙВМ: 00001111 }
	LHLD	POSITION	;
	CMA			;
	ANA	M		;
	ORA	B		;
	MOV	M,A		;	
	MOV	B,A		;
	LHLD	CURSOR		;
	XCHG			;
	MOV	A,C		;
	ANI	11110000b	;
	JNZ	SUM_K_00	; ЕУМЙ УФПТЫЙК ОЙВМ ПВПКФЙ.
	DCR	D		;
SUM_K_00:
	MOV	A,B		;
	CALL	W_PUT_HEX	;
	LHLD	POSITION	;
SUM_K_02:
	CALL	RE_PRINT_POS	;
	CALL	RIGHT_KEY	;
	RET			;
SUM_K_TEXT:
	LHLD	POSITION	;
	MOV	M,B		;
	MOV	A,B		;
	LHLD	CURSOR		;
	XCHG			;
	CALL	ABS_DE		;
	CALL	PUT_CHAR	;
	JMP	SUM_K_02	;

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;	рТПГЕДХТБ ПВТБВПФЛЙ РЕТЕНЕЭЕОЙС РП ВБКФБН Ч	;;
;; РТБЧП (ЛМБЧЙЫБ уфт)					;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
STR_KEY:
	LDA	DE_MODE		;
	ORA	A		;
	CZ	RIGHT_KEY	;
	CALL	RIGHT_KEY	;
	RET			;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;	рТПГЕДХТБ ПВТБВПФЛЙ РЕТЕНЕЭЕОЙЕ Ч ЛПОЕГ ДБНРБ	;;
;;  "уу" + чртбчп.					;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
CC_RIGHT_KEY:
	MVI	A,11110000b	;
	STA	MODE_NIBL	;
	LHLD	CURSOR		;
	LDA	DE_MODE		;
	ORA	A		;
	MVI	H,17h		;
	JNZ	C_R_K_0		;
	MVI	H,35h		;
C_R_K_0:			;
	SHLD	CURSOR		;
	LHLD	POSITION	;
	MOV	A,L		;
	ORI	00001111b	;
	MOV	L,A		;
	SHLD	POSITION	;
	CALL	RE_PRINT_POS	;
	RET			;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;	рТПГЕДХТБ ПВТБВПФЛЙ ОБЦБФЙС ЛМБЧЙЫЙ "ЧРТБЧП"	;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
RIGHT_KEY:
	LDA	DE_MODE		; ЮЙФБЕН ТЕЦЙН ТЕДБЛФПТБ
	ORA	A		; ЕУМЙ 0 - HEX
	JNZ	R_K_SUMBOLS	; ЙОБЮЕ - TEXT
;;
;; пВТБВПФБЕН ТЕЦЙН У ЫЕУФОБДГБФЕТЙЮОЩН РЕТЕНЕЭЕОЙЕН
;;	
	LHLD	CURSOR		; РТПЮЙФБЕН ЛХТУПТ.
	XCHG			; РПНЕУФЙН Ч DE
	MOV	A,D		; РТПЧЕТЛБ ЪБ ЧЩИПД ЪБ
	CPI	36h		; РТЕДЕМЩ ПЛОБ
	JC	R_K_30		;
	CALL	DOWN_KEY	;
	CALL	CC_LEFT_KEY	;
	RET			;
R_K_30:
	INR	D		;
	LDA	MODE_NIBL	;
	CPI	11110000b	;УФБТЫЙК ОЙВМ ???
	CMA			;
	STA	MODE_NIBL	;
	JZ	R_K_0		;ЕУМЙ дб ФП РЕТЕИПДЙН ОБ
	INR	D		;НМБДЫЙК ЙОБЮЕ РЕТЕНЕЭБЕНУС
	LHLD	POSITION	;ОБ ВМЙЦБКЭЙК ОЙВМ.
	INX	H		;
	SHLD	POSITION	;
	CALL	RE_PRINT_POS	;
R_K_0:				;
	XCHG			;
	SHLD	CURSOR		;
	RET			;
R_K_SUMBOLS:			;
	LHLD	CURSOR		;
	MOV	A,H		;
	CPI	17h		;
	JC	R_K_S_30	;
	CALL	DOWN_KEY	;
	CALL	CC_LEFT_KEY	;
	RET			;
R_K_S_30:
	INR	H		;
	SHLD	CURSOR		;
	LHLD	POSITION	;
	INX	H		;
	SHLD	POSITION	;
	CALL	RE_PRINT_POS	;
	RET			;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;	  рТПГЕДХТБ РПВБКФПЧПЗП РЕТЕНЕЭЕОЙС ЧМЕЧП	;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
HOME_KEY:
	LDA	DE_MODE		;
	ORA	A		;
	CZ	LEFT_KEY	;
	CALL	LEFT_KEY	;
	RET			;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;    рТПГЕДХТБ РЕТЕИПДБ Ч ОБЮБМП УФТПЛЙ "уу+чмечп"	;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
CC_LEFT_KEY:
	MVI	A,11110000b	;
	STA	MODE_NIBL	;
	LHLD	CURSOR		;
	MVI	H,08h		;
	SHLD	CURSOR		;
	LHLD	POSITION	;
	MOV	A,L		;
	ANI	11110000b	;
	MOV	L,A		;
	SHLD	POSITION	;
	CALL	RE_PRINT_POS	;
	RET			;

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;    рТПГЕДХТБ ПВТБВПФЛЙ ОБЦБФЙС ОБ ЛМБЧЙЫХ "чмечп"	;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
LEFT_KEY:
	LDA	DE_MODE		;
	ORA	A		;
	JNZ	L_K_SUMBOLS	;
;;
;; пВТБВПФБЕН ЛПДПЧЩК ТЕЦЙН.
;;
	LHLD	CURSOR		;
	XCHG			;
	MOV	A,D		;
	CPI	9h		;
	RC			;
	DCR	D		;
	LDA	MODE_NIBL	;
	CPI	11110000b	;
	CMA			;
	STA	MODE_NIBL	;
	JNZ	R_K_0		; L_K_0 === R_K_0
	DCR	D		;
	LHLD	POSITION	;
	DCX	H		;
	SHLD	POSITION	;
	CALL	RE_PRINT_POS	;
	JMP	R_K_0		;
L_K_SUMBOLS:			;
	LHLD	CURSOR		;
	MOV	A,H		;
	CPI	09h		;
	RC			;
	DCR	H		;
	SHLD	CURSOR		;
	LHLD	POSITION	;
	DCX	H		;
	SHLD	POSITION	;	
	CALL	RE_PRINT_POS	;
	RET			;

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;	рТПГЕДХТБ ПУХЭЕУФЧМСЕФ "ХНОПЕ" РЕТЕНЕЭЕОЙЕ ЛХТ-	;;
;; УПТБ  Й  ДПМЦОБ ЧЩРПМОСФУС РТЙ РЕТЕЛМАЮЕОЙСИ ЬЛТБОБ	;;
;; У ФЕЛУФПЧПЗП Ч ЛПДПЧЩК ТЕЦЙН Й ОБПВПТПФ ЬФП УЧСЪБОП	;;
;; У  ТБЪОЩН  ЫБЗПН РЕТЕНЕЭЕОЙС ЛХТУПТБ Ч ЬФЙИ ТЕЦЙНБИ	;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
CUR_RESTART:
	CALL	LOAD_OFFSET	;
	PUSH	H		;
	CALL	CC_LEFT_KEY	; РЕТЕНЕУФЙНУС ОБ ОБЮБМП
	POP	H		;
	MOV	A,L		;
	ANI	00001111b	;
CU_R_00:
	RZ			;
	PUSH	PSW		;
	CALL	STR_KEY		; РЕТЕКДЕН ЗДЕ ВЩМЙ.
	POP	PSW		;
	DCR	A		;
	JMP	CU_R_00		;

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;	рТПГЕДХТБ ПВТБВПФЛЙ ОБЦБФЙС ЛМБЧЙЫЙ "F3"	;;
;;     ( РТПЙЪЧПДЙФ УНЕОХ ТЕЦЙНБ "уйнчпм - лпд")	;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
F3_KEY:
	LDA	DE_MODE		;
	CMA			;
	STA	DE_MODE		;
	ORA	A		;
	JNZ	F3_K_SUMBOLS	; РЕТЕКФЙ ОБ ФЕЛУФ.
;;
;; пВТБВПФБЕН РЕТЕЛМАЮЕОЙЕ Ч ЛПДПЧЩК ТЕЦЙН.
;;
	LHLD	WIND2		;
	MOV	D,H		;
	MVI	H,3Bh		;
	SHLD	WIND2		;
	MOV	H,D		;
	LXI	D,0B05h		;
	CALL	CLS		;
	CALL	NEW_DUMP	;
	CALL	DUMP_HEX	;
	CALL	CUR_RESTART	;
	RET			;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;DOW ]----------+
;*  ЧЩИПД:   ПФЛТЩЧ. РТЕД ЙДХЭЕЕ ПЛОП   *
;+--------------------------------------+
DEACTI:		DI
		PUSH	B	
		PUSH	D	
		PUSH	H	
		PUSH	PSW	
		LXI	H,NUM		;ХЛБЪБФЕМШ ОБ ЮЙУМП ПФЛТ.
		MOV	A,M		;ПЛПО
		ORA	A
		JZ	MAIN_EXIT	;$$$$$$
		DCR	M
		LHLD	BUFSEK	
		DCX	H	
		MOV	D,M	
		DCX	H	
		MOV	E,M	
		DCX	H	
		MOV	B,M	
		DCX	H	
		MOV	C,M	
		MOV	A,E	
		ADD	C	
		DCR	A	
		MOV	E,A	
		DCX	H	
		PUSH	D	
		XCHG		
		CALL	DEH1	
		SHLD	WIND1	
		CALL	DEH1	
		SHLD	WIND2	
		CALL	DEH1	
		SHLD	CURSOR	
		XCHG		
		DCX	H	
		POP	D	
		XRA	A	
		MOV	A,B	
		RAR		
		PUSH	PSW	
		ADD	D	
		MOV	D,A	
		POP	PSW	
		SHLD	BUF1	
		LXI	H,100H	
		JNC	DE2	
		INR	L	
DE2:		PUSH	H	
		LHLD	BUF1	
		JNC	DE1	
		CALL	DEH2	
		INR	D	
DE1:		CALL	DEH2	
		XTHL		
		MOV	A,D	
		SUB	L	
		SUB	H	
		MOV	D,A	
		INR	H	
		XTHL		
		CALL	DEH2	
		XTHL		
		MOV	A,D	
		ADD	L	
		ADD	H	
		MOV	D,A	
		INR	H	
		MOV	A,H	
		CMP	B	
		XTHL		
		JC	DE1	
		INX	H	
		SHLD	BUFSEK	
		POP	PSW 
		JMP	MAIN_EXIT	;$$$$$$$$$

;////////////////// CLOSE  HELP //////////////////
DEH2:		PUSH	B	
		PUSH	D	
DH21:		MOV	A,M	
		CALL	PUTCXY	
		DCX	H	
		DCR	E	
		DCR	C	
		JNZ	DH21	
		POP	D	
		POP	B	
		RET		
DEH1:		LDAX	D	
		MOV	H,A	
		DCX	D	
		LDAX	D	
		MOV	L,A	
		DCX	D	
		RET		

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

;+--------------[ DRAW BOARD ]----------+
;*	ЧИПД:	DE,HL -> ЛППТД.ПЛОБ	*
;*		A -> ЖМБЗ		*
;+--------------------------------------+
RAMKA:		LDA	FLAGW	
BORT:		PUSH	B	
		PUSH	D	
		PUSH	H	
		PUSH	PSW	
		ANI	4	
		LXI	B,DOUBLE
		JZ	BORT01	
		LXI	B,INTEG	
BORT01:		LDAX	B	
		CALL	PUTCXY	
		PUSH	D	
		MOV	E,L	
		INX	B	
		LDAX	B	
		CALL	PUTCXY	
		XCHG		
		INX	B	
		LDAX	B	
		CALL	PUTCXY	
		XTHL		
		MOV	E,L	
		INX	B	
		LDAX	B	
		CALL	PUTCXY	
		XTHL		
		DCR	L	
		PUSH	D	
		INX	B	
BORT02:		LDAX	B	
		INR	E	
		CALL	PUTCXY	
		MOV	A,E	
		CMP	L	
		JNZ	BORT02	
		POP	D	
		XCHG		
		PUSH	D	
		INR	L	
BORT03:	        LDAX	B	
		CALL	PUTCXY	
		DCR	E	
		MOV	A,E	
		CMP	L	
		JNC	BORT03	
		POP	D	
		POP	PSW	
		INX	B	
		INR	E	
		DCR	L	
CONT:		INR	D	
		DCR	H	
		LDAX	B	
		CALL	PUTCXY	
		PUSH	D	
		MOV	E,L	
		CALL	PUTCXY	
		POP	D	
		XCHG		
		CALL	PUTCXY	
		PUSH	D	
		MOV	E,L	
		CALL	PUTCXY	
		POP	D	
		XCHG		
		MOV	A,D	
		CMP	H	
		JC	CONT	
		JMP	MAIN_EXIT	;$$$$$$$$$$$

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

;-----------[ MAIN HELP ]----------+
;*  ЗМПВБМШОЩЕ ЧУРПНПЗБФ. РПДРТПЗТ.*
;+---------------------------------+
HLSUBDE:	MOV	A,H	
		SUB	D	
		INR	A	
		MOV	B,A	
		MOV	A,L	
		SUB	E	
		INR	A	
		MOV	C,A	
		RET		

HLDEWIND:	LHLD	WIND1	
		XCHG		
		LHLD	WIND2	
		RET		

;+------[ SCROLLING HELP ]-------+
;*		--//--		 *
;+-------------------------------+
SCHELP:		MOV	A,H	
		SUB	D	
		RRC		
		ANI	1FH	
		MOV	C,A	
		INR	C	
		MOV	A,D	
		XRA	H	
		ANI	1	
		JZ	SCS3	
		MOV	A,D	
		ANI	1	
		JZ	SCS3	
		INR	C	
SCS3:		MOV	A,L	
		SUB	E	
		RLC		
		RLC		
		RLC		
		RLC		
		MOV	B,A	
		RET		
SCH1:		PUSH	B	
		PUSH	D	
		PUSH	H	
SH10:		CALL	LDIR	
		DCR	H	
		DCR	D	
		DCR	C	
		JNZ	SH10	
		POP	H	
		POP	D	
		POP	B	
		MOV	A,H	
		ADI	20H	
		MOV	H,A	
		MOV	A,D	
		ADI	20H	
		MOV	D,A	
SH11:		CALL	LDIR	
		DCR	H	
		DCR	D	
		DCR	C	
		JNZ	SH11	
		RET		
SCH2:		PUSH	B	
		PUSH	D	
		PUSH	H	
SH20:		CALL	LIIR	
		INR	H	
		INR	D	
		DCR	C	
		JNZ	SH20	
		POP	H	
		POP	D	
		POP	B	
		MOV	A,H	
		ADI	20H	
		MOV	H,A	
		MOV	A,D	
		ADI	20H	
		MOV	D,A	
SH21:		CALL	LIIR	
		INR	H	
		INR	D	
		DCR	C	
		JNZ	SH21	
		RET		

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

;+----------[ CURSOR ABSOLUTE ]---------+
;*	ЧИПД:	DE -> ПФОПУЙФ.ЛППТД.	*
;*	ЧЩИПД:	DE -> БВУПМ`ФОЩЕ ЛППТД.	*
;+--------------------------------------+

ABSJDE:		PUSH	PSW	
		PUSH	H	
		LHLD	WIND1	
		MOV	A,D	
		ADD	H	
		MOV	D,A	
		MOV	A,E	
		ADD	L	
		MOV	E,A	
		POP	H	
		POP	PSW	
		RET		
;+-----[ РТПХЕДХТБ ПФЮЙУФЛЙ ПЛОБ ]------+
;*	ЧИПД:	DE,HL -> WINDOW COORD	*
;+--------------; вМПЛ РЕТЕИПДБ Ч УЙНЧПМШОЩК ТЕЦЙН ТЕДБЛФЙТПЧБОЙС
;;
F3_K_SUMBOLS:			;
	LHLD	WIND2		;
	MOV	D,H		;
	MVI	H,1Bh		;
	SHLD	WIND2		;
	MOV	H,D		;
	LXI	D,0B05h		;
	CALL	CLS		;
	CALL	NEW_DUMP	;
	CALL	DUMP_TEXT	;
	CALL	CUR_RESTART	;	
	RET			;
;;
;; ъБРЙУБФШ УЕЛФПТ ОБ ДЙУЛ ?
;;
SOOB_00:
	DB	0FAh,0C1h,0D0h,0C9h,0D3h,0C1h
	DB	0D4h,0D8h,020h,0D3h,0C5h,0CBh
	DB	0D4h,0CFh,0D2h,020h,0CEh,0C1h
	DB	020h,0C4h,0C9h,0D3h,0CBh
	DB	' ?',000h
SOOB_YN:
;;
;;  дБ  оЕФ
;;
	DB	0E4h,0C1h,020h,020h,020h,020h
	DB	0EEh,0C5h,0D4h,000h

SOOB_10:
;;
;; дПТПЦЛБ [    ]
;;
	DB	0E4h,0CFh,0D2h,0CFh,0D6h,0CBh
	DB	0C1h,'  [    ] ( 00h - 4Fh )',000h
;;
;; уЕЛФПТ  [   ]
;;
	DB	0F3h,0C5h,0CBh,0D4h,0CFh,0D2h
	DB	'   [   ]  ( 0 - 5 )',000h
;;
;; уФПТПОБ [   ]
;;
	DB	0F3h,0D4h,0CFh,0D2h,0CFh,0CEh
	DB	0C1h,'  [   ]  ( 0 - 1 )',000h

SOOB_HLP:
       DB     05Fh,05Fh,05Fh,05Fh,05Fh,020h,0EBh,0CCh
       DB     0C1h,0D7h,0C9h,0DBh,0C9h,020h,0D5h,0D0h
       DB     0D2h,0C1h,0D7h,0CCh,0C5h,0CEh,0C9h,0D1h
       DB     03Ah,05Fh,05Fh,05Fh,05Fh,05Fh,05Fh,05Fh
       DB     05Fh,05Fh,05Fh,05Fh,05Fh,05Fh,05Fh,05Fh
       DB     05Fh,05Fh,05Fh,05Fh,05Fh,05Fh,05Fh,05Fh
       DB     05Fh,000h
       DB     020h,0F3h,0D4h,0D2h,0C5h
       DB     0CCh,0CBh,0C9h,020h,02Dh,020h,0F5h,0D0h
       DB     0D2h,0C1h,0D7h,0CCh,0C5h,0CEh,0C9h,0C5h
       DB     020h,0CBh,0D5h,0D2h,0D3h,0CFh,0D2h,0CFh
       DB     0CDh,02Eh,00h
       DB     020h,046h,033h,020h,02Dh
       DB     020h,0F0h,0C5h,0D2h,0C5h,0CBh,0CCh,0C0h
       DB     0DEh,0C5h,0CEh,0C9h,0C5h,020h,0D2h,0C5h
       DB     0D6h,0C9h,0CDh,0C1h,020h,0D2h,0C5h,0C4h
       DB     0C1h,0CBh,0D4h,0CFh,0D2h,0C1h,020h,048h
       DB     045h,058h,020h,02Dh,020h,041h,053h,043h
       DB     049h,049h,02Eh,000h
       DB     020h,046h,035h
       DB     020h,02Dh,020h,0F0h,0C5h,0D2h,0C5h,0CBh
       DB     0CCh,0C0h,0DEh,0C5h,0CEh,0C9h,0C5h,020h
       DB     0D2h,0C5h,0C7h,0C9h,0D3h,0D4h,0D2h,0C1h
       DB     020h,0CBh,0CCh,0C1h,0D7h,0C9h,0C1h,0D4h
       DB     0D5h,0D2h,0D9h,020h,020h,028h,0EEh,0F2h
       DB     02Fh,0F7h,0F2h,029h,02Eh,00h
       DB     020h
       DB     0F3h,0F3h,020h,02Bh,020h,0F7h,0D7h,0C5h
       DB     0D2h,0C8h,020h,028h,0F7h,0CEh,0C9h,0DAh
       DB     029h,020h,020h,02Dh,020h,020h,022h,0FBh
       DB     0C1h,0C7h,0C1h,0CEh,0C9h,0C5h,022h,020h
       DB     020h,0D0h,0CFh,020h,020h,020h,0D3h,0C5h
       DB     0CBh,0D4h,0CFh,0D2h,0C1h,0CDh,02Eh,000h

       DB     020h,0F3h,0F3h,020h,02Bh,020h,0F7h
       DB     0CCh,0C5h,0D7h,0CFh,020h,028h,0F7h,0D0h
       DB     0D2h,0C1h,0D7h,0CFh,029h,020h,02Dh,020h
       DB     020h,0EEh,0C1h,0DEh,0C1h,0CCh,0CFh,020h
       DB     020h,028h,0CBh,0CFh,0CEh,0C5h,0C3h,029h
       DB     020h,020h,0D3h,0D4h,0D2h,0CFh,0CBh,0C9h
       DB     02Eh,00h
       DB     020h,0F5h,0F3h,020h,02Bh
       DB     020h,03Ch,0C3h,0C9h,0C6h,0D2h,0C1h,03Eh
       DB     020h,02Dh,020h,020h,0F7h,0D9h,0C2h,0CFh
       DB     0D2h,020h,020h,020h,022h,0D0h,0C1h,0CEh
       DB     0C5h,0CCh,0D8h,0CBh,0C9h,022h,020h,0D3h
       DB     020h,020h,0C6h,0D5h,0CEh,0CBh,0C3h,0C9h
       DB     0C5h,0CAh,02Eh,00h
       DB     05Fh,05Fh,05Fh
       DB     05Fh,05Fh,05Fh,05Fh,05Fh,05Fh,05Fh,05Fh
       DB     05Fh,05Fh,05Fh,05Fh,05Fh,05Fh,05Fh,05Fh
       DB     05Fh,05Fh,05Fh,05Fh,05Fh,05Fh,05Fh,020h
       DB     050h,050h,041h,020h,053h,06Fh,066h,074h
       DB     020h,053h,079h,073h,074h,065h,06Dh,073h
       DB     020h,05Fh,05Fh,05Fh,05Fh,05Fh,000h

;;
;; чЩКФЙ ЙЪ ТЕДБЛФПТБ ?
;;
SOOB_30:
	DB	0F7h,0D9h,0CAh,0D4h,0C9h,020h
	DB	0C9h,0DAh,020h,0D2h,0C5h,0C4h
	DB	0C1h,0CBh,0D4h,0CFh,0D2h,0C1h
	DB	' ?',000h
;;
;; гЧЕФ РЕТЕДОЕЗП РМБОБ
;;
SOOB_40:
	DB	0E3h,0D7h,0C5h,0D4h,020h,0D0h
	DB	0C5h,0D2h,0C5h,0C4h,0CEh,0C5h
	DB	0C7h,0CFh,020h,0D0h,0CCh,0C1h
	DB	0CEh,0C1h,'  [    ]',000h
;;
;; гЧЕФ ЪБДОЕЗП РМБОБ
;;
	DB	0E3h,0D7h,0C5h,0D4h,020h,0DAh
	DB	0C1h,0C4h,0CEh,0C5h,0C7h,0CFh
	DB	020h,0D0h,0CCh,0C1h,0CEh,0C1h
	DB	'    [    ]',000h

	END
------------------------+
CLS:		PUSH	B	
		PUSH	D	
		PUSH	H	
		PUSH	PSW	
		JMP	HOMEDH	
HOME:		PUSH	B	
		PUSH	D	
		PUSH	H	
		PUSH	PSW	
		CALL	HLDEWIND	
HOMEDH:		DI
		CALL	HLSUBDE	
		PUSH	B	
		PUSH	D	
		PUSH	H	
		CALL	ADDREM	
HOM7:		PUSH	H	
		PUSH	B	
HOM6:		MVI	M,' '	
		INX	H	
		DCR	B	
		JNZ	HOM6	
		POP	B	
		POP	H	
		LXI	D,40H	
		DAD	D	
		DCR	C	
		JNZ	HOM7	
		POP	H	
		POP	D	
		POP	B	
		MOV	A,C	
		ANI	0FH	
		RLC		
		RLC		
		RLC		
		RLC		
		MOV	B,A	
		MOV	A,D	
		RRC		
		JNC	HOM1	
		CALL	STOLB	
		INR	D	
HOM1:		MOV	A,H	
		RRC		
		JC	HOM2	
		XCHG		
		PUSH	D	
		MOV	E,L	
		CALL	STOLB	
		POP	D	
		XCHG		
		DCR	H	
HOM2:		MOV	A,H	
		SUB	D	
		RAR	
		INR	A	
		MOV	C,A	
		CALL	ADDRSC	
		XRA	A	
		PUSH	B	
		MOV	D,B	
		MOV	E,L	
HOM3:		MOV	M,A	
		INR	L	
		DCR	B	
		JNZ	HOM3	
		MOV	B,D	
		MOV	L,E	
		INR	H	
		DCR	C	
		JNZ	HOM3	
		DCR	H	
		POP	B	
		MOV	A,H	
		ADI	20H	
		MOV	H,A	
		XRA	A	
HOM5:		MOV	M,A	
		INR	L	
		DCR	B	
		JNZ	HOM5	
		MOV	B,D	
		MOV	L,E	
		DCR	H	
		DCR	C	
		JNZ	HOM5	
		JMP	MAIN_EXIT	;$$$$$$$$$$
;+--------[ STOLB ]---------+
STOLB:		PUSH	D	
		PUSH	B	
		MVI	A,' '	
ST1:		CALL	PUTCXY	
		INR	E	
		DCR	C	
		JNZ	ST1	
		POP	B	
		POP	D	
		RET		

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

;+--------[ SCROLL WINDOW ]---------+
;*    РТПГЕДХТЩ УЛТПМЙОЗБ ПЛПО 	    *
;+----------------------------------+
;////////////////////////////  ЧРТБЧП //////////////////////////
SCRP:	;;*;;	PUSH	B	
	;;*;;	PUSH	D	
	;;*;;	PUSH	H	
	;;*;;	PUSH	PSW	
	;;*;;	JMP	SC3P	
SCROL3:		PUSH	B	
		PUSH	D	
		PUSH	H	
		PUSH	PSW	
		CALL	HLDEWIND	
SC3P:		DI
		CALL	HLSUBDE	
		CALL	SCREM3	
		MOV	A,C	
		MOV	C,B	
		PUSH	D	
		PUSH	H	
		ANI	0FH	
		RLC		
		RLC		
		RLC		
		RLC		
		MOV	B,A	
		MOV	A,C	
		RAR		
		DCR	A	
		MOV	C,A	
		XCHG		
		INR	E	
		CALL	ADDRSC	
		DCX	H	
		MOV	D,H	
		MOV	E,L	
		DCR	H	
		CALL	SCH1	
		POP	H	
		POP	D	
		MOV	H,D	
		INR	H	
		CALL	CLS	
		JMP	MAIN_EXIT	;$$$$$$$$

;//////////////////////////// ЧМЕЧП //////////////////////////
SCRL:	;;*;;	PUSH	B	
	;;*;;	PUSH	D	
	;;*;;	PUSH	H	
	;;*;;	PUSH	PSW	
	;;*;;	JMP	SC4L	
SCROL4:		PUSH	B	
		PUSH	D	
		PUSH	H	
		PUSH	PSW	
		CALL	HLDEWIND	
SC4L:		DI
		CALL	HLSUBDE	
		CALL	SCREM4	
		PUSH	D	
		PUSH	H	
		MOV	A,C	
		MOV	C,B	
		ANI	0FH	
		RLC		
		RLC		
		RLC		
		RLC		
		MOV	B,A	
		MOV	A,C	
		RAR		
		DCR	A	
		MOV	C,A	
		CALL	ADDRSC	
		MOV	D,H	
		MOV	E,L	
		INR	H	
		CALL	SCH2	
		POP	H	
		POP	D	
		MOV	D,H	
		DCR	D	
		CALL	CLS	
		JMP	MAIN_EXIT	;$$$$$$
;//////// SCREM4 ////////
SCREM4:		PUSH	B	
		PUSH	D	
		PUSH	H	
		DCR	B	
		DCR	B	
		CALL	ADDREM	
SEM41:		MOV	D,H	
		MOV	E,L	
		INX	H	
		INX	H	
		CALL	LIIR	
		LXI	H,40H	
		DAD	D	
		DCR	C	
		JNZ	SEM41	
		POP	H	
		POP	D	
		POP	B	
		RET		
;////// SCROLEM3 ////////
SCREM3:		PUSH	H	
		PUSH	D	
		PUSH	B	
		XCHG		
		DCR	B	
		DCR	B	
		CALL	ADDREM	
SCE31:		MOV	D,H	
		MOV	E,L	
		DCX	D	
		DCX	D	
		XCHG		
		CALL	LDIR	
		XCHG		
		LXI	D,0FFC0H
		DAD	D	
		DCR	C	
		JNZ	SCE31	
		POP	B	
		POP	D	
		POP	H	
		RET		

;////////////////////////// ЧОЙЪ ////////////////////////////
SCRN:		PUSH	B	
		PUSH	D	
		PUSH	H	
		PUSH	PSW	
		JMP	SCN0	
SCROL2:		PUSH	B	
		PUSH	D	
		PUSH	H	
		PUSH	PSW	
		CALL	HLDEWIND	
SCN0:		DI
		MOV	A,E	
		CMP	L	
		JZ	QS2	
		PUSH	H	
		PUSH	D	
		CALL	HLSUBDE	
		CALL	ADDREM
SCE21:		LXI	D,40H	
		XCHG		
		DAD	D	
		CALL	LIIR	
		DCR	C	
		JNZ	SCE21	
		POP	D	
		POP	H	
		PUSH	H	
		PUSH	D	
		CALL	SCHELP	
		CALL	ADDRSC
		MOV	D,H	
		MOV	A,L	
		ADI	16	
		MOV	E,A	
		XCHG		
		CALL	SCH2	
		POP	D	
		POP	H	
		MOV	E,L	
QS2:		CALL	CLS	
		JMP	MAIN_EXIT	;$$$$$$

;//////////////////////////// ЧЧЕТИ ////////////////////////////
SCRV:		PUSH	B	
		PUSH	D	
		PUSH	H	
		PUSH	PSW	
		JMP	SCV0	
SCROL1:	        PUSH	B	
		PUSH	D	
		PUSH	H	
		PUSH	PSW	
		CALL	HLDEWIND	
SCV0:		DI
		MOV	A,L	
		CMP	E	
		JZ	SCQ1	
		PUSH	H	
		PUSH	D	
		CALL	HLSUBDE	
		XCHG		
	        CALL	ADDREM
SCE1:		LXI	D,0FFC0H
		XCHG		
		DAD	D	
		CALL	LDIR	
		DCR	C	
		JNZ	SCE1	
		POP	D	
		POP	H	
		PUSH	D	
		PUSH	H	
		CALL	SCHELP	
		XCHG		
		CALL	ADDRSC	
		MOV	D,H	
		MOV	A,L	
		ADI	16	
		MOV	E,A	
		DCX	H	
		DCX	D	
		CALL	SCH1	
		POP	H	
		POP	D	
		MOV	L,E	
SCQ1:		CALL	CLS	
		JMP	MAIN_EXIT	;$$$$$$

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

;ЮЮЮЮЮЮЮЮ MOVE PROCEDURE ЮЮЮЮЮЮЮ
LIIR:		PUSH	B
		PUSH	D	
		PUSH	H	
LI1:		MOV	A,M	
		STAX	D	
		INX	D	
		INX	H	
		DCR	B	
		JNZ	LI1	
		POP	H	
		POP	D	
		POP	B	
		RET		

LDIR:	        PUSH	B	
		PUSH	D	
		PUSH	H	
LD1:		MOV	A,M	
		STAX	D	
		DCX	H	
		DCX	D	
		DCR	B	
		JNZ	LD1	
		POP	H	
		POP	D	
		POP	B	
		RET		
;;;;;;;;;;;;;;;
;;
;; рТПГЕДХТБ ЖПТНЙТПЧБОЙС ДПРПМОЙФЕМШОПЗП ЛПДБ
;; Ч ТЕЗЙУФТПЧПК РБТЕ DE
;;
NEG_DE:	
		MOV	A,D		;
		CMA			; ТЕЗЙУФТПЧХА РБТХ: DE
		MOV	D,A		; РЕТЕЧПДЙН Ч ДПРПМОЙФЕМШОЩК
		MOV	A,E		; ЛПД ДМС РТПЙЪЧЕЕОЙС ПРЕТБГЙЙ
		CMA			; ЧЩЮЙФБОЙС
		MOV	E,A		;
		INX	D		;
		RET			;
;;;;;;;;;;;;;;;


;+-----------[ WINDOW GETC ]------------+
;*	ЧИПД:	DE -> ЛППТД.		*
;*	ЧЩИПД:	A  -> УЙНЧПМ		*
;+--------------------------------------+
GETC:		PUSH	H	
		CALL	ABSJDE	
		JMP	GE1	
GETCXY:		PUSH	H	
GE1:		CALL	ADDREM
		MOV	A,M	
		POP	H	
		RET		

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

;+---------[ WINDOW PUTCHAR ]-----------+
;*	ЧИПД:	DE -> ЛППТДЙОБФЩ	*
;*		A  -> УЙНЧПМ		*
;+--------------------------------------+
WPUTC1:		PUSH	D	
		CALL	ABSJDE	
		CALL	PUTCXY	
		POP	D	
		RET		
PUTCXY:   	PUSH	H	
		PUSH	D	
		PUSH	B	
		PUSH	PSW	
		CALL	ADDREM
		MOV	M,A	
		MOV	B,A	
		CALL	ADDRSC	
		XCHG		
		MOV	A,H	
		RRC		
		MOV	A,B	
		MVI	B,16	
		PUSH	PSW
		PUSH	D		;ПРТЕДЕМЕОЙС ОБЮБМБ ЪОБЛПЗЕОЕТБФПТБ
		MVI	H,0
		MOV	L,A	
		DAD	H	
		DAD	H	
		DAD	H	
		DAD	H	
		LXI	D,MZG		;ХЛБЪБФЕМШ ОБ ЪОБЛПЗЕОЕТБФПТ
		DAD	D
		POP	D	
		POP	PSW
		XCHG		
		JC	SHET	
		MVI	C,0FH	
SCA:		MOV	A,M	
		ANA	C	
		MOV	M,A	
		LDAX	D	
		ANI	0F0H	
		ORA	M	
		MOV	M,A	
		INR	L	
		INX	D	
		DCR	B	
		JNZ	SCA	
		MVI	B,16	
		MOV	A,H	
		ADI	20H	
		MOV	H,A	
SCC:		DCX	D	
		DCR	L	
		MOV	A,M	
		ANA	C	
		MOV	M,A	
		LDAX	D	
		ANA	C	
		RLC		
		RLC		
		RLC		
		RLC		
		ORA	M	
		MOV	M,A	
		DCR	B	
		JNZ	SCC	
		JMP	NEXT	
SHET:		MVI	C,0F0H	
SCA0:		MOV	A,M	
		ANA	C	
		MOV	M,A	
		LDAX	D	
		ANA	C	
		RRC		
		RRC		
		RRC		
		RRC		
		ORA	M	
		MOV	M,A	
		INR	L	
		INX	D	
		DCR	B	
		JNZ	SCA0	
		MVI	B,16	
		MOV	A,H	
		ADI	20H	
		MOV	H,A	
SCC0:		DCX	D	
		DCR	L	
		MOV	A,M	
		ANA	C	
		MOV	M,A	
		LDAX	D	
		ANI	0FH	
		ORA	M	
		MOV	M,A	
		DCR	B	
		JNZ	SCC0	
NEXT:		POP	PSW	
		POP	B	
		POP	D	
		POP	H	
		RET		
;+--------[ ЧУРПНПЗБФЕМШОЩЕ РТПГЕДХТЩ ]---------+
;*       ПРТЕДЕМЕОЙЕ ЖЙЪЙЮЕУЛЙИ БДТЕУПЧ		*
;+----------------------------------------------+
;////////////////////////// ADDDR EMUL //////////////////////
ADDREM:		PUSH	B
		LXI	B,MEMU		;ХЛБЪБФЕМШ ОБ ПВМБУФШ ЬНХМСГЙЙ
		MVI	H,0	
		MOV	L,E	
		DAD	H	
		DAD	H	
		DAD	H	
		DAD	H	
		DAD	H	
		DAD	H	
		DAD	B	
		MVI	B,0	
		MOV	C,D	
		DAD	B	
		POP	B	
		RET		
;//////////////////////////// ADDDR SCREEN ////////////////////////
ADDRSC:		PUSH	PSW	
		MOV	A,E	
		ANI	0FH	
		RLC		
		RLC		
		RLC		
		RLC		
		MOV	L,A	
		MOV	A,D	
		RAR		
		ORI	0A0H	
		MOV	H,A	
		POP	PSW	
		RET		

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;
;;   дБООБС РПУМЕДПЧБФЕМШОПУФШ ЗЕОЕТЙТХЕФ УМХЮБК ОЩК БДТЕУ
;; ДМС ОБЛБЪБОЙС ЧЪМПНЭЙЛБ
;;
ER_K_SUMMA:
		LHLD	KONTR_PPA+1	;
		MVI	C,16		;
ER_K_00:				;
		MOV	A,H		;
		DAD	H		;
		ANI	60H		;
		JPE	ER_K_10		;
		INX	H		;
ER_K_10:				;
		DCR	C		;
		JNZ	ER_K_00		;
		MOV	A,H		;
		ANI	1FH		;
		MOV	H,A		;
		SHLD	KONTR_PPA+1	;
		RET			;

;		INCLUDE	KEYDRIV.ASM
;;
;; рБЛЕФ ОБРЙУБО ОБ БУУЕНВМЕТЕ (Intel 8080) Й УМХЦЙФ ДМС РТПЗТБНОПК РПДДЕТ-
;; ЦЛЙ НПДХМС ЛМБЧЙБФХТЩ ,УПДЕТЦЙФ РЕТЕТБВПФБОЩК ДТБКЧЕТ ЛМБЧЙБФХТЩ
;; ПФ Basic Korvet v 2.0
;; РПУМЕДОСС НПДЙЖЙЛБГЙС: 13.11.1992 (РСФОЙГБ - 13 )
;; лБТБЗБОДБ  Ф. 52-81-95
;;

;;////////// ТБВПЮЙЕ СЮЕКЛЙ KEYBOARD.DRIVE ////////
FLAGC:		DB	0	;ЕУМЙ <>0 ФП ГЧЕФПЗЕОЕТБФПТ ОЕ ФТПЗБЕФУС
RAB0:		DB	0	
COLOR:		DW	0000H	
RUSLAT:		DB	0	
SMAL:		DB	0	
KEYKOD:		DB	255	;УПД.ЛПД ЛМБЧЙЫЙ ОБЦ Ч ДБООЩК НПНЕОФ
KOOL:		DB	0	
DREB:		DB	0	
SEEK:		DB	1	
		DB	"PPA Systems"	;ВХЖЕТ ЛМБЧЙБФХТЩ
		DB	CR,LF,0		; 14 - ЬМЕНЕОФПЧ
;+-------[ INKEYJSUMBOL ]-------+
;* ЧЩИ:	A -> ЛПД ЛМБЧЙЫЙ	*
;+------------------------------+
INKEY:		PUSH	B	
		PUSH	D	
		PUSH	H	
		LXI	H,SEEK	
		MVI	C,255	
		DI
		DCR	M	
		JZ	INQ	
		MOV	B,M	
		INX	H	
		MOV	C,M	
		EI
		MOV	D,H	
		MOV	E,L	
IN0:		INX	H	
		MOV	A,M
		STAX	D
		INX	D
		DCR	B
		JNZ	IN0
		DCR	M	
INQ:		EI
		INR	M	
		MOV	A,C	
		POP	H	
		POP	D	
		POP	B	
		RET		
;;
;; нПДЙЖЙЛБГЙС ДТБКЧЕТБ: 21.10.1993 ++++ юЕФЧЕТЗ ++++
;; ================ 21:55 "Good luck "================
;; РТПЙЪЧЕДЕОП ЛПНЕОФЙТПЧБОЙЕ ЙУИПДОПЗП ФЕЛУФБ НПДХМС
;; ДТБКЧЕТБ ЛМБЧЙБФХТЩ У ГЕМША ЙУРПМШЪПЧБОЙС ЕЗП Ч РП-
;; УМЕДХАЭЙИ ТБЪТБВПФЛБИ Б ФБЛЦЕ ЙЪНЕОЕОЩ ОЕЛПФПТЩЕ
;; ХРТБЧМСАЭЙЕ ЛМБЧЙЫЙ:
;;  "F5" - фТЙЗЕТОБС ЛМБЧЙЫБ РЕТЕЛМАЮБЕФ РТЙП-
;;         ТЕФЕФОПЕ УПУФПСОЙЕ ДБФЮЙЛБ РТПРЙУОЩЕ
;;         - УФТПЮОЩЕ ВХЛЧЩ ФЕЛХЭЕЗП БМЖБЧЙФБ
;;  "уу" - лМБЧЙЫБ РТПЙЪЧПДЙФ ЧТЕНЕООПЕ РЕТЕЛМА-
;;         ЮЕОЙЕ НБМЕОШЛЙИ-ВПМШЫЙИ ВХЛЧ

;+---------[ KEYJDRIVER ]-------+
KEY_INT:	PUSH	B	; рТПЙЪЧПЦХ РПМОПЕ УПИТБОЕОЙЕ
		PUSH	D	; УПУФПСОЙС РТПГЕУУПТБ Ч НПНЕОФ
		PUSH	H	; ЧПЪОЙЛОПЧЕОЙС РТЕТЩЧБОЙС
		PUSH	PSW	;
		LXI	H,FLAGC	; юЙФБЕН ЖМБЗ РПДНЕОЩ РБМЙФТЩ
		MOV	A,M	;
		ORA	A	;
		JNZ	KEY_DO0	; ЕУМЙ =0 ФП РЕТЕРТПЗТБНЙТПЧБФШ ФБВМЙГХ
		DCR	M	;
		LHLD	COLOR	; юЙФБА ДЧБ ВБКФБ ЖЙЪЙЮЕУЛЙИ ГЧЕФПЧ
		LXI	D,100FH	; ЖПОБ Й РЕТЕДОЕЗП РМБОБ
KEY_00:		MOV	A,E	; H - ГЧЕФ ретдоезп рмбоб
		OUT	02	; L - ГЧЕФ жпоб
		ANI	06	; Й РЕТЕИПДЙН Л ТБУРТЕДЕМЕОЙА
		MOV	A,L	; ЕФЙИ ВБКФПЧ Ч УППФЧЕФУФЧЙЙ
		JZ	KEY_01	; У НБФЕНБФЕНБФЙЮЕУЛЙНЙ ГЧЕФБНЙ
		MOV	A,H	;
KEY_01:		OUT	0FH	; РТПЙЪЧПДЙН НОПЗПЛТБФОХА ЪБРЙУШ
		DCR	E	; РПМХЮЕОПЗП ЛПДБ Ч УЧСЪЙ У НБМПК
		OUT	0FH	; УЛПТПУФША ТБВПФЩ пъх -л155тх2-
		OUT	0FH	;
		OUT	0FH	;
		DCR	D	;
		OUT	0FH	;
		JNZ	KEY_00	;
KEY_DO0:	MVI	A,8AH	; оБУФТБЙЧБЕН УЙУФЕНОЩК РПТФ ОБ
		OUT	00	; УЛБОЙТПЧБОЙЕ ЛМБЧЙБФХТЩ
		LXI	H,RAB0	;
		IN	01	; РТПЮЙФБФШ УПУФПСОЙЕ РПТФБ "C"
		ANI	80H	; бОБМЙЪЙТХЕН ВЙФ ЛМБЧЙЫЙ "тху/мбф"
		JNZ	M5	; РЕТЕИПД ЕУМЙ ПОБ ОЕ ОБЦБФБ !!!
		MOV	A,M	; РТПЧЕТСЕН УПДЕТЦЙНПЕ ЧУРПНПЗБФЕ-
		ORA	A	; МШОПК СЮЕКЛЙ ЕУМЙ ПОБ ТБЧОБ ОХМА
		JZ	DONE01	; ФП ЛМБЧЙЫБ тху/мбф еЭЕ ОБЦБФБ
		DCR	M	; Й РПЧФПТОХА РЕТЕХУФБОПЧЛХ РТПЙ-
		LDA	RUSLAT	; ЪЧПДЙФШ ОЕ ОБДП
		XRI	08H	; РТПЙЪЧПДЙН ЙОЧЕТУЙА Ч ВЙФЕ УЧЕФП-
		STA	RUSLAT	; ДЙПДБ
		JMP	DONE01	;
M5:		MVI	M,1	; ЖЙЛУЙТХЕН ОЕ ОБЦБФПЕ УПУФПСОЙЕ
DONE01:		XRA	A	; ЧЩДБЕН ОБ НБФТЙГЕ ЪБРТПУ П ОБЦ-
		OUT	03	; БФЩИ ЛМБЧЙЫБИ
		IN	02	; 
		INR	A	; РТПЙЪЧПДЙН РТПЧЕТЛХ ОБ ОБЦБФЙЕ
		JZ	EXIT1	; ХИПДЙН ЕУМЙ ОЕ ОБЦБФБ ОЙ ПДОБ
		LXI	B,0FE08H; ЛМБЧЙЫБ
		LXI	D,0800H	; РЕТЕИПДЙН Л РПДУЮЕФХ НЕУФБ ОБЦБФЙС
		MOV	A,B	; РП УТЕДУФЧПН ЗПОЕТБЮЙЙ ОБ ЧИПДОЩИ
KEY01:		OUT	03	; МЙОЙСИ ЛПДБ : "вЕЗХЭЙК ОПМШ"
		IN	02	; Й БОБМЙЪПН ЛПДБ ОБ ЧЩИПДОЩИ
		INR	A	; МЙОЙСИ НБФТЙГЙ ЛМБЧЙБФХТЩ
		JNZ	KEY010	;
		MOV	A,E	;
		ADD	D	;
		MOV	E,A	;
		MOV	A,B	;
		RLC		;
		MOV	B,A	;
		DCR	C	;
		JNZ	KEY01	;
EXIT1:		CALL	HLP	; РТПЙЪЧЕДЕН ХУФБОПЧЛХ РБТБНЕФТПЧ
		MVI	A,0FFH	; ЬЛТБОБ Й ЪБЧЕТЫЙН РТЕТЩЧБОЙЕ
		STA	KEYKOD	; У ЛПДПН ОЕ ОБЦБФПК ЛМБЧЙЫЙ
		JMP	MAIN_EXIT;

KEY010:		DCR	A	;
KEY00:		RAR		;
		INR	E	;
		JC	KEY00	;
		DCR	E	;
		CALL	HLP	;
		LXI	H,NUMBER;
		MOV	M,E	; УПИТБОСЕН ОПНЕТ ЛМБЧЙЫЙ
		INX	H	; DONEM-LABEL
		PUSH	H	; ЧЕЛФПТ РЕТЕИПДБ УПИТБОСЕН Ч УФЕЛЕ
		IN	01H	; ЮЙФБЕН УФБФХУ ХРТБЧМСАЭЙИ ЛМБЧЙЫ
		LXI	B,1020H	; BC - ТБВПЮЙЕ ЛПОУФБОФЩ
		ANA	C	; ЧЩДЕМСЕН ЛМБЧЙЫХ "уу"
		MOV	D,A	; УПИТБОСЕН Ч ТЕЗЙУФТЕ MPU
		MOV	A,E	; РТПЮЙФБЕН ОПНЕТ ЛМБЧЙЫЙ
		CMP	B	; УТБЧОЙН У ЛПДПН == 10H ===
		JNC	DONE03	; РЕТЕИПД ЕУМЙ ОПНЕТ ВПМШЫЕ 10H
;; рТПЙЪЧПДЙН ПВТБВПФЛХ ОБЦБФЙС ЛМБЧЙЫ УМХЦЕВОПК ЛМБЧЙБФХТЩ
;; ЙНЕАЭЙЕ УМЕДХАЭЙЕ ОПНЕТБ:
;;
		CPI	03H	; ОПНЕТ ЛМБЧЙЫЙ НЕОЙЫЕ 10H
		RNZ		; Ф.Е. ОБЦБФБ ЛМБЧЙЫБ УМХЦЕВОПК
		MOV	A,D	; ЛМБЧЙБФХТЩ ( РЕТЧЩЕ ДЧЕ МЙОЙЙ ОБ
		ORA	A	; УИЕНЕ ОЕПВИПДЙНП РПНЕОСФШ НЕУФБНЙ)
		MOV	A,E	; ЪДЕУШ ОЕПВИПДЙНП РТПЧЕТЙФШ ФПМШЛП
		RNZ		; ЛМБЧЙЫХ "ъв" Ч ЪБЧЙУЙНПУФЙ ПФ
		MVI	A,5FH	; ОБЦБФЙС ЛМБЧЙЫЙ "уу"
		RET		;

DONE03:		CMP	C	; УТБЧОЙН У ЛПДПН == 20H ==
		JNC	DONE05	; РЕТЕИПД ЕУМЙ ВПМЙЫЕ ЙМЙ ТБЧОП
;; пВТБВПФБЕН ЧБТЙБОФ ОБЦБФЙС ЛМБЧЙЫ У ОПНЕТБНЙ
;; ПФ 10H-20H - ГЙЖТЩ Й УРЕГ ЪОБЛЙ
		MOV	A,D	; ЧПЪШНЕН УФБФХУ ЛМБЧЙЫЩ "уу"
		ORA	A	; ЕУМЙ ФБН 0 ФП ЪОБЮЙФ ОБЦБФБ
		MOV	A,E	; ЙОБЮЕ ОЕ ОБЦБФБ
		JZ	KEY02	; 
		ADD	B	;
KEY02:		ADD	B	;
		MOV	L,A	;
		MOV	A,E	;
		CPI	1CH	;
		MOV	A,L	;
		RC		;
		XRA	B	;
		RET		;
;;
;; пВТБВПФБЕН ЧБТЙБОФ ОБЦБФЙС ВХЛЧЕОЩИ ЛМБЧЙЫ
;;
DONE05:		CPI	3FH	; ЕУМЙ ЬФП РТПВЕМ ФП ЧПЪЧТ.
		MOV	A,C	; ЛПД 20H
		RZ		;
		MOV	A,D	;
		ORA	A	;
		LDA	SMAL	; ЮЙФБЕН УФБФХУ СЮЕКЛЙ ТЕЗЙУФТПЧ
		JNZ	D_5_OBH	;
		CMA		;
D_5_OBH:	ORA	A	; РТПЧЕТСЕН ОБ ТБЧЕОУФЧП 0
		MOV	A,E	; ЕУМЙ = 0 ФП РТПРЙУОЩЕ ВХЛЧЩ
		JZ	KEY04	; ЙОБЮЕ УФТПЮОЩЕ ВХЛЧЩ
		ADD	C	;
KEY04:		ADD	C	;
		MOV	E,A	;
		LDA	RUSLAT	;
		ORA	A	;
		MOV	A,E	;
		RZ		;
		ADI	80H	; ЛПТЕЛГЙС ОБ ТХУЛЙЕ ВХЛЧЩ
		XRA	C	;
		RET		;
;###				;
NUMBER:		DB	'P'	;ОПНЕТ ЛМБЧЙЫЙ
;###				;
DONEM:		LXI	H,MAIN_EXIT;	
		PUSH	H	;
		MOV	C,A	;
		LDA	KEYKOD	;
		CMP	C	;
		LXI	H,KOOL	;
		JNZ	M22	;
		MOV	A,M	;
AL1:		CPI	30	;
		JZ	M24	;
M23:		INR	M	;
		RET		;
M22:		MVI	M,0	;
		MVI	A,30	;ЧТЕН.ПЦЙДБОЙС
		STA	AL1+1	;
		INX	H	;DREB
		MOV	A,M	;
		DCR	A	;
		JNZ	M23	;
		DCR	M	;
		DCX	H	;
		JMP	DONE10	;
M24:		MVI	M,0	;
		MVI	A,2	;CONST AUTO
		STA	AL1+1	;
DONE10:		MOV	A,C	;
		DCX	H	;
		MOV	M,A	;
		DCX	H	;
		DCR	B	;
		CMP	B	;
		JNZ	M31	;
		MOV	A,M	;SMAL
		CMA		;
		MOV	M,A	;
M31:		LXI	H,SEEK	;
		MOV	A,M	;
		CMP	B	;
		CALL	BEEP	;
		RZ		;
		INR	M	;
		MOV	C,A	;
		MVI	B,0	;
		DAD	B	;
		LDA	KEYKOD	;
		MOV	M,A	;
		RET		;
MAIN_EXIT:	POP	PSW	;
		POP	H	;
		POP	D	;
		POP	B	;
		EI		;
		RET		;

HLP:		MVI	A,88H	;
		OUT	00H	;
		LDA	RUSLAT	;
		OUT	01	;
		MVI	A,0FFH	;УЛТПМЙОЗ
		OUT	03	;
		MVI	A,10H	;ТЕЦЙН Й ВПТДАТ
		OUT	02	;
		RET		;

BEEP:		PUSH	PSW	;
		MVI	B,8	;
		MVI	E,30H	;
		LDA	RUSLAT	;
		MOV	C,A	;
BIP0:		INR	A	;
		ANI	1	;
		ORA	C	;
		OUT	1	;
		PUSH	D	;
BIP:		DCR	E	;
		JNZ	BIP	;
		POP	D	;
		DCR	B	;
		JNZ	BIP0	;
		POP	PSW	;
		RET		;

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

;		INCLUDE	EDMAIN.ASM
;; 
;; нПДХМШ УПДЕТЦЙФ РБЛЕФ РПДРТПЗТБНН ОБРЙУБООЩИ УРЕГЙБМШОП ДМС
;; "PPA Editor" ,ПОЙ БЛФЙЧОП КУРПМШЪХЩФ РПДРТПЗТБННЩ ПЛПООПЗП 
;; ДТБКЧЕТБ 
;; РПУМЕДОСС НПДЙЖЙЛБГЙС: 12.11.1992 З. лБТБЗБОДБ
;;
;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;
;;ыыыыыыы      470075     З.лБТБЗБОДБ           ыыыыыыы;;
;;ыыыыыыы   ХМ. 40 МЕФ лБЪБИУФБОБ Д.39/3 ЛЧ.1   ыыыыыыы;;
;;ыыыыыыы            рЙНЕОПЧ р.б                ыыыыыыы;;
;;ыыыыыыы               Ф.52-81-95              ыыыыыыы;;
;;
;;ыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыы
;; рТПГЕДХТБ MENU: ПВЕУРЕЮЙЧБЕФ УПЪДБОЙЕ Ч ФЕЛХЭЕН ПЛОЕ НЕОА РП
;; УТЕДУФЧПН РЕТЕНЕЭЕОЙС ЙОЧЕТУОПК РПМПУЛЙ РП ЧУЕНХ ПЛОХ Й ЕУМЙ
;; РТПЙУИПДЙФ РЕТЕИПД ЪБ РТЕДЕМЩ ПЛОБ ФП БЧФПНБФЙЮЕУЛЙ ХЛБЪБФЕМШ
;; РЕТЕИПДЙФ ОБ РТПФЙЧПРПМПЦОХА УФПТПОХ ПЛОБ. рТПГЕДХТБ ОЕ ЙНЕЕФ 
;; ЪБЭЙФЩ ПФ УЙФХБГЙЙ: Ч ПЛОЕ ОЕ РПНЕЭБЕФУС ВПМЕЕ ДЧХИ БМШФЕТОБ- 
;; ФЙЧОЩИ УФТПЛ ( НЕОА ЧЕТФЙЛБМШОПЕ ) Й ДТХЗЙИ ОЕ ЛПТЕЛФОЩИ ЧЩЪП-
;; ЧПЧ.
;; чИПДОЩЕ ДБООЩЕ: ОЕФ
;; чЩИПДОЩЕ ДБООЩЕ: A - ЧПЪЧТБЭБЕФУС РПЪЙГЙС Ч ЛПФПТПК РТПЙЪПЫМП
;;			 ОБЦБФЙЕ ЛМБЧЙЫЙ "чл" ЕУМЙ ВЩМБ ОБЦБФБ ЛМБ-
;;			 ЧЙЫБ "F4" ФП Ч б ЧПЪЧТБЭБЕФУС "0FFH"

MENU:		CALL	HLDEWIND	; ЮЙФБЕН ЛППТДЙОБФЩ ПЛОБ
		CALL	HLSUBDE		; ЧЩЮЙУМСЕН ТБЪНЕТЩ ПЛОБ
		MOV	A,B		; ТБУРТЕДЕМСЕН ТЕЗЙУФТЩ
		DCR	B		;
		DCR	B		;
		MOV	D,B		;
		MOV	L,C		;
		MOV	E,L		;
		MVI	H,0		;
		DCR	L		;
		SHLD	CURSOR		;
M_KEY_LOOP:	CALL	LINE_INV	; ЙОЧЕТФЙТЕХН УФТПЛХ
		CALL	KEYRESET	; УВТБУЩЧБЕН ДТБКЧЕТ ЛМБЧЙБФХТЩ
		CALL	KEYDELAU	; ПЦЙДБЕН ОБЦБФЙС
;;;;		CALL	PLAY		; РЙЛБЕН ( лт580чй53 )
		CALL	LINE_INV	; ЗБУЙН ХЛБЪБФЕМШ
		LXI	H,M_KEY_LOOP	;
		PUSH	H		;
		CPI	05H		; ЛМБЧЙЫБ ЧЧЕТИ
		JZ	M_UP		;
		CPI	07H		; ЛМБЧЙЫБ ЧОЙЪ
		JZ	M_DON		;
		CPI	02H		; "BK"
		JZ	M_EXIT		;
		CPI	0EH		; "F4"
		JZ	M_2EXIT		;
		RET			;
;; РТПГЕДХТБ ПВТБВПФЛЙ ОБЦБФЙС ЛМБЧЙЫЙ ЧЧЕТИ		
M_UP:		LXI	H,CURSOR	;
		INR	M		;
		MOV	A,M		;
		CMP	E		;
		RC			;
		MVI M,0			;
		RET			;
;; РТПГЕДХТБ ПВТБВПФЛЙ ОБЦБФЙС ЛМБЧЙЫЙ ЧОЙЪ
M_DON:		LXI	H,CURSOR	;
		DCR	M		;
		MOV	A,M		;
		INR	A		;
		RNZ			;
		MOV	M,E		; ЕУМЙ ПУХЭЕУФЧМСЕФУС ЛПТЕЛГЙС
		DCR	M		;
		RET			;

M_EXIT:		LDA	CURSOR		; ВЕТЕН ОПНЕТ ФЕЛХЭЕК УФТПЛЙ
M_2EXIT:	LXI	H,0AH		; ЛХТУПТ РПУЩМБЕН ОБ... ДПНПК
		SHLD	CURSOR		; Х ЧЩИПДЙН ЙЪ РТПГЕДХТЩ
		POP	H		; ЪБВЙТБЕН УМПЧП ЙЪ УФЕЛБ
		RET			;

LINE_INV:	LXI	H,CURSOR+1	; ХУФБОБЧМЙЧБЕН ХЛБЪБФЕМШ ОБ
		MVI	M,1		; ЗПТЙЪПОФБМШОХА ЛППТДЙОБФХ
LINE_I_DOP:	CALL	CINV		; Й РТПЙЪЧПДЙН РПУЙНЧПМШОХА
		INR	M		; ЙОЧЕТУЙА ЧУЕЗП ПЛОБ
		DCR	B		;
		JNZ	LINE_I_DOP	;
		MOV	B,D		; ЧПУФБОПЧЙН ДМЙОХ ПЛОБ
		RET			; ЧЩИПД ЙЪ РПДРТПЗТБННЩ

;;ыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыы

;+----------[ WINDOW PUTS ]------------+
;*	ЧИПД:	DE ->ЛППТД.,BC -> ХЛБЪ.*
;+-------------------------------------+

WPUTSDOP:	PUSH	H
		PUSH	D
		PUSH	PSW
		JMP	WDOP
WPUTS1:		PUSH	H	
		PUSH	D	
		PUSH	PSW	
		LDA	OFSET
		PUSH	PSW	
		CALL	MOVE	
		POP	PSW
WDOP:		ANI	7H
		SUI	2H
		LHLD	WIND2	
		INR	H
		MOV	L,A	
		CALL	ABSJDE	
WP01:		LDAX	B	
		CPI	CR	
		JZ	WPQ	
		CPI	9H
		JNZ	WP04	
WP02:		XRA	A	
		CALL	PUTCXY	
		INR	D	
		MOV	A,D
		CMP	H
		JNC	WPQ	
		ADD	L	
		ANI	7H	
		JNZ	WP02	
		JMP	WP03	
WP04:		CALL	PUTCXY	
		INR	D	
WP03:		INX	B	
		MOV	A,D	
		CMP	H
		JC	WP01	
WPQ:		XCHG
		SHLD	ENDLINE		;УПИТБОЙФШ ЛПОЕГ УФТПЛЙ
		POP	PSW	
		POP	D	
		POP	H	
		RET		

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

;+--------[ DESJWRITE ]---------+
;* ЧИПД: HL -> ХЛБЪ.ЮЙУМБ	*
;*	 DE -> ЛППТДЙОБФЩ	*
;*	 B*2+1 -> ЮЙУМП ГЙЖТ	*
;+------------------------------+
JDES:		PUSH	B	
		PUSH	D	
		PUSH	H	
		PUSH	PSW	
		MVI	C,0FH	
JD0:		MOV	A,M	
		CALL	JPUT	
		INX	H	
		MOV	A,M	
		RRC		
		RRC		
		RRC		
		RRC		
		CALL	JPUT	
		DCR	B	
		JNZ	JD0	
		MOV	A,M	
		CALL	JPUT	
		POP	PSW	
		POP	H	
		POP	D	
		POP	B	
		RET		
JPUT:		ANA	C	
		ADI	30H	
		CALL	PUTCXY	
		INR	D	
		RET		

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

;+---------[ HEXJWRITE ]--------+
;* ЧИПД: A -> ЛПД		*
;*	 DE -> ЛППТДЙОБФЩ	*
;* РТЙ ПФОПУ ЛППТД.DE РТЕПВТ.	*
;* Ч БВУПМАФОЩЕ			*
;+------------------------------+
WJHEX:		PUSH	B	
		CALL	ABSJDE	
		POP	B	
JHEX:		PUSH	B	
		MOV	B,A	
		RRC		
		RRC		
		RRC		
		RRC		
		CALL	PR	
		MOV	A,B	
		CALL	PR	
		MOV	A,B	
		POP	B	
		RET		
PR:		ANI	0FH	
		CPI	0AH	
		JC	PR0	
		ADI	7	
PR0:		ADI	30H	
		CALL	PUTCXY	
		INR	D	
		RET		

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

;+-----------[ MOVE ]-----------+
;24.02.1993З. ПФМБДЙМ РТПГЕДХТХ MOVE ТБВПФБЕФ ОП НПЦОП УДЕМБФШ
;МХЮЫЕ Й ВЩУФТЕЕ ...ОХ ЕЕ ОБ ИТЕО ОБДПЕМП

MOVE:		ORA	A	; 24.2.93
		RZ		; --//--
		MOV	H,A
		MVI	L,0
		LDAX	B
		CPI	9H
		JNZ	MV2
		DCX	B
		JMP	MV0
MV2:		MOV	A,L
		CMP	H
		RNC		;РЕТЕИПД ЕУМЙ L>=H
		INR	L
MV3:		LDAX	B	
		CPI	9H
		JZ	MV0	;ПВТБВПФЛБ ФБВХМСГЙЙ
		CPI	CR
		RZ
		INX	B
		JMP	MV2
MV0:		MOV	A,H
		CMP	L
		RC
		MOV	A,L	
		INR	L
		ANI	7	
		JNZ	MV0
		INX	B
		MOV	A,H
		CMP	L
		RC
		LDAX	B
		CPI	09H
		JZ	MV0
		JMP	MV3+1
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

;		INCLUDE	EDLINE.ASM
;$$$$$$$$$$$$$$ SMALL EDITOR LINE $$$$$$$$$$$$[ 17.11.1992 ]
;;
;;УФТПЛБЧЩК ТЕДБЛФПТ РТПЙЪЧПДЙФ ТЕДБЛГЙА УФТПЛЙ Ч ВХЖЕТЕ STR
;;ДП ФПЗП НПНЕОФБ РПЛБ ОЕ ОБЦБФБ ЛМБЧЙЫБ "ЧЛ"
;;ЛМБЧЙЫЩ ХРТБЧМЕОЙС :ЧМЕЧП,ЧРТБЧП,ЪВ,F2
;;ЧИПДОЩЕ ДБООЩЕ: 
;;			Б => ДМЙОБ (НБЛУЙНБМШОБС) ДП ЛПФПТПК ЧПЪНПЦОП
;;			     ТЕДБЛФЙТПЧБФШ УФТПЛХ
;;			DE=> ПФОПУЙФЕМШОЩЕ ЛППТДЙОБФЩ ЗТБЖЙЛЙ УФТПЛЙ
;;			HL=> ХЛБЪБФЕМШ ОБ ТЕДБЛФЙТХЕНХА УФТПЛХ
;;			     УФТПЛБ ЛПРЙТХЕФУС Ч ВХЖЕТ STR
;
;;ыыыыыыы      470075     З.лБТБЗБОДБ           ыыыыыыы;;
;;ыыыыыыы   ХМ. 40 МЕФ лБЪБИУФБОБ Д.39/3 ЛЧ.1   ыыыыыыы;;
;;ыыыыыыы            рЙНЕОПЧ р.б                ыыыыыыы;;
;;ыыыыыыы               Ф.52-81-95              ыыыыыыы;;
;;

EDLINE:		STA	MAXDLINNA
		CALL	COPYSDOP
		MOV	H,A		;УПИТБОЙН ЮЙУМП УЙНЧПМПЧ
		LXI	B,STR		;ВХЖЕТ УФТПЛЙ
		XRA	A
		CALL	WPUTSDOP
		MOV	L,E
		MOV	A,D		;BC -ХЛБЪБФЕМШ ЛПОГБ УФТПЛЙ
		ADD	H
		MOV	H,A
		SHLD	CURSOR		;ХУФБОПЧЙН МПЛБМШОЩК ЛХТУПТ
EDDO:		CALL	CINV
EDKEYLOOP:	CALL	KEYDELAU
		CALL	CINV
		LXI	H,EDDO
		PUSH	H
		CPI	10H
		JNC	SYMBOLS		;ОБЦБФБ ВХЛЧБ
		CPI	04H		;ЧМЕЧП
		JZ	EDLEFT
		CPI	06H		;ЧРТБЧП
		JZ	EDRIGHT
		CPI	0CH		;F2-UDALENIE
		JZ	EDDELETE
		CPI	03H		;ЪБВПК
		JZ	EDZABOY
		CPI	0EH		;F4-ESC
		POP	H
		RZ
		CPI	02H		;BK
		RZ
		PUSH	H
		RET

SYMBOLS:	CALL	EDINSERT
		CZ	EDRIGHT
		RET
;$$$$$$$$$$$$
EDZABOY:	CALL	EDLEFT
		CNZ	EDDELETE
		RET
;$$$$$$$$$$$$
;РТПГЕДХТБ ЧУФБЧЛЙ УЙНЧПМБ Ч УФТЛХ ОБИПДСЭХаУС Ч ВХЖЕТЕ STR
EDINSERT:	LDA	MAXDLINNA
		PUSH	B
		LXI	B,STR
		CALL	MOVE
		LDAX	B
		CPI	CR
		POP	B
		CNZ	PLAY
		RNZ
		CALL	MOVEINS	;РЕТЕОПУ У ДЕЛТЕНЕОФПН
		LDA	KEYKOD
		STAX	B
		PUSH	B
		LXI	B,STR
		XRA	A
		CALL	WPUTSDOP
		POP	B
		RET
;$$$$$$$$$$$
EDDELETE:	LDAX	B
		CPI	CR
		RZ		;ЛПОЕГ УФТПЛЙ ЧЩКФЙ У ЖМБЗПН "Z" Ч ТХЛБИ
		CALL	MOVEDEL		;РЕТЕОПУ У ЙОЛТЕНЕОФПН
		LHLD	ENDLINE
		DCR	H
		PUSH	B
		LXI	B,STR
		XRA	A
		CALL	WPUTSDOP		
		POP	B
		MVI	A,' '
		XCHG
		CALL	PUTCXY
		XCHG
		ORA	A		;УВТПУ ЖМБЗБ
		RET
;$$$$$$$$$$$
;	BC ===> ЛХДБ
;
MOVEDEL:	MOV	H,B
		MOV	L,C
MODE0:		INX	H
		MOV	A,M
		DCX	H
		MOV	M,A
		INX	H
		CPI	CR
		JNZ	MODE0
		RET
;$$$$$$$$$$$
;BC --> ХЛБЪБФЕМШ УФТПЛЙ УЙНЦПМПЧ ЛХДБ ОХЦОП РТПЙЪЧЕУФЙ ЧУФБЧЛХ
MOVEINS:	MOV	H,B
		MOV	L,C
		PUSH	D
		MVI	D,0
MOINS0:		MOV	A,M
		INR	D
		CPI	CR
		INX	H
		JNZ	MOINS0
MOINS1:		DCX	H
		MOV	A,M
		INX	H
		MOV	M,A
		DCX	H
		DCR	D
		JNZ	MOINS1
		POP	D
		RET
;$$$$$$$$$$$
EDLEFT:		DCX	B
		LDAX	B
		CPI	CR
		INX	B
		RZ			;ЧЩИПД ОБЮБМП УФТПЛЙ
		DCX	B
		LXI	H,CURSOR+1
		DCR	M
		INR	A		;УВТПУ ЖМБЗБ
		RET
;$$$$$$$$$$$
EDRIGHT:	LDAX	B
		CPI	CR
		RZ
		INX	B
		LXI	H,CURSOR+1
		INR	M
		INR	A		;УВТПУ ЖМБЗБ
		RET
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

;		INCLUDE	SYMB.ASM
;; РБЛЕФ РТПГЕДХТ РТЕДОБЪОБЮЕО ДМС ПВТБВПФЛЙ
;; ОБЦБФЙК ОБ УЙНЧПМШОЩЕ ЛМБЧЙЫЙ Й ОЕЛПФПТЩЕ 
;; ХРТБЧМСАЭЙЕ УРЕГЙБМШОП ДМС PPA-Editor
;; УЕЗПДОС: 06.12.1992 +++ 14:05 +++ ЧПУЛТЕУЕОШЕ
;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;
;;ыыыыыыы      470075     З.лБТБЗБОДБ           ыыыыыыы;;
;;ыыыыыыы   ХМ. 40 МЕФ лБЪБИУФБОБ Д.39/3 ЛЧ.1   ыыыыыыы;;
;;ыыыыыыы            рЙНЕОПЧ р.б                ыыыыыыы;;
;;ыыыыыыы               Ф.52-81-95              ыыыыыыы;;
;;

;#######################################
BYKVA:		PUSH	PSW
		CALL	NARUSHENIE
		CALL	KEYRESET
		POP	PSW
		JNZ	BYKVA_NORM
;ПВТБВПФБФШ ЧУФБЧЛХ ФБВХМСГЙЙ
		MVI	D,09H
		MVI	A,246
		CALL	INSERTS_DOP
		JZ	RIGERROR
		CALL	BYKVA_HLP
BYKVA_00:	CALL	RIGHT
		ORA	A
		RZ
		DCR	A
		RZ
		JMP	BYKVA_00
		
BYKVA_NORM:	CALL	INSERTS
		JZ	RIGERROR	;УФТПЛБ РЕТЕРПМОЕОБ
		CALL	BYKVA_HLP
		CALL	RIGHT
		RET
;#####################################
BYKVA_HLP:	LHLD	CURSOR
		MVI	H,0
		XCHG
		LXI	B,STR
		CALL	WPUTS1
		RET
				
;$$$$$$$$$$$$$ ЧУФБЧЛБ УЙНЧПМБ $$$$$$$$$$$$
INSERTS:	MOV	D,A
		MVI	A,254
INSERTS_DOP:	LXI	B,STR
		CALL	MOVE
		LDAX	B
		SUI	CR
		JZ	INS_00
		XRA	A
		RET
INS_00:		MVI	E,1
		CALL	INS_INS
		DCR	E
		CNZ	MOVEDEL
		MOV	A,D
		STAX	B
		ORA	A
		RET
»»
;; ДМС ЪБРХФЩЧБОЙС®
;;
;%%%%%%%%%%%%% ХУ + ЛМБЧЙЫЙ %%%%%%%%%%%%%%%

USADDX:		CALL	REGENER		;
		LXI	H,K_SUMMA + 41E1H ;
		LXI	D, -41E1H	;
		DAD	D		;
		MOV	A,M		;
		ORA	A		;
		INX	H		;
		CNZ	ER_K_SUMMA	;
		MOV	A,M		;
		ORA	A		;
		CNZ	ER_K_SUMMA	;
;;
;; РПДУЮЙФБЕН ЛПОФТПМШОХА УХННХ ДМС ХЮБУФЛБ ПУОПЧОПЗП ЛПОФТПМС
;;
		LXI	B,0		;
		LXI	H,PPASTART + 41E1h ;
		DAD	D		;
US_K_PPA_00:
		MOV	A,C		;
		ADD	M		;
		MOV	C,A		;
		INX	H		;
		DCR	B		;
		JNZ	US_K_PPA_00	;
;;
;;  C - оБИПДЙФУС ЛПОФТПМШОБС УХННБ
;; ХЮБУФЛБ ПУХЭЕУФЧМСАЭЕЗП ЛПОФТПМШ ПУОПЧОПЗП НПДХМС
;;
		CPI	0		;
		CNZ	ER_K_SUMMA	;
		LXI	H,100h + 41E1h	;
		DAD	D		;
US_K_PPA_10:
		MOV	A,C		;
		ADD	M		;
		MOV	C,A		;
		INX	H		;
		DCR	B		;
		JNZ	US_K_PPA_10	;
		CPI	00		;
		CNZ	ER_K_SUMMA	;		
		LDA	NUMBER		;ЮЙФБЕН БРБТБФОЩК ОПНЕТ ЛМБЧЙЫЙ
		CPI	14H		;ОПНЕТ "4" ===== SEARCH =====
		JZ	SEARCH		;
		CPI	17H		;ОПНЕТ "7" ====== QUIT ======
		JZ	PPAQUIT		;
		CPI	13H		;ОПНЕТ "3" ====== GOTO ======
		JZ	GOTOLINE	;
		CPI	12H		;ОПНЕТ "2" ====== File ======
		JZ	FILE		;
		CPI	11H		;ОПНЕТ "1" ====== Help ======
		JZ	HELP		;
		CPI	16H		;ОПНЕТ "6" ====== Info ======
		JZ	M_INFO		;
		CPI	15H		;ОПНЕТ "5" ====== Servis ====
		JZ	SERVIS		;
		LDA	KEYKOD		;
		JMP	KEYDONE		;

;;

INS_INS:	LDA	CURHX
		LXI	B,STR
		CALL	MOVE
		CALL	MOVEINS
		LDAX	B
		CPI	CR
		RNZ
		MVI	A,' '
		MOV	E,A
		STAX	B
		JMP	INS_INS

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

;		INCLUDE	UPR.ASM
; ;РТПГЕДХТЩ ПВТБВПФЛЙ ХРТБЧМСАЭЙИ ЛМБЧЙЫ
; ;РПУМЕДОСС НПДЙЖЙЛБГЙС : 17.11.1992 ЛБТБЗБОДБ

;;
;;ыыыыыыы      470075     З.лБТБЗБОДБ           ыыыыыыы;;
;;ыыыыыыы   ХМ. 40 МЕФ лБЪБИУФБОБ Д.39/3 ЛЧ.1   ыыыыыыы;;
;;ыыыыыыы            рЙНЕОПЧ р.б                ыыыыыыы;;
;;ыыыыыыы               Ф.52-81-95              ыыыыыыы;;
;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
; ; РТПГЕДХТБ ХДБМЕОЙС УЙНЧПМБ ОБИПДСЭЕЗПУС РПД ЛХТУПТПН
; ; 16.11.1992 ЛБТБЗБОДБ
DELETE:		CALL	KEYRESET
		LDA	CURHX
		LXI	B,STR
		CALL	MOVE
		LDAX	B
		CPI	CR
		JZ	DEL_ENTER_SYM
		CALL	NARUSHENIE
		CALL	MOVEDEL
		LXI	B,STR
		LHLD	CURSOR
		XCHG
		MVI	D,0
		CALL	WPUTS1
		LHLD	ENDLINE
		XCHG
		MVI	H,3DH
		MOV	A,D
		CMP	H
		MVI	A,' '
		CZ	PUTCXY
		MOV	L,E
		MOV	A,D
		CMP	H
		RNC
		CALL	CLS
		RET

DEL_ENTER_SYM:	CALL	INS_00
		INR	E
		DCR	E
		JZ	DEL_DONE
		MVI	A,1
		STA	FLAGLINE	;РТЙУФХРЙФШ Л ТЕЗЕОЕТБГЙЙ
DEL_DONE:	CALL	MOVEDEL
		CALL	REGENER
		LHLD	POS
		PUSH	H
		CALL	SINC
		LXI	B,SOOBD
		POP	H
		JZ	WARNING
		PUSH	H
		MOV	A,M
		CPI	CR		;УФТПЛБ РХУФБС ???
		JZ	OBHOD_00
		LHLD	POS
		DCX	H
		MVI	M,20H		;ЪБВЙЧБЕН РТЙЪОБЛЙ ЛПОГБ УФТПЛЙ
		DCX	H
		MVI	M,20H
		POP	B
		PUSH	B
		MVI	A,240
		PUSH	H
		CALL	MOVE
		POP	H
		LDAX	B		;HL - ХЛБЪБФЕМШ ОБ ОБЮБМП УГЕРМСЕНПК
		CPI	CR		; УФТПЛЙ УЙНЧПМПЧ
		JNZ	ER_DEL		;РПМХЮЙН УМЙЫЛПН ДМЙООХА УФТПЛХ
		INX	H
		INX	H
OBHOD_00:	LXI	B,0FE00H
		CALL	COPUINC		;ХОЙЮФПЦБЕН УЙНЧПМЩ ЛПОГБ УФТ.
		POP	H
		SHLD	POS
		PUSH	H
		PUSH	H
		LHLD	CURSOR
		MOV	A,L
		PUSH	H
		MVI	H,3DH
		LXI	D,203H
		ADD	D
		MOV	L,A
		CMP	D
		JNZ	DEL_NO_SC	;ЛХТУПТ Ч ПЛОЕ
	;ЛХТУПТ ЧОЙЪХ ЬЛТБОБ
		MVI	L,0DH
		CALL	SCRV
		MVI	A,1
		STA	CURSOR
		MVI	L,4
		CALL	CLS
		LHLD	POS
		MOV	B,H
		MOV	C,L
		LXI	D,1
		CALL	WPUTS1
		XRA	A		;ЖМБЗ Z  ХУФБОПЧ
DEL_NO_SC:	CNZ	SCRV		;УЛТПМЙОЗ ПЛОБ ЧЧЕТИ
		PUSH	PSW
		INR	L
		POP	PSW
		MOV	E,L
		CNZ	CLS
		POP	D
		MVI	D,0
		POP	B
		CNZ	WPUTS1		;ДПРПМОСЕН УФТПЛЙ
		CALL	COPYS
		STA	DLINNA
		LDA	CURSOR		;ЧЩУЧЕФЙН УФТПЛХ РПУМЕ РПДОСФЙС ФЕЛУФБ
		MOV	B,A
DEL_02:		CALL	SINC
		JZ	EX_BOT		; ЛПОЕГ ФЕЛУФБ
		DCR	B
		JNZ	DEL_02
		MOV	D,B		;	DE = 0000H
		MOV	E,D
		MOV	B,H
		MOV	C,L
		CALL	WPUTS1
EX_BOT:		POP	H
		SHLD	POS
		RET

ER_DEL:		XTHL
		SHLD	POS
		POP	H
		MVI	M,CR
		INX	H
		MVI	M,LF
		XRA	A
		JMP	RIGERROR
;;ыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыы
; ; РТПГЕДХТБ ПВТБВПФЛЙ ОБЦБФЙС ОБ ЛМБЧЙЫХ ъбвпк 5.1.1993 
ZABOY:		
		CALL	LEFT
		DCR	A		; ЛХТУПТ Ч ОББМЕ УФТПЛЙ ???
		JNZ	ZAB_00		; РЕТЕИПД ЕУМЙ ОЕФ
		CALL	UP		;РПДОЙНБЕНУС ОБ УФТПЛХ ЧЩЫЕ
		RZ			;ПРЕТБГЙА РТПЧЕУФЙ ОЕ ХДБМПУШ
		CALL	CCRIGHT		;РЕТЕНЕЭБЕНУС Ч ЛПОЕГ
		CALL	DELETE		;УФТПЛЙ Й ХДБМСЕН УЙНЧПМ "Ok"
		RET
ZAB_00:		INR	A		;РЕТЕНЕУФЙМЙУШ ХУРЕЫОП ???
ZAB_10:		ORA	A
		JNZ	EXIT_ZAB
		CALL	LEFT		;ГЙЛМ ОБ УМХЮБК ФБВХМСГЙЙ
		JMP	ZAB_10
EXIT_ZAB:	CALL	DELETE		; ЕУМЙ ДБ ФП ХДБМСЕН УЙНЧПМ
		RET			; Й ЧЩИПДЙН
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
; ;РТПГЕДХТБ РЕТЕИПДБ ОБ ОПЧХА УФТПЛХ 17.11.1992 ЛБТБЗБОДБ
; ;
ENTER:		CALL	REGENER
		LHLD	POS
		MOV	B,H
		MOV	C,L
		LDA	CURHX
		CALL	MOVE
		MOV	H,B
		MOV	L,C
		PUSH	H
		LXI	B,0200H		;2-РТЙТБЭЕОЙЕ УФТПЛЙ
		CALL	COPUDEC
		MVI	M,CR
		INX	H
		MVI	M,LF

		LDA	OFSET
		ORA	A
		LXI	H,3D0DH
		LXI	D,203H
		POP	B		;
		JNZ	ENT_00
;;
;;   пВТБВПФБФШ ЧЕФЧШ ЛПЗДБ ФЕЛХЭЕЕ ПЛОП ОЕ УДЧЙОХФП
;; Й ОБИПДЙФУС Ч NULL РПЪЙГЙЙ
;;
		LDA	CURSOR
		ADD	D		;D=2
		MOV	L,A
		CMP	D		;D=2
		CNZ	SCRN
		INX	B
		INX	B
		PUSH	PSW
		INR	L
		LDA	CURSOR+1
		ADD	D		;D=2 8.2.1993
		MOV	D,A
		MOV	E,L
		CMP	H		;H=3DH  8.2.1993
		CC	CLS		; 8.2.1993
		MVI	A,' '		;
		CNC	PUTCXY		;
		LHLD	CURSOR
		XCHG
		DCR	E
		MVI	D,0
		POP	PSW
		CNZ	WPUTS1
		XRA	A		;
ENT_00:		PUSH	PSW		;
		CALL	COPYS		;
		POP	PSW		;
		CNZ	HOME		;
		CALL	CCLEFT		;
		CALL	DON		;
		RET			;

;#######################################
DOMOY:		CALL	REGENER
		CALL	CCLEFT
		LDA	CURSOR
		CPI	0AH
		CNZ	CCUP
		RET


;%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
; ; РТПГЕДХТЩ DON and UP ОЕ УПИТБОСАФ ТЕЗЙУФТПЧ
; ; Й ЧПЪЧТБЭБАФ ТЕЪХМЙФБФ УЧПЕК ТБВПФЩ Ч ЧЙДЕ ЖМБЗБ Z
; ;	Z = 1  -  ДПУФЙЗОХФ ЛПОЕГ ( ОБЮБМП ) ФЕЛУФБ
; ;	Z = 0  -  РТПЙЪПЫМП ХУРЕЫОПЕ РЕТЕНЕЭЕОЙЕ
; ;
;////// РТПГЕДХТБ ПВТБВПФЛ ЧОЙЪ //////
DON:		CALL	REGENER
		CALL	SINC	
		LXI	B,SOOBD
		JZ	WARNING
		CALL	COPYS	
		STA	DLINNA
		CALL	INCY	
		LHLD	CURSOR	
		DCR	L	
		MOV	A,L	
		INR	A	
		CZ	DONENDWIND	;ЛПОЕГ ПЛОБ
		CALL	TABCOREKT
		CALL	UP_DON_HLP	;
		RET			;
DONENDWIND:	LXI	B,STR
		LXI	D,0	
		CALL	SCROL1	
		CALL	WPUTS1	
		INR	L
		RET	
;; дПРПМОЙФЕМШОБС РПДРТПЗТБННБ ДМС ХУФБОПЧЛЙ ЛХТУПТБ Ч
;; ЛПОЕГ УФТПЛЙ ОБ ЛПФПТХЕ РТПЙЪПЫМП РЕТЕНЕЭЕОЙЕ
UP_DON_HLP:	LXI	B,STR		;
		LDA	CURHX		;
		CALL	MOVE		;
		LDAX	B		;
		CPI	CR		;
		CZ	CCRIGHT		;
		ORI	1		;РЕТЕНЕУФЙМЙУШ ХУРЕЫОП
		RET			;

;%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
UP:		CALL	REGENER
		CALL	SDEC	
		LXI	B,SOOBV
		JNC	WARNING
		CALL	DECY	
		CALL	COPYS
		STA	DLINNA
		LHLD	CURSOR	
		MOV	A,L	
		INR	L
		CPI	0AH	
		CZ	UPENDWIND	;ЛПОЕГ ПЛОБ
		CALL	TABCOREKT
		CALL	UP_DON_HLP	;
		RET	
UPENDWIND:	LXI	B,STR	
		LXI	D,0AH	
		CALL	SCROL2	
		CALL	WPUTS1
		DCR	L
		RET
;%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
; ; РТПГЕДХТЩ ОЕ УПИТБОСАФ ТЕЗЙУФТПЧ РТПГЕУПТБ
; ; ТЕЪХМШФБФ Ч БЛЛБНХМСФПТЕ:
; ; 	A = 0 - РЕТЕИПД ЪБ РТЕДЕМЩ ПЛОБ ("ОЕРПМОЩК фбв")
; ; 	A = 1 - ОБЮБМП (ЛПОЕГ) ПЛОБ
; ; 	б = 2 - РЕТЕНЕЭЕОЙЕ РТПЙЪПЫМП ХУРЕЫОП
; ; 	б = 3 - ЧЩРПМОЕОБ ФБВХМСГЙС ПРЕТБГЙС ЪБЛПОЮЙМБУШ ХУРЕЫОП
; ; 	б = 0FFH - РТПЙЪПЭЕМ ЧЩИПД ЪБ РТЕДЕМЩ ПЛОБ Й ПО ХУРЕЫОП
; ;		   РПДДБМУС ЛПНРЕОУБГЙЙ ( УДЧЙЗ,ЛПТЕЛГЙС Х Ф.Д.)
; ;
; ;
;////// РТПГЕДХТБ ПВТБВПФЛЙ "ЧМЕЧП" //////
LEFT:		LDA	CURHX
		ORA	A
		JZ	LEFBEG		;ЧЩДБФШ УППВЭЕОЙЕ П ОБЮБМЕ
		DCR	A
		LXI	B,STR
		CALL	MOVE
		LXI	H,CURSOR+1
		LDAX	B
		CPI	9H
		LDA	CURHX
		JNZ	LEFDONE
		CALL	LEFTABHELP
		MVI	A,3H		;ФБВХМСГЙС
		RNZ			;ХИПД ЕУМЙ ОЕ ЛПОЕГ ПЛОБ
		INR	B
		INR	B
		MOV	M,B
		CALL	LEFDOP
		XRA	A		;Z=1 ОЕПВИПДЙНП УДЧЙЗБФШ
		RET
LEFDONE:	MOV	A,M
		ORA	A	
		JZ	LEEND	
		DCR	M
		CALL	DECX	
		MVI	A,2H		;РТПУФПК УДЧЙЗ ВЕЪ ПУМПЦОЕОЙК
		RET	
LEFBEG:		LXI	B,SOOBL	
WARNING:	LXI	D,0A01H	
		CALL	MESS	
		CALL	PLAY	
		LHLD	ENDLINE
		CALL	CLS	
		CALL	KEYRESET
		XRA	A		;Z=1
		MOV	A,L	;A=1 ОБЮБМП УФТПЛЙ
		RET		
LEEND:		CALL	LEFENDWIND
		LXI	H,CURSOR+1
		INR	M
		MVI	A,0FFH	;A=255 УДЧЙЗ ЪБ ПЛОП
		RET	
;%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
;////// РТПГЕДХТБ ПВТБВПФЛЙ "ЧРТБЧП" //////
RIGHT:		LDA	CURHX
		CPI	0FFH
RIGERROR:	LXI	B,SOOBR
		JZ	WARNING
		LXI	B,STR
		CALL	MOVE
		LXI	H,CURSOR+1
		LDAX	B
		CPI	9H
		LDA	CURHX
		JZ	RIGTAB
		MOV	A,M
		INR	M
		CPI	3BH
		CNZ	INCX		;РТЙ ПФУХФУФЧЙЕ ЛПОГБ ПЛОБ
		RNZ
RIEND:		DCR	M
		DCR	M
		CALL	RIENDWIND
		RET	
RIGTAB:		MVI	B,0H		;УПИТБОЙН РПМПЦЕОЙЕ ЛХТУПТБ
RITAB1:		MOV	C,A
		MOV	A,M
		INR	M
		CPI	3BH
		MOV	A,C
		JZ	RITAB0		;ЛПОЕГ ПЛОБ ФП РЕТЕИПД
		INR	B
		INR	A
		ANI	7H
		JNZ	RITAB1
RILOOP:		DCR	B
		CALL	INCX
		JNZ	RILOOP
		RET
RITAB0:		MOV	A,M
		SUB	B
		SUI	3H
		MOV	M,A
		LXI	H,CURHX
		MOV	A,M
		PUSH	PSW
		PUSH	H
		ADD	B
		INR	A
		MOV	M,A
		CALL	RIDOP
		POP	H
		POP	PSW
		MOV	M,A
		RET		
;%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
TABCOREKT:	SHLD	CURSOR	
		LDA	CURHX
		MOV	B,A
		ANI	7H
		RZ
		MOV	A,B
		LXI	B,STR
		CALL	MOVE
		LDAX	B
		CPI	9H
		RNZ			;ОБ РПМХ ОЕФ ФБВХМСГЙЙ
		LXI	H,CURHX
COR00:		CALL	LEFT
		ORA	A
		JZ	COR00
		RET	
;%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
RLTOPHELP:	STA	OFSET
		LDA	CURSOR
RLTOPDOP:	INR	A
		CPI	0BH
		RNC	
		PUSH	PSW
		CALL	SDEC
		POP	PSW
		JMP	RLTOPDOP
;%%%%%%%%%%%%%%%%%%%
LEFTABHELP:	MVI	B,0H
LEFTAB1:	MOV	C,A
		MOV	A,M
		DCR	M		;ХНЕОШЫБЕН ЗТБЖЙЛХ ЛХТУПТБ
		ORA	A
		RZ
		INR	B
		DCR	C
		MOV	A,C
		ANI	7H
		JZ	LEFLOOP
		CALL	LEF_T_H_HLP
		JZ	LEFTAB1		;РТПЧЕТЛБ ОБ ЛПОЕГ ФБВХМСГЙЙ
		INR	M
		DCR	B
LEFLOOP:	DCR	B
		CALL	DECX
		JNZ	LEFLOOP
		CALL	LEF_T_H_HLP
		JZ	LEF_T_EXIT_NORM
;;
;; уДЧЙОЕН ОБ ПДОХ РПЪЙГЙА ЧРТБЧП®
;;		
		INR	M
		CALL	INCX
LEF_T_EXIT_NORM:
		ORI	1		;УВТПУ ЖМБЗБ Z
		RET

LEF_T_H_HLP:
		PUSH	H
		LHLD	CURSOR
		XCHG
		CALL	GETC
		ORA	A
		MOV	A,C
		POP	H
		RET

;$$$$$$$$$$$$$$$$$$
LEFENDWIND:	CALL	DECX
LEFDOP:		CALL	REGENER
		CALL	SCROL3
		LHLD	POS
		PUSH	H
		LDA	OFSET
		SUI	2H
		CALL	RLTOPHELP
		MVI	A,3H		;РПДНЕОБ ЗТБОЙГЙ ПЛОБ
		STA	WIND2+1
		LXI	D,000AH		;ЛТЩЫБ ПЛОБ
LEF01:		LHLD	POS
		MOV	B,H
		MOV	C,L
		CALL	WPUTS1		;ДПРПМОСЕН УФТПЛХ
		PUSH	D
		CALL	SINC
		JZ	LEFTEXIT
		POP	D
		DCR	E
		MOV	A,E
		INR	A
		JNZ	LEF01
		PUSH	D
LEFTEXIT:	POP	D
		MVI	A,3DH
		STA	WIND2+1
		POP	H
		SHLD	POS
		RET
;$$$$$$$$$$$$$$$$$$
RIENDWIND:	CALL	INCX
RIDOP:		CALL	REGENER
		CALL	SCROL4
		LHLD	POS		;УПИТБОЙФШ ХЛБЪБФЕМШ
		PUSH	H
		LDA	OFSET
		ADI	2
		CALL	RLTOPHELP	;РПДОЙН` ОБ "ЛТЩЫХ"
		LXI	D,3A0AH		;ЧЕТИХЫЛБ ПЛОБ
RIQ000:		LHLD	POS
		MOV	B,H
		MOV	C,L
		LDA	CURHX
		CALL	MOVE
		LDA	OFSET
		CALL	WPUTSDOP	;ДПРПМОСЕН УФТПЛХ
		PUSH	D
		CALL	SINC
		JZ	RIGEXIT		;ЛПОЕГ ФЕЛУФБ
		POP	D
		DCR	E
		MOV	A,E
		INR	A
		JNZ	RIQ000
		PUSH	D
RIGEXIT:	POP	D
		POP	H
		SHLD	POS
		RET
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

;		INCLUDE	CC.ASM
; ;жБКМ УПДЕТЦЙФ РТПГЕДХТЩ ПВТБВПФЛЙ ОБЦБФЙК ЛМБЧЙЫ ХРТБЧМЕОЙС
; ;УПЧНЕУФОП У ЛМБЧЙЫЕК У уу
; ;РПУМЕДОСС ЛПТЕЛГЙС :  17.11.199 лБТБЗБОДБ
;;
;;ыыыыыыы      470075     З.лБТБЗБОДБ           ыыыыыыы;;
;;ыыыыыыы   ХМ. 40 МЕФ лБЪБИУФБОБ Д.39/3 ЛЧ.1   ыыыыыыы;;
;;ыыыыыыы            рЙНЕОПЧ р.б                ыыыыыыы;;
;;ыыыыыыы               Ф.52-81-95              ыыыыыыы;;

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
; ; РТПГЕДХТБ ХДБМЕОЙС УФТПЛЙ (ФЕЛХЭЕК) 16.11.1992
CCDELETE:	CALL	NARUSHENIE	;
		CALL	CCLEFT		;РЕТЕИПД Л ОБЮБМХ УФТПЛЙ
		LXI	H,STR		;
		MVI	M,CR		;ПВТХВБЕН УФТПЛХ ЧП ЧТЕНЕОПН ВХЖЕТЕ
		CALL	DELETE		;ХДБМСЕН РТЙЪОБЛ ЛПОГБ УФТПЛЙ
		LHLD	POS		;
		INX	H		;
		INX	H		;
		MOV	A,M		;
		CPI	STOPBYTE	;
		PUSH	PSW		;
		LHLD	CURSOR		;
		INR	L		;
		INR	L		;
		INR	L		;
		MVI	D,2		;
		MOV	E,L		;
		MVI	H,03DH		;
		POP	PSW		;
		CZ	CLS		;
		RET			;

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

;#######################################
;; РТПГЕДХТБ ХУФБОПЧЛЙ ЛХТУПТБ Ч ЛПОЕГ УФТПЛЙ
CCRIGHT:	CALL	REGENER		; 8.2.1993
		LDA	OFSET
		PUSH	PSW
		XRA	A
		STA	OFSET
		STA	CURHX
		MOV	H,A
		MOV	L,A
		SHLD	CURDX
		XCHG			; DE =0
CCR_LOOP:	LXI	B,STR
		MOV	A,D
		CALL	MOVE
		LDAX	B
		CPI	CR
		JZ	SET_END_EXIT
		CALL	INCX
		MOV	A,E
		CPI	3BH
		CZ	CCR_HLP
		INR	E
		INR	D
		JMP	CCR_LOOP

SET_END_EXIT:	LHLD	CURSOR
		MOV	H,E
		SHLD	CURSOR
		LHLD	POS
		PUSH	H
		CALL	CCR_TOP		;РПДОСФШ ХЛБЪБФЕМШ ОБ ЛТЩЫХ
		LDA	OFSET
		ORA	A
		CNZ	HOME
		LHLD	POS
		MOV	B,H
		MOV	C,L
		POP	H
		SHLD	POS
		LXI	D,10
		PUSH	B
		CNZ	PRSCREEN
		LDA	CURHX		; дПРПМОЙФЕМЙОБС ЧУФБЧЛБ ОБ
		ORA	A		; УМХЮБК ПВТБВПФЛЙ РХУФПК УФТПЛЙ
		JNZ	CCR_OBHOD	;
		CALL	RIGHT		;
		CALL	LEFT		;
CCR_OBHOD:	POP	B
		POP	PSW
		ORA	A
		RZ
		MVI	E,0AH
		CALL	PRSCREEN
		RET

CCR_HLP:	LXI	H,OFSET
		INR	M
		INR	M
		DCR	E
		DCR	E
		RET

CCR_TOP:	LDA	CURSOR		;РПДОЙНЕБФ ЛХТУПТ ОБ ЛТЩЫХ
		MOV	B,A
		MVI	A,10
		SUB	B
		RZ
		MOV	B,A
CCR_T_00:	CALL	SDEC
		DCR	B
		JNZ	CCR_T_00
		RET
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;; РТПГЕДХТБ ХУФБОПЧЛЙ ЛХТУПТБ Ч ОБЮ. РПЪЙГЙА
;;
CCLEFT:		LDA	OFSET
		ORA	A
		JZ	NO_CLS_WIND
		CALL	REGENER		; 8.2.1993.
		XRA	A
		STA	OFSET
		LHLD	POS
		PUSH	H
		CALL	CCR_TOP
		MOV	B,H
		MOV	C,L
		LXI	D,10
		CALL	PRSCREEN
		POP	H
		SHLD	POS
		XRA	A
NO_CLS_WIND:	STA	CURHX
		MOV	H,A
		MOV	L,A
		SHLD	CURDX
		STA	CURSOR+1
		CALL	INCX		;RIGHT
		CALL	DECX		;LEFT		
		RET

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;		
CCDON:		CALL	REGENER		;
		LDA	CURSOR		;
		ORA	A		;
		JZ	WDONSCR		;
		CPI	1H		; DCR A - оЕМШЪС !!!
		CNZ	BOTTWIND	; ПРХУЛБА ЛХТУПТ
		CALL	COPYS		;
		STA	DLINNA		;
		CALL	DON		;
		RET			;
WDONSCR:	LHLD	POS		;
		PUSH	H		;
		CALL	SINC		;
		LXI	B,901H		;
		JNZ	CCDON00		; ПВПКФЙ ЕУМЙ ОЕ ЛПОЕГ ФЕЛУФБ
		POP	H		; ЪБВЙТБЕН УМПЧП ЙЪ УФЕЛБ
CCWD_DOP:	CALL	COPYS		;
		STA	DLINNA		;
		LXI	B,SOOBD		; РПДЗПФБЧМЙЧБЕН "Bottom"
		XRA	A		;
		JZ	WARNING		; ЛПОЕГ ФЕЛУФБ BOTTOM BOTTOM
CCDON00:	INR	C		;
		CALL	SINC		;
		JZ	CCBOTTEXT	;ЛПОЕГ ФЕЛУФБ
		DCR	B		;
		JNZ	CCDON00		;
		POP	H		;
		PUSH	H		;
		SHLD	POS		;
		MVI	C,0AH		;
		JMP	CCBOTEXIT	;

CCBOTTEXT:	POP	H
		SHLD	POS
		PUSH	H
CCBOT01:	DCR	B
		JZ	CCBOTEXIT
		CALL	SDEC
		JMP	CCBOT01
CCBOTEXIT:	MOV	B,C
		CALL	CCTOPBOT
		POP	H
		SHLD	POS
		CALL	COPYS
		STA	DLINNA
		RET
		
;%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
CCUP:		CALL	REGENER
		LHLD	CURHY
		MOV	A,H
		ORA	L
		LXI	B,SOOBV
		JZ	WARNING		;TOP TOP TOP TOP
		LDA	CURSOR
		CPI	0AH
		JNC	WUPSCR		;УМЕДХАЭЙК ЛХУПЛ
		CPI	09H
		CNZ	TOPWIND		;РПДОСФЙЕ ЛХТУПТБ
		CALL	UP
		MVI	A,0AH
		STA	CURSOR
		RET

WUPSCR:		LHLD	POS
		PUSH	H
		MVI	B,10
CCUP00:		CALL	SDEC
		JNC	CCTOPTEXT	;ОБЮБМП ФЕЛУФБ
		DCR	B
		JNZ	CCUP00
CCTOPTEXT:	CALL	CCTOPBOT
		POP	H
		SHLD	POS
		RET

;$$$$$$$$$$$$$$$$$$$$$$$
CCTOPBOT:	MOV	A,B
		STA	CURSOR
		LXI	D,0AH
		LHLD	POS
		MOV	B,H
		MOV	C,L
		CALL	HOME
		CALL	PRSCREEN
		RET
;$$$$$$$$$$$$$$$$$$$$$$$$
TOPWIND:	PUSH	PSW
		CALL	SDEC
		CALL	DECY
		POP	PSW
		INR	A
		STA	CURSOR
		CPI	09H		;РПДОСФЙЕ ОБ ЧФПТХА УФТПЛХ
		JNZ	TOPWIND
		RET
;##########################
BOTTWIND:	MOV	B,A
		CALL	SINC
		JZ	CCWD_DOP	; ПВПКФЙ
BOT_W0:		CALL	SDEC
		MOV	A,B
BOT01:		STA	CURSOR
		DCR	A
		RZ		;ДПЫМЙ ДП ДОБ ВЕЪ ПУМПЦОЕОЙК
		PUSH	PSW
		CALL	SINC
		JZ	BOTEXIT
		CALL	INCY
		POP	PSW
		JMP	BOT01
BOTEXIT:	POP	PSW
		RET
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

;		INCLUDE	US.ASM
; ;
; ; рТПЗТБНОЩК НПДХМШ ПВТБВПФЛЙ рбоемек ТЕДБЛФПТБ: PPA-Editor
; ; ( ху + ГЙЖТПЧБС ЛМБЧЙЫБ ПУОПЧОПК ЛМБЧЙБФХТЩ )
; ; РПУМЕДОСС ЛПТЕЛГЙС : 5.10.1992 ++++++ 13:16 +++ чПУЛТЕУЕОШЕ
; ;
;;ыыыыыыы      470075     З.лБТБЗБОДБ           ыыыыыыы;;
;;ыыыыыыы   ХМ. 40 МЕФ лБЪБИУФБОБ Д.39/3 ЛЧ.1   ыыыыыыы;;
;;ыыыыыыы            рЙНЕОПЧ р.б                ыыыыыыы;;
;;ыыыыыыы               Ф.52-81-95              ыыыыыыы;;
;;
SERVIS:		LXI	D,0809H		; ПФЛТПЕН ПЛОП Й РТПЙЪЧЕДЕН
		LXI	H,180BH		; ЧЩЧПД УППВЭЕОЙК 
		MVI	A,15H		; РПУМЕ ЬФПЗП РТПЙЪЧПДЙН ЧЩЪПЧ
		CALL	ACTIV		; "ПЖЙГБОФБ"
		CALL	ESCF4		;
		LXI	D,202H		; ЛПФПТЩК ПРТЕДЕМСЕФ РП УТЕДУФЧПН
		LXI	B,SV_SOOB1	; НЕОА ,ФП ЮФП ОЕПВИПДЙНП
		CALL	WPUTSDOP	; РПМШЪПЧБФЕМА
		INX	B		;
		DCR	E		;
		CALL	WPUTSDOP	;
		INX	B		;
		DCR	E		;
		LXI	B,S_SOOBEX	;
		CALL	WPUTSDOP	;
SV_POVT2:	LXI	D,SV_POVT2	;
		PUSH	D		;
		CALL	MENU		;
		ORA	A		; "чЩИПД" ???
		CZ	DEACTI		; ЕУМЙ ДБ ФП ХИПДЙН
		POP	D		;
		RZ			;
		PUSH	D		;
		DCR	A		; "гЧЕФ" ???
		JZ	SV_COLOR	; ЕУМЙ ДБ ФП ====//=====
		DCR	A		; "ФЕЛУФ" ???
 		JZ	SV_TEXT		; ЕУМЙ ДБ ФП ====//=====
		CPI	0CH		; ЛМБЧЙЫБ - F4 ???
		RNZ			;
		CALL	DEACTI		;
		POP	D		;
		RET			;
;;
;; пВТБВПФБЕН ЧЩВПТ ТЕЦЙНБ РЕТЕЛПДЙТПЧЛЙ ЙУИПДОПЗП ФЕЛУФБ
;;

SV_TEXT:	LXI	D,1006H		;
		LXI	H,3209H		;
		MVI	A,1AH		;
		CALL	ACTIV		;
		CALL	ESCF4		;
		LXI	D,2105H		;
		MVI	A,09FH		;
		CALL	PUTCXY		;
		MVI	A,83H		;
		MVI	C,4		;
SV_00:		INR	E		;
		CALL	PUTCXY		;
		DCR	C		;
		JNZ	SV_00		;
		INR	E		;
		MVI	A,0A1H		;
		CALL	PUTCXY		;
		LXI	D,404H		;
		LXI	B,SV_TS1	;
		CALL	WPUTSDOP	;
		INX	B		;
		MVI	D,17H		;
		CALL	WPUTSDOP	;
		LXI	D,203H		;
		LXI	B,SV_TS0	;
		CALL	SV_PRINT	;
		INX	B		;
		LXI	D,201H		;
		CALL	SV_PRINT	;
		INX	B		;
		LXI	D,0C03H		;
		PUSH	B		;
		CALL	SV_PRLR		;
		POP	B		;
		LXI	D,1E03H		;
		CALL	SV_PRLR		;
		LXI	H,2009H		;
		SHLD	WIND2		;
		CALL	MENU		;
		CPI	0EH		;
		CZ	DEACTI		;
		RZ			;
		LXI	D,1006H		;
		PUSH	PSW		;
		ADD	E		;
		MOV	E,A		;
		MVI	A,8		;
		CALL	PUTCXY		;
		LXI	H,3209H		;
		SHLD	WIND2		;
		LXI	H,2206H		;
		SHLD	WIND1		;
		POP	B		;
SV_TLOOP:	PUSH	B		;
		CALL	MENU		;
		CPI	0EH		;
		CZ	DEACTI		;
		POP	B		;
		RZ			;
;;
;;  рПМХЮЙМЙ ДБООЩЕ П РЕТЕЛПДЙТПЧЛЙ ФЕЛУФБ
;;
					; C - РЕТЧЩК ЧЩВПТ
		MOV	C,A 		; B - ЧФПТПК ЧЩВПТ
		CMP	B		;
		JZ	SV_TLOOP	;
		LXI	D,2206H		;
		ADD	E		;
		MOV	E,A		;
		MVI	A,8		;
		CALL	PUTCXY		;
		LXI	H,1006H		;
		SHLD	WIND1		;
		LXI	D,2805H		;
		LXI	H,3905H		;
		CALL	S_ARE_YOU	; чЩ ХЧЕТЕОЩ
		CNZ	DEACTI		;
		RNZ			;
;;
;; рТЙУФХРЙФШ Л РЕТЕЛПДЙТПЧЛЕ ФЕЛУФБ
;;
		MOV	A,C		;
		MOV	C,B		; BC - йОДЕЛУ ЛПДБ РПЙУЛБ
		MVI	B,0		;
		LXI	H,SV_COD	;
		PUSH	H		;
		DAD	B		;
		MOV	D,M		; D - оБЮБМШОЩК ЛПД РПЙУЛБ
		MOV	C,A		;
		POP	H		;
		DAD	B		;
		MOV	E,M		; E - оБЮБМШОЩК ЛПД ЪБНЕОЩ
		MOV	A,D		;
		ADI	20H		;
		MOV	B,A		; B - лПО. ЛПД РПЙУЛБ
		ORA	A		;
		MVI	A,0D2H		; ЛПД ЛПНБОДЩ JNC
		JNZ	SV_02		; ОЕ ЪБНЕОСЕН ЛПНБОДХ
		MVI	A,0DAH		; ЛПД ЛПНБОДЩ JC
SV_02:		STA	SV_ALT		;	
		LXI	H,BTEXT + 1	;
SV_01:		INX	H		;
		MOV	A,M		;
		CPI	STOPBYTE	;
		JZ	SV_1TEXIT	;
		CMP	D		;
		JC	SV_01		;
		CMP	B		;
SV_ALT:		JNC	SV_01		;
		SUB	D		;
		ADD	E		;
		MOV	M,A		;
		JMP	SV_01		;

SV_COD:		DB	0C0H		; УФТПЮОЩЕ ТХУУЛЙЕ
		DB	060H		; УФТПЮОЩЕ МБФЙОУЛЙЕ
		DB	0E0H		; РТПРЙУОЩЕ ТХУУЛЙЕ
		DB	040H		; РТПРЙУОЩЕ МБФЙОУЛЙЕ

SV_1TEXIT:	STA	OFSET		;
		CALL	DEACTI		;
		CALL	DEACTI		;
		POP	PSW		;
		CALL	DOMOY		;
		RET			;
;;
;;  рТПГЕДХТБ ЧЩЧПДБ ЪБРТПУБ: чЩ ХЧЕТЕОЩ ???
;;		
S_ARE_YOU:	PUSH	B		;
		MVI	A,17H		;
		CALL	ACTIV		;
		CALL	YESNO		;
		LXI	D,200H		;
		LXI	B,SV_TS2	;
		CALL	WPUTSDOP	;
		CALL	KEYDELAU	;
		POP	B		;
		LDA	NUMBER		;
		CPI	57		; лМБЧЙЫБ "Y" ???
		CALL	DEACTI		;
		RET			;

SV_PRLR:	PUSH	B		;
		CALL	WPUTSDOP	;
		INX	B		;
		DCR	E		;
		CALL	WPUTSDOP	;
		POP	B		;
		DCR	E		;
		CALL	WPUTSDOP	;
		INX	B		;
		DCR	E		;
		CALL	WPUTSDOP	;
		RET			;

SV_PRINT:	PUSH	B		;
		CALL	WPUTSDOP	;
		POP	B		;
		PUSH	B		;
		MVI	D,14H		;
		CALL	WPUTSDOP	;
		POP	B		;
		PUSH	B		;
		DCR	E		;
		CALL	WPUTSDOP	;
		POP	B		;
		MVI	D,2		;
		CALL	WPUTSDOP	;
		RET			;

;; пВТБВПФБЕН ЧЩВПТ ТЕДБЛФЙТПЧЙОЙС ГЧЕФБ РЕТЕДОЕЗП РМБОБ
;; ДМС ЬФПЗП ДПРПМОЙФЕМШОП ПФЛТПЕН ПЛОП Й РТЙ РПНПЭЙ ЛМБЧЙЫ
;; ХРТБЧМЕОЙС ЛХТУПТПН РТПЙЪЧЕДЕН ЛПТЕЛГЙА СЮЕКЛЙ COLOR
;; ЙЪ ВМПЛБ ТБВПЮЙИ СЮЕЕЛ РПДРТПЗТБННЩ ПВТБВПФЛЙ ЛБДТПЧПЗП
;; РТЕТЩЧБОЙС - ДТБКЧЕТ ЛМБЧЙБФХТЩ.
;;
SV_COLOR:	LXI	D,1207H		;
		LXI	H,1A08H		;
		MVI	A,16H		;
		CALL	ACTIV		;
		LXI	D,201H		;
		LXI	B,SV_SOOB2	;
		CALL	WPUTSDOP	;
		DCR	E		;
		INX	B		;
		CALL	WPUTSDOP	;
SV_POVTOR:	CALL	MENU		;
		CPI	0EH		;
		CZ	DEACTI		;
		RZ			;
		PUSH	PSW		;
		LXI	D,1706H		;
		LXI	H,2A06H		;
		MVI	A,17H		;
		CALL	ACTIV		;
		CALL	ESCF4		;
		LXI	B,SV_SOOB3	;
		LXI	D,100H		;
		CALL	WPUTSDOP	;
		POP	B		; B - БЛЛБНХМСФПТ
		LHLD	COLOR		;
SV_LOOP:	SHLD	COLOR		;
		XRA	A		;
		STA	FLAGC		;
		LXI	D,SV_LOOP	;
		PUSH	D		;
		LXI	D,1000H		;
		MOV	A,B		;
		ORA	A		;
		MOV	A,H		;
		JNZ	$ + 4		;
		MOV	A,L		;
		CALL	WJHEX		;
		CALL	KEYDELAU	;
		MOV	C,A		;
		CPI	0EH		; "F4"
		JZ	SV_EX0		;
		CPI	2H		; "чл"
		JZ	SV_EX0		;
		CPI	05H		;
		JNZ	SV_OBHOD	;
; пВТБВПФБЕН ОБЦБФЙЕ ЛМБЧЙЫЙ ЧЧЕТИ
		MOV	A,B		;
		INR	H		;
		ORA	A		;
		RNZ			;
		DCR	H		;
		INR	L		;		
		RET			;
SV_OBHOD:	MOV	A,C		;
		CPI	07H		;
		RNZ			;
; пВТБВПФБЕН ОБЦБФЙЕ ЛМБЧЙЫЙ ЧОЙЪ
		MOV	A,B		;
		DCR	H		;
		ORA	A		;
		RNZ			;
		INR	H		;
		DCR	L		;
		RET			;

SV_EX0:		CALL	DEACTI		;
		POP	D		;
		JMP	SV_POVTOR	;


;;ыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыы

; ; ========= ху + 3 ======= GOTO =======
GOTOLINE:	LXI	D,50CH
		LXI	H,1A0CH
		MVI	A,15H
		CALL	ACTIV
		CALL	ESCF4
GOTODONE:	LXI	D,100H
		LXI	B,WARNGOTO	;ЧЩДБФШ УППВЭЕОЙЕ
		XRA	A
		CALL	WPUTSDOP
		MVI	D,0FH		;ЛПОЕГ УППВЭЕОЙС
		MVI	A,4H
		MOV	H,B
		MOV	L,C
		CALL	EDLINE
		CPI	0EH		;ЧЩИПД ЕУМЙ F4
		PUSH	PSW
		CZ	COPYS
		POP	PSW
		CZ	DEACTI
		RZ
; РТЙУФХРЙФШ Л РПЙУЛХ УФТПЛЙ				
		DI		;ХЧЕМЙЮЙФШ ВЩУФТПДЕКУФЧЙЕ
		MVI	A,30H
		STA	KEYKOD	;ЬНХМСГЙС ОХМС
		LXI	B,STR
DOPLOOP:	CALL	EDINSERT	;ЧУФБЧЛБ ОХМС
		JZ	DOPLOOP		;ДПРПМОЕОЙЕ ЪБЧЕТЫЕОП ???
		EI
		CALL	KORREKT
		CALL	DEACTI
		CALL	NULL_POS
POLOP1:		LXI	H,CURDY
		LXI	B,KORBUF
		MVI	D,3
POILOOP:	LDAX	B
		CMP	M
		JNZ	POIDONE		;РТПДПМЦБФШ РПЙУЛ
		INX	B
		INX	H
		DCR	D
		JNZ	POILOOP
;ОБКДЕОБ ОХЦОБС УФТПЛБ		
POIEXIT:	CALL	PRINT_POS
		CALL	KEYRESET
		CALL	COPYS
		STA	DLINNA
		RET

POIDONE:	CALL	SINC
		CNZ	INCY
		JNZ	POLOP1
		JMP	POIEXIT
;&&&&&&&&&&&&& KORREKTOR &&&&&&&&&&&&&&&&&
KORREKT:	LXI	B,STR
		LXI	H,KORBUF+2
		CALL	CLEAR3
		MVI	E,5
POVTOR:		LDAX	B
		CPI	30H
		JC	KORERROR
		CPI	3AH
		JNC	KORERROR
		ANI	0FH		;ЧЩДЕМЙФШ ГЙЖТХ
		MOV	D,A
		MOV	A,E
		RRC
		MOV	A,D
		JC	KORNOHET	;ОЕЮЕФ
		RLC
		RLC
		RLC
		RLC
		INX	H		;УЮЕФЮЙЛ ДЕУСФЙЮОПЗП ЮЙУМБ
KORNOHET:	INX	B		;ХЛБЪБФЕМШ УФТПЛЙ
		ORA	M
		MOV	M,A
		DCR	E
		JNZ	POVTOR
		RET

KORERROR:	LXI	D,90BH
		LXI	H,210BH
		MVI	A,17H
		CALL	ACTIV
		LXI	D,200H
		LXI	B,ERROR01
		XRA	A
		CALL	WPUTSDOP
		ADI	40
KOR02:		HLT
		DCR	A
		JNZ	KOR02			
		CALL	DEACTI
		CALL	HOME
		CALL	KEYRESET
		POP	H
		JMP	GOTODONE

;============== ЧУРПНПЗБФЕМШОЩЕ УЕТЧЙУОЩЕ РТПГЕДХТЩ =============
;РТПГЕДХТБ ХУФБОБЧМЙЧБЕФ ЧУЕ ЗМПВБМШОЩЕ РЕТЕНЕООЩЕ Ч ОЕМЕЧПЕ РПМПЦЕОЙЕ

NULL_POS:	CALL	CCLEFT
		LXI	H,BTEXT+2
		SHLD	POS
		LXI	H,0
		SHLD	CURHY
		LXI	H,CURDY+2
		CALL	CLEAR3
		RET

;РТПГЕДХТБ ТБУРЕЮБФЩЧБЕФ ЛБТФЙОЛХ ОБЮЙОБС У ФЕЛХЭЕЗП POS
PRINT_POS:	LXI	H,0AH
		SHLD	CURSOR
		XCHG
		CALL	HOME
		LHLD	POS
		MOV	B,H
		MOV	C,L
		CALL	PRSCREEN
		CALL	DON		;ЛПТЕЛГЙС УЭЕФЮЙЛБ
		CNZ	UP
		RET
; ; ======= ху + 1 ====== Help ========
HELP:		CALL	CCLEFT		;
		LXI	D,0608H		; ПФЛТЩЧБЕН ПЛОП
		LXI	H,2F0BH		;
		MVI	A,15H		;
		CALL	ACTIV		;
		CALL	ESCF4		; ЧЩЧПДЙН УППВЭЕОЙЕ П ЧЩИПДЕ
		XCHG			; ТЙУХЕН ЧЕТФЙЛБМШОХА УФТЕМЛХ
		INR	D		;
		MVI	B,4H		;
		CALL	STL2		; РПДРТПЗТБННБ ТЙУПЧБОЙС
;; пУФБМПУШ РТПДЕМБФШ РТПУФЕКЫЙЕ ПРЕТБГЙЙ:
;; 1) рПМХЮЙФШ ДПУФХР Л СДТХ ПРЕТБГЙПООПК УЙУФЕНЩ
;; 2) рПДЗПФПЧЙФУС Л ЮЕОЙА ЖБКМБ: EDHLP.PPA
;; 3) рП ЛПНБОДЕ ЧПЪЧТБФБ РЕТЕЛМАЮЙФШ ХРТБЧМЕОЙЕ
;;    СДТХ "PPA Editor"
;; РТПЗТБННБ ТБВПФЩ У ДЙУЛПН 26.11.1992
;;
;; ========== пРЙУБОЙЕ ЖБКМБ EDHLP.PPA ===========   
;; ЖБКМ EDHLP.PPA СЧМСЕФУС "ФЕУФПЧЩН ЖБКМПН" ОП ЙНЕАЭЙК
;; ПУПВЕОПУФШ:
;;       ЛБЦДС (ЛТПНЕ ЛБЦДПК ФТЕФЕК) ДПМЦОБ ЙНЕФШ ДМЙОХ
;;       ТБЧОХА: 40 УЙНЧПМПЧ + 2 УЙНЧПМБ CR Й LF
;;       ЛБЦДБС ФТЕФШС УФТПЛБ ДПМЦОБ ЙНЕФШ ОБ 2 УЙНЧПМБ
;;       ВПМШЫЕ ЬФП У ЧСЪБОП УП УФБОДБТФОПК ДМЙООПК ЪБ-
;;       РЙУЙ = 128  вБКФ Ф.Е Ч ПДОПК ЪБРЙУЙ РПНЕУФЙФУС
;;       ТПЧОП 3 ЙОЖПТНБГЙПООЩЕ УФТПЛЙ.
;;         дМС  ПВЕУРЕЮЕОЙС  ДПРПМОЙФЕМШОПК ЪБЭЙФЩ ЬФПЗП
;;       ПО  ЪБЛПДЙТПЧБО  ЛПДЙТПЧЛБ  РТПЙЪЧПДЙФУС УМЕДХ-
;;       АЭЕК РТПЗТБННПК  ОБРЙУБОПК  ОБ  BDS C Compiling
;;
;; /*************************************************************/
;; /*   24.12 1992  рТПЗТБННБ ОЙЪЛПХТПЧОЕЧПК ПВТБВПФЛЙ ЖБКМБ    */
;; /*             KБТБЗБОДБ-1992      PPA Systems               */
;; /*************************************************************/
;; /*
;;  * дБООБС РТПЗТБННБ РТЕДОБЪОБЮЕОБ ДМС ЫЙЖТПЧЛЙ ХЛБЪБООПЗП
;;  * ЖБКМБ ПУОПЧОПК РТПГЕДХТПК СЧМСЕФУС ЖХОЛГЙС:
;;  *    korrect ( *char)
;;  *       ПОБ РТПЙЪЧПДЙФ ЫЙЖТПЧЛХ ВБКФПЧ ЧУЕЗП ЖБКМБ
;;  *       РП УТЕДУФЧПН ПРЕТБГЙЙ "йУЛМАЮБАЭЕЕ ймй"
;;  *       У ОБЮБМШОЩН ЪОБЮЕОЙН :    0xE1
;;  *       ПОП ПВТБЪПЧБОП УХННПК ASCII ЛПДПЧ УФТПЛЙ
;;  *       "PPA" 
;;  */
;;
;; #define INPUT 0		/* пРЕТБГЙС ЮФЕОЙС */
;; #define OUTPUT 1		/* пРЕТБГЙС ЪБРЙУЙ */
;; #define IOPUT 2		/* пРЕТБГЙС ПВНЕОБ */
;;
;; #define ERROR -1	/* лПОУФБОФБ ПЫЙВЛЙ */
;; #define SEEK_SET 0	/* бВУПМАФОПЕ УНЕЭЕОЙЕ ПФ ОБЮБМБ ЖБКМБ */
;; #define SEEK_CUR 1	/* пФОПУЙФЕМШОПЕ УНЕЭЕОЙЕ */
;; #define SEEK_END 2	/* уНЕЭЕОЙЕ ПФОПУЙФЕМШОП ЛПОГБ ЖБКМБ */
;;
;; #define SECSIZ 0x80	/* дМЙООБ ЪБРЙУЙ ДМС CP/M */
;;
;; main(argc,argv)
;; int argc;
;; char **argv;
;;  {
;;   int fd_file;	/* дЕУЛТЙРФПТ ЖБКМБ ПВТБВПФЛЙ */
;;   int count;		/* дМЙООБ ЙУИПДОПЗП ЖБКМБ Ч ЪБРЙУСИ */
;;
;;     puts("(C)  PPA  Systems.Ltd   1992     fone:  52-81-95\n\n" );
;;
;;     if (argc != 2 )
;;       error_exit ("Format: tp <file.ext>\n");
;;
;;     fd_file = open ( argv[1], IOPUT);	  /* пФЛТЩФШ ХЛБЪБОЩК ЖБКМ */
;;     if (fd_file == ERROR)
;;        error_exit ("No file");
;;
;;     count = seek ( fd_file, 0, SEEK_END );/* ДМЙООБ ЖБКМБ Ч ЪБРЙУСИ */
;;     seek (fd_file, 0, SEEK_SET);
;;     printf ("file: %s real bloc = %d\n",argv [1],count);
;;
;;     while (count--)
;;      {
;;         char file_buf [ SECSIZ ];
;;           if (read ( fd_file, file_buf, 1 ) == ERROR )
;;               error_exit ( "Error read file");
;;           korrect ( file_buf );
;;           seek (fd_file, -1, SEEK_CUR);
;;           if (write ( fd_file, file_buf, 1) == ERROR )
;;               error_exit ( "Error write file");
;;      }
;;     puts ("\nProcess complete !!!");
;;     exit (0);
;; }
;; /****************************************************************
;;  * жХОЛГЙС РТЕПВТБЪПЧБОЙС ВМПЛБ ЖБКМБ Ч УПФЧЕФУФЧЙЙ У ЪБДБОЩНЙ  *
;;  * ХУМПЧЙСНЙ Ф.Е. ПУХЭЕУФЧМСЕФ РЕТЕЛПДЙТПЧЛХ ФЕЛУФПЧЩИ ЖБКМПЧ   *
;;  ****************************************************************/
;;
;; korrect ( buf )
;; char *buf;
;; {
;;  int  i;	/* уЮЕФЮЙЛ ВБКФПЧ */
;;  char c;	/* нБУЛБ ЛПДЙТПЧЛЙ */
;;     c = 'P' + 'P' + 'A';
;;      for (i = 0 ; i < SECSIZ ;)
;;          buf [i++] ^= c++;
;; }
;;
;; /***************************************************************/
;;
;; error_exit (str)
;; char *str;
;; {
;;   puts (str);
;;   exit (-1);
;; }
;;

H_READ:		MVI	A,KD_CONST	; йОЙГЙБМЙЪЙТХЕН СДТП УЙУФЕНЩ
		OUT	10H		; Й РПДЗПФБЧМЙЧБЕН ВХЖЕТ FCB
;;
;; УЛПРЙТХЕН ЮБУФШ УФТПЛЙ Ч ВХЖЕТ STR
;;
		LXI	H,H_SOOB1+8	;
		CALL	COPYSDOP	;
		LXI	H,F_FILE0	;
		PUSH	H		;
		CALL	F_DROB_FILE	;
		POP	D		;
		INT	_OPENC		; ЙНС ЖБКМБ (У ХЛБЪ. ОПНЕТБ ДЙУЛБ)
		INR	A		; РТПЧЕТСЕН ОБМЙЮЙЕ ХЛБЪБООПЗП ЖБКМБ
		JZ	H_NOFILE	; ЕУМЙ ОЕФ ЧЩКФЙ ЙЪ ТЕЦЙНБ
;;
;; рТПЙЪПЫМП ХУРЕЫОПЕ ПФЛТЩФЙЕ ЧУРПНПЗБФЕМШОПЗП ЖБКМБ
;; РЕТЕИПДЙН Л ЮФЕОЙА
;;
H_BEG:		CALL	H_LOAD		; рТПЙЪЧПДЙН ЮФЕОЙЕ 2-И ЪБРЙУЕК
		LXI	D,3		; Й ТБУРЕЮБФЩЧБЕН РПМХЮЕООЩК ТЕЪХМШФБФ
		CALL	PRSCREEN	;
		DCX	B		; ХУФБОПЧЙН ХЛБЪБФЕМШ ОБ ОБЮБМП
		DCX	B		; ФЕОЕЧПК УФТПЛЙ
;;
;; РТЙ РТПУНПФТЕ ЧПУРПМШЪХЕНУС ОЕ ЙУРПМШЪХЕНПК СЮЕКЛПК
;; ДМС ЬФПЗП РПДИПДЙФ СЮЕКЛБ: FLAGLINE ОП РТЙ ЧПЪЧТБФЕ Ч
;; ОЕЕ ОХЦОП ЪБРЙУБФШ ФП ЮФП ВЩМП , Б ВЩМП ФБН ЪБРЙУБОП:
;; 00H - Ф.Л. РЕТЕД ЧИПДПН Ч ЬФХ РПДРТПЗТБННХ ВЩМБ РТП-
;; ЙЪЧЕТЕОБ ТЕЗЕОЕТБГЙС ФЕЛУФПЧПЗП НБУЙЧБ
;; 
H_LOOP:		LXI	H,H_LOOP	; ХУФБОПЧЙН ЧЕЛФПТ ЧПЪЧТБФБ
		PUSH	H		; ПРХУЛБЕН Ч УФЕЛ
		CALL	KEYDELAU	; ПЦЙДБЕН ОБЦБФЙС ЛМБЧЙЫЙ
		CPI	0EH		; ОБЦБФБ ЛМБЧЙЫБ "F4" ???
		POP	H		;
		JZ	H_EXIT		; ЕУМЙ дБ ФП ЪБЛТЩЧБЕН ЖБКМ
		PUSH	H		; Й ЧЩИПДЙН ЙЪ ТЕЦЙНБ
		LXI	H,FLAGLINE	; ХУФБОПЧЛБ ХЛБЪБФЕМС ОБ УЮЕФЮЙЛ
		CPI	07H		; ОБЦБЛФБ ЛМБЧЙЫБ "чОЙЪ"
		JNZ	H_DONE0		; ЕУМЙ дБ ФП РТПДПМЦБЕН
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;   ПВТБВПФБЕН ОБЦБФЙЕ ЛМБЧЙЫЙ ЧОЙЪ   ;;
		INR	M		;
		INX	B		;
		INX	B		;
		LDAX	B		;
		CPI	STOPBYTE	;
		RZ			;		
		CALL	SCROL1		;
		MOV	A,M		;
		CPI	3		;
		CZ	H_LOAD		; РТПЪЧЕУФЙ ДПРПМОЙФЕМШОПЕ
		CPI	8		;
		CZ	H_LOAD		;		
		CPI	14		;
		CZ	H_LOAD		;
		LXI	D,0		; УЮЙФЩЧБОЙЕ
		CALL	WPUTSDOP	; 
		RET			;
;;
;; рТПГЕДХТБ РТПЙЪЧПДЙФ ДПЮФЕОЙЕ ЖБКМБ
;;
H_LOAD:		PUSH	PSW		;
;; рТПГЕДХТБ ЮФЕОЙС 2 ВМПЛБ (256 вБКФ) ЙЪ ЖБКМБ РПНПЭЙ
H_R_BLOCK:	MVI	A,KD_CONST	;
		OUT	10H		;
		LXI	D,STR		;
		PUSH	D		;
		INT	_SET_DMA	;
		LXI	D,F_FILE0	; ХЛБЪБФЕМШ ОБ FCB
		PUSH	D		;
		INT	_READS		; ЧЩЪЩЧБЕН УЙУФЕНХ
		LXI	D,STR + SECSIZ	;
		INT	_SET_DMA	;
		POP	D		;
		INT	_READS		;
		XRA	A		;
		OUT	10H		;
;; лПТЕЛГЙС РТПЮЙФБООПЗП ВМПЛБ ДБООЩИ	;
		POP	H		;
		PUSH	H		;
		MOV	D,A		;
H_KOR0:		MVI	E,'P'+'P'+'A'	;
H_KOR1:		MOV	A,M		;
		XRA	E		;
		MOV	M,A		;
		INX	H		;
		INR	E		;
		INR	D		;
		MOV	A,D		;
		CPI	080H		;
		JZ	H_KOR0		;		
		ORA	A		;
		JNZ	H_KOR1		;
		POP	B		;
		POP	PSW		;
		RET			; ЧПЪЧТБФ
;;
;; рТПДПМЦБЕН РТПЧЕТЛХ ОБЦБФЙС ОБ ЛМБЧЙЫХ
;;
H_DONE0:	CPI	05H		; "чЧЕТИ"
		RNZ			;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;  ПВТБВПФБЕН ОБЦБФЙЕ ЛМБЧЙЫЙ  ЧЧЕТИ  ;;
		MVI	M,0		;
		LXI	H,F_FILE0 + CR_OFSET	;
		MVI	M,0		;
		POP	H		;
		CALL	HOME		;
		JMP	H_BEG		;

H_EXIT:		MVI	A,KD_CONST	;
		OUT	10H		;
		LXI	D,F_FILE0	;
		INT	_CLOSEC		;
		XRA	A		;
		OUT	10H		;
		STA	FLAGLINE	;
		CALL	DEACTI		;
		CALL	COPYS		;
		RET			;
;;
H_NOFILE:	OUT	10H		; БЛФЙЧЙТХЕН СДТП ТЕДБЛФПТБ
		LXI	D,2007H		; ПФЛТЩЧБЕН ДПРПМОЙФЕМШОПЕ ПЛОП
		LXI	H,3407H		;
		MVI	A,1AH		;
		CALL	ACTIV		;
		CALL	ESCF4		;
		LXI	B,H_SOOB1	; ЧЩЧПДЙН УППВЭЕОЙЕ П ФПН
		LXI	D,200H		; ЮФП ДБООЩК ЖБЙМ ОЕ ОБКДЕО
		CALL	WPUTSDOP	;
		CALL	KEYDELAU	; ПЦЙДБЕН ПФЧЕФБ
		CPI	0EH		; ЛМБЧЙЫБ "F4"???
		CALL	DEACTI		; ЕУМЙ ДБ ФП ЧЩИПД ЙЪ ТЕЦЙНБ
		JZ	H_EXIT		;
		JMP	H_READ		; ЙОБЮЕ РПЧФПТЙФШ РПРЩФЛХ
;;
;;ыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыы
;;  рТПГЕДХТБ РТПЙЪЧПДЙФ ПФЮЙУФЛХ НБУЙЧБ РБНСФЙ
;;  HL - ОБЮБМШОЩК БДТЕУ
;;  B  - УЛПМШЛП ПФЮЙЭБФШ

CLEAR_MEM:	PUSH	PSW		;
		XRA	A		;
CL_00:		MOV	M,A		;
		INX	H		;
		DCR	B		;
		JNZ	CL_00		;
		POP	PSW		;
		RET			;
;;ыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыы
;; ======== ху + 2 ====== File ========
;;
;;    ™ќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќ‹
;;    Љ  (C) 1993  лБТБЗБОДБ  лРФй  ьб-91-2  рЙНЕОПЧ р.б   Љ
;; ™ќќљќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќ‹  Љ
;; Љ     ED.COM  -  Utilite for text editor MAR.COM     Љ  Љ
;; Љ							Љ  Љ
;; Љ ========== 52-81-95 ========= PPA Systems ======== Љ  Љ
;; Љ              Copyright  by  рЙНЕОПЧ р.б            Љ  Љ
;; Љ  ™ќќќќќќќќќќќќќќќќќќ‹    ™ќќќќќќќќќќќќќќќќќќќќќќ‹  њќќЊ
;; ќќ‰ asm file: 0000h  њќќќќ‰ com file: 0000h byte њќќЊ
;;    ќќќќќќќќќќќќќќќќќќЊ    ќќќќќќќќќќќќќќќќќќќќќќЊ
;;
;;	      /////////////////////////////////////
;;      	   01110010 00100111 00100000
;;	           РТ. зБЗБТЙОБ 01110010/0001
;;	           0010 - 00110000 - 00010100
;;	      /////////////////////////////////////
;;
;;
FILE:		LXI	D,0809H		; ПФЛТЩЧБЕН ТБВПЮЕЕ ПЛОП
		LXI	H,170BH		; ЧЩЧПДЙН РПСУОСАЭЙЕ ОБДРЙУЙ
		MVI	A,15H		;
		CALL	ACTIV		;
		CALL	ESCF4		;
		LXI	D,202H		;
		LXI	B,F_S00		;
		CALL	WPUTSDOP	;
		INX	B		;
		DCR	E		;
		CALL	WPUTSDOP	;
		INX	B		;
		DCR	E		;
		CALL	WPUTSDOP	;

F_MENU:		LXI	H,F_MENU	;
		PUSH	H		;
		CALL	MENU		;
		CPI	0EH		;
		CZ	DEACTI		;
		POP	H		;
		RZ			;
		PUSH	H		;
		ORA	A		; "рПДЗТХЪЛБ"
		JZ	F_MERGE		;
		DCR	A		; "ъБРЙУШ ЖБКМБ"
		JZ	F_SAVE		;
		JMP	F_LOAD		; "юФЕОЙС ЖБКМБ"
					;
;;ыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыы
					;
;;
;;	рТПЙЪЧЕДЕ ЪБНЕОХ РТПГЕДХТ ПВТБВПФЛЙ ЛПНБОД ЮФЕОЙС
;; Й РПДЗТХЪЛЙ ЖБКМБ®
;;
F_F_HELP:
		XRA	A		;
		STA	F_SL_BUF	; A = 0 ЖЙЛУЙТХЕН ЧЩЪПЧ РТПГ.
;;		LXI	H,STR		; ЮФЕОЙС ЖБКМБ У ДЙУЛБ
		SHLD	F_ALT + 1	;
		LXI	H,F_F_ASCII	;
		MOV	B,M		;
		MVI	M,CR		;
		PUSH	B		;
		CALL	F_INPUT_NAME	;
		POP	B		;
		MOV	A,B		;
		RET			;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
F_MERGE:	
		LXI	H,STR		;
		CALL	F_F_HELP	; 22.4.1993
		STA	F_F_ASCII	;
		CZ	COPYS		;
		RZ			;
;;
;;    рТПЙЪЧЕДЕН РПДЗТХЪЛХ ( ЧУФБЧЛХ ) ЖБКМБ Ч ДБООПЕ НЕУФП
;;  1)  ъБРПНОЙН ФЕЛХЭХА РПЪЙГЙА ( POS ) ,Б ИЧПУФ РЕТЕОЕУЕН  
;;      Л РПФПМЛХ ДПУФХРОПК РБНСФЙ
;;  2)  рТПЙЪЧПДЙН РПУМЕДПЧБФЕМШОПЕ ЮФЕОЙЕ ЙЪ ЧИПДОПЗП ЖБК-
;;      МБ ДП ФПЗП  НПНЕОФБ РПЛБ ОЕ  ЪБЛПОЮЙФУС РБНСФШ МЙВП
;;      ДПУФЙЗОЕН  ЛПОГБ  жБКМБ.  ч  РЕТЧПН  УМХЮБЕ  ЧЩДБЕН
;;	РТЕДХРТЕЦДБАЭЕЕ  УППВЭЕОЙЕ  Й  ЧПУФБОБЧМЙЧБЕН РТЕД-
;;      ЙДХЭЙК ЧБТЙБОФ ФЕЛУФБ ,  ЙОБЮЕ  РТПЙЪЧПДЙН  УЛМЕКЛХ
;;	РПМХЮЙЧЫЕЗПУС ПВ'ЕДЙОЕОЙС  Й ЧПЪЧТБЭБЕНУС Ч РПЪЙГЙА
;;	ЧУФБЧЛЙ ЖБКМБ.
;;
		LHLD	POS		; юЙФБЕН ФЕЛХЭЙК ХЛБЪБФЕМШ
		XCHG			; РЕТЕОПУЙН Ч DE
		LHLD	ENDTEXT		; юЙФБЕН ХЛБЪБФЕМШ ОБ ЛПОЕГ
		BH_MOV			; ФЕЛУФБ.
		CALL	NEG_DE		;
		DAD	D		; HL = ENDTEXT - POS
		INX	H		;
		LXI	D,TEXT_LIMIT	;
		PUSH	H		;
;;
;;  ч РБТЕ HL УПДЕТЦЙФУС ЮЙУМП ВБКФ ЛПФПТЩЕ
;; ОЕПВИПДЙНП РЕТЕОЕУФЙ Л РПФПМЛХ ДПУФХРОПК РБНСФЙ
;;
;; DE -> ЛХДБ
;; BC -> ПФЛХДБ
;; HL -> УЛПМШЛП
;;
;; рТПЙЪЧПДЙН РЕТЕОПУ НБУЙЧБ У ДЕЛТЕНЕОФПН ЙОДЕЛУБ
;;
F_M_LOOP0:	LDAX	B		;
		STAX	D		;
		DCX	B		;
		DCX	D		;
		DCX	H		;
		MOV	A,H		;
		ORA	L		;
		JNZ	F_M_LOOP0	;
		INX	B		;
		INX	D		;
		PUSH	B		; фПЮЛБ ЪБЗТХЪЛЙ
		PUSH	D		; фПЮЛБ "ЛПОЕГ РБНСФЙ"
		PUSH	B		;
;;
;; рЕТЕИПДЙН Л ЧУФБЧЛЕ ЖБКМБ
;;				
		LXI	D,STR		; хУФБОПЧЙН ВХЖЕТ ПВНЕОБ У ДЙУЛПН
		INT	_SET_DMA	;
		POP	H		; HL-фПЮЛБ ЪБЗТХЪЛЙ
		LXI	D,F_FILE0	;

F_M_0:		PUSH	D		; уПИТБОЙН ХЛБЪБФЕМШ FCB
		PUSH	H		; УПИТБОЙН ХЛБЪБФЕМШ ЪБРПМОЕОЙС
		INT	_READS		; РТПЮЙФБЕН ЪБРЙУШ
		POP	D		;
		MOV	C,A		;
		CALL	F_PSEVDO	; чЩЪПЧ ЛПТТЕЛФПТБ ЛПДБ
		CALL	LIIR		; РТПЙЪЧЕДЕН РЕТЕОПУ РБНСФЙ
;;
;;	DE - лХДБ
;;	HL - пФЛХДБ
;;	B  - уЛПМШЛП
;;
		DCR	C		; C = 00 ЖБКМ ОЕ РТПЮЙФБО.
					; C = 01 End file.
		JZ	F_M_END_FILE	; рТПЮЙФБМЙ ЧЕУШ ЖБКМ
;;
;;   A - УПДЕТЦЙФ ЛПД ЧПЪЧТБФБ УЙУФЕНОПК ЖХОЛГЙЙ
;;   _READS ЕУМЙ ЧПЪЧТБЭБЕФУС ЛПД 0x01 ФП ПЪОБЮБЕФ
;;   ЮФП РТПЮЙФБО ЧЕУШ ЖБКМ (EOF - file).
;;

		XCHG			; рПМХЮЙФШ ХЛБЪБФЕМШ ЪБЗТХЪЛЙ
		LXI	D,SECSIZ+SECSIZ	; ХЧЕМЙЮЙФШ ОБ ЧЕМЙЮЕОХ ЪБРЙУЙ * 2
		DAD	D		;
		POP	B		; чТЕНЕООП ЧПЪШНЕН FCB* 
		POP	D		; ЧoЪШНЕН РТЕДЕМ ДПУФХРОПК РБНСФЙ
		PUSH	D		; рТПФПМЛОЕН Ч УФЕЛ
		XCHG			; рТЕДЕМ РЕТЕЛЙОЕН Ч HL
		PUSH	D		; Ч DE РПСЧЙФУС ХЛБЪ. ЪБРПМОЕОЙС
		CALL	NEG_DE		; уЗЕОЕТЙТХЕН ДПР. ЛПД ДМС DE РБТЩ
					; Ф.Е. ДМС ХЛБЪБФЕМС ЪБРПМОЕОЙС
		DAD	D		; рТПЙЪЧЕДЕН ЧЩЮЕФБОЙЕ
;;
;;    еУМЙ HL>DE ФП рпдойнефус ЖМБЗ "у"
;; ЬФП ВХДЕФ ПЪОБЮБФШ ЮФП РБНСФШ ЕЭЕ ПУФБМБУШ РП ЛТБКОЕК
;; НЕТЕ ОБ ЮФЕОЙЕ ЕЭЕ ПДОПК ЪБРЙУЙ
;;
		POP	H		; чПУФБОПЧЙН ХЛБЪБФЕМШ ЪБРПМОЕОЙС
		PUSH	PSW		; УПИТБОЙН ТЕЪХМШФБФ РТЕДЩДХЭ.
		LXI	D,-SECSIZ	; ПРЕТБГЙЙ Й ЧПЪЧТБФЙН ХЛБЪ.
		DAD	D		; ОБ ЪБРЙУШ ОБЪБД.
		POP	PSW		; ЧПУФБОПЧЙН ТЕЪХМШФБФ.
		MOV	D,B		;
		MOV	E,C		; 
;;
;;     Ч ТЕЪХМШФБФЕ НЩ РПМХЮБЕН УМЕДХЕЭЕЕ ТБУРТЕДЕМЕОЙЕ ТЕЗЙУФТПЧ
;; HL - ХЛБЪБФЕМШ ЪБРПМОЕОЙС "РХУФПФЩ" 
;; DE - ХЛБЪБФЕМШ ОБ FCB ЖБКМБ ЮФЕОЙС 
;; flag.C - ЕУМЙ ХУФБОПЧМЕО ФП НПЦОП РТПДПМЦБФШ ЪБЗТХЪЛХ
;;	    ЙОБЮЕ ЧПЪОЙЛМБ УЙФХБГЙС "оеичбфлб рбнсфй"

		JC	F_M_0		;
;;
;;
;; чПУФБОПЧЙН РЕТЧПОБЮБМШОЩК ЧБТЙБОФ ФЕЛУФБ. дП ЬФПЗП Ч УФЕЛЕ
;; ВЩМЙ УПИТБОЕОЩ РБТБНЕФТЩ РЕТЕОПУБ  НБУЙЧБ ОБ ЛТЩЫХ РПЬФПНХ
;; ЙЪЧМЕЛБЕН ЙЪ УФЕЛБ ОЕПВИПДЙНЩЕ ДБООЩЕ Й  ЧЩЪЩЧБЕН РТПГЕДХ-
;; ТХ "mem_move_inc" ЛПФПТБС   РТПЙЪЧПДЙФ  ПВТБФОЩК   РЕТЕОПУ
;; ФЕЛУФБ
;;
		XRA	A		;
		OUT	10H		;
		LXI	B,SOOBF		;
		CALL	F_PR_OVER	;
		POP	D		; пФлХДБ
		POP	B		; лХДБ
		POP	H		; уЛПМШЛП
		
		CALL	MEM_MOVE_INC	;
F_M_EXIT:
		XRA	A		;
		OUT	10H		;
		POP	H		;
		CALL	DEACTI		;
		CALL	DEACTI		;
		INR	A		;
		STA	OFSET		;
		CALL	HOME		;
		CALL	CCLEFT		;
		CALL	DON		; 13.4.1993
		CALL	UP		;  /* V1.00 */
		RET			;
;;
;;   пВТБВПФБЕН ЧБТЙБОФ ХУРЕЫОПЗП ЮФЕОЙС ЖБКМБ У ДЙУЛБ,
;; Ф.Е. РТПЮЙФБООЩК ЖБКМ РПНЕУФЙМУС Ч ПФЧЕДЕООПЕ "ПЛОП"
;;

;;
;; рТПЙЪЧЕДЕН РПЙУЛ ЛПОГБ ФЕЛУФПЧПЗП ЖБКМБ.
;;

F_M_END_FILE:
		DCX	D		;
		LDAX	D		;
		CPI	LF		;
		JNZ	F_M_END_FILE	;
		XCHG			;
		INX	H		;
;;
;; HL - ФПЮЛБ УГЕРМЕОЙС ЛХУЛПЧ.
;;		
		POP	D		;
		POP	D		; пФлХДБ
		POP	B		; уФБТЩК "лхдб"
		BH_MOV			; лХДБ
		POP	H		; уЛПМШЛП
		CALL	MEM_MOVE_INC	;
		DCX	B		;
		MOV	H,B		;
		MOV	L,C		;
		SHLD	ENDTEXT		;
		JMP	F_M_EXIT	;


;;;;;;;;;;;;;;;
;;
;; рТПГЕДХТБ РЕТЕОПУБ НБУЙЧБ РБНСФЙ У ЙОЛТЕНЕОФБН ЙОДЕЛУБ
;;   BC - лХДБ
;;   DE - пФЛХДБ
;;   HL - УЛПМШЛП
;;

MEM_MOVE_INC:
F_M_LOOP1:	LDAX	D		;
		STAX	B		;
		INX	D		;
		INX	B		;
		DCX	H		;
		MOV	A,H		;
		ORA	L		;
		JNZ	F_M_LOOP1	;
		RET			;

;;ыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыы

F_SAVE:		
		INR	A		; A=1 ЖЙЛУЙТХЕН ЧЩЪПЧ
		STA	F_SL_BUF	; РТПГЕДХТЩ ЪБРЙУЙ
		LXI	H,STR		;
		SHLD	F_ALT + 1	;
F_S_DUBL:	CALL	F_INPUT_NAME	;
		MOV	B,A		; уПИТБОЙН ЛПД ЧПЪЧТБФБ
		CPI	0EH		;
		CZ	COPYS		;
		RZ			;

		INR	B		; рТПЧЕТЛБ ЛПДБ ЧПЪЧТБФБ
		DCR	B		;
		JNZ	F_S_YES		; ЖБКМ УХЭЕУФЧХЕФ Й УПЪДБЧБФШ
;;
;; жБЙМ У ЪБДБООЩН ЙНЕОЕН ОЕ УХЭЕУФЧХЕФ
;; Ф.Е ОЕПВИПДЙНП УПЪДБФШ ДБООЩК ЖБКМ
;;
		LXI	D,F_FILE0	;
		JMP	F_S_DOP		;
;;
;; рПДФЧЕТДЙФШ РПРЩФЛХ ЪБРЙУЙ ЖБКМБ
;;
F_S_YES:	XRA	A		;
		OUT	10H		;
		LXI	D,2006H		;
		LXI	H,3106H		;
		CALL	S_ARE_YOU	;
		JNZ	F_S_QUIT	;
		MVI	A,KD_CONST	;
		OUT	10H		;
		LXI	D,F_FILE0	;
		PUSH	D		;
		INT	_DELC		;
		POP	D		;
F_S_DOP:
		INT	_GREATS		;
;;
;;     рЕТЕИПДЙН Л ЪБРЙУЙ ЖБКМБ ОБ ДЙУЛ
;;
F_S_SAVE:	MVI	A,KD_CONST	; хРТБЧМЕОЙЕ СДТХ УЙУФЕНЩ
		OUT	10H		;
		LXI	D,STR		; хУФБОПЧЙФШ ВХЖЕТ DMA
		INT	_SET_DMA	;		
		LXI	H,BTEXT+2	;
F_S_LOOP:	LXI	B,1A80H		; B - STOPBYTE ; C - SECSIZ
		LXI	D,STR		; РТПЙЪЧПДЙН ОБЮБМШОХА ХУФБОПЧЛХ
					; РБТБНЕФТПЧ ДМС ЪБРЙУЙ ФЕЛУФБ
;;
;; рЕТЕИПДЙН ОЕРПУТЕДУФЧЕООП Л ЪБРЙУЙ ФЕЛУФБ
;;
F_S_S00:	MOV	A,M		; вЕТЕН ЙЪ ВХЖЕТБ ВБКФ ФЕЛУФБ
		STAX	D		; РПУЩМБЕН Ч ВХЖЕТ DMA
		CMP	B		; рТПЧЕТЛБ ОБ ЛПОЕГ ЖБКМБ
		CZ	F_S_EXIT	; ЪБЛПОЮЙФШ ЕУМЙ ЛПОЕГ ФЕЛУФБ
		INX	H		;
		INX	D		;
		DCR	C		;
		JNZ	F_S_S00		;
;;
;; рТПЙЪЧЕДЕОП ХУРЕЫОПЕ РЕТЕНЕЭЕОЙЕ ПЮЕТЕДОПК РПТГЙЙ
;; Ч ТБВПЮЙК ВХЖЕТ DMA
;;
		LXI	D,F_FILE0	;
		PUSH	H		;
		INT	_WRITS		;
		POP	H		;
		ORA	A		;
		JNZ	F_S_ERROR2	; рТПЙЪПЫМБ ПЫЙВЛБ ПВНЕОБ
		DCX	H		;
		MOV	A,M		;
		INX	H		;
		CPI	STOPBYTE	;
		JNZ	F_S_LOOP	;
;;
;; рТПЙЪЧЕМЙ ЪБРЙУШ ЖБКМБ ОЕПВИПДЙНП ЪБЛТЩФШ
;; ЕЗП Й ЧЩКФЙ Ч ПУОПЧОПЕ ПЛОП ТЕДБЛФПТБ
;;
		LXI	D,F_FILE0	;
		INT	_CLOSEC		;
		JMP	F_S_QUIT	;

;;
;;  пВТБВПФЮЙЛ ПЫЙВЛЙ РТЙ ЪБРЙУЙ ОБ ДЙУЛ У РПУМЕДХАЭЕН
;;       ЧЩИПДПН ЙЪ РТПГЕДХТЩ ЪБРЙУЙ
;;
F_S_ERROR2:	LXI	B,F_S30		; "Out of disk !"
F_S_E_0:	XRA	A		;
		OUT	10H		;
		CALL	F_PR_OVER	;

F_S_QUIT:	XRA	A		;
		OUT	10H		;
		POP	H		;
		CALL	COPYS		;
		CALL	DEACTI		;
		CALL	DEACTI		;
		RET			;
;;;;;;;;;;;
;;    рТПГЕДХТБ ПВТБВПФЛЙ ЛПОГБ ЖБКМБ ПОБ БЧФПНБФЙЮЕУЛЙ
;; ДПРПМОСЕФ ПЮЕТЕДОПК ВМПЛ РТЕДОБЪОБЮЕООЩК ДМС ЪБРЙУЙ
;; ЛПДПН ЛПОГБ ФЕЛУФБ ( STOPBYTE = 1AH )
;;;;;;;;;;;
F_S_EXIT:	XCHG			;
F_S_E_LOOP:	MOV	M,B		;
		INX	H		;
		DCR	C		;
		JNZ	F_S_E_LOOP	;
		INR	C		; C = 1
		DCX	H		; ЧЕТОЕН HL ОБ НЕУФП
		RET			;
;;
;; рТПГЕДХТБ ПВТБВПФЛЙ ОЕИЧБФЛЙ ДЙУЛПЧПЗП РТПУФТБОУФЧБ
;; ДМС ПФЛТЩФЙС ЙМЙ ЪБРЙУЙ ФЕЛУФПЧПЗП ЖБКМБ
;;
;;ыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыы

F_LOAD:		
		LXI	H,F_F_ASCII	;
		CALL	F_F_HELP	;
		CZ	COPYS		;
;;
;;    еУМЙ ЧЩРПМОЙФУС РТПГЕДХТБ COPYS ФП ПОБ РПДОЙНЙФ
;; ЖМБЗ ОХМС Ф.Е. БЧФПНБФЙЮЕУЛЙ РТПГЕДХТБ ЪБЧЕТЫЙФ УЧПА
;; ТБВПФХ УМЕДХАЭЕК ЛПНБОДПК
;;
		RZ			;
;;    йНС ЖБКМБ ЧЧЕДЕОП ЛПТЕЛФОП Й ЖБКМ УХЭЕУФЧХЕФ
;; ПО ПФЛТЩФ ДМС ДПУФХРБ УТЕДУФЧБНЙ нЙЛТП дПУ
;; 
;; РЕТЕИПДЙН Л РТПГЕДХТЕ ЮФЕОЙС ЖБКМБ Й ЛПТЕЛГЙЙ ЕЗП
;; ЛПДБ ОБ РТЙУХФУФЧЙЕ ОЕДПРХУФЙНЩИ УЙНЧПМПЧ Ч РУЕЧДП-
;; ЗТБЖЙЛЙ ФЕЛУФПЧПЗП РТПГЕУУПТБ MAR.COM
;;
F_L_DOP:
		LXI	D,STR		; хУФБОПЧЙН ВХЖЕТ ПВНЕОБ У ДЙУЛПН
		INT	_SET_DMA	;
		LXI	H,BTEXT + 2	;
		LXI	D,F_FILE0	;
		MVI	A,((TEXT_LIMIT-BTEXT+2)/SECSIZ)
F_YES_0:	PUSH	D		;
		PUSH	PSW		;
		PUSH	H		;
		INT	_READS		;
		POP	D		;
		MOV	C,A		;
		CALL	F_PSEVDO	; чЩЪПЧ ЛПТТЕЛФПТБ ЛПДБ
		POP	PSW		;
		DCR	A		;
		JZ	F_OVER		;
		PUSH	PSW		;
		CALL	LIIR		;
		POP	PSW		;
		DCR	C		; ЛПТЕЛГЙС УЮЕФЮЙЛБ
		XCHG			;
		LXI	D,SECSIZ	;
		DAD	D		;
		POP	D		;
		JNZ	F_YES_0		;
		LXI	B,-SECSIZ - SECSIZ - 1;
		DAD	B		;
		MVI	B,0		;
F_YES_EX:	INX	H		;
		MOV	A,M		;
		CPI	STOPBYTE	;
		JZ	F_YES_00	; чЩКФЙ ЙЪ РПЙУЛБ ЛПДБ
		DCR	B		;
		JNZ	F_YES_EX	;
F_YES_00:	DCX	H		;
		MOV	A,M		;
		CPI	LF		;
		INX	H		;
		JZ	F_EXIT		;
		MVI	M,CR		;
		INX	H		;
		MVI	M,LF		;
		INX	H		;
		MVI	M,STOPBYTE	;
F_EXIT:		SHLD	ENDTEXT		;
		PUSH	D		;
		INT	_CLOSEC		;
		XRA	A		;
		OUT	10H		;
		POP	H		; HL - ХЛБЪБФЕМШ ОБ FCB
		POP	D		; ъБВЙТБЕН ЧЕЛФПТ ЧПЪЧТБФБ
;;
;; уЛПТЕЛФЙТХЕН ЙНС ЖБКМБ Ч ПУОПЧОПН ПЛОЕ ТЕДБЛФПТБ
;;
F_L_NAME:
		MOV	A,M		;
		ORA	A		;
		LXI	D,290EH		;
		JNZ	F_EX_00		;
		MVI	A,'*' - 40H	;
F_EX_00:	ADI	40H		;
		CALL	PUTCXY		;
		INR	D		;
		MVI	B,8		;
		CALL	F_EX_PRINT	;
		INR	D		;
		MVI	B,3		;
		CALL	F_EX_PRINT	;
		CALL	DEACTI		;
		CALL	DEACTI		;
		CALL	NULL_POS	;
		CALL	PRINT_POS	;
		CALL	INCY		;
		CALL	DECY		;
		CALL	COPYS		;
		STA	DLINNA		;
		RET			;
;; пВТБВПФБЕН РЕТЕРПМОЕОЙЕ РБНСФЙ
F_OVER:		OUT	10H		;
		XCHG			;
F_OV_0:		DCX	H		;
		MOV	A,M		;
		CPI	LF		;
		JNZ	F_OV_0		;
		INX	H		;
		MVI	M,STOPBYTE	;
		LXI	B,SOOBF		;
		CALL	F_PR_OVER	; чЩЪПЧ РТПГЕДХТЩ ЧЩЧПДБ РТЕДХРТ.
		MVI	A,KD_CONST	; чПЪЧТБФЙФШ ХРТБЧМЕОЙС
		OUT	10H		; СДТХ OS "нЙЛТП дПУ"
		POP	D		;
		JMP	F_EXIT		;
;;;;;;;;;;
;; рТПГЕДХТБ ЧЩЧПДБ РТЕДХРТЕЦДБАЭЕЗП УППВЭЕОЙС
;; Ч ФЕЛХЭЕН (блфйчопн) ПЛОЕ
;;   BC - ХЛБЪБФЕМШ ОБ УЙНЧПМШОХА УФТПЛХ
;;        ЛПФПТХА ОЕПВИПДЙНП ЧЩЧЕУФЙ ОБ
;;        ЬЛТБО Ч ЛБЮЕУФЧЕ РТЕДХРТЕЦДЕОЙС
;;
F_PR_OVER:
		LXI	D,500H		;
		CALL	HOME		; пФЮЙУФЙН ФЕЛХЭЕЕ ПЛОП
		CALL	WPUTSDOP	;
		MVI	A,80H		; пТЗБОЙЪХЕН ЪБДЕТЦЛХ
F_OV0:		HLT			;
		DCR	A		;
		JNZ	F_OV0		;
		RET			;

;;;;;;;;;;
;; рТПГЕДХТБ ТБУРЕЮБФЛЙ ЪБДБООПЗП ЛПМЙЮЕУФЧБ МЙФЕТ
;; Ч БВУПМАФОЩИ ЛППТДЙОБФБИ ЬЛТБОБ
;;
F_EX_PRINT:	
		INR	D		;
		INX	H		;
		MOV	A,M		;
		CALL	PUTCXY		;
		DCR	B		;
		JNZ	F_EX_PRINT	;
		RET			;
;;;;;;;;;
;;   рТПГЕДХТБ ЛПТТЕЛГЙЙ ПДОПК ЪБРЙУЙ ( 128 ВБКФ )
;; ПФ ОЕДПРХУФЙНЩИ ЛПДПЧ РУЕЧДПЗТБЖЙЛЙ Ч ФЕЛУФПЧПН
;; ТЕДБЛФПТЕ MAR.COM
;; БЧФПНБФЙЮЕУЛЙ ЙОЙГЙБМЕЪЙТХАФУС УМЕДХАЭЙЕ ТЕЗЙУФТЩ
;;     HL = STR
;;     B  = SECSIZ
;; рЕТЕЛПДЙТПЧЛБ РТПЙУИПДЙФ ФПМШЛП Ч УМХЮБЕ
;; ое ОБЦБФЙС ЛМБЧЙЫЙ "ху"
;;
F_PSEVDO:
		LXI	H,STR		;
		MVI	B,SECSIZ	;
		IN	01H		;
		ANI	40H		;
		RZ			;
		PUSH	H		; уПИТБОЙН ТЕЗЙУФТЩ
		PUSH	B		;
;;
;;  рТПЙЪЧЕДХН ЛПТЕЛГЙА ЛПДБ УЮЙФБОПК ЪБРЙУЙ
;;  ОБ РТЙУХФУФЧЙЕ УЙНЧПМПЧ "ЪБРТЕФОПК" РУЕЧДПЗТБЖЙЛЙ

F_Y_LOOP:	MOV	A,M		; ЮЙФБЕН ВБКФ ЙЪ ЪБРЙУЙ
		CPI	0A0H		; УТБЧОЙН У ЛПДПН (0AH)
		JC	F_DONE		; РЕТЕИПД ЕУМЙ НЕОШЫЕ
		CPI	0C0H		; --//--//--//--//--
		JNC	F_DONE		; РЕТЕИПД ЕУМЙ >=
;; оЕВИПДЙНП РТПЙЪЧЕУФЙ ЛПТЕЛГЙА ЛПДБ
		SUI	80H		;
		MOV	M,A		;
F_DONE:		INX	H		;
		DCR	B		;
		JNZ	F_Y_LOOP	;
		POP	B		;
		POP	H		;
		RET			;

;;ыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыы
;;
;;   рТПГЕДХТБ РТПЙЪЧПДЙФ ПФЛТЩФЙЕ ДЙБМПЗПЧПЗП ПЛОБ
;; ЪБРТБЫЙЧБЕФ ЙНС ФТЕВХЕНПЗП ЖБКМБ РТЙ ЬФПН
;; РТПЙЪЧПДЙФ УЙОФБЛУЙЮЕУЛЙК БОБМЙЪ.
;;
;;  рПУМЕ ЬФПЗП РЩФБЕФУ ПФЛТЩФШ ХУФБОПЧМЕООЩК ЖБКМ
;; Й Ч УМХЮБЕ ХДБЮЙ ЧПЪЧТБЭБЕФ ХРТБЧМЕОЙЕ УП УВТПЫ-
;; ЕОЩН ЖМБЗПН "Z" РТЙ ЬФПН ПУФБЕФУС ДПУФХРОПК СДТП
;; ПРЕТБГЙПООПК УЙУФЕНЩ Ф.Е :
;;		KD_CONST -> PORT 10H
;;
;; Ч УМХЮБЕ ОЕ ХДБЮЙ ЖМБЗ РПДОЙНБЕФУС Z=1
;; РТЙ ЬФПН PORT 10H <- Zero
;;
;; рЕТЕД ЧИПДПН Ч РПДРТПЗТБННХ ОЕПВИПНП УМЕДЙФШ
;; ЪБ РТБЧЙМШОПУФША ХУФБОПЧЛЙ СЮЕКЛЙ: F_VEKTOR
;; ПОБ ИТБОЙФ БДТЕУ ВХЖЕТБ ASCII ДМС ЧЧЕДЕООПЗП
;; ЙНЕОЙ ЖБКМБ
;;
F_INPUT_NAME:
		LXI	D,1008H		;
		LXI	H,2608H		;
		MVI	A,16H		;
		CALL	ACTIV		;
		CALL	ESCF4		;
F_I_LOOP:	LXI	B,F_S10		;
		LDA	SMAL		;
		MOV	H,A		;
		LDA	RUSLAT		;
		MOV	L,A		;
		PUSH	H		;
		XRA	A		;
		STA	SMAL		;
		STA	RUSLAT		;
		LXI	D,100H		;
		CALL	WPUTSDOP	;
		MVI	D,7		;
		LXI	H,F_F_ASCII	;
		MVI	A,13		;
		CALL	EDLINE		;		
		CPI	0EH		;
		CZ	DEACTI		;
		POP	H		;
		RZ			;
		MOV	A,H		;
		STA	SMAL		;
		MOV	A,L		;
		STA	RUSLAT		;
		LXI	H,F_FILE0	;
		CALL	F_DROB_FILE	;
		CNZ	HOME		;
		JNZ	F_I_LOOP	;
;;
;; рПМХЮЕОЙЕ ЙНЕОЙ ЖБКМБ У ЛПОУПМЙ
;; РТПЫМП ХУРЕЫОП УЛПРЙТХЕН ASCII ЛПД
;; Ч ТБВПЮЙК ВХЖЕТ 
;;
				; чЕЛФПТ ЛПРЙТПЧБОЙС ASCII
				; ЖПТНБФБ ЧП ЧТЕНЕООЩК ВХЖЕТ
				; ОЕПВИПДЙН ДМС ФПЗП ЮФПВЩ
				; РПФПН ЧПУФБОПЧЙФШ FCB ТБВПЮЕЗП
				; ЖБКМБ РПУМЕ ЧУФБЧЛЙ

		MVI	B,15		; рТПЙЪЧПДЙН РЕТЕОПУ
		LXI	H,STR		; ФЕЛУФПЧПК УФТПЛЙ ЧП ЧТЕНЕ-
F_ALT:		LXI	D,0		; ООЩК ВХЖЕТ ДМС РПУМЕДХАЭЕЗП

		CALL	LIIR		; ЙУРПМШЪПЧБОЙС
;;
;; рЕТЕИПДЙН Л ПФЛТЩФЙА ЖБКМБ
;;
		LXI	D,F_FILE0	;
		MVI	A,KD_CONST	;
		OUT	10H		;
		INT	_OPENC		; рЩФБЕНУС ПФЛТЩФШ ЪБДБООЩК ЖБКМ
		INR	A		; ЕУМЙ ОЕ РПМХЮЙМПУШ ОБ РПЧФПТОЩК
		RNZ			; ЪБРТПУ ,ЙОБЮЕ ЧЩИПДЙН
;;
;; пВТБВПФБФШ ЧБТЙБОФ ЕУМЙ ЖБКМ ОЕ ОБКДЕО
;;
		LDA	F_SL_BUF	; рТПЧЕТСЕН ЛБЛХА ПРЕТБГЙА
		DCR	A		; РТПЙЪЧПДЙН ЕУМЙ ЪБРЙУШ
		RZ			; ФП ЧПЪЧТБЭБЕНУС У б=0
		LXI	D,2007H		;
		LXI	H,2D07H		;
		XRA	A		;
		OUT	10H		;
		MVI	A,17H		;
		CALL	ACTIV		;
		CALL	ESCF4		;
		LXI	B,F_S20		;
		LXI	D,300H		;
		CALL	WPUTSDOP	;
		CALL	KEYDELAU	;
		CPI	0EH		;
		CALL	DEACTI		;
		CALL	DEACTI		;
		JNZ	F_INPUT_NAME	; рТПЙЪЧЕУФЙ РПЧФПТОЩК ЧЧПД ЙНЕОЙ
		RET			; ЕУМЙ F4 ФП ЧЩКФЙ ЙЪ ТЕЦЙНБ

;;ыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыы

;;
;; рТПГЕДХТБ ТБЪДТПВМЕОЙС ЙНЕОЙ ЖБКМБ Й ЗЕОЕТБГЙС
;; ВМПЛБ FCB
;;      чИПД:
;;        HL - ХЛБЪБФЕМШ ОБ ВХДХЭЙК FCB
;;      чЩИПД:
;;         Z - РПДОСФ ФП ЧУЕ ОПТНБМШОП
;;         Z - ПРХЭЕО ФП ОЕЛПТЕЛФОПЕ ЙНС ЖБКМБ
;;
F_FCB		SET	36		; дМЙООБ УФБОДБТФОПЗП FCB
F_DROB_FILE:
		MVI	B,F_FCB		;
		PUSH	H		;
		CALL	CLEAR_MEM	; РТПЙЪЧЕДЕН ПФЮЙУФЛХ
		POP	H		; ВХДХЭЕЗП ВМПЛБ FCB
		LXI	B,STR+1		;
		LDAX	B		;
		CPI	':'		; ЕУФШ РТЕЖЙЛУ ЪБНЕОЩ ДЙУЛБ
		DCX	B		;
		JNZ	F_D_00		; ЕУМЙ ОЕФ ФП ПВПКФЙ
		LDAX	B		;
		INX	B		;
		INX	B		;
		SUI	40H		; РПМХЮЙФШ ОПНЕТ ОБЛПРЙФЕМС
		CPI	4		;
		RNC			;
		MOV	M,A		; РПУФБЧЙФШ Ч FCB
F_D_00:		INX	H		;
		MVI	D,9		; уЮЕФЮЙЛ ЙНЕОЙ ЖБКМБ
		CALL	F_D_HLP		;
		CPI	' '		; ЙНС ЖБКМБ ЛПТТЕЛФОП ???
		RNZ			; хИПД ЕУМЙ ОБ ЧЕТОП ЪБДБОП ЙНС
		LDAX	B		;
		CPI	CR		; ЙНС ВЕЪ ТБУЫЙТЕОЙС ???
		JZ	F_D_40		; ЕУМЙ ОЕФ ФП ПВТБВПФБФШ ДБМШЫЕ
		INX	B		;
F_D_40:		MVI	D,4		;
		CALL	F_D_HLP		;
		MOV	M,D		; D = 0 - уЮЕФЮЙЛ ПФТБВПФБМ
		CPI	' '		;
		RET			;

F_D_HLP:	LDAX	B		; ЮЙФБЕН УЙНЧПМ ФЕЛУФБ
		CPI	'?'		;
		RZ			; лПОФТПМШ ОБ НЕФБ-УЙНЧПМЩ
		CPI	CR		; лПОЕГ УФТПЛЙ ???
		JZ	F_D_30		; еУМЙ дБ ФП ПВИПДЙН
		CPI	'.'		; ЕУМЙ ОБЮБМПУШ ТБУЫЙТЕОЙЕ
		JNZ	F_D_10		; ПУФБЧЫЩЕУС НЕУФБ Ч ВМПЛЕ
F_D_30:		DCX	B		; FCB ЪБРПМОСЕН РТПВЕМБНЙ
		MVI	A,' '		;
F_D_10:		MOV	M,A		;
		INX	B		;
		INX	H		;
		DCR	D		;
		JNZ	F_D_HLP		;		
		DCX	H		;
		RET			;		

;; /////// тБВПЮЙЕ ВХЖЕТБ ДМС ТБВПФЩ У ЖБКМБНЙ \\\\\\\\
;;  F_FILE0:	DB	0,0,0,0	; вМПЛ ХРТБЧМЕОЙС ЖБКМПН
;;		DB	0,0,0,0	; уПДЕТЦЙФ 36 ЬМЕНЕОФПЧ.
;;		DB	0,0,0,0	;
;;		DB	0,0,0,0	;
;;		DB	0,0,0,0	;
;;		DB	0,0,0,0	;
;;		DB	0,0,0,0	;
;;		DB	0,0,0,0	;
;;		DB	0,0,0,0	;
;; РЕТЕНЕЭЕО РП БДТЕУХ 81H

F_F_ASCII:	DB	CR	; оБЮБМШОБС ЪБЗМХЫЛБ
				; ЙНС ЖБКМБ Ч ASCII ЖПТНБФЕ
		DB	"A:Filename.ppa",CR

;; ======= ху + 7 ====== Search ======
;;ыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыы
SEARCH:		CALL	S_LINE_INPUT	; ЪБРТПУЙФШ УФТПЛЙ РПЙУЛБ Й ЪБНЕОЩ

; ;ОБЮБФШ РПЙУЛ ЪБДБООПК УФТПЛЙ Й РТЙ ОЕПВИПДЙНПУФЙ ЪБНЕОСФШ
; ;   BUF_ETALON:	--> ВХЖЕТ ДМС ЬФБМПОБ
; ;   BUF_PODM:		--> ВХЖЕТ ДМС ЪБНЕОСЕНПК УФТПЛЙ
; ;   DL_ETALON:	--> ДМЙОБ ЬФБМПОПК УФТПЛЙ
; ;   DL_PODM:		--> ДМЙОБ ЪБНЕОСЕНПК УФТПЛЙ

		CALL	NULL_POS	;ХЛБЪБФЕМШ ОБ ОБЮБМП ФЕЛУФБ
		LDA	DL_ETALON	;ВЕТЕН ДМЙОХ ЬФБМПОБ
		MOV	B,A		;УПИТБОСЕН Ч ТЕЗЙУФТБИ
		MOV	C,A		;
		LHLD	POS		;ЮЙФБЕН ХЛБЪБФЕМШ ОБ УФТПЛХ Ч HL
S_LOOP:		MOV	B,C		;ЧПУФБОБЧМЙЧБЕН "B"
		LXI	D,BUF_ETALON	;
S_LOOP1:	MOV	A,M		;УТБЧОЙЧБЕН У УЙНЧПМПН "ЛПОЕГ УФТПЛЙ"
		CPI	CR		;
		JZ	S_END_LINE	;ЛПОЕГ УФТПЛЙ ???
		LDAX	D		;ЕУМЙ ОЕ ЛПОЕГ ФП РТПЮЙФБЕН ЬФБМПО
		CMP	M		;Й УТБЧОЙН ЕЗП У ФЕЛХЭЙН УЙНЧПМПН ЕУМЙ
		INX	H		;ОЕ ТБЧОЩ ФП ЧПУФБОПЧЙФШ ХЛБЪБФЕМШ
		INX	D		;ЬФБМПОБ Й ДМЙООХ ЬФБМПОБ
		JNZ	S_LOOP		;ЙОБЮЕ ХНЕОШЫЙФШ УЮЕФЮЙЛ ХДБЮОЩИ
		DCR	B		;УТБЧОЕОЙК ЕУМЙ ТБЧОП ОХМА ФП
		JNZ	S_LOOP1		;ОБЫМЙ ЬФБМПООХА РПУМЕДПЧБФЕМШОПУФШ
;
; ; ОБЫМЙ ЙУЛПНХА УФТПЛХ ФЕРЕТШ ОЕПВИПДЙНП ПРТЕДЕМЙФШ
; ; ЮФП У ОЕК ДЕМБФШ Б ФБЛЦЕ ЧЩДБФШ УППФЧЕФУФЧХАЭЙЕ
; ; РПСУОЕОЙС РПМШЪБЧБФЕМА Й РТЙОСФШ ТЕЫЕОЙЕ П ДБМШ-
; ; ОЕЫЕН ИПДЕ ТБВПФЩ МЙВП ЪБЛПОЮЙФШ РПЙУЛ ,МЙВП РТП-
; ; ДПМЦЙФШ РПЙУЛ
; ; УЕЗПДОС: 03.12.1992 ++++++++ 19:08
; 
		PUSH	B		;УПИТБОЙН ТЕЗЙУФТЩ РТПГЕУУПТБ
		PUSH	D		;
		PUSH	H		;
		PUSH	B		;
		CALL	PRINT_POS	;ТБУРЕЮБФБЕН ОБКДЕОХС УФТПЛХ Ч
		POP	B		;
		POP	H		;
		PUSH	H		;
		MOV	A,C		;РПНЕФЙН ЙОЧЕТУОЩН ГЧЕФПН ОБКДЕОПЕ
S_LOOP2:	DCX	H		;УМПЧП
		DCR	C		;дМЙОБ ЬФБМПООПК УФТПЛЙ
		JNZ	S_LOOP2		;
		MOV	B,H		;
		MOV	C,L		;
		LXI	D,000AH		;
		CALL	WPUTS1		;
		MOV	B,A		;
		LHLD	ENDLINE		;
		XCHG			;
		LXI	H,3D0DH		;
		MOV	A,D		;
		CMP	H		;
		CC	CLS		;
		LXI	H,CURSOR + 1	;
		CALL	LINE_I_DOP	;
		MVI	M,0		;
		LXI	D,0508H		;ЧЕТИХ ЬЛТБОБ Й РПДЗПФПЧЙН ДБООЩЕ
		LXI	H,180AH		;ДМС ПФЛТЩФЙС ПЛОБ
		LXI	B,S_SOOB1	;
		LDA	DL_PODM		;
		ORA	A		;
		PUSH	PSW		;
		JZ	S_DONE0		;
		LXI	B,S_SOOB2	;ЕУМЙ ТЕЦЙН РПЙУЛ-ЪБНЕОБ ФП
		DCR	E		;ПЛОП ЙНЕЕФ ФТЙ УФТПЛЙ ЙОБЮЕ ДЧЕ
		MVI	H,13H		;
S_DONE0:	MVI	A,017H		;
		CALL	ACTIV		;
		LXI	D,0201H		;ЧЩЧПДЙН БМШФЕТОБФЙЧОЩЕ УФТПЛЙ
		CALL	WPUTSDOP	;Ч УППФЧЕФУФЧЙЙ У ФЕЛХЭЙН ТЕЦЙНПН
		LXI	B,S_SOOBEX	;Й ЧЩЪЩЧБЕН РТПГЕДХТХ MENU:
		DCR	E		;
		CALL	WPUTSDOP	;
		POP	PSW		;
		MVI	E,2		;
		INX	B		;
		CNZ	WPUTSDOP	;
		LXI	B,S_SOOBHLP	;
		CZ	WPUTSDOP	;
		INR	E		;
		CNZ	WPUTSDOP	;
MEN_LOOP:	CALL	MENU		;
;
; ; рПУМЕ ЧПЪЧТБФБ КЪ РПДРТПТБННЩ Ч БЛБНХМСФПТЕ ОБИПДЙФУС ОПНЕТ
; ; УФТПЛЙ Ч ЛПФПТПК ПУФБМУС ЛХТУПТ РТЙ ОБЦБФЙЙ чл ЕУМЙ
; ; ЧЩИПД РТПЙЪПЫЕМ РПУМЕ ОБЦБФЙС ЛМБЧЙЫЙ F4 ФП Ч б ВХДЕФ
; ; ОБИПДЙФУС ЛПД 0EH (Ф.Е Ч НЕОА ОЕ НПЦЕФ ВЩФШ РПЪЙГЙК
; ; ВПМШЫЕ 15
; ; УЕЗПДОС :03.12.1992 ++++++++++++++++ 18:08
; ; ЪБВЙМММММММММММММММММММ ОБ УБРТПНБФ !!!
;
		ORA	A		; ЕУМЙ ОХМЕЧБС РПЪЙГЙС ФП
		JZ	S_EXIT_REJ	; ЧЩИПД ЙЪ ТЕЦЙНБ РПЙУЛБ (ЪБНЕОЩ)
		CPI	0EH		; ОБЦБФБ ЛМБЧЙЫБ F4 ???
		JZ	S_EXIT_REJ	; ЕУМЙ ДБ ФП ФБЛЦЕ ЧЩИПД
		MOV	B,A		; УПИТБОСЕН РПЪЙГЙА ХЛБЪБФЕМС
		LDA	DL_PODM		; ПРТЕДЕМСЕН ФЕЛХЭЙК ТЕЦЙН
		ORA	A		; ( РПЙУЛ ЙМЙ РПЙУЛ-ЪБНЕОБ)
		JZ	ALT_POISK	; РЕТЕИПДЙН ЕУМЙ рпйул
; ; ПВТБРПФБЕН ПЛОП ДМС рпйулб Й ъбнеощ
		MOV	A,B		; ЧПУФБОПЧЙН ХЛБЪБФЕМШ
		CPI	3H		; "ртпунпфт"
		CZ	PROSMOTR	;
		JZ	MEN_LOOP	; ЧПЪЧТБФЙФУС Ч "НЕОА"
		DCR	A		; "ое ЪБНЕОСФШ"
		JZ	S_OBHOD		;
; рТПЙЪЧПДЙН ЪБНЕОХ ЬФБМПООПЗП УМПЧБ ОБ РПДНЕОСЕНПЕ
		CALL	DEACTI		; ъБЛТЩЧБЕФ ПЛОП ЪБРТПУПЧ
		POP	D		; ЮЙФБЕН ФПЮЛХ ЗДЕ ОБЫМЙ УФТПЛХ
		PUSH	D		; 
		LHLD	POS		; ЮЙФБЕН ОБЮБМП УФТПЛЙ
		XCHG			;
		CALL	NEG_DE		; ЖПТНЙТХЕН ДПРПМОЙФЕМШОЩК
		DAD	D		; ЛПД ДМС ТЕЗЙУФТБ DE
					; (ЮФПВЩ РТПЧЕУФЙ ЧЩЮЙФБОЙЕ)
					; HL - УНЕЭЕОЙЕ УМПЧБ Ч STR
		CALL	COPYS		;
		CPI	200		; РТПЧЕТЛБ ДМЙООЩ УФТПЛЙ
		JNC	S_OVERFLOM	;
		LXI	B,STR		;
		DAD	B		;
		MOV	B,H		;
		MOV	C,L		;
		LDA	DL_ETALON	;
		MOV	D,A		;
S_LOOP4:	DCX	B		; РТПЙЪЧПДЙН ХДБМЕОЙЕ ЙУИПДПК
		CALL	MOVEDEL		; УФТПЛЙ У УППФЧЕФУФЧХАЭЕК
		DCR	D		; ЛПТЕЛГЙЕК ХЛБЪБФЕМС
		JNZ	S_LOOP4		;
		LDA	DL_PODM		;
		LXI	D,BUF_PODM	;
		PUSH	B		;
S_LOOP5:	PUSH	PSW		; РТПЙЪЧПДЙН ЧУФБЧЛХ
		CALL	MOVEINS		; ОПЧПК УФТПЛЙ
		LDAX	D		;
		STAX	B		;
		INX	B		;
		INX	D		;
		POP	PSW		;
		DCR	A		;
		JNZ	S_LOOP5		;		
		POP	B		;
		LXI	D,020DH		; ПФПВТБЦБЕН РТПЙЪЧЕДЕООХА
		LXI	H,3D0DH		; ЪБНЕОХ
		CALL	CLS		;
		LXI	D,10		;
		CALL	WPUTSDOP	;
		CALL	NARUSHENIE	; РТПЙЪЧПДЙН ЙУЛХУФЧ.ТЕЗ. ВХЖЕТБ
		CALL	REGENER		; ФЕЛУФБ
; ; рТПЙЪЧЕДЕОБ ЪБНЕОБ ФЕРЕТШ ЧЩЧПДЙН ПЛОП У ЪБРТПУПН
; ; ОБ РТПДПМЕОЙЕ РПЙУЛБ Й ЪБНЕОЩ

S_ZAPROS:	LXI	D,080AH		;
		LXI	H,150AH		;
		MOV	A,H		; 15-пДЙОБТОПЕ ПЛОП
		CALL	ACTIV		;
		LXI	B,S_SOOBHLP3	;
		LXI	D,0100H		;
		CALL	WPUTSDOP	;
		CALL	ESCF4		;
		CALL	KEYDELAU	;	
		CPI	0EH		; F4
		JZ	S_EXIT_REJ	;
		JMP	S_OBHOD		;

S_OVERFLOM:	LXI	B,SOOBR		;
		CALL	WARNING		;
		JZ	S_ZAPROS	; РТПДПМЦЙФШ РПЙУЛ
; ; ПВТБВПФБЕН ПЛОП рпйул
ALT_POISK:	MOV	A,B		; ЧПУФБОПЧЙН ХЛБЪБФЕМШ
		CPI	2H		; "ртпунпфт"
		CZ	PROSMOTR	; РТПУНПФТЕФШ УФТЛХ
		JZ	MEN_LOOP	; ЧПЪЧТБФЙФУС Ч НЕОА
S_OBHOD:	POP	H		;
		POP	D		;
		POP	B		;
		CALL	DEACTI		;
		JMP	S_LOOP		;
		
S_EXIT_REJ:	CALL	DEACTI		;
		POP	D		;
		POP	D		;
		POP	D		;
		LXI	D,0AH		;
		LHLD	POS		;
		MOV	B,H		;
		MOV	C,L		;
		CALL	WPUTS1		;
		RET			;

;+++++++++++ ртпгедхтб пвтбвпфлй ртпунпфтб уфтплй +++++++++++
PROSMOTR:	PUSH	PSW		;
		LXI	D,0A06H		;
		LXI	H,3606H		;
		MVI	A,16H		;
		CALL	ACTIV		;		
		CALL	ESCF4		;
		LXI	B,S_SOOBHLP2	;
		CALL	WIND_PR_TOP	;
		LHLD	POS		;
		MOV	B,H		;
		MOV	C,L		;
		LXI	D,0		;
		PUSH	B		;
		CALL	WPUTS1		;
		POP	B		;
PROS_LOOP:	LXI	H,PROS_LOOP	;
		PUSH	H		;
		CALL	KEYDELAU	;
		LXI	D,0		;
		CPI	04H		; ЧМЕЧП
		JZ	PROS_LEFT	;
		CPI	06H		; ЧРТПЧП
		JZ	PROS_RIG	;
		CPI	0EH		;
		RNZ			;
		POP	H		;
		XRA	A		;
		STA	OFSET		;
		CALL	DEACTI		;
		POP	PSW		;
		RET			;

PROS_LEFT:	LXI	H,OFSET		;
		INR	M		;
		PUSH	B		;
		CALL	WPUTS1		;
		POP	B		;
		LDA	ENDLINE + 1	;
		MOV	D,A		;
		MVI	E,6H		;
		CPI	37H		;
		MVI	A,' '		;
		CC	PUTCXY		;
		DCR	M		;
		MOV	A,D		;
		CPI	0BH		; ОБЮБМБ ДБООПЗП ПЛОБ
		CZ	PLAY		;
		RZ			;
		INR	M		;
		RET			;

PROS_RIG:	LXI	H,OFSET		;
		XRA	A		;
		ORA	M		;
		CZ	PLAY		;
		RZ			;
		DCR	M		;
		PUSH	B		;
		CALL	WPUTS1		;
		POP	B		;
		RET			;

S_END_LINE:	INX	H		;РЕТЕИПДЙН ОБ УМЕДХАЭХА УФТПЛХ
		INX	H		;Й РТПЧЕТСЕН ОЕ ДПУФЙЗОХФ МЙ ЛПОЕГ
		MVI	A,STOPBYTE	;ФЕЛУФБ ЕУМЙ ДБ ФП Й ОЕ ВЩМП ОБКДЕОП
		CMP	M		;ОЙ ПДОПЗП ЕФБМПОБ ФП ЧЩДБФШ УППВЭЕОЙЕ
		JZ	S_END_TXT	;П ФПН ЮФП РПУМЕДПЧБФЕМШОПУФШ ОЕ
		SHLD	POS		;ОБКДЕОБ (ЛХТУПТ ХУФБОБЧМЙЧБЕФУС
		CALL	INCY		;Ч ЛПОЕГ ФЕЛУФБ !!!!!!!!! )
		JMP	S_LOOP		;РТПДПМЦЙФШ РПЙУЛ У ОПЧПК УФТПЛЙ

		CALL	DEACTI
S_END_TXT:	CALL	PRINT_POS
		RET
		
;ыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыы
WIND_PR_TOP:	CALL	HLDEWIND	;
		PUSH	B		;
		CALL	HLSUBDE		;
		MOV	E,C		;
		MVI	D,1		;
		POP	B		;
		XRA	A		;
		CALL	WPUTSDOP	;
		RET			;

;ыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыы
; ; РТПГЕДХТБ ПФЛТЩЧБЕФ ДПРПМОЙФЕМШОПЕ ПЛОП Й ЪБРТБЫЙЧБЕФ
; ; УФТПЛЙ ДМС РПЙУЛБ Й ЪБНЕОЩ РТЙ РПНПЭЙ ЧУФТПЕООПЗП ТЕ-
; ; ДБЛФПТБ EDLINE РПМХЮЕООЩЕ УФТПЛЙ ЛПРЙТХАФУС ЧП ЧТЕНЕ-
; ; ИЩЕ ВХЖЕТЩ (BUF_ETALON , BUF_PODM) Б ФБЛЦЕ Ч СЮЕКЛЙ
; ; DL_ETALON Й DL_PODM ЪБОПУСФУС ДМЙОЩ ЬФЙИ УФТПЛ ЬФП
; ; ДМС РПУМЕДХАЭЙИ ПРЕТБГЙК РПЙУЛБ Й ЪБНЕОЩ Ч ПУОПЧОПН
; ; ФЕЛУФПЧПН ВХЖЕТЕ
; ; УЕЗПДОС: 03.12.1992 +++++++ 18:53
;

S_LINE_DL   	SET	20		; ЛПОУФБОФБ ДМЙОЩ

S_LINE_INPUT:	LXI	D,50BH		;ПФЛТЩЧБА ПЛОП ДМС ЧЧПДБ
		LXI	H,220CH		;ЬФБМПООЩИ УФТПЛ
		MVI	A,15H		;
		CALL	ACTIV		;
		CALL	ESCF4		;
		LXI	B,ETALON	;РЕЮБФБА РПСУОЙФЕМШОЩЕ
		LXI	D,101H		;ЧЩТБЦЕОЙС
		XRA	A		;
		CALL	WPUTSDOP	;
		MOV	E,A		;
		INX	B		;
		CALL	WPUTSDOP	;
		LXI	H,STR		;РПДЗПФБЧМЙЧБА ДБООЩЕ ДМС ТЕДБЛФПТБ
		MVI	M,CR		;УФТПЛЙ EDLINE
		LXI	D,801H		;
		MVI	A,S_LINE_DL - 1	;
		PUSH	H		;
		CALL	EDLINE		;
		POP	H		;
		CPI	0EH		;ЧПЪЧТБФ РП F4 ???
		JZ	SEA_EXIT	;ЕУМЙ ДБ ФП ЧЩКФЙ ЙЪ ТЕЦЙНБ РПЙУЛБ
		MOV	A,M		;ЕУМЙ ЧПЪЧТБЭБЕНБС ТЕДБЛФПТПН УФТПЛБ
		CPI	CR		;РХУФБС ФП ЧЩКФЙ ЛБЛ РТЙ ОБЦБФЙЙ F4
		JZ	SEA_EXIT	;
		CALL	COPYSDOP	;ПРТЕДЕМСА ДМЙООХ УФТПЛЙ
		MOV	B,A		;
		STA	DL_ETALON	;УПИТБОЙФШ ДМЙООХ УФТПЛЙ ETALON
		LXI	D,BUF_ETALON	;ХЛБЪБФЕМШ ОБ ВХЖЕТ ДМС РЕТЕОПУБ
		CALL	LIIR		;УФТПЛЙ ЙЪ STR
		MVI	M,CR		;
; рТЙУФХРЙФШ Л ЧЧПДХ УФТПЛЙ ЪБНЕОЩ (ЕУМЙ ПОБ РТПЙЪЧПДЙФУС)
		LXI	D,800H		;ЧЧЕУФЙ У ЛПОУПМЙ УФТПЛХ ЪБНЕОЩ
		MVI	A,S_LINE_DL - 1	;
		PUSH	H		;
		CALL	EDLINE		;
		POP	H		;ЕУМЙ ОБЦБФБ F4 ФП ЧЩИПД ХЪ ТЕЦЙНБ
		CPI	0EH		;
		JZ	SEA_EXIT	;
		CALL	COPYSDOP	;
		MOV	B,A		;
		STA	DL_PODM		;УПИТБОЙН ДМЙООХ РПДНЕОСЕНПК УФТПЛЙ
		LXI	D,BUF_PODM	;ХЛБЪБФЕМЙ ОБ ВХЖЕТ ДМС РЕТЕОПУ
		ORA	A		;ЕУМЙ УФТПЛБ ОЕ РХУФБС ФП РПЙУЛ-ЪБН.
		CNZ	LIIR		;УПИТБОСЕН ЧЧЕДЕООХА УФТПЛХ
		CALL	DEACTI		;
		RET			;

SEA_EXIT:	CALL	DEACTI		;
		CALL	COPYS		;
		POP	H		; ВЕТЕН УМПЧП ЙЪ УФЕЛБ
		RET			; ЧЩИПД ЙЪ ТЕЦЙНБ

BUF_ETALON:	DS	S_LINE_DL	;ВХЖЕТ ДМС ЬФБМПОБ
BUF_PODM:	DS	S_LINE_DL	;ВХЖЕТ ДМС ЪБНЕОСЕНПК УФТПЛЙ

DL_ETALON:	DB	0H		;ДМЙОБ ЬФБМПОПК УФТПЛЙ
DL_PODM:	DB	0H		;ДМЙОБ ЪБНЕОСЕНПК УФТПЛЙ



; ; ======= ху + 7 ====== QUIT =======
PPAQUIT:	LXI	D,50CH
		LXI	H,1A0CH
		MVI	A,15H
		CALL	ACTIV
		CALL	YESNO
		LXI	D,100H
		LXI	B,QUITPPA
		XRA	A
		CALL	WPUTSDOP
		CALL	KEYDELAU
		LDA	NUMBER
		CPI	57		;"ЛМБЧЙЫБ Y"
		CALL	DEACTI
		RNZ
		DI
		CALL	SCREENCLS
		MVI	A,KD_CONST
		LHLD	KEYVEKT
		SHLD	39H		;ЧПУФБОПЧЙФШ ЧЕЛФПТ
		OUT	10H
		INT	0		;

;;ыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыы
; ; РТПГЕДХТБ ПВТБВПФЛЙ ЙОЖПТНБГЙПООПЗП ЧЩЪПЧБ
; ; УЕЗПДОС: 05.01.1992
M_INFO:		LXI	D,080AH		;
		LXI	H,220BH		;
		MVI	A,15H		;
		CALL	ACTIV		;
		CALL	ESCF4		;
		LXI	D,101H		;
		LXI	B,I_SOOB1	;
		CALL	WPUTSDOP	;
		DCR	E		;
		INX	B		;
		CALL	WPUTSDOP	;
		INX	B		;
		PUSH	B		;
		MVI	D,13H		;
		CALL	WPUTSDOP	;
		INR	E		;
		POP	B		;
		CALL	WPUTSDOP	;
		LHLD	ENDTEXT		;
		PUSH	H		;
		LXI	D, - BTEXT -2	;
		DAD	D		;
		LXI	D,0F01H		;
		CALL	HL_PRINT	;
		POP	D		;
		LXI	H,TEXT_LIMIT	;
		CALL	NEG_DE		;
		DAD	D		;
		LXI	D,0F00H		;
		CALL	HL_PRINT	;
		CALL	KEYDELAU	;
		CALL	DEACTI		;
		RET			;
;;ыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыы
HL_PRINT:	PUSH	D		;
		MOV	A,H		;
		CALL	WJHEX		;
		MOV	A,L		;
		CALL	JHEX		;
		POP	D		;
		RET			;

;;ыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыы

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;////////////// ТБВПЮЙЕ СЮЕКЛЙ ТЕДБЛФПТБ ////////////////
OFSET:	DB	0	;УНЕЭЕОЙЕ ПЛОБ ПФОПУЙФ.УФТПЛЙ
CURHY:	DW	0	
CURDY:	DB	0,0,0	;РСФЙЪО. ДЕУ. ЙУМП-ОПНЕТ УФТПЛЙ
CURHX:	DB	0	
CURDX:	DB	0,0	;ДЕУ. ОПНЕТ РПЪЙГЙЙ
POS:	DW	BTEXT+2	
;))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))
DLINNA:		DB	0H	;ОБЮБМШОБС ДМЙООБ УФТПЛЙ
FLAGLINE:	DB	0H	;=0 УФТПЛБ ОЕ КЪНЕОСМБУШ <>0 ЙЪН.

F_SL_BUF:
KORBUF:		DB	0,0,0	;ВХЖЕТ ЛПТЕЛФПТБ
ENDLINE:	DW	0000H	;ЛПТД. ЛПОГБ УФТПЛЙ
ENDTEXT:	DW	BTEXT+4	;БДТЕУ ИЧПУФБ ФЕЛУФБ
MAXDLINNA:	DB	0H	;ОБЙВПМШЫБС ДМЙООБ ТЕДБЛФЙТХЕНПК УФТПЛЙ


;$$$$$$$$$ ВБЪПЧЩЕ РТПГЕДХТЩ $$$$$$$$$
REGENER:	LXI	H,FLAGLINE
		MOV	A,M
		ORA	A
		RZ			;ЧЩИПД ТЕЗЕОЕТБГЙС ОЕ ОХЦОБ
		DCR	M		;УВТПУЙФШ ЖМБЗ РТЙУФХРЙФШ Л ТЕЗЕОЕТБГЙЙ
		DCX	H
		MOV	B,M		;УФБТБС ДМЙООБ УФТПЛЙ
		MOV	C,B		;
		LXI	H,STR
		CALL	COPYSDOP
		SUB	B
		MOV	B,A		;ТБЪОПУФШ
		LHLD	POS
		JZ	NOSDVIG		;ДМЙООЩ УФТПЛ ОЕ ЙЪНЕОЙМЙУШ
		CC	COPUINC		;ДМЙОБ ХНЕОШЫЙМБУШ
; ДМЙООБ ХЧЕМЙЮЙМБУШ
		CNC	COPUDEC		;УДЧЙОХФШ ФЕЛУФ Ч ПУОПЧО.ВХЖЕТЕ
NOSDVIG:	MOV	A,C
		ADD	B
		MOV	B,A
		XCHG
		INR	B
		LXI	H,STR
		CALL	LIIR		;ЧУФБЧЛБ  ОПЧПК УФТПЛЙ
		CALL	COPYS
		STA	DLINNA
		RET
;%%%%%%%%%%%%%% COPUINCSTOP %%%%%%%%%%%
COPUINC:	PUSH	B
		PUSH	D
		PUSH	H
		PUSH	PSW
		MOV	A,B
		MVI	B,0
		DAD	B
		MOV	D,H
		MOV	E,L		;DE---> ПФЛХДБ
		MOV	C,A		;HL --> ЛХДБ
		DCR	B		;B=0FFH
		DAD	B
		PUSH	H
		LHLD	ENDTEXT
		DAD	B
		SHLD	ENDTEXT
		POP	H
		MVI	B,STOPBYTE	
COILOP0:	LDAX	D
		MOV	M,A
		CMP	B
		INX	D
		INX	H
		JNZ	COILOP0
		POP	PSW
		POP	H
		POP	D
		POP	B
		RET
;%%%%%%%%%%%%%% COPUDEC %%%%%%%%%%%
;; HL ---> БДТЕУ ФЕЛХЭЕК УФТПЛЙ Ч ФЕЛУФЕ
;; B  ---> ТБЪОПУФШ НБЦДХ УФБТПК Й ОПЧПК УФТПЛПК
;; C  ---> УФБТБС ДМЙООБ УФТПЛЙ
COPUDEC:	PUSH	B
		PUSH	D
		PUSH	H
		PUSH	PSW
		MOV	A,B
		MVI	B,0
		DAD	B		;DE -> ДП ЛХДБ
		DCX	H
		XCHG
		MOV	C,A
		LHLD	ENDTEXT
		PUSH	H
		DAD	B		;HL -> ЛХДБ
		SHLD	ENDTEXT
		PUSH	H
		LXI	B, -TEXT_LIMIT
		DAD	B
		POP	H
		POP	B		;BC -> ПФЛХДБ
		JNC	COLOOP1
		LXI	B,SOOBF		;ОЕФ РБНСФЙ
		CALL	WARNING
		CALL	COPYS
		XRA	A
		STA	FLAGLINE	;ПВПТЧБФШ ТЕЗЕОЕТБГЙА УФТПЛЙ
		INR	A
		STA	OFSET		;ЗЕОЕТБГЙС ДБМЙОЕЗП РЕТЕИПДБ ДПНПК
		CALL	DOMOY
		POP	PSW		
		POP	H
		POP	D
		POP	B
		POP	PSW		;ЪБВПТ ЙЪ УФЕЛБ ДЧХИ БДТЕУПЧ
		POP	PSW		;Й ==> * REGENER
		RET

COLOOP1:	LDAX	B
		MOV	M,A
		DCX	B
		DCX	H
		MOV	A,C
		CMP	E
		JNZ	COLOOP1
		MOV	A,B
		CMP	D
		JNZ	COLOOP1
		POP	PSW
		POP	H
		POP	D
		POP	B
		RET
;$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$
NARUSHENIE:	LXI	H,FLAGLINE
		MOV	A,M
		ORA	A
		RNZ			;УФТБЛБ ЙУРТПЧМСЕФУС
		INR	M		;ЖМБЗ =1 РЕТЧПЕ ЙУРТБЧМЕОЙЕ
		RET

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

;+-----------[ SERVISE ]--------+

;+------[ CURSOR ]------+
CINV:		PUSH	B	
		PUSH	D	
		PUSH	H	
		PUSH	PSW	
		LHLD	CURSOR	
		XCHG		
		CALL	ABSJDE	
		CALL	ADDRSC	
		MVI	B,0	
		MVI	C,CBEG	;УНЕЭ
		DAD	B	
		MVI	E,RAZM
		MOV	B,E	;ЧЩУПФБ
		MOV	A,D	
		RRC		
		MVI	A,0FH	
		JC	CV2	
		CMA		
CV2:		MOV	C,A	
CV0:		MOV	A,M	
		XRA	C	
		MOV	M,A	
		INR	L	
		DCR	B	
		JNZ	CV0	
		DCR	L	
		MOV	B,E	
		MOV	A,H	
		ADI	20H	
		MOV	H,A	
CV1:		MOV	A,M	
		XRA	C	
		MOV	M,A	
		DCR	L	
		DCR	B	
		JNZ	CV1	
		POP	PSW	
		POP	H	
		POP	D	
		POP	B	
		RET		

;+--[ ТЙУ ЧЕТФ.УФТЕМЛХ ]---+
STL2:		PUSH	D	
		PUSH	PSW	
		MVI	A,3	
		CALL	PUTCXY	
		DCR	B	
		DCR	B	
		INR	A	
ST0:		DCR	E	
		CALL	PUTCXY	
		DCR	B	
		JNZ	ST0	
		DCR	E	
		INR	A	
		CALL	PUTCXY	
		POP	PSW	
		POP	D	
		RET	

;+----[ ТЙУ ЗПТ. УФТЕМЛХ ]----+
PAR1:		PUSH	D	
		PUSH	PSW	
		MVI	A,6	
		CALL	PUTCXY	
		INR	A	
		DCR	B	
		DCR	B	
PA0:		INR	D	
		CALL	PUTCXY	
		DCR	B	
		JNZ	PA0	
		INR	A	
		INR	D	
		CALL	PUTCXY	
		POP	PSW	
		POP	D	
		RET		

;%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
KEYRESET:	MVI	A,1
		STA	SEEK
		RET
;//////// УФБОДБТФОЩЕ РТПГЕДХТЩ //////////
;РТПГЕДХТБ PRSCREEN ТБУРЕЮБФЩЧБЕФ ФЕЛХЭЕЕ УПД ВХЖЕТБ ФЕЛУФБ ДП ЛПОГБ ПЛОБ

PRSCREEN:	CALL	WPUTS1	
		PUSH	PSW	
PRINL3:		LDAX	B	
		INX	B	
		CPI	CR	
		JNZ	PRINL3	
		INX	B
		POP	PSW	
		LDAX	B
		CPI	STOPBYTE
		RZ		;ХИПД ЛПОЕГ ФЕЛУФБ
		DCR	E	
		MOV	A,E
		INR	A
		JNZ	PRSCREEN
		RET
;$$$$$$$$$$$$$$$$$$$$$$$$$$$
PLAY:		PUSH	B	
		PUSH	PSW	
		MVI	A,36H	
		OUT	08H	
		LXI	B,200H	
PLJ0:		MOV	A,C	
		OUT	0BH	
		MOV	A,B	
		OUT	0BH	
		INX	B	
		MOV	A,B	
		CPI	13	
		JNZ	PLJ0	
		MVI	A,36H	
		OUT	08H	
		POP	PSW	
		POP	B	
		RET		
;$$$$$$$$$$$$$$$$$$$$$$$$$
MESS:		LXI	H,0	
		SHLD	WIND1	
		XRA	A
		CALL	WPUTSDOP
		LXI	H,203H	
		SHLD	WIND1	
		RET		
;////////////////////////////
COPYSDOP:	PUSH	B
		PUSH	D
		PUSH	H
		JMP	CODOP
COPYS:		PUSH	B	
		PUSH	D	
		PUSH	H	
		LHLD	POS	
CODOP:		XCHG			;ФПЮЛБ ЧИПДБ ДМС ЛПРЙТПЧЙОЙС РП HL
		LXI	H,STR-1	
		LXI	B,0D00H
COJ0:		LDAX	D	
		INX	H	
		INX	D	
		CMP	B	
		JZ	COQ	
		INR	C	;---//----
		JZ	COQ	;ЪБЭЙФБ ПФ РЕТЕРПМОЕОЙС
		MOV	M,A	
		JMP	COJ0	
COQ:		MOV	M,B	
		MOV	A,C	;ЮЙУМП УЛПРЙТПЧБООЩИ УЙНЧПМПЧ
		POP	H
		POP	D
		POP	B
		RET
;////////////////////
DECX:		PUSH	B	
		PUSH	D	
		PUSH	H	
		PUSH	PSW	
		LXI	H,CURHX	
		XRA	A	
		ORA	M	
		JZ	JINQ	
		DCR	M	
		LXI	B,9999H	
		JMP	JXINM	
;////////////////////
INCX:		PUSH	B	
		PUSH	D	
		PUSH	H	
		PUSH	PSW	
		LXI	H,CURHX	
		INR	M	
		JNZ	JXIN0	
		DCR	M	
		JMP	JINQ	
JXIN0:		LXI	B,100H	
JXINM:		INX	H	
		INX	H	
		MOV	A,M	
		ADD	B	
		DAA		
		MOV	M,A	
		DCX	H	
		MOV	A,M	
		ADC	C	
		DAA		
		MOV	M,A	
		MVI	B,1	
		LXI	D,0E0EH	
		CALL	JDES	
		JMP	JINQ	
;//////////////////////
DECY:		PUSH	B	
		PUSH	D	
		PUSH	H	
		PUSH	PSW	
		LHLD	CURHY	
		MOV	A,H	
		ORA	L	
		JZ	JINQ	
		DCX	H	
		SHLD	CURHY	
		LXI	B,9999H	
		JMP	JIN1	
;////////////////////
INCY:		PUSH	B	
		PUSH	D	
		PUSH	H	
		PUSH	PSW	
		LHLD	CURHY	
		INX	H	
		MOV	A,H	
		ORA	L	
		JZ	JINQ	
		SHLD	CURHY	
		LXI	B,100H	
JIN1:		LXI	H,CURDY+2
		MOV	A,M	
		ADD	B	
		DAA		
		MOV	M,A	
		DCX	H	
		MOV	A,M	
		ADC	C	
		DAA		
		MOV	M,A	
		DCX	H	
		MOV	A,M	
		ADC	C	
		DAA		
		MOV	M,A	
JMAI:		MVI	B,2	
		LXI	D,80EH	
		CALL	JDES	
JINQ:		POP	PSW	
		POP	H	
		POP	D	
		POP	B	
		RET		
;#################### ЧУРПНПЗБФЕМШОЩЕ РТПГЕДХТЩ ###################
;$$$$$$$$$$$$ CLEAR 3 BYTE $$$$$$$$$
CLEAR3:		MVI	D,3
CL00:		MVI	M,0
		DCX	H
		DCR	D
		JNZ	CL00
		INX	H
		RET
;$$$$$$$$$$$$ ESC F4 $$$$$$$$$$$$
ESCF4:		LXI	B,F4ESC
		JMP	YESDOP
;$$$$$$$$$$$$ YES NO $$$$$$$$$$$$
YESNO:		LXI	B,PPAYESNO
YESDOP:		CALL	HLDEWIND
		INR	D
		DCR	E
		CALL	WRITE
		RET
;$$$$$$$$$$$$ WRITE $$$$$$$$$$$$$
WRITE:		LDAX	B
		ORA	A
		INX	B
		RZ
		CALL	PUTCXY
		INR	D
		JMP	WRITE
;$$$$$$$$$$$$ KEYDELAY $$$$$$$$$$
KEYDELAU:	CALL	INKEY
		INR	A
		JZ	KEYDELAU
		DCR	A
		RET
;$$$$$$$$$$ CLS.ASM 30.09.1992 $$$$$$$$$$
SCREENCLS:	IN	3
		MOV	L,A
		LXI	B,0
SCRECLS0:	MVI	H,0A0H
SCRECLS:	MOV	M,B
		INR	H
		MOV	A,H
		CPI	0E0H
		JNZ	SCRECLS
		MOV	A,L
		DCR	L
		OUT	3
		INR	C
		JNZ	SCRECLS0
		RET

;$$$$$$$$$$$$$$$$$$
;РТПГЕДХТЩ SINC Й SDEC РПТФСФ ЧУЕ ТЕЗЙУФТБ ЛТПНЕ BC
;ТЕЪХМШФБФ:    
;SINC ->  ЛПОЕГ ФЕЛУФБ ФП "Z=1"
;SDEC ->  ОБЮБМП ФЕЛУФБ ФП "C=0"

SINC:		LHLD	POS	
		MVI	E,CR	
SI1:		MOV	A,M	
		INX	H	
		CMP	E	
		JNZ	SI1	
		INX	H
		MOV	A,M	
		CPI	STOPBYTE
		RZ
SSM:		SHLD	POS	
		RET		

;//////////////
SDEC:		LHLD	POS	
		MVI	E,CR
		DCX	H
		DCX	H	
SD1:		DCX	H	
		MOV	A,M	
		CMP	E	
		JNZ	SD1	
		INX	H	
		LXI	D, -BTEXT	;ОБЮБМП ФЕЛУФБ Ч ДПРПМОЙФ ЛПДЕ
		XCHG		
		DAD	D	
		XCHG		
		INX	H
		JC	SSM	
		RET		
;%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
;   22.10.1992 ВМПЛ ДБООЩИ
;
;(((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((
;РТПГЕДХТБ JBEG Й ДБООЩЕ ЧЩДЕМЕОЩЕ НОПЗПУЛПВЙЕН ОХЦОЩ ФПМШЛП ОБ ОБЮБМКОПН
;ЪБРХУЛЕ ТЕДБЛФПТБ РПУМЕ ЮЕЗП ПОЙ НПЗХФ ВЩФШ ЪБФЕТФЩ
;ПВЭЙК ПВ'ЕН ОЕОХЦОЩИ ВБКФ: 167H
;РПЕФПНХ ОБ ЬФП НЕУФП ХУФБОБЧМЙЧБЕФУС ВХЖЕТ УФТПЛЙ "STR"

;+---------[ BEGIN ]--------+
		DB	CR	;STOP STOP STOP STOP
STR:		
COPY_RIGHT:
		DB	"(C) 1993 KARAGANDA PRESENT BY PIMENOV PAVEL"
		DB	CR,LF,9," PPA TEXT EDITOR V1.02"
		DB	CR,LF,CR,LF,'$'
ER_ARG:		DB	"ERROR",CR,LF,'$'
;;
;; мПЦОБС ОЕ ЪБЛПДЙТПЧБООБС УФТПЛБ
;;
;;ЛБТБЗБОДБ-1992
;;	DB	32,0EBH,0C1H,0D2H,0C1H,0C7H,0C6H,0CEH
;;	DB	0C4H,0C1H,',1993',32
;;PPA-EDITOR
;;	DB	32,0BDH,0BEH,0BFH,32,'PPA-Editor',32
;;
VERSION:	DB	6,7,' Version 1.02 ',7,8,CR
POD1:		DB	6,7,' 00000/000 ',7,8,CR
		DB	6,7,' Edit ',7,8,CR
		DB	6,7,' *:noname  .txt ',7,8,CR
		DB	15,' 1-Help ',15,' 2-File ',15,' 3-Goto '
		DB	15,'4-Search',15,'5-Servis',15,' 6-Info '
		DB	15,' 7-Quit ',18,CR
		DB	'Message:',CR
		DB	6,7,7,8,CR

;;JCOL:		DB	80,82,84,86,88,92,240,242,244,246,248,252,254,0F8H

JBEG:		LXI	H,MEMU
		MVI	D,20H
		LXI	B,400H
EMGLS:		MOV	M,D
		INX	H
		DCX	B
		MOV	A,B
		ORA	C
		JNZ	EMGLS
		LXI	D,102H	
		LXI	H,3E0FH
		CALL	BORT	
		DCR	L	
		CALL	BORT	
		MVI	D,3	
		DCR	L	
		MVI	B,33
		CALL	PAR1	
		XCHG		
		MVI	B,11	
		CALL	STL2	
		MVI	A,9CH	
		LXI	D,10EH
		CALL	PUTCXY	
		MVI	D,3EH	
		MVI	A,89H	
		CALL	PUTCXY	
		LXI	D,2802H
		LXI	B,VERSION
		CALL	WPUTS1
		INX	B
		LXI	D,50EH	
		CALL	WPUTS1	
		INX	B	
		MVI	D,18H	
		CALL	WPUTS1	
		MVI	D,26H	
		INX	B	
		CALL	WPUTS1	
		INX	B	
		MVI	A,0F8H		; ъБЦЗЕН ЙЪПВТБЦ.
		STA	COLOR+1		;
		XRA	A		;
		STA	FLAGC		;
		LXI	H,3F0FH	
		SHLD	WIND2	
		LXI	H,0	
		SHLD	WIND1	
		MOV	D,H	
		MOV	E,L	
		CALL	INFO	
		INX	B	
		PUSH	B	
		LXI	D,50FH	
		CALL	WPUTS1	
		POP	B	
		MVI	D,36H	
		CALL	WPUTS1	
		LXI	H,AVT0	
		PUSH	H	
		LXI	H,AVT+15
		LXI	B,1210H	
BL8:		LXI	D,70FH	
		CALL	SPPAR	
		MOV	A,M	
		INR	A	
		CALL	PUTCXY	
		DCX	H	
		XTHL		
		MVI	D,25H	
		CALL	SPPAL	
		MOV	A,M	
		INR	A	
		MVI	D,37H	
		CALL	PUTCXY	
		INX	H	
		XTHL		
		DCR	C	
		JNZ	BL8	
		POP	H	
		LXI	H,203H	
		SHLD	WIND1	
		LXI	H,3D0DH	
		SHLD	WIND2	
		RET		

;ЛБТБЗБОДБ-1992
AVT:	DB	31,0EAH,0C0H,0D1H,0C0H,0C6H,0C0H,0CDH
	DB	0C3H,0C0H,',0882',31
;+-------[ INVERS ]-----+
;* ЙОЧЕТФЙТХЕФ ЬЛТБО ПФ *
;* (HL) -ЧЩУПФБ:(D)	*
;* 	-ЫЙТЙОБ:(Е)	*
;+----------------------+
INV:		PUSH	B	
		MOV	B,D	
		MOV	C,E	
		CALL	IV2	
		MOV	A,H	
		ADI	20H	
		MOV	H,A	
		CALL	IV2	
		POP	B	
		RET		
IV2:		PUSH	H	
IV1:		PUSH	H	
IV0:		MOV	A,M	
		CMA		
		MOV	M,A	
		INR	L	
		DCR	E	
		JNZ	IV0	
		POP	H	
		MOV	E,C	
		INR	H	
		DCR	D	
		JNZ	IV1	
		MOV	D,B	
		POP	H	
		RET		

;$$$$$$$$$$$$$$$$  УФБТФПЧЩК ВМПЛ $$$$$$$$$$$$
PPASTART:

;;
;;   пРЙУБОЙЕ ТБВПФЩ У  РБТБНЕФТБНЙ РЕТЕДПЧБЕНЩНЙ РТПЗТБННЕ
;; Ч РТПГЕУУЕ ЕЕ БЛФЙЧЙЪБГЙЙ:
;; 1) ч РПМЕ (0080H)  ОБИПДЙФУС  ЮЙУМП ХЛБЪЩЧБАЭЕЕ ОБ ДМЙОХ
;;    УФТПЛЙ ЧЧЕДЕООПК УТБЪХ РПУМЕ ЙНЕОЙ РПТПЦДБЕНПЗП  РТП-
;;    ГЕУУБ (ЧЛМАЮБС РТПВЕМ НЕЦДХ ЙНЕОЕН Й РБТБНЕФТБНЙ),  Ч
;;    ПУФБМШОПН РТПЗТБННБ ДПМЦОБ БОБМЙЪЙТПЧБФШ  ЬФХ  УФТПЛХ
;;    ЛБЛ  УФТПЛХ РБТБНЕФТПЧ РЕТЕДБООЩИ  РТПЗТБННЕ  ( ЙНЕОБ 
;;    ЖБКМПЧ РПУМЕДПЧБФЕМШОПУФШ ПРГЙК Й ДТ.) УФТПЛБ УМЕДХЕФ
;;    ПФ БДТЕУБ 0081H.
;;
;; 2) Ч РПМЕ 5CH - ОБЦПДЙФУС ТБУВТПУБООБС РП ЮБУФСН ( FCB )
;;    ХЛБЪБООПЗП ЖБКМБ Ч ЛБЮЕУФЧЕ РБТБНЕФТБ.
;;


;;
;; чЩЧЕДЕН УППВЭЕОЙЕ ХЧЕДПНМСАЭЕЕ ПВ БЧФПТУЛПН РТБЧЕ
;;

;;
;;    рЕТЕИПДЙН ОБ БОБМЙЪ РБТБНЕФТПЧ РПУФХРЙЧЫЙИ
;; РТЙ ЪБРХУЛЕ ТЕДБЛФПТБ.
;;
		LXI	D,COPY_RIGHT	;
		MVI	C,9		;
		CALL	SYS_MDOS	;
;;
;;   пУХЭЕУФЧМСЕН ЛПОФТПМШ ЛПОФТПМШОПК УХННЩ ЖБКМБ
;;
		LXI	H,100H		;
		BH_MOV			;
		LXI	D,(BTEXT-7FH) AND 0FFFEH ;
PPA_S_10:
		MOV	A,M		;
		ADD	B		;
		MOV	B,A		;
		INX	H		;
		MOV	A,M		;
		SUB	C		;
		MOV	C,A		;
		INX	H		;
		DCX	D		;
		DCX	D		;
		MOV	A,D		;
		ORA	E		;
		JNZ	PPA_S_10	;
		PUSH	B		;
		POP	H		;
		NOP			;
		NOP			;
		NOP			;
		SHLD	K_SUMMA		;
		LXI	H,80H		;
		MOV	A,M		; РТПЮЙФБЕН ТБЪНЕТ
		CPI	16		; ВХЖЕТБ УФТПЛЙ
		JC	PPA_2_START	; УТБЧОЙН У НБЛУЙНХНПН
;;
;;   пВТБВПФБЕН ЧБТЙБОФ ЛПЗДБ ЖПТНБФ РТЕЧЩЫБЕФ 16 УЙНЧПМПЧ
;;
		LXI	D,ER_ARG	;
		MVI	C,9		;
		CALL	SYS_MDOS	;
		RET			;
PPA_2_START:
		DI
		LHLD	39H
		SHLD	KEYVEKT		;УПИТБОСЕН ЧЕЛФПТ РТЕТЩЧБОЙС
		LXI	SP,STACKSEG	;
		XRA	A		;
		OUT	10H		;
		CALL	SCREENCLS	;
		EI			;
		LXI	H,KEY_INT	;
		SHLD	0039H		;
		CALL	JBEG		;
;;
;;    бОБМЙЪЙТХЕН ЮЙУМП УЙНЧПМПЧ РПУФХРЙЧЫЙИ РТЙ
;; РПТПЦДЕОЙЙ РТПГЕУУБ
;;
		LXI	H,80H		;
		MOV	A,M		;
		CPI	2		;
		JC	EDITING		;
		MOV	E,A		;
		INR	E		;
		MVI	D,0		;
		DAD	D		;
		MVI	M,CR		;

		LXI	H,82H		;
		CALL	COPYSDOP	;
		LXI	H,F_FILE0	;
		CALL	F_DROB_FILE	;
		JNZ	EDITING		; оЕЛПТЕЛФОПЕ ЙНС ЖБКМБ

		MVI	B,15		; рТПЙЪЧПДЙН РЕТЕОПУ
		LXI	H,STR		; ФЕЛУФПЧПК УФТПЛЙ ЧП ЧТЕНЕ-
		LXI	D,F_F_ASCII	; ООЩК ВХЖЕТ ДМС РПУМЕДХАЭЕЗП
		CALL	LIIR		; ЙУРПМШЪПЧБОЙС
;;
;; рЕТЕИПДЙН Л ПФЛТЩФЙА ЖБКМБ
;;
		MVI	A,KD_CONST	;
		OUT	10H		;
		LXI	D,F_FILE0	;
		INT	_OPENC		; рЩФБЕНУС ПФЛТЩФШ ЪБДБООЩК ЖБКМ
		INR	A		; ЕУМЙ ОЕ РПМХЮЙМПУШ ОБ РПЧФПТОЩК
;;
;;   ьФБ "УФТБООБС" РПУМЕДПЧБФЕМШОПУФШ ОЕПВИПДЙНБ
;; ДМС ФПЗП ЮФПВЩ ПУХЭЕУФЧЙФШ РТБЧЙМШОЩК ЧПЪЧТБФ
;; ЙЪ РТПГЕДХТЩ: F_L_DOP (ПОБ РТПРХУЛБЕФ УМПЧП Ч
;; БРБТБФОПН УФЕЛЕ)
;;
		LXI	H,ED_00_RETURN	;
		PUSH	H		;
		JZ	ED_RETURN	;
		CALL	F_L_DOP		;
ED_00_RETURN:
		ORI	1		;
		PUSH	H		;
ED_RETURN:
		POP	H		;
		MVI	A,0		; XRA A  --->> оемшъс
		OUT	10H		;
		LXI	H,F_FILE0	;
		CZ	F_L_NAME	;		
		MVI	D,STOPBYTE	;
		LXI	H,BTEXT+2	;
		MOV	A,M		;
		CMP	D		;ЕУМЙ ЖБКМ РХУФПК УДЕМБФШ 1 РХУФХА
		JNZ	SET_END		;УФТПЛХ
		MVI	M,CR		;
		INX	H		;
		MVI	M,LF		;
		INX	H		;
		MOV	M,D		;
		DCX	H		;
		DCX	H		;
SET_END:				;
CONOOP0:	MOV	A,M		;
		INX	H		;
		CMP	D		;
		JNZ	CONOOP0		;
		DCX	H		;
		SHLD	ENDTEXT		;
		JMP	EDITING		;
;+-------[ INFO ]-------+
;* ЧЩДБЕФ 'РПДЧБМ'	*
;+----------------------+
INFO:		CALL	WPUTS1	
		INR	E
		MVI	D,1	
		INX	B	
		CALL	WPUTS1	
		LXI	H,0A002H
		LXI	D,200CH	
		CALL	INV	
		RET		
;PPA-EDITOR
AVT0:		DB	31,0BCH,0BDH,0BEH,31,'OO@,Dchsnq',31
;+------[ SPPAR ]-------+
;* УДЧЙЗБЕФ ПФ (DE) (B)	*
;* ЬМЕН. УФТПЛЙ Ч РТБЧП *
;+----------------------+
SPPAR:		PUSH	D	
		PUSH	B	
		PUSH	PSW	
		MOV	A,D	
		ADD	B	
		DCR	A	
		MOV	D,A	
SP0:		DCR	D	
		CALL	GETCXY	
		INR	D	
		CALL	PUTCXY	
		DCR	D	
		DCR	B	
		JNZ	SP0	
		POP	PSW	
		POP	B	
		POP	D	
		RET		
;+-----[ SPPAL ]--------+
SPPAL:		PUSH	D	
		PUSH	B	
		PUSH	PSW	
SL0:		INR	D	
		CALL	GETCXY	
		DCR	D	
		CALL	PUTCXY	
		INR	D	
		DCR	B	
		JNZ	SL0	
		POP	PSW	
		POP	B	
		POP	D	
		RET		
;)))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))
	END
H		;
		SHLD	ENDTEXT		;
		JMP	EDITING		;
;+-------[ INFO ]-------+
;* ЧЩДБЕФ 'РПДЧБМ'	*
;+----------------------+
INFO:		CALL	WPUTS1	
		INR	E
		MVI	D,1	
		INX	B	
		CALL	WPUTS1	
		LXI	H,0A002H
		LXI	D,200CH	
		CALL	INV	
		RET		
;PPA-EDITOR
AVT0:		DB	31,0BCH,0BDH,0BEH,31,'OO@,Dchsnq',31
;+------[ SPPAR ]-------+
;* УДЧЙЗБЕФ ПФ (DE) (B)	*
;* ЬМЕН. УФТПЛЙ Ч РТБЧП *
;+----------------------+
SPPAR:		PUSH	D	
		PUSH	B	
		PUSH	PSW	
		MOV	A,D	
		ADD	B	
		DCR	A	
		MOV	D,A	
SP0:		DCR	D	
		CALL	GETCXY	
		INR	D	
		CALL	PUTCXY	
		DCR	D	
		DCR	B	
		JNZ	SP0	
		POP	PSW	
		POP	B	
		POP	D	
		RET		
;+-----[ SPPAL ]--------+
SPPAL:		PUSH	D	
		PUSH	B	
		PUSH	PSW	
SL0:		INR	D	
		CALL	GETCXY	
		DCR	D	
		CALL	PUTCXY	
		INR	D	
		DCR	B	
		JNZ	SL0	
		POP	PSW	
		POP	B	
		POP	D	
		RET		
;))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))ееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееPPAГ !Нё2FНДН	НшН„2џ!Нш!еGЫOж@xКЕюТkyж xКe·КkюКДюК	юК“юК=юКBюК3юКµюКTЙ!fеюКюКІюК~юКъюКУГPюФЕОЙЕ ЖБКМБъБРЙУШ ЖБКМБрПДЗТХЪЛБFile:No file!Out of disk !рТПДПМЦЙФШ ? хРТБЧМЕОЙЕ:   рТПУНПФТрТПДПМЦЙФШ РПЙУЛчщипд - F4ъБНЕОЙФШоЕ ЪБНЕОСФШоБКФЙ:ъБНЕОБ:тБЪНЕТ ЖБКМБ:уЧПВПДОП:H вБКФ Yes/No   F4-Esc  Out of memoryпыйвлб рПЧФПТЙФЕ ЧЧПДчЩКФЙ ЙЪ ТЕДБЛФПТБ ?оПНЕТ УФТПЛЙ:HomeEndBottomTopчЩ ХЧЕТЕОЩ ??? пФЛХДБ:  лХДБ: рТПРЙУОЩЕуФТПЮОЩЕмБФтХУфЕЛХЭЙК ГЧЕФ:фЕЛУФжПОрЕТЕЛПДЙТПЧЛБчЩВПТ РБМЙФТЩNo file EDHLP.PPA26.09 
   ?  њ ™‹ЊЉќђЄЏ©ѓ”уЕХех:Y2Lс2Y|’G}“O:YжВ¤xю?ЪЏ? &?yюЪ› .НCН-Г
юЪЪжВЪxю=Ъє=&>yюЪЖ.$,НCН-НE%-Г
xю<Ъж<&=yюЪт.$$,НC%Н-НEН%-"Tл"R!  "PЇбСБыЙеХ:Yж‡ЖG$-xНzјВ+xН{ЅВ6СбЙХе:YжК¤е!V4бНЇ*WЕХЇxхН®ХzЂ=WН®Сс=В^x·К{Н®СБ:Lw#Хл*PН§*TН§*RН§`iН§лСs#r#"WбСЙ}|ЙЕХНw#В°СБЙуЕХех!V~·К3
5*W+V+^+F+N{Ѓ=_+ХлН>"RН>"TН>"Pл+СЇxх‚Wс"L! Т,е*LТН/Н/гz•”W$гН/гz…„W$|ёгЪ#"WсГ3
ЕХ~Н+В1СБЙgoЙ:YЕХехжZКW`
НХ]
Нл
Нг]
Нг-Х
Н{ЅВsСлХ,
Н{ЅТЃСс-%
НХ]НСлНХ]НСлzјЪђГ3
|’<G}“<OЙ*Rл*TЙ|’жOz¬жКХzжКХ}“GЙЕХеНп%ВабСБ|Ж gzЖ WНп%ВфЙЕХеНа$ВбСБ|Ж gzЖ WНа$ВЙхе*Rz„W{…_бсЙЕХехГ;ЕХехНёуНЇЕХеНеЕ6 #ВGБб@ ВEбСБyжGzТlНЄ|ЪzлХ]НЄСл%|’<OН¬ЇЕP]w,В†Bk$В†%Б|Ж gЇw,ВљBk%ВљГ3
ХЕ> НВ®БСЙЕХехНёуНЇН7yHХежGy=OлН¬+T]%НЭбСb$Н-Г3
ЕХехНёуНЇНХеyHжGy=OН¬T]$НюбСTН-Г3
ЕХеНT]##На!@ В$бСБЙеХЕлНT]лНплАяВ@БСбЙЕХехГcЕХехНёу{ЅК“еХНЇН@ лНаВqСбеХНАН¬T}Ж_лНюСб]Н-Г3
ЕХехГ§ЕХехНёу}»КЪеХНЇлНАялНпВ¶СбХеНАлН¬T}Ж_+НЭбСkН-Г3
ЕХе~#ВгбСБЙЕХе~+ВтбСБЙz/W{/_ЙеНГеН~бЙХННСЙеХЕхНwGН¬л|xхХ& o)))) #СслЪl~Ўwжр¶w,ВD|Ж g-~ЎwЎ¶wВXГ“р~ЎwЎ¶w,Вn|Ж g-~Ўwж¶wВ…сБСбЙЕ & k))))))	 J	БЙх{жozц gсЙ*|)ж`кЙ#ВБ|жg"Й      я  PPA Systems
 ЕХе!Юяу5К		F#NыT]#~В 	5ы4yбСБЙЕХех!Х~·В<	5*Ч{Уж}К-	|УУУУУВ#	>ЉУ !ЦЫжЂВ[	~·К]	5:Що2ЩГ]	6ЇУЫ<К	ю xУЫ<ВЉ	{‚_xGВm	Н9
>я2ЫГ3
=Ъ‹	Н9
!г	s#еЫ ЎW{ёТ°	юАz·{А>_Й№ТД	z·{К»	ЂЂo{ю}ШЁЙю?yИz·:ЪВС	/·{КЧ	ЃЃ_:Щ·{ИЖЂ©ЙP!3
еO:Ы№!ЬВы	~юК
4Й6 >2х	#~=Вщ	5+Г
6 >2х	y+w+ёВ 
~/w!Ю~ёНK
И4O 	:ЫwЙсбСБыЙ>€У :ЩУ>яУ>УЙх0:ЩO<ж±УХВ[
СВT
сЙНёНЇxPi]& -"PНј
НfН„Нј
!x
еюКќ
юК§
юК±
юКґ
Й!P4~»Ш6 Й!P5~<Аs5Й:P!
 "PбЙ!Q6Нш4ВБ
BЙеХхГЬ
еХх:;хНeсжЦ*T$oН
юКю	ВЇНzјТ…жВу
Г
НzјЪи
л"KсСбЙЕХех~Н8#~Н8В~Н8сбСБЙЎЖ0НЙЕНБЕGНUxНUxБЙжю
Ъ^ЖЖ0НЙ·Иg. 
ю	ВtГ…}јР,
ю	К…юИГt|ЅШ},жВ…|ЅШ
ю	К…Гy2OНІgФЇНЛ
kz„g"PНшН„Нш!±еюТаюКSюК`юКюКзюбИюИеЙНоМ`ЙНSДЙ:OЕФНe
юБД„АН;:ЫЕФЇНЛ
БЙ
юИН.*K%ЕФЇНЛ
Б> лНл·Й`i#~+w#юВ0Й`iХ ~ю#В@+~#w+ВHСЙ
юИ!Q5<Й
юИ!Q4<ЙхНрНfсВЌ	>цНЄКНљН“·И=ИГѓН§КНљН“Й*P& лФНС
ЙW>юФНe
ЦКёЇЙН+Д.z·ЙНP!+Eѕ~·#Дј~·Дј  !Ѓcy†O#Вбю»Дј!бBy†O#ВтюЧДј:г	юК0юК®юКљюКџюКЏюКеюКљ:ЫГP:AФНeН;
юА> _Г+Нf:AФНe
юК{НрН.Ф*Pл НС
*Kл&=zј> МkzјРН-ЙНёК€>2GН.НP*DеН¦ЅбКtе~юКЅ*D+6 +6 БЕ>реНeб
юВ%## юНЂб"Dее*P}е&=‚oєВф.Н™>2P.Н-*DDM НС
ЇД™х,с]Д-С БДС
Нё2F:PGН¦К ВPZDMНС
б"DЙг"Dб6#6
ЇГН==ВEН	ИНъНBЙ<·ВPН=ГFНBЙНP*DDM:AНe`iе НҐ6#6
:;·!=БВ¦:P‚oєДUх,:Q‚W]јЬ-> Ф*Pл сДС
ЇхНёсД4Н~НДЙНPН~:Pю
ДЙНPН¦ЅКtНё2FН+*P-}<МйНнНчЙФ  Н НС
,ЙФ:AНe
юМъцЙНPНєДТtННё2F*P},ю
М/НнНчЙФ
 Н\НС
-Й:A·Кq=ФНe!Q
ю	:AВeН>АpНYЇЙ~·К‰5НЪ>Йґ
НЎН„*KН-НfЇ}ЙНV!Q4>яЙ:Aюя№КtФНe!Q
ю	:AКѕ~4ю;ДнА55Н•Й O~4ю;yКШ<жВАНнВРЙ~ђЦw!A~хеЂ<wНбсwЙ"P:AGжИxФНe
ю	А!AН=·КЙ2;:P<юРхНєсГ O~5·ИyжК6НJК!4НЪВ6НJКG4НнцЙе*PлН·yбЙНЪНPН№*Dе:;ЦН>2U
 *DDMНС
ХН¦КЉС{<ВsХС>=2Uб"DЙНнНPНм*Dе:;ЖН
:*DDM:AНe:;НЛ
ХН¦КНС{<В­ХСб"DЙНрН~!Ф6НB*D##~юх*P,,,]&=сМ-ЙНP:;хЇ2;2Ago"BлФzНe
юК)Нн{ю;МeГ*Pc"P*DеНm:;·Д4*DDMб"D
 ЕДl:A·В[Н“Н=Бс·И
НlЙ!;44Й:PG>
ђИGНєВvЙ:;·К НPЇ2;*DеНmDM
 Нlб"DЇ2Ago"B2QНнНЪЙНP:P·КЛюДzНё2FНДЙ*DеН¦	ВжбНё2FЅЇКtН¦КыВжбе"D
Г
б"DеК
НєГ AНUб"DНё2FЙНP*<|µДКt:Pю
Т=ю	ДhН	>
2PЙ*Dе
НєТMВCНUб"DЙx2P
 *DDMН4НlЙхНєНс<2Pю	ВhЙGН¦КЩНєx2P=ИхН¦КН+сГ…сЙ	!>НfНgНЛ
НЛ
НЛ
ѕХНf
·МЅСИХ=К=КЬюАНЅСЙ!	2>НfНg!>џН>ѓНВц>ЎНЧНЛ
НЛ
йН Н ЕНмБНм!	 "TНf
юМЅИхѓ_>Н!	2"T!""RБЕНf
юМЅБИOёКY"ѓ_>Н!"R(!9ННДЅАyH !»е	VOб	^zЖ G·>ТВ >Ъ2І!3#~юКїєЪ¦ёТ¦’ѓwГ¦А`а@2;НЅНЅсНµЙЕ>НfНm ИНЛ
Н„Б:г	ю9НЅЙЕНЛ
НЛ
БНЛ
НЛ
ЙЕНЛ
БЕНЛ
БЕНЛ
БНЛ
Й!>НfНЛ
НЛ
Нf
юМЅИх!*>НfНg НЛ
Б*Ч"ЧЇ2ХVХ x·|Вk}Н@Н„OюК“юК“юВ€x$·А%,ЙyюАx%·А$-ЙНЅСГ1!>НfНg ¦ЇНЛ
>`iНњюхМёсМЅИу>02ЫФНоКПыННЅН`!>H
ѕВя#ВзНvНfНё2FЙН¦Д+ВЯГтФ!JН\
ю0Ъ7ю:Т7жW{zЪ/#¶wВЙ	!!>Нf {ЇНЛ
Ж(v=ВNНЅН4НfбГЁН~!3"D!  "<!@Н\Й!
 "PлН4*DDMНlНДД	ЙН~!/>НfНgлН2>#У!@НІ!Ѓ еНУСН <КnН Нl!НеН„юбКUе!GюВD4
юИН ~юМюМюМ  НЛ
Йх>#УФХН Ѓ ХН T Н СН ЇУбеWб~«w#zюЂК/·В1БсЙюА6 !Ў 6 бН4ГВ>#УЃ Н ЇУ2GНЅНёЙУ !4>НfНg8 НЛ
Н„юНЅКUГ§хЇw#В—сЙ	!>НfНg…НЛ
НЛ
НЛ
!АеНf
юМЅбИе·Ко=КҐГIЇ2H"’! F6ЕН@БxЙ!ФНЪ2 МёИ*Dл*MDMНю#я—е
+|µВЕХЕФН бЃ ХеН СOННаКл БСХлХНюбхЂясPYЪ(ЇУmНСБбНљЇУбНЅНЅ<2;Н4Н~НДН	Йю
Вл#ССБDMбНљ`i"MГd+|µВљЙ<2H!Ф"’Н@GюМёИВДЃ ГбЇУ !1ННВ1>#УЃ ХН СН >#УФН !3ЂФ~ёМ?#ВыЃ еН б·В(+~#юВхЃ Н Г1ёЇУНЇУбНёНЅНЅЙлp#В@+Й! НЪМёИФН !3Ѓ >КХхеН СOНс=КзхНаслЂ СВcяю	 #~юК•ВЉ+~ю
#КҐ6#6
#6"MХН ЇУбС~·)ВЅ>кЖ@ННННЅНЅН`НvН+ННё2FЙУл+~ю
Вк#6mН>#УСГҐ Н4НЛ
>Ђv=ВЙ#~НВЙ!ФЂЫж@ИеЕ~ю Ъ8юАТ8ЦЂw#В*БбЙ!&>НfНg©:Ъg:ЩoеЇ2Ъ2Щ НЛ
! >НњюМЅбИ|2Ъ}2Щ!Ѓ НУД4ВN!Ф  НаЃ >#УН <А:H=И !-ЇУ>НfНgЇ НЛ
Н„юНЅНЅВ@Й$еН•бХ
ю:Вн
Ц@юРw#	Ню А
юКэНrю Й
ю?ИюКю.В> w#В+ЙA:Filename.ppaНН`:¬GO*DA„~юКнѕ#В>ВBЕХеЕНvБбеy+В^DM
 НС
G*Kл!=zјЬ-!QНБ
6 !
ф:­·хК—&>НfНЛ
НЛ
сДЛ
лМЛ
ДЛ
Нf
·КhюКhG:­·КVxюМzКє=К_НЅСХ*DлНюНёюИТMФ	DM:¬WН.Въ:­ЕхН;с=В	Б!=Н-
 НЛ
НрНP
!
|НfЖ НЛ
НgН„юКhГ_№НtК,xюМzКєбСБНЅГ>НЅССС
 *DDMНС
Йх
!6>НfНgУН*DDM  ЕНС
Б!њеН„  юКЅюКЭюАбЇ2;НЅсЙ!;4ЕНС
Б:LWю7> Ь5zюМ„И4Й!;Ї¶М„И5ЕНС
БЙ##>ѕК"DН+Г>НЅНvЙНёЕНЇYБЇНЛ
Й!">НfНg%ЇНЛ
_НЛ
!Ф6>еНњбюК|~юК|НІG2¬„На6 >еНњбюК|НІG2­·ДаНЅЙНЅНёбЙmµpІeІЈrЪ‘°  "€AЃЎрU›XА™µЁx"  Ђlp
Ѕ›r  !>НfНm ‘ЇНЛ
Н„:г	ю9НЅАуНЌ>#*N"9 У Н 
!">НfНg4НЛ
НЛ
ЕНЛ
БНЛ
*MеюМН0С!я—Ню Н0Н„НЅЙХ|Н@}НEСЙ         3       3 !G~·И5+FH!ФНІђG*DКnЬЂФҐyЂGл!ФНаНё2FЙЕХехx 	T]O	е*M	"Mбwё#ВсбСБЙЕХехx 	+лO*Mе	"Mеh	бБТЭmНtНёЇ2G<2;НµсбСБссЙ
w+y»ВЭxєВЭсбСБЙ!G~·А4ЙЕХех*PлНН¬ 	Cz>Ъ/O~©w,В-C|Ж g~©w-В%сбСБЙХх>Н<НВ<<НсСЙХх>Н<НВV<НсСЙ>2ЮЙНС
х
юВpс
юИ{<ВlЙЕх>6У yУxУxюВЌ>6УсБЙ!  "RЇНЛ
!"RЙЕХеГѕЕХе*Dл!У #ёКФКФwГЕpyбСБЙЕХех!AЇ¶КW5™™ГяЕХех!A4Вь5ГW ##~Ђ'w+~‰'wНГWЕХех*<|µКW+"<™™Г>ЕХех*<#|µКW"< !@~Ђ'w+~‰'w+~‰'wНсбСБЙ6 +В^#Й`ГpSНёНyЙ
·ИНГyНн<К„=ЙЫo  & p$|юаВ•}-УВ“Й*D~#»В«#~юИ"DЙ*D+++~»ВБ# Нлл#Ъ¶Й(C) 1993 KARAGANDA PRESENT BY PIMENOV PAVEL
	 PPA TEXT EDITOR V1.02

$ERROR
$ Version 1.02  00000/000  Edit  *:noname  .txt  1-Help  2-File  3-Goto 4-Search5-Servis 6-Info  7-Quit Message:!   r#x±Вї !>НH-НH-!НLлН2>њН>>‰Н(% НС
НС
НС
&НС
>ш2ШЇ2Х!?"T!  "RT]Нb"ЕНС
Б6НС
!v"е!|!Н†"~<Н+г%Нћ"~<7Н#гВ@!б!"R!="TЙкАСАЖАНГА,0882ЕBKНЊ!|Ж gНЊ!БЙее~/w,ВЋ!бY$ВЌ!PбЙФ	Н ! DMЂ2~ЂG#~‘O#zіВ°!Еб   "J!Ђ ~юЪЩ! 	Н Йу*9 "N1 ЇУНЌы!	"9 Н· !Ђ ~юЪ_ 6!‚ НІ!Ѓ НУВ!Ф На>#УЃ Н <!4"еК7"НSцеб> У!Ѓ Мі!3~єВU"6#6
#r++~#єВU"+"MГНС
НС
!  Н}!ЙјЅѕOO@,DchsnqХЕхzЂ=WННВЌ"сБСЙХЕхННВЎ"сБСЙ б>           ================  Version 1.02  Good_bye: JMP $ ================                    зZ~<з       зяЅ™яяЫяз   f f f f f язffB f f f f f f f f  BBffзя f f f f      "fооf"                         DfwwfD            рррррррррррррррррррррррр         яяяяяяяяяяяяяяяяяяяяяяя        $’I$’I$’’I$’I$’I$’I$’I$’  пппппппппппп     Ђ„ДЖжзжЖД„Ђ     !#cgзgc#!    яяяяяяяяяяяя      ҐҐ ҐҐҐҐҐҐ       eeeеmmmmз     ж©"F¦©©¦F„©ж      ппп            зBfзBBBзfB       BBBBBBзfB       BfзBBBBBB         B"п"B           D„п„D                                                                                         BB BBBBBB              ҐҐҐ      ¦¦п¦¦¦п¦¦       	 F¦¦F 	        ©ҐDB"©‰         еЄЄкеF¦¦F             DBBB      "BDDDDDB"       DB"""""BD         ҐfяfҐ           BBзBB        DBBB                 з           BB              €„DB"!        ж©©­нл«©ж       зBBBBBЖFB       п©„DB"!©ж       ж©!!fB"©п       c""пЄ¦fb"       ж©!!о€€€п       ж©©©о€€„F       DDDDB"!©п       ж©©©ж©©©ж       Ж"!!з©©©ж        BB   BB        DBB   BB        !"BD„DB"!         з  з          „DB"!"BD„       BB BB"©©ж       ж€кллл©©ж       ©©©п©©¦F@       оҐҐҐжҐҐҐо       fҐ‰€€€‰Ґf       О¦ҐҐҐҐҐ¦О       пҐ…†Ж†…Ґп       М„„†Ж†…Ґп       GҐ©«€€‰Ґf       ©©©©п©©©©       fBBBBBBBf       ЖЄЄ"""""c       ­Ґ¦¦Ж¦¦Ґ­       пҐ…„„„„„М       ©©©©©йпЇ©       ©©©«лн­©©       F¦©©©©©¦F       М„„„жҐҐҐо      #"жлй©©©©ж       ­ҐҐ¦жҐҐҐо       ж©©"F„©©ж       fBBBBBZЫя       ж©©©©©©©©       @F¦©©©©©©       ¦Їпйй©©©©       ©©©¦FF¦©©       fBBBfҐ™™™       п©‰„DB*©п       fDDDDDDDf       !"BD„€        f"""""""f              ©¦F@   я                         "@B     еЄЄж"Ж          кҐҐҐ¦Ж„„Њ       ж©€€©ж          еЄЄЄ¦f""b       ж©€п©ж          ЖDDDЖDEeb     ЖЄ"жЄЄЄе          ­ҐҐҐе¦„„Њ       fBBBBF BB     F¦¦""""b ""       ­Ґ¦Ж¦Ґ„„Њ       fBBBBBBBF       ййййй®          ҐҐҐҐҐж          ж©©©©ж        М„„жҐҐҐо        c""жЄЄЄе          М„„Ґек          ж©bД©ж          beDDоDD@        еЄЄЄЄЄ          @F¦©©©          ¦пйй©©          ©¦FF¦©        Ж"!з©©©©          пҐDBЄп          #BBBDBBB#       BBBBBBBBB       ДBBB"BBBД                я    я             ] » ] » ] » ] » рррррррр’I$’I$’I$’I$’I$’BBBBBBBBBBBBBBBBBBBBBBBООBBBBBBBBBBBBBОBBОBBBBBB$$$$$$$¬¬$$$$$$$$$$$$$$оо       BBBBBBОBBО      $$$$$$¬  ¬$$$$$$$$$$$$$$$$$$$$$$$$$$$$¬  о            о  ¬$$$$$$       оо$$$$$$$      ОBBОBBBBBBBBBBBBBОО              ssBBBBBBB       яяBBBBBBBBBBBBBBяя       BBBBBBBssBBBBBBB       яя       BBBBBBBяяBBBBBBBBBBBBBsBBsBBBBBB$$$$$$$55$$$$$$$      w5$$$$$$$$$$$$5w            я  Ѕ$$$$$$$$$$$$Ѕ  я      $$$$$$55$$$$$$      я  я      $$$$$$Ѕ  Ѕ$$$$$$      я  яBBBBBB       яя$$$$$$$BBBBBBя  я      $$$$$$$яя              ww$$$$$$$      sBBsBBBBBBBBBBBBsBBs      $$$$$$$ww       $$$$$$$ЅЅ$$$$$$$BBBBBBя  яBBBBBB       ООBBBBBBBBBBBBBBss                                                                                                                                                                                                                                                                                                        "T0pшp0T"  ZfҐЫз з зЫҐfZ  ЂD**DЂ      ЄййнйЄ          еЄЄж"Ж          ж©©©©о€ж!     !пЄЄЄЄЄ        	©п¦¦¦¦F          ж©€п©ж        BBBзЫЫЫз          М„„…Ґп          ©¦FF¦©          ©­нл«©          ©­нл«© F       ­¦ЖЖ¦­          Ґeeec#          ©©йпЇ©          ©©©п©©          ж©©©©ж          ©©©©©п          «¦жЄЄз        М„„жҐҐҐо          ж©€€©ж          BBBBГз        ж!!з©©©©          ййжжйй          оҐҐжҐо          оҐҐж„М          нллн©©          ж©!b©ж          пййййй          ж©!c©ж        !пййййй          !!з©©©          feefLМ          ЄйййнйййЄ       ©©©п©©¦F@       оҐҐҐж„…Ґп     !пЄЄЄЄЄЄЄЄ     	©п¦¦¦¦¦¦¦f       пҐ…†Ж†…Ґп       fBBзЫЫЫЫз       М„„„„„…Ґп       ©©©¦FF¦©©       ©©­нл«©©©       ©©­нл«©©©F     ­Ґ¦¦Ж¦¦Ґ­       ©ҐҐҐҐҐec#       ©©©©©йпЇ©       ©©©©п©©©©       F¦©©©©©¦F       ©©©©©©©©п       «Є¦fжЄЄЄз       М„„„жҐҐҐо       fҐ‰€€€‰Ґf       fBBBBBZЫя       ж!!!з©©©©       йййжFжййй       оҐҐҐжҐҐҐо       оҐҐҐж„„„М       нлллн©©©©       ж©!!f!!©ж       пйййййййй       ЖЄ!!g!!ЄЖ     !пйййййййй       !!!!з©©©©       feeefDDLМ   

 PPA Soft  /* (C) 30.3.1993 Karaganda written by PIMENOV PAVEL OBJ: 100H-337FH ASM: 116 K_byte Link: 16:32:12 30.03.1993 */    ©¦FF¦©          ©­нл«©          ©­нл«© F       ­¦ЖЖ¦­          Ґeeec#          ©©йпЇ©          ©©©п©©          ж©©©©ж          ©©©©©п          «¦жЄЄз        М„„жҐҐҐо          ж©€€©ж          BBBBГз        ж!!з©©©©          ййжжйй          оҐҐжҐо          оҐҐж„М          нллн©©          ж©!b©ж          пййййй          ж©!c©ж        !пййййй          !!з©©©          feefLМ      ееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееее	Title	EXT.ASM
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;	Header - ЖБКМ УПДЕТЦЙФ ПРЙУБОЙЕ ЧЩИПДПЧ ОБ ЧУЕ 	;;
;; ЧОЕЫОЙЕ РТПГЕДХТЩ.					;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

;;///////////// KD.ASM - дТБКЧЕТ ЛМБЧЙБФХТЩ //////////////

	External BEEP	; эЕМЮЕЛ.
	External IN_KEY	; ЧЪСФШ ЛПД ЙЪ ВХЖЕТБ
	External KEY_RESET; УВТПУ ЛМБЧЙБФХТЩ
	External KEY_DELAY; пЦЙДБЕФ ОБЦБФЙС.

	External KEY_INT; ХЛБЪБФЕМШ ДТБКЧЕТ

	External FLAGC	; ЖМБЗ ГЧЕФПЗЕОЕТБФПТБ
	External COLOR	; ЛПД ГЧЕФПЧПК РБМЙФТЩ
	External RUSLAT	; УФБФХУ РП БМЖБЧЙФХ
	External SMALL	; УФБФХУ РП ТЕЗЙУФТХ
	External KEY_KOD; ДЙОБНЙЮЕУЛЙК ЛПД ЛМБЧЙЫ
	External SEEK	; ХЛБЪБФЕМШ ЪБРПМОЕОЙС
	External KEY_NUM; БРБТБФОЩК ОПНЕТ ЛМБЧЙЫЙ

;;//////// WD.ASM - дТБКЧЕТ ПЛПООПЗП ЙОФЕТЖЕКУБ //////////

;========= ПУОПЧОБС ФБВМЙГБ РЕТЕИПДПЧ ==========
	External GETC	;ЮФЕОЙЕ УЙНЧПМБ -//-
	External ACTIV	;ПФЛТЩФЙЕ ПЛОБ (DE),(HL),Б-ЖМБЗ
	External DEACTI  ;ЪБЛТЩФЙЕ ПЛОБ
	External BORT	;ОБТЙУПЧБФШ ТБНЛХ
	External HOME	;ПФЮЙУФЛБ ПЛОБ
	External SCROL1	;УЛТПММЙОЗ ПЛОБ ЧЧЕТИ
	External SCROL2	;--//-- ЧОЙЪ
;	External SCROL3	;--//-- ЧРТБЧП (ОБ 2 УЙНЧПМБ)
;	External SCROL4	;--//-- ЧМЕЧП --//--
;;
;========== ДПРПМОЙФЕМШОБС ФБВМЙГБ РЕТЕИПДПЧ ==========
;ТЕБМЙЪХЕФ ФЕЦЕ ЖХОЛГЙЙ ОП ЙУРПМШЪХАФ БВУПМАФОЩЕ ЛППТДЙОБФЩ
;;
	External PUTCXY	
	External GETCXY	
	External RAMKA	;ЖМБЗ РЕТЕДПЧБФШ ОЕ ОХЦОП
	External TEN	;
	External CLS	
	External SCRN	
	External SCRV	
;	External SCRP	
;	External SCRL	
	External ABS_DE
	External LIIR
	External LDIR
	External HL_DE_WIND
	External HL_SUB_DE
	External ADDREM
	External ADDRSC	

;______________ ТБВПЮЙЕ СЮЕКЛЙ ________________
	External CURSOR
	External WIND1
	External WIND2
	External NUM
	External BUF_SEK
	External FLAGW

;___________ ЙОУФБМСГЙПООЩЕ ЛТОУФБОФЩ __________

	External BUF_ZISE  ; 2 ВБКФБ РПЛБЪЩЧ ТБЪНЕТ ВХЖЕТБ.
	External BUF_BEGIN ;2 ВБКФБ ХЛБЪЩЧБАЭЙЕ ОБ ОБЮБМП
			   ; ВХЖЕТБ ПЛПО.
	External W_ZG	 ; 2 ВБКФБ ХЛБЪЩЧ ОБЮБМП ЪОБЛП ЗЕО.
	External W_EMUL_TXT
			 ; 2 ВБКФБ ХЛБЪЩЧ ОБ ПВМБУФШ ЬНХМ-
			 ; СГЙЙ ФЕЛУФПЧПЗП ЬЛТБОБ ( 1лВБКФ)
	External STACK_SEGMENT;
			 ; ХЛБЪБФЕМШ ЧЕТИХЫЛЙ УФЕЛБ.
	External BUF_DISK; ХЛБЪБФЕМШ ОБ ВХЖЕТ.

ЙЪХЕФ ФЕЦЕ ЖХОЛГЙЙ ОП ЙУРПМШЪХАФ БВУПМАФОЩЕ ЛППТДЙОБФЩ
;;
	External PUTCXY	
	External GETCXY	
	External RAMKA	;ЖМБЗ РЕТЕДПЧБФШ ОЕ ОХЦОП
	External TEN	;
	External CLS	
	External SCRN	
	External SCRV	
;	External SCRP	
;	External SCRL	
	External ABS_DE
	External LIIR
	External LDIR
	External HL_DE_WIND
	External HL_SUB_DE
	External ADDREM
	External ADDRSC	

;______________ ТБВПЮЙЕ СЮЕКЛЙ ________________
	External CURSOR
	External WIND1
	External WIND2
	External NUM
	External BUF_SEK
	External FLAGW

;___________ ЙОУФБМСГЙПООЩЕ ЛТОУФБОФЩ __________

	External BUF_ZISE  ; 2 ВБКФБ РПЛБЪЩЧ ТБЪНЕТ ВХЖЕТБ.
	External BUF_BEGIN ;2 ВБКФБ ХЛБЪЩЧБАЭЙЕ ОБ ОБЮБМП
			   ; ВХЖЕТБ ПЛПО.
	External W_ZG	 ; 2 ВБКФБ ХЛБЪЩЧ ОБЮБМП ЪОБЛП ЗЕО.
	Exterееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееее;;;;;; PPA Soft Systems ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;    Compiling and linking object moduls for DE.COM    ;;
;;;;;;;;;;;;; 5.4.1993 ;;;;;;;;; Is problems ;;;;;;;;;;;;;
M80 DE=DE.ASM
L80 DE,KEY,DEADD,DE/N/E
SID DE.COM

ееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееL80 INSTAL,DE,SERV,KD,WD,KEY,ZG,START,DE/N/E
SID DE.COM

ееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееM80 P=P.ASM
L80 P,P/N/E
SID P.COM

ееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееее;; Compiling and linking programm: RD.ASM
;; 5.1.1993 //////// PPA Systems ////////
M80 RD=RD.ASM
L80 RD,RD/N/E
SID RD.COM
ееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееM80 PPA=PPA.ASM
L80 PPA,ZG,PPA/N/E
SID PPA.COM

ееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееее;;
;;   Header - file   MACRO.PPA:
;;   "уФБОДБТФОЩК ЖБКМ" ДПРПМОЙФЕМШОЩИ НБЛТПРПДУФБОПЧПЛ
;;   ХРТПЭБАЭЙИ ОБРЙУБОЙЕ РПДРТПЗТБНН Ч УТЕДЕ нБЛТПБУУ-
;;   ЕНВМЕТБ M80.COM
;;  //////////////////////////////////////////////////
;;     PPA Soft Systems   Instal  3.3.1993  чФПТОЙЛ.
;;  //////////////////////////////////////////////////

;;
;;=========================================================
;;	LOOP -  ЛПНБОДБ ПТЗБОЙЪБГЙЙ ГЙЛМЙЮОЩИ РПУМЕДПЧ-
;;		БФЕМШОПУФЕК  РП ЪБДБООПНХ ТЕЗЙУФТХ.
;;
LOOP	macro	REG,ADRESS	;
		DCR	REG	;
		JNZ	ADRESS	;
	endm			;

;;=========================================================
;;	RG_PUSH - лПНБОДБ ЪБЗТХЪЛЙ ХЛБЪБООЩИ ТЕЗЙУФТПЧ
;;	Ч УФЕЛ.
;;	(ОЕ ТБЪТБВПФБОП)

;;
;;=========================================================
;;	INT - ЛПНБОДБ ПТЗБОЙЪБГЙЙ УЙУФЕНОЩИ ЧЩЪПЧПЧ Ч
;;	ПРЕТБГЙПООПК УЙУФЕНЕ CP/M ( нЙЛТП дПУ ).
;;

INT	Macro	SYS_NUM		;
		MVI	C,SYS_NUM	;
		CALL	0005H		;
	Endm			;
;;
;;=========================================================
;;	BH_MOV - лПНБОДБ РЕТЕУЩМЛЙ УППФЧЕФУФЧХАЭЙИ ТЕЗЙУФТ-
;;	ПЧ РБТЩ HL Ч РБТХ BC.
;;
BH_MOV	Macro			;
		MOV	B,H	;
		MOV	C,L	;
	Endm			;
;;
;;=========================================================
;;	HB_MOV - рЕТЕОПУ РБТЩ BC Ч РБТХ HL.
;;
HB_MOV	Macro			;
		MOV	H,B	;
		MOV	L,C	;
	Endm			;
;;
;;=========================================================
;;	BD_MOV - рЕТЕОПУ РБТЩ DE Ч РБТХ BC.
;;
BD_MOV	Macro			;
		MOV	B,D	;
		MOV	C,E	;
	Endm			;
;;
;;=========================================================
;;	DB_MOV - рЕТЕОПУ РБТЩ BC Ч РБТХ DE.
;;
DB_MOV	Macro			;
		MOV	D,B	;
		MOV	E,C	;
	Endm			;

H - лПНБОДБ ЪБЗТХЪЛЙ ХЛБЪБООЩИ ТЕЗЙУФТПЧ
;;	Ч УФЕЛ.
;;	(ОЕ ТБЪТБВПФБОП)

;;
;;=========================================================
;;	INT - ЛПНБОДБ ПТЗБОЙЪБГЙЙ УЙУФЕНОЩИ ЧЩЪПЧПЧ Ч
;;	ПРЕТБГЙПООПК УЙУФЕНЕ CP/M ( нЙЛТП дПУ ).
;;

INT	Macro	SYS_NUM		;
		MVI	C,SYS_NUM	;
		CALL	0005H		;
	Endm			;
;;
;;=========================================================
;;	BH_M;;
;;   Header - file   MACRO.PPA:
;;   "уФБОДБТФОЩК ЖБКМ" ДПРПМОЙФЕМШОЩИ НБЛТПРПДУФБОПЧПЛ
;;   ХРТПЭБАЭЙИ ОБРЙУБОЙЕ РПДРТПЗТБНН Ч УТЕДЕ нБЛТПБУУ-
;;   ЕНВМЕТБ M80.COM
;;  //////////////////////////////////////////////////
;;     PPA Soft Systems   Instal  3.3.1993  чФПТОЙЛ.
;;  //////////////////////////////////////////////////

;;
;;=========================================================
;;	LOOP -  ЛПНБОДБ ПТЗБОЙЪБГЙЙ ГЙЛМЙЮОЩИ РПУМЕДПЧ-
;;		БФЕМШОПУФЕК  РП ЪБДБООПНХ ТЕЗЙУФТХ.
;;
LOOP	macro	REG,ADRESS	;
		DCR	REG	;
		JNZ	ADRESS	;
	endm			;

;;=========================================================
;;	RG_PUSH - лПНБОДБ ЪБЗТХЪЛЙ ХЛБЪБООЩИ ТЕЗЙУФТПЧ
;;	Ч УФЕЛ.
;;	(ОЕ ТБЪТБВПФБОП)

;;
;;=========================================================
;;	INT - ЛПНБОДБ ПТЗБОЙЪБГЙЙ УЙУФЕНОЩИ ЧЩЪПЧПЧ Ч
;;	ПРЕТБГЙПООПК УЙУФЕНЕ CP/M ( нЙЛТП дПУ ).
;;

INT	Macro	SYS_NUM		;
		MVI	C,SYS_NUM	;
		CALL	0005H		;
	Endm			;
;;
;;=========================================================
;;	BH_MOV - лПНБОДБ РЕТЕУЩМЛЙ УППФЧЕФУФЧХАЭЙИ ТЕЗЙУФТ-
;;	ПЧ РБТЩ HL Ч РБТХ BC.
;;
BH_MOV	Macro			;
		MOV	B,H	;
		MOV	C,L	;
	Endm			;
;;
;;=========================================================
;;	HB_MOV - рЕТЕОПУ РБТЩ BC Ч РБТХ HL.
;;
HB_MOV	Macro			;
		MOV	H,B	;
		MOV	L,C	;
	Endm			;
;;
;;=========================================================
;;	BD_MOV - рЕТЕОПУ РБТЩ DE Ч РБТХ BC.
;;
BD_MOV	Macro			;
		MOV	B,D	;
		MOV	C,E	;
	Endm			;
;;
;;=========================================================
;;	DB_MOV - рЕТЕОПУ РБТЩ BC Ч РБТХ DE.
;;
DB_MOV	Macro			;
		MOV	D,B	;
		MOV	E,C	;
	Endm			;
;;
;;   Header - file   EDEQU.ASM  :
;;  уПДЕТЦЙФ ЧУЕ ОЕПВИПДЙНЩЕ ЛПОУФБОФЩ ЛБЛ ДМС ТБВПФЩ ЬЛТБООЩИ
;;  РПДРТПЗТБНН ФБЛ ЦЕ УПДЕТЦЙФ РБЛЕФ ПРТЕДЕМЕОЙК ОЕПВИПДЙНЩИ
;;  ДМС ТБВПФЩ У ДЙУЛПЧЩН ОБЛПРЙФЕМЕН
;;    УЕЗПДОС: 17.12.1992З. ++++ 16:47 +++++ ЮЕФЧЕТЗ
;;				/* PPA Systems */
STOP_BYTE	EQU 1AH		;ЙДЕОФЙЖЕЛБФПТ "ЛПОЕГ ФЕЛУФБ"
KD_CONST	EQU 23H		;ЛПОУФБОФБ ПВМБУФЙ нЙЛТПдпу ОБ лд.
;;ыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыы
SYS_MDOS	EQU 5	; system point CP/M
SECSIZ		EQU 80H	; дМЙООБ ЪБРЙУЙ Ч CP/M
CR		EQU 0DH ; лПОЕГ УФТПЛЙ
LF		EQU 0AH	; рЕТЕЧПД УФТПЛЙ
;;ыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыы
DR_OFSET	EQU 0	; уНЕЭЕОЙЕ ОПНЕТБ ОБЛПРЙФЕМС Ч ВМПЛЕ FCB
NM_OFSET	EQU 1	; уНЕЭЕОЙЕ ЙНЕОЙ ЖБКМБ Ч ВМПЛЕ FCB
ET_OFSET	EQU 9	; уНЕЭЕОЙЕ ТБУЫЙТЕОЙС Ч ВМПЛЕ FCB
EX_OFSET	EQU 12	; уНЕЭЕОЙЕ ОПНЕТБ ФЕЛХЭЕЗП ЬЛУФЕОФБ
RC_OFSET	EQU 15	; уНЕЭЕОЙЕ ЮЙУМБ ЪБРЙУЕК ДБООПЗП ЬЛУФЕОФБ
CR_OFSET	EQU 32	; уНЕЭЕОЙЕ ОПНЕТБ ФЕЛХЭЕК ЪБРЙУЙ
;;ыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыы
_CONIN		EQU 1	; ЮФЕОЙЕ УЙНЧПМБ У ЛПОУПМЙ
_CONOUT		EQU 2	; ЪБРЙУШ УЙНЧПМБ Ч РПФПЛ ЛПОУПМЙ
_LSTOUT		EQU 5	; ЧЩЧПД УЙНЧПМБ ОБ РЕЮБФШ
_DCONIO		EQU 6	; ПВНЕО У ЛПОУПМША
_PSTRING	EQU 9	; ЪБРЙУШ РПУМЕДПЧБФЕМШОПУФЙ
			; Ч РПФПЛ ЛПОУПМЙ  (terminated by '$')
_GETLIN		EQU 10	; РТЙЕН Ч ВХЖЕТ ЛПОУПМЙ
_CSTAT		EQU 11	; РПМХЮЙФШ УФБФХУ ЛПОУПМЙ
_DISK_RESET	EQU 13	; УВТПУ ДЙУЛПЧПК РПДУЙУФЕНЩ
_SELECT		EQU 14	; ЧЩВПТ ДЙУЛБ
_OPENC		EQU 15	; ПФЛТЩФЙЕ ЖБКМБ
_CLOSEC		EQU 16	; ЪБЛТЩФЙЕ ЖБКМБ
_SEARCH_1	EQU 17	; РПЙУЛ РЕТЧПЗП ЧИПДБ
_SEARCH_N	EQU 18	; РПЙУЛ УМЕДХАЭЕЗП ЧИПДБ
_DELC		EQU 19	; ХДБМЕОЙЕ ЖБКМБ
_READS		EQU 20	; ЮЙФБФШ ФЕЛХЭАА ЪБРЙУШ Ч DMA
_WRITS		EQU 21	; ЪБРЙУБФШ ---//----///----
_GREATS		EQU 22	; УПЪДБФШ ЖБКМ ОБ ДЙУЛЕ
_RENC		EQU 23	; РЕТЕЙНЕОПЧБФШ ЖБКМ
_IN_DISK	EQU 25	; РПМХЮЙФШ ФЕЛХЭЙК ДЙУЛ
_SET_DMA	EQU 26	; ХУФБОПЧЙФШ DMA
_GSUSER		EQU 32	; РПМХЮЕОЙЕ/ХУФБОПЧЛБ ЛПДБ РПМШЪПЧ.
_READR		EQU 33	; РТПЙЪЧПМШОПЕ ЮФЕОЙЕ
_WRITR		EQU 34	; РТПЙЪЧПМШОБС ЪБРЙУШ
_SFSIZC		EQU 35	; ПРТЕДЕМЕОЙЕ ТБЪНЕТБ ЖБКМБ
_SRRECC		EQU 36	; ХУФБОПЧЛБ ХЛБЪБФЕМС ДМС РТПЙЪЧПМШОПЗП
			; ПВНЕОБ У ЖБЙМПН
_SETMUL		EQU 44	; ХУФБОПЧЛБ НХМШФЙУЕЛФПТОПК ПВТБВПФЛЙ

	Title	EXT.ASM
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;	Header - ЖБКМ УПДЕТЦЙФ ПРЙУБОЙЕ ЧЩИПДПЧ ОБ ЧУЕ 	;;
;; ЧОЕЫОЙЕ РТПГЕДХТЩ.					;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

;;///////////// KD.ASM - дТБКЧЕТ ЛМБЧЙБФХТЩ //////////////

	External BEEP	; эЕМЮЕЛ.
	External IN_KEY	; ЧЪСФШ ЛПД ЙЪ ВХЖЕТБ
	External KEY_RESET; УВТПУ ЛМБЧЙБФХТЩ
	External KEY_DELAY; пЦЙДБЕФ ОБЦБФЙС.

	External KEY_INT; ХЛБЪБФЕМШ ДТБКЧЕТ

	External FLAGC	; ЖМБЗ ГЧЕФПЗЕОЕТБФПТБ
	External COLOR	; ЛПД ГЧЕФПЧПК РБМЙФТЩ
	External RUSLAT	; УФБФХУ РП БМЖБЧЙФХ
	External SMALL	; УФБФХУ РП ТЕЗЙУФТХ
	External KEY_KOD; ДЙОБНЙЮЕУЛЙК ЛПД ЛМБЧЙЫ
	External SEEK	; ХЛБЪБФЕМШ ЪБРПМОЕОЙС
	External KEY_NUM; БРБТБФОЩК ОПНЕТ ЛМБЧЙЫЙ

;;//////// WD.ASM - дТБКЧЕТ ПЛПООПЗП ЙОФЕТЖЕКУБ //////////

;========= ПУОПЧОБС ФБВМЙГБ РЕТЕИПДПЧ ==========
	External GETC	;ЮФЕОЙЕ УЙНЧПМБ -//-
	External ACTIV	;ПФЛТЩФЙЕ ПЛОБ (DE),(HL),Б-ЖМБЗ
	External DEACTI  ;ЪБЛТЩФЙЕ ПЛОБ
	External BORT	;ОБТЙУПЧБФШ ТБНЛХ
	External HOME	;ПФЮЙУФЛБ ПЛОБ
	External SCROL1	;УЛТПММЙОЗ ПЛОБ ЧЧЕТИ
	External SCROL2	;--//-- ЧОЙЪ
;	External SCROL3	;--//-- ЧРТБЧП (ОБ 2 УЙНЧПМБ)
;	External SCROL4	;--//-- ЧМЕЧП --//--
;;
;========== ДПРПМОЙФЕМШОБС ФБВМЙГБ РЕТЕИПДПЧ ==========
;ТЕБМЙЪХЕФ ФЕЦЕ ЖХОЛГЙЙ ОП ЙУРПМШЪХАФ БВУПМАФОЩЕ ЛППТДЙОБФЩ
;;
	External PUTCXY	
	External GETCXY	
	External RAMKA	;ЖМБЗ РЕТЕДПЧБФШ ОЕ ОХЦОП
	External TEN	;
	External CLS	
	External SCRN	
	External SCRV	
;	External SCRP	
;	External SCRL	
	External ABS_DE
	External LIIR
	External LDIR
	External HL_DE_WIND
	External HL_SUB_DE
	External ADDREM
	External ADDRSC	

;______________ ТБВПЮЙЕ СЮЕКЛЙ ________________
	External CURSOR
	External WIND1
	External WIND2
	External NUM
	External BUF_SEK
	External FLAGW

;___________ ЙОУФБМСГЙПООЩЕ ЛТОУФБОФЩ __________

	External BUF_ZISE  ; 2 ВБКФБ РПЛБЪЩЧ ТБЪНЕТ ВХЖЕТБ.
	External BUF_BEGIN ;2 ВБКФБ ХЛБЪЩЧБАЭЙЕ ОБ ОБЮБМП
			   ; ВХЖЕТБ ПЛПО.
	External W_ZG	 ; 2 ВБКФБ ХЛБЪЩЧ ОБЮБМП ЪОБЛП ЗЕО.
	External W_EMUL_TXT
			 ; 2 ВБКФБ ХЛБЪЩЧ ОБ ПВМБУФШ ЬНХМ-
			 ; СГЙЙ ФЕЛУФПЧПЗП ЬЛТБОБ ( 1лВБКФ)
	External STACK_SEGMENT;
			 ; ХЛБЪБФЕМШ ЧЕТИХЫЛЙ УФЕЛБ.
	External BUF_DISK; ХЛБЪБФЕМШ ОБ ВХЖЕТ.

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;		   Title    DDR.PPA
;;      (C) 1993 лБТБЗБОДБ Copyright  by  рЙНЕОПЧ рБЫБ
;;      Header  -  ЖБКМ  ПРТЕДЕМЕОЙС  ЛПОУФБОФ ДМС РТПЗТБНН
;; ОБ  БУУЕНВМЕТЕ  У  ПТЕОФБГЙЕК ОБ ТБВПФХ У ОБЛПРЙФЕМЕН ОБ
;; ЗЙВЛЙИ НБЗОЙФОЩИ ДЙУЛБИ (ознд) УРЕГЙБМШОП ДМС чЕЛФПТ-06г
;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

DS_STATUS	EQU 1BH	; ТЕЗЙУФТ УФБФХУБ EQU COM
DS_COM		EQU 1BH	; ТЕЗЙУФТ ЛПНБОД Й УФБФХУБ
DS_TRACK	EQU 1AH	; ТЕЗЙУФТ ДПТПЦЛЙ
DS_SECTOR	EQU 19H	; ТЕЗЙУФТ УЕЛФПТБ
DS_DATA		EQU 18H	; ТЕЗЙУФТ ДБООЩИ
DS_MOTOR	EQU 1CH	; ЪБРХУЛ ДЧЙЗБФЕМС


БЪНЕТ ВХЖЕТБ.
	External BUF_BEGIN ;2 ВБКФБ ХЛБЪЩЧБАЭЙЕ ОБ ОБЮБМП
			   ; ВХЖЕТБ ПЛПО.
	External W_ZG	 ; 2 ВБКФБ ХЛБЪЩЧ ОБЮБМП ЪОБЛП ЗЕО.
	External W_EMUL_TXT
			 ; 2 ВБКФБ ХЛБЪЩЧ ОБ ПВМБУФШ ЬНХМ-
			 ; СГЙЙ ФЕЛУФПЧПЗП ЬЛТБОБ ( 1лВБКФ)
	External STACK_SEGMENT;
			 ; ХЛБЪБФЕМШ ЧЕТИХЫЛЙ УФЕЛБ.
	External BUF_DISK; ХЛБЪБФЕМШ ОБ ВХЖЕТ.

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееее/*********************************************************/
/* рТПЗТБННБ ЖПТНЙТХЕФ БУУЕНВМЕТПЧУЛЙК ДБНР ЙЪ ДЧПЙЮОПЗП */
/* ЖБКМБ ( ВМПЛ ДБООЩИ, ЪОБЛПЗЕОЕТБФПТ,Й Ф.Д.)		 */
/*********************************************************/
/*==================== Public domain =====================
   (C) лБТБЗБОДБ 18.05.1993      PPA Soft Systems
  _______________________________________________________
    470075         З. лБТБЗБОДБ
	ХМ. 40 МЕФ лБЪБИУФБОБ Д. 39/3 ЛЧ. 1
	         рйнеопч рбчем
  _____________________________ 52-81-95 ________________

	лТБФЛЙК БМЗПТЙФН ТБВПФЩ ХФЙМЙФЩ:
 1) ПФЛТЩЧБЕН ДЧБ ЖБКМБ (РП РХФЙ ХЛБЪБОПН Ч ПРГЙЙ ХФЙМЙФЩ)
    РЕТЧЩК  ЖБКМ  СЧМСЕФУС  ДЧПЙЮОЩН, ЧФПТПК ФЕЛУФПЧЩН - Ч
    ОЕЗП РПРБДБЕФ ТЕЪХМШФБФ ТБВПФЩ РТПЗТБННЩ.
 2) ЛБЦДЩК  вБКФ ДЧПЙЮОПЗП ЖБКМБ РТЕПВТБЪХСФУС Ч ДБНР ФЙРБ
    'DB  000h,000h,000h,000h,000h,000h,000h,000h'.

    дБООБС  ХФЙМЙФБ  СЧМСЕФУС  ОЕПВИПДЙНПК  РТЙ ТБВПФЕ  ОБ
    БУУЕНВМЕТЕ  Й   РПЪЧПМСЕФ  ЙЪВБЧЙФШ ПФ  ТХЮОПЗП ОБВПТБ
    ВПМШЫЙИ  "ДБНРПЧ"  ( УРТБКФЩ , ЪОБЛПЗЕОЕТБФПТЩ,Й Ф.Д.)

     лПНРЙМСГЙС Й УВПТЛБ РТПЙЪЧПДЙФУС Ч УМЕДХАЭЕК РПУМЕДП-
    ЧБФЕМШОПУФЙ ( ЕУМЙ ЧЩ ТБУРПМПЗБЕФЕ РБЛЕФПН "BDS C")
	; рЕТЧЩК РТПИПД ЛПНРЙМСФПТБ
	A>CC1 DA -M 100 -A Z 0
	BDS Software C Compiler v1.50a (Part I)
	    24K elbowrom
	; чФПТПК РТПИПД.
	A>CC2 DA
	BDS Software C Compiler v1.50a (Part II)
	    21K to spare
	; лПНРБОПЧЛБ Ч БВУПМАФОЩК НПДХМШ.
	A>CLINK DA
	Linkage complete
	32K left over
	

=========================================================*/
    
/************** пУОПЧОЩЕ НБЛТПРПДУФБОПЧЛЙ ****************/
#define INPUT 0		/* пРЕТБГЙС ЮФЕОЙС */
#define OUTPUT 1	/* пРЕТБГЙС ЪБРЙУЙ */
#define IOPUT 2		/* пРЕТБГЙС ПВНЕОБ */
#define ERROR -1	/* лПОУФБОФБ ПЫЙВЛЙ */
#define SEEK_SET 0	/* уНЕЭЕОЙЕ ПФ ОБЮБМБ ЖБКМБ */
#define SEEK_CUR 1	/* пФОПУЙФЕМШОПЕ УНЕЭЕОЙЕ */
#define SEEK_END 2	/* уНЕЭЕОЙЕ ПФ ЛПОГБ ЖБКМБ */

#define SECSIZ 0x80	/* дМЙООБ ЪБРЙУЙ ДМС CP/M */
#define CR 0x0D		/* ЧПЪЧТБФ ЛПТЕФЛЙ */
#define LF 0x0A		/* РЕТЕЧПД УФТПЛЙ */
#define EOF 0x1A	/* фЕЛУФПЧЩК УФПР ВБКФ */

#define PPA_1 7		/* ЛПОУФБОФБ ПФУФХРБ ДБ DB */
#define PPA_2 5		/* ЛПОУФБОФБ ПФУФХРБ РПУМЕ DB */

main(argc,argv)
 int argc;
 char **argv;
  {
    int fd_inp;		/* дЕУЛТЙРФПТ ЖБКМБ ДМС ЮФЕОЙС */
    int fd_out;		/* дЕУЛТЙРФПТ ЖБКМБ ДМС ЪБРЙУЙ */
    int count;		/* дМЙООБ ЙУИПДОПЗП ЖБКМБ Ч ЪБРЙУСИ */

	puts("(C) Karaganda 1993  PPA C Soft Systems 1992   Phone 52-81-95\n\n" );
	if (argc != 3)
	  error_exit ("Format: PDDA <fileinp.ext> <fileout.ext>\n\n");
/**************** ПФЛТПЕН ЖБКМ ДМС ЮФЕОЙС *****************/
	fd_inp = open ( argv[1], INPUT);
	if (fd_inp == ERROR)
	  error_exit ("No file\n");
/************ ПРТЕДЕМЙН ТЕБМШОХА ДМЙОХ ЪБРЙУЙ *************/
	count = seek ( fd_inp, 0, SEEK_END );
	seek (fd_inp, 0, SEEK_SET);
/*********** УПЪДБДЙН ЖБКМ ДМС ЪБРЙУЙ ТЕЪХМШФБФБ **********/
	fd_out = creat( argv [2] );
	if (fd_out == ERROR )
	  error_exit ("error creat file\n");
/************* рЕТЕИПДЙН Л ПВТБВПФЛЕ ЖБКМПЧ ***************/
    while ( count-- )
     {
      char f_input_buf [ SECSIZ ];	/* ВХЖЕТ ЮФЕОЙС */
      char f_output_buf [ SECSIZ * 8 ];	/* ВХЖЕТ ЪБРЙУЙ */
      char *f_oseek;	/* ХЛБЪБФЕМШ ВХЖЕТБ ЪБРЙУЙ */
      char *f_iseek;	/* хЛБЪБФЕМШ ВХЖЕТБ ЮФЕОЙС */
      int i,j;		/* ТБВПЮЙЙ УЮЕФЮЙЛЙ */

	f_iseek = ";; PPA Soft ;;\r\n";
	f_oseek = f_output_buf;
	for (;*f_iseek;*f_oseek++ = *f_iseek++);
	f_iseek = f_input_buf;
	/****** РТПЮЙФБЕН ВМПЛ ВЙОБТОПЗП ЖБКМБ ******/
	read_block ( fd_inp, f_input_buf, 1);
	/****** УПЪДБДЙН БУУЕНВМЕТПЧУЛЙК ДБНР *******/
for (j=0; j<16; j++)
{
	full_mem ( f_oseek, ' ', PPA_1);
	f_oseek   += PPA_1;
	*f_oseek++ = 'D';
	*f_oseek++ = 'B';
	full_mem ( f_oseek, ' ', PPA_2);
	f_oseek   += PPA_2;
for (i=0; i < 8 ; i++)
  {
   char tmp; /* ЧТЕНЕООБС РЕТЕНЕООБС */
	*f_oseek++ = '0';
	tmp = ((*f_iseek) & 0xf0) >> 4;
	tmp > 0x09 ? tmp += 0x37 : tmp += 0x30;
	*f_oseek++ = tmp;
	tmp = (*f_iseek++) & 0x0f;
	tmp > 0x09 ? tmp += 0x37 : tmp += 0x30;
	*f_oseek++ = tmp;
	*f_oseek++ = 'h';
	*f_oseek++ = ',';
    }
	f_oseek--;
	*f_oseek++ = CR;
	*f_oseek++ = LF;
}
	 *f_oseek++ = EOF;

   write_block ( fd_out, f_output_buf,count != 0 ? 7 : 8);
     }

     printf ("Process complete !!!\nReal blok: %d\nSee you soon !!!\n\n",tell (fd_inp)*8);
     close (fd_out);
     close (fd_inp);
exit (0);
}

/*********************************************************/
/**   жХОЛГЙС  РТПЙЪЧПДЙФ ЪБРПМОЕОЙЕ ХЛБЪБООПК ПВМБУФЙ	**/
/** ХЛБЪБООПК ЛПОУФБОФПК.				**/
/*********************************************************/
full_mem ( buf, code, count)
char *buf;	/* ХЛБЪБФЕМШ ОБ РБНСФШ */
char code;	/* ЛПД ЪБРПМОЕОЙС */
int  count;	/* УЛПМШЛП ВБКФПЧ ЪБРПМОЙФШ */
  {
	for (; count--;*buf++ = code);
  }


/*********************************************************/
/** ЖХОЛГЙС  РТПЙЪЧПДЙФ  ВМПЮОПЕ  ЮФЕОЙЕ  ЙЪ  ХЛБЪБОПЗП **/
/** ЖБКМБ Й РПНЕЭБЕФ ЕЗП Ч ВХЖЕТ РЕТЕДПЧБЕНПЗП РП ХЛБЪ. **/
/*********************************************************/
read_block ( descr, buf, n)
int descr;	/* ДЕУЛТЙРФПТ ПФЛТЩФПЗП ЖБКМБ */
char *buf;	/* ХЛБЪБФЕМШ ОБ ВХЖЕТ ЮФЕОЙС */
int n;		/* УЛПМШЛП ВМПЛПЧ ОЕПВИПДЙНП РТПЮЙФБФШ */
 {
	if ( read (descr, buf, n) == ERROR )
		error_exit ("Error read file\n");
 }
/*********************************************************/
/** БОБМПЗЙЮОБС РТПГЕДХТБ ОП ПУХЭЕУФЧМСЕФ ЪБРЙУШ Ч ЖБКМ **/
/*********************************************************/
write_block ( descr, buf, n)
int descr;	/* ДЕУЛТЙРФПТ ПФЛТЩФПЗП ДМС ЪБРЙУЙ ЖБКМБ */
char *buf;	/* ХЛБЪБФЕМШ ОБ ВХЖЕТ ЛПФПТЩК ЧЩЗТХЦБЕФУС */
int n;		/* юйумп вмплпч дмс ъбрйуй */
 {
	if ( write (descr, buf, n) == ERROR )
		error_exit ("Error write file\n");
 }

/**********************************************************/
/* жХОЛГЙС РТПЙЪЧПДЙФ ЧЩЧПД УППВЭЕОЙС ПВ ПЫЙВЛЙ Й ЧЩИПДЙФ */
/* Ч ПРЕТБГЙПООХА УЙУФЕНХ.				  */
/**********************************************************/
error_exit (str)
char *str;
{
   puts(str);
   exit(-1);
}

* щ  ГГ  НbНёГ{ёГwГ{Г–ГаГЕГјГHГГ!ГKГ]ГjГUшН2НµГб^#V#е*~#foЙб^#е *~#foЙб^#V#е*nЙб^#е *nЙб^#V#ел	~#foЙб^#ел& 	~#foЙ! И+Й!  И#Й! Ш+Й!  Ш#Й! р+Й! ш+Й ИЙ  ИЙ ШЙ  ШЙ рЙ шЙ}»А|єЙлzјА{ЅЙл|єА}»Йл|Єтмz·р7Йл|Єту|·р7ЙzхНZлНZлН)с·р|/g}/o#Й  |µИХеН‰СНk|/g}/o#СЙЇ2hНZлНZНk:hР|/g}/o#Й|·р/g}/o#:h<2hЙЕНqБЙDM!  x±ИxGyOТѓл)лГv|µИЕН”`iБЙ|·ъ )Г–лx  хНЭЪ·Хz/W{/_СЇzW{_с=ИхyOxGГ¦Ї2hНZлНZлН‰ГM|єША}»ЙлИЇ|g}oГжлИ)Гф|/g}/o#Йz/W{/_Й! 9~#foЙ! Г! Г!
 Г! Г! Г! ГP! 9Е~#ВAБЙ!  9"w* МчщГ*wщЙб"j!zе*"d!и"f!ЬY"H>Ы2^>У2a>Й2`2cН>Ї2s2t>2r>2v! М"@! "D!@ "B! "FН · КЙН !Ђ щF#x·ВЬ Г:~#ВЬЇ!щ |Ї2i~#ю Ку·К:ю"В	2iГ
+}|~#·К:ЕG:i·xБК.ю"ВЇ2i+w#ю В+6 #ГуХ!Ю6 #В@НAЇ2n2?*jй*л*Нъ|µИ+ЇГ`Й"d!и"f!!яяЙ>хНЕЪЊo& еН–бс=юВ}Г	Н
НЕЪw~Н2жКёеНЕНјлН БбН56 юя!  А+ЙWЦШю	?ШХ_ !Ю~ж7СzИ?ЙЕН§ею:> ВчНћЦ@w#НН5ю.ВНЇw w#w#w#wСБЙЕю*>?К@НЊЪ>w#ВБНЊШГ5> w#В@БЙЕеН§НµТgХ яН С2qбБГ& ХЦ0Ox‡‡‡ЂЂЃGНµТjю/К†СГSбxГ\Нћю.7Ию:7Ию7Ию!ЙюaШю{РЦ Йю КЁю	КЁЙю0Шю:?ЙЕ·OВж	Ю!љжyВХБЙХ$ СВМ7БЙНЕЪгЦo& ))T])))л!љyБЙЕеХх яН 2pсхж_ Н сСбБЙЕеХх:pГ                                                                                     ѓ6ЙЕел)))®Y~хжюЉ0Мї7сж‡G~хж`°2Ћ@сж2“@#~ж2Ќ@~ж?>Кв&=2†@#^#V#Х^#V#л"Џ@л^#Vл"‘@С:“@·К'*{@ л!  :Ћ@ж@К'"‘@бБЙе*Ґ@#w"Ґ@бЙе*Ґ@~юяК9'·ВD'Ь/Нї7Н€?бЙ+"Ґ@бЙе*Ґ@+"Ґ@бЙе!6D"Ґ@6я!^D"§@бЙе*Ґ@~·бИюяЙех*Ќ@л*§@s#r#л*Џ@лs#r#л*‘@лs#r#л*‰@лs#r#л*‹@лs#r#:“@w#"§@Но'сбЙех*@л*§@s#r#л*љ@лs#r#л*њ@лs#r#л*”@лs#r#л*–@лs#r#:ћ@w#"§@Но'сбЙ|юEШВщ'}юXШО2Гк7ех*§@+~2“@+V+^+л"‹@лV+^+л"‰@лV+^+л"‘@лV+^+л"Џ@лV+^"§@л"Ќ@сбЙех*§@+~2ћ@+V+^+л"–@лV+^+л"”@лV+^+л"њ@лV+^+л"љ@лV+^"§@л"@сбЙНp'Н;(ЙНЇ'Ня'ЙеН‹(бЙ! "џ@"K@Ї2¤@<2Ј@2ў@2Ў@НҐ)Ки(НЪ)Ки(Н*Вѕ(Ї2ў@2Ў@Гг(НS*ВП(Н#)Ї2ў@2Ј@ЙНЖ)ИНl*КГЯГ ГЬГсГYГЄГMГГ”Г2ГмГГ	Е!qы9щDM!NеН»СНѓ“+++|µК	!ЌеНѕС!  е!•	~#fo##~#foеНБССл`is#rНђ #|µВ4	!ёеНѕС! е!  еНђ еНДСССл! 	s#r!  е!  еНђ еНДССС!•	~#fo ~#foеНЗСл! 	s#rНђ#|µВ‘	!БеНѕС! 	^#Vr+szіК!Ул!€	s#r!† 	л!†	s#rНѓ€n}·Ке	!†	^#Vr+sХ!€	^#Vr+sлnлбsГ№	! 	л!€	s#r! е! 	еНђ еНКССС!Њ	Їw#wНѓЊря|ТЭ! е!  еНѓ†еННССС!†	е~#fo лбs#r!†	^#Vr+sл6D!†	^#Vr+sл6B! е!  еНѓ†еННССС!†	е~#fo лбs#r!Љ	Їw#wНѓЉшя|Т¦!†	^#Vr+sл60Нѓ€n& р |ўg}Јo Нел!Ћ	s!Ћ	n& ця|Ъм
!Ћ	еn& 7 лбsл& Гь
!Ћ	еn& 0 лбsл!†	^#Vr+sХ!Ћ	nлбs!€	^#Vr+sлn&  |ўg}Јoл!Ћ	s!Ћ	n& ця|ЪU!Ћ	еn& 7 лбsл& Гe!Ћ	еn& 0 лбsл!†	^#Vr+sХ!Ћ	nлбs!†	^#Vr+sл6h!†	^#Vr+sл6,!Љ	^#Vr+sГЌ
!†	^#Vr+s!†	^#Vr+sл6!†	^#Vr+sл6
!Њ	^#Vr+sГ
!†	^#Vr+sл6Нђ|µНЈКю! Г! е!† 	еНђеНРСССГ‘	Нђ еНЦС)))е!деНУССНђеНЩСНђ еНЩС!  еНЬСл!Џ9щлБЙ(C) Karaganda 1993  PPA C Soft Systems 1992   Phone 52-81-95

 Format: PDDA <fileinp.ext> <fileout.ext>

 No file
 error creat file
 ;; PPA Soft ;;
 Process complete !!!
Real blok: %d
See you soon !!!

 Е!  9щDM! 	^#Vr+szіКK! 	^#Vr+sХ! 	nлбsГ"БЙГVГГЬЕ!  9щDMНђеНђеНђеНPССС#|µВЃ!ѓеНSСБЙError read file
 ГќГµГЬЕ!  9щDMНђеНђеНђеН—ССС#|µВИ!КеНљСБЙError write file
 ГеГ Г	Е!  9щDMНђеНЯС!яяеНвСБЙГГiЕ!  9щDMНђn}·К0! 	^#Vr+sлn& еНСГБЙГ;ГiГUЕ!  9щDM*6е! 	еН8ССБЙБЙГdГNГцГ%Г€Е!Yя9щDM!« 	^#Vr+sл~#foл! 	s#rНђ«л!Ґ 	s#r! 	^#Vr+sлnл`is{·К?`in}ю%В! 	л!њ 	s#r!Ј 	6#6 !  	 s!ћ 	s!џ 	sНђn}ю-Вф! 	^#Vr+s!џ 	4Нђn}ю0В!  	4Нђn& еН[С}·К!! 	еН^СГ$!  л!Ў 	s#r! 	^#Vr+sлnл`is{ю.Вl! 	еН^Сл!Ј 	s#r!ћ 	4! 	^#Vr+sлnл`is`in& еНaС}юDКќюUКЩюXКвюOКлюCК1юSКbю КЫГбНђҐ~#fo|ТЩ!њ 	^#Vr+sл6-НђҐеНђҐ~#foНълбs#r!Ў 	^#Vr+s! 	6
Гс! 	6Гс! 	6!Ў 	е~#foе! 	n& е!Ґ 	^#Vr+sл~#foе!њ 	еНXССССЇgНълбs#rГЪ!њ 	^#Vr+sХ!Ґ 	^#Vr+sл~#foлбs!Ў 	^#Vr+sГЪ!ћ 	n}·Вu!Ј 	6И#6 !Ґ 	^#Vr+sл~#foл! 	s#rНђn}·КЪНђЈ|µКЪ!њ 	^#Vr+sХ! 	^#Vr+sлnлбs!Ј 	^#Vr+s!Ў 	^#Vr+sГђНђњ6 ! 	л!њ 	s#r!џ 	n}·ВH!Ў 	^#Vr+s!яя|ЪHНђ­еНђЇе!  	n}·К%!0 Г(!  е!6е! 9~#foйССС#|µВE!яяГEГцНђњn}·КЊНђ­еНђЇе!њ 	^#Vr+sлn& е!zе! 9~#foйССС#|µВ‰!яяГEГH!џ 	n}·КШ!Ў 	^#Vr+s!яя|ЪШНђ­еНђЇе!  е!Же! 9~#foйССС#|µВХ!яяГEГ–Г!  ГEНђ­еНђЇе`in& е!юе! 9~#foйССС#|µВ!яяГEГ<Нђ­еНђЇе`in& е!-е! 9~#foйССС#|µВ<!яяГEГ“!  ГEл!§ 9щлБЙГTГNЕ!яя9щDMНђеНђ	СНмТўНђ^#Vr+sХНђцяЪЏНђ0 Г—Нђ7 лбs! & ГнНђ	еНђеНђ	СН‰еНђеНQСССл`isНђ	еНђеНђ	СН)еНђеНQССС`in& #& Гнл! 9щлБЙЕ!  9щDM! 	n& Ря|НЇЪ!! 	n& Жя|Н©БЙБЙГ+ГцЕ!юя9щDM`iЇw#wНђ~#fon& еН(С}·КxНђ 
 Н?еНђ^#Vr+sлnСЇgРял`is#rГ9Нђ Гл! 9щлБЙГЋГВЕ!  9щDM! 	n& еН‹С|µКµ! 	n& аяГј! 	n& & БЙБЙЕ!  9щDM! 	n& џя|НЇЪн! 	n& …я|Н©БЙБЙН7ЇН,Т >
Г2hл*PлЕН/:qН2Н юяБ>КP:hН):R·К<=К<=>ВP:q‚w#Їw#w:ho& Н5ЙН52?ГГ_ГН7Е:PН,>Тu2?БГе! ^#V*R:T·Кћ=ВЏГћ*PХеН\ССл*Rг! Сs#rлБЙГіГкГсН7*PЕеН­С:qН2\ Н Н5юяБВЮ>2?Г! е*PеН°ССЙН
Н,Тэ>2?Г! ~#foЙГ#Г Н7:PН)V>ЪЇzж>КЇЕzН2:PН,"j!  "l*T|µ*lВGН5БЙ*RлН *jл!ХН С·Кx2?юКrюКr!яяГB*lГB*T+"T*RЂ "R*l#"l*j! 	N#Fp+qx±В7##6>2?Г<2?ГН7:PН)"XV>Ъczж>	КcЕzН2:PН,"j!  "l*T|µВ*j! ^#VХ*X#^#VглНЭбТ	r+s*lН5БЙ*RелН бЂ "R*jл"Н *l·К92?Г#"l*T+"T*j! 	N#Fp+qx±Вг##6>2?Г	2?ГН
Ею
В}Н >
_Н Н ·ВЊБЙН юК БЙН
Н,Т©>2?ГЕеНН)~Н2#"jС!! е~#foе#Н Бб^#Vp+q*jе~#foНЭТдгs#rлСН5БЙН
Ел!\ Н/:qН2Н Н5!  БюяА>2?+Й ! 9щлБЙГЋГВЕ!  9щDM! 	n& еН‹С|µКµ! 	n& аяГј! 	n& & БЙБЙЕ!  9щDM! 	n& џя|НЇЪн! 	n& …я|Н©БЙБЙН7ЇН,Т >
Г2hл*PлЕН/:qН2Н юяБ>КP:hН):R·К<=К<=>ВP:q‚w#Їw#w:ho& Н5ЙН52?ГГ_ГН7Е:PН,>Тu2?БГе! ^#V*R:T·Кћ=ВЏГћ*PХеН\ССл*Rг! Сs#rлБЙГіГкГсН7*PЕеН­С:qН2\ Н Н5юяБВЮ>2?Г! е*PеН°ССЙН
Н,Тэ>2?Г! 	Title	DE.ASM
	ORG	0000h
;;
;; //////// 15.04.1993 ///////////////////////////////////
;; //  (C) 1993  лБТБЗБОДБ  лРФй  ьб-91-2  рЙНЕОПЧ р.б	//
;; //							//
;; // ====== 52-81-95 ======== PPA Soft Systems ======	//
;; //		Copyright  by  рЙНЕОПЧ рБЫБ		//
;; ////// "ыЕМ ДПЦДШ ОБ ПУФБОПЧЛЙ" ///////////////////////
;;
	Include	MACRO.PPA	; нБЛПРПДУФБОПЧЛЙ
	External	W_ZG	;

	XRA	A		;
	DI			;
	LXI	SP,100h		;
	OUT	10H		;
	CALL	SCREEN_CLS	;
	LXI	H,KEY_INT	;
	MVI	A,0C3h		;
	STA	38h		;
	SHLD	39h		;
	EI			;
	HLT			;
	DI			;
	LXI	D,0101h		;
	LXI	H,3E0Fh		;
	LXI	B,INTEG		;
	CALL	BORT		;
	LXI	B,DOUBLE	;
	LXI	D,0302h		;
	LXI	H,3C07h		;
	CALL	BORT		;
	MVI	B,36h		;
	INR	D		;
	INR	D		;
	CALL	GOR_STREL	;
	LXI	B,INTEG		;
	LXI	D,030Bh		;
	LXI	H,160Eh		;
	CALL	BORT		;
	MVI	A,1		;
	CALL	TEN		;
	LXI	D,1A09h		;
	LXI	H,3B0Eh		;
	LXI	B,INTEG		;
	CALL	BORT		;
	MVI	A,3		;
	CALL	TEN		;
	LXI	D,0702h		;
	LXI	B,PPA_00	;
	CALL	PUTSXY_Z	;
	LXI	D,0806h		;
	CALL	PUTSXY_Z	;
	DCR	E		;
	CALL	PUTSXY_Z	;
	DCR	E		;
	CALL	PUTSXY_Z	;
	DCR	E		;
	MVI	H,30h		;
	MVI	A,'~'		;
BEG_00:
	CALL	PUTCXY		;
	INR	D		;
	DCR	H		;
	JNZ	BEG_00		;
	LXI	D,1D0Dh		;
	CALL	PUTSXY_Z	;
	DCR	E		;
	CALL	PUTSXY_Z	;
	DCR	E		;
	CALL	PUTSXY_Z	;
	DCR	E		;
	MVI	H,1Bh		;
	MVI	A,'~'		;
BEG_02:
	CALL	PUTCXY		;
	INR	D		;
	DCR	H		;
	JNZ	BEG_02		;
	LXI	D,050Fh		;
	CALL	PUTSXY_Z	;
	LXI	D,070Dh		;
	CALL	PUTSXY_Z	;
	DCR	E		;
	CALL	PUTSXY_Z	;
	EI			;
BEG_05_LOOP:
	LDA	KEY_KOD		;
	INR	A		;
	JZ	BEG_05_LOOP	;
	MVI	B,1Ah		;
BEG_LOOP:
	LXI	D,0403h		;
	LXI	H,3B06h		;
	CALL	SCROL4		;
	LXI	D,1C0Ah		;
	LXI	H,390Dh		;
	CALL	SCROL3		;
	DCR	B		;
	JNZ	BEG_LOOP	;
	CALL	SCREEN_CLS	;
	NOP			;
	NOP
	NOP
	DI
	JMP	$

PPA_00:
	DB	" (C)(R)13.10.1992 ",0BDh,0BEh,0BFh
	DB	" PPA Soft Systems Laboratory ",0
PPA_01:
       DB     0E5h,0D3h,0CCh
       DB     0C9h,020h,020h,020h,0D7h,0D9h,020h,020h,0C8h
       DB     0CFh,0D4h,0C9h,0D4h,0C5h,020h,020h,0D0h,0CFh
       DB     0CCh,0D5h,0DEh,0C9h,0D4h,0D8h,020h,020h,0C4h
       DB     0CFh,0D3h,0D4h,0D5h,0D0h,020h,020h,0CBh,020h,020h
       DB     0CFh,0C2h,0DBh,0C9h,0D2h,0CEh,0CFh,0CAh
       DB     00h
       DB     0C2h,0C9h,0C2h,0CCh,0C9h,0CFh
       DB     0D4h,0C5h,0CBh,0C5h,020h,020h,020h,0D0h
       DB     0D2h,0C9h,0CBh,0CCh,0C1h,0C4h,0CEh,0D9h
       DB     0C8h,02Ch,020h,020h,0D3h,0C9h,0D3h,0D4h
       DB     0C5h,0CDh,0CEh,0D9h,0C8h,020h,020h,020h
       DB     0C9h,020h,020h,0C9h,0C7h,0D2h,0CFh,0D7h
       DB     0D9h,0C8h,00h
       DB     0D0h,0D2h,0CFh,0C7h
       DB     0D2h,0C1h,0CDh,0CDh,020h,0C4h,0CCh,0D1h
       DB     020h,0F0h,0FCh,0F7h,0EDh,020h,020h,022h
       DB     0F7h,0C5h,0CBh,0D4h,0CFh,0D2h,020h,030h
       DB     036h,0E3h,022h,02Ch,020h,020h,0D4h,0CFh
       DB     020h,020h,0DAh,0D7h,0CFh,0CEh,0C9h,0D4h
       DB     0C5h,02Eh,02Eh,02Eh,00h
PPA_02:
       DB     05Fh,05Fh,05Fh,05Fh,05Fh,05Fh,020h,0EEh
       DB     0C1h,0DBh,0D9h,020h,0D4h,0C5h,0CCh,0C5h
       DB     0C6h,0CFh,0CEh,0D9h,03Ah,05Fh,05Fh,05Fh
       DB     05Fh,05Fh,05Fh,00h
       DB     020h,035h,032h,02Dh
       DB     038h,031h,02Dh,039h,035h,020h,020h,020h
       DB     0F0h,0C9h,0CDh,0C5h,0CEh,0CFh,0D7h,020h
       DB     0F0h,0C1h,0D7h,0C5h,0CCh,00h
       DB     020h,037h
       DB     035h,02Dh,035h,038h,02Dh,039h,033h,020h
       DB     020h,020h,0E7h,0CFh,0CCh,0D5h,0CEh,0CFh
       DB     0D7h,020h,0E1h,0CEh,0C4h,0D2h,0C5h,0CAh
       DB     00h
PPA_03:
	DB	6,7,20h
       DB     0EBh,0C1h,0D2h,0C1h,0C7h,0C1h,0CEh,0C4h
       DB     0C1h,020h,031h,039h,039h,032h,020h,0DAh
       DB     0C1h,0D3h,0D4h,0C1h,0D7h,0CBh,0D5h,020h
       DB     0D2h,0C1h,0DAh,0D2h,0C1h,0C2h,0CFh,0D4h
       DB     0C1h,0CCh,020h,020h,0F0h,0C9h,0CDh,0C5h
       DB     0CEh,0CFh,0D7h,020h,0F0h,0C1h,0DBh,0C1h
       DB     20h,7,8,00h
PPA_04:
	DB	"Good luck !!!",0
	DB	"See you soon.",0

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;	    йУИДОЩК ФЕЛУФ УЕТЧЙУОЩИ РТПГЕДХТ.		;;
;;++++++++++++++++++++++++++++++++++++++++++++++++++++++;;

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;	рТПГЕДХТБ РПМХЮЕОЙС ДПРПМОЙФЕМШОПЗП ЛПДБ ДМС	;;
;; ТЕЗЙУФТПЧПК РБТЩ: DE					;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
NEG_DE:			;
	MOV	A,D	;
	CMA		;
	MOV	D,A	;
	MOV	A,E	;
	CMA		;
	MOV	E,A	;
	INX	D	;
	RET		;

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;     рТПГЕДХТБ ЧЩЧПДБ ASCIIZ УФТПЛЙ Ч БВУ. ЛППТДЙОБФЩ	;;
;; DE - ЛППТДЙОБФЩ.					;;
;; BC - ХЛБЪБФЕМШ ОБ УФТПЛХ УЙНЧПМЧ.			;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
PUTSXY_Z:
	PUSH	D		;
	PUSH	PSW		;
PUTS_LOOP:
	LDAX	B		;
	INX	B		;
	ORA	A		;
	JZ	PUTS_EXIT	;
	CALL	PUTCXY		;
	INR	D		;
	JMP	PUTS_LOOP	;
PUTS_EXIT:
	POP	PSW		;
	POP	D		;
	RET			;

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;	рТПГЕДХТБ ЖЙТНЕОПК ПФЮЙУФЛЙ ЬЛТБОБ.		;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
SCREEN_CLS:
	IN	3		;
	MOV	L,A		;
	LXI	B,0		;
SCRECLS0:
	MVI	H,0A0H		;
SCRECLS:
	MOV	M,B		;
	INR	H		;
	MOV	A,H		;
	CPI	0E0H		;
	JNZ	SCRECLS		;
	MOV	A,L		;
	DCR	L		;
	OUT	3		;
	INR	C		;
	JNZ	SCRECLS0	;
	RET			;

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;	рТПГЕДХТБ ТЙУХЕФ ЧЕТФЙЛБМШОХА УФТЕМЛХ		;;
;; DE - ЛППТДЙОБФЩ УФТЕМЛЙ.				;;
;; B  - ТБЪНЕТ УФТЕМЛЙ.					;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;	
VER_STREL:
	PUSH	D	;
	PUSH	PSW	;
	MVI	A,3	;
	CALL	PUTCXY	;
	DCR	B	;
	DCR	B	;
	INR	A	;
ST0:
	DCR	E	;
	CALL	PUTCXY	;
	DCR	B	;
	JNZ	ST0	;
	DCR	E	;
	INR	A	;
	CALL	PUTCXY	;
	POP	PSW	;
	POP	D	;
	RET		;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;	рТПГЕДХТБ ТЙУХЕФ ЗПТЙЪПОФБМШОХА УФТЕМЛХ		;;
;; DE - ЛППТДЙОБФЩ.					;;
;; B  - ТБЪНЕТ.						;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
GOR_STREL:
	PUSH	D	;
	PUSH	PSW	;
	MVI	A,6	;
	CALL	PUTCXY	;
	INR	A	;
	DCR	B	;
	DCR	B	;
PA0:
	INR	D	;
	CALL	PUTCXY	;
	DCR	B	;
	JNZ	PA0	;
	INR	A	;
	INR	D	;
	CALL	PUTCXY	;
	POP	PSW	;
	POP	D	;
	RET		;
;;;;;;;;;;;;;;;;;;;;;;;;;
;; лБТБЗБОДБ  Ф. 52-81-95 	/* PPA Soft Systems */
;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;	рБЛЕФ  РТЕДОБЪОЕЮЕО  ДМС УЛМЕКЛЙ У ДТХЗЙНЙ РТП-	;;
;; ГЕУУБНЙ  ЛПФПТЩН  ФТЕВХЕФУС  ТБВПФБФШ  У ЛМБЧЙБФХТПК	;;
;; ЛТПНЕ  ЬФПЗП  ДТБКЧЕТ РТПЙЪЧПДЙФ ОБЮБМШОХА ХУФБОПЧЛХ	;;
;; ТЕЦЙНБ  ЬЛТБОБ  ( 512 * 256  - 2 ГЧЕФБ ДОПЧТЕНЕООП )	;;
;; БДТЕУБ ЬЛТБООПК ПВМБУФЙ: 0A000h - 0DFFFh.		;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

	Public	KEY_INT	; ПВТБВПФЮЙЛ РТЕТЩЧБОЙС.
	Public	COLOR	; ЛПД ФЕЛХЭЕЗП ГЧЕФБ.
	Public	KEY_KOD	; ДЙОБНЙЮЕУЛЙК ЛПД ЛМБЧЙБФХТЩ
	
;;////////// ТБВПЮЙЕ СЮЕКЛЙ KEYBOARD.DRIVE ////////
COLOR:	DW	0FF00H	
KEY_KOD: DB	255	;УПД.ЛПД ЛМБЧЙЫЙ ОБЦ Ч ДБООЩК НПНЕОФ

;; ================ 21:55 "Good luck "================

KEY_INT:
	PUSH	B	; рТПЙЪЧПЦХ РПМОПЕ УПИТБОЕОЙЕ
	PUSH	D	; УПУФПСОЙС РТПГЕУУПТБ Ч НПНЕОФ
	PUSH	H	; ЧПЪОЙЛОПЧЕОЙС РТЕТЩЧБОЙС
	PUSH	PSW	;
	LHLD	COLOR	; юЙФБА ДЧБ ВБКФБ ЖЙЪЙЮЕУЛЙИ ГЧЕФПЧ
	LXI	D,100FH	; ЖПОБ Й РЕТЕДОЕЗП РМБОБ
KEY_00:
	MOV	A,E	; H - ГЧЕФ ретдоезп рмбоб
	OUT	02	; L - ГЧЕФ жпоб
	ANI	06	; Й РЕТЕИПДЙН Л ТБУРТЕДЕМЕОЙА
	MOV	A,L	; ЕФЙИ ВБКФПЧ Ч УППФЧЕФУФЧЙЙ
	JZ	KEY_01	; У НБФЕНБФЕНБФЙЮЕУЛЙНЙ ГЧЕФБНЙ
	MOV	A,H	;
KEY_01:
	OUT	0FH	; РТПЙЪЧПДЙН НОПЗПЛТБФОХА ЪБРЙУШ
	DCR	E	; РПМХЮЕОПЗП ЛПДБ Ч УЧСЪЙ У НБМПК
	OUT	0FH	; УЛПТПУФША ТБВПФЩ пъх -л155тх2-
	OUT	0FH	;
	OUT	0FH	;
	DCR	D	;
	OUT	0FH	;
	JNZ	KEY_00	;
	MVI	A,8AH	; оБУФТБЙЧБЕН УЙУФЕНОЩК РПТФ ОБ
	OUT	00	; УЛБОЙТПЧБОЙЕ ЛМБЧЙБФХТЩ
	XRA	A	; ЧЩДБЕН ОБ НБФТЙГЕ ЪБРТПУ П ОБЦ-
	OUT	03	; БФЩИ ЛМБЧЙЫБИ
	IN	02	; 
	STA	KEY_KOD	;
	MVI	A,88h	;
	OUT	00h	;
	MVI	A,0FFh	;
	OUT	03h	;
	MVI	A,10h	;
	OUT	02h	;
	POP	PSW	;
	POP	H	;
	POP	D	;
	POP	B	;
	EI		;
	RET		;
;;	/* 31.03.1993 PPA Systems Utilites */
;;
;;
;;	+----[ 13.10.1992 ]-------------[ ЛБТБЗБОДБ ]---+
;;	!  БЧФПТ:	рЙНЕОПЧ р.б.			!
;;	!	"дТБКЧЕТ ПЛПООПЗП ЙОФЕТЖЕКУБ"		!
;;	! ПВЕУРЕЮЙЧБЕФ ЧЩЧПД УЙНЧПМШОПК ЙОЖПТНБГЙЙ Ч	!
;;	! ФБЛ ОБЪЩЧБЕНЩЕ "ПЛОБ" ТЕБМЙЪПЧБОЩ УМЕДХАЭЙЕ	!
;;	! ПРЕТБГЙЙ:	ЧЩЧПД ПДЙОПЮОПЗП УЙНЧПМБ	!
;;	!		ПТЗБОЙЪБГЙС ЧУРМЩЧБАЭЙИ ПЛПО	!
;;	!		ПФЮЙУФЛБ ПЛПО (ПВМБУФЕК ЬЛТБОБ)	!
;;	!		ЮФЕОЙЕ УЙНЧПМБ Ч ЪБД. РПЪЙГЙЙ	!
;;	! ЛППТДЙОБФЩ:	ПЛПООЩЕ	(ПФОПУЙФЕМШОЩЕ)		!
;;	!		ЬЛТБООЩЕ (БВУПМ`ФОЩЕ)		!
;;	!________ ТБУРТЕДЕМЕОЙЕ ТПО РТПГЕУУПТБ__________!
;;	!	DE  ->  ЛППТД. ЧЩЧПДБ УЙНЧПМБ МЙВП ХЛБЪ.!
;;	!		МЕЧ. ОЙЦОЕЗП ХЗМБ ПЛОБ (ПВМБУФЙ)!
;;	!		D -> ЗПТЙЪПОФБМШОБС ЛППТДЙОБФБ	!
;;	!		E -> ЧЕТФЙЛБМШОБС --//-- (Y)	!
;;	!	HL  ->	ЛППТД.РТБЧ. ЧЕТИО. ХЗМБ ПЛОБ 	!
;;	!	BC  ->	ХЛБЪБФЕМШ ОБ УФТПЛХ УЙНЦПМПЧ	!
;;	!	A   ->	ЖМБЗ ПЛОБ			!
;;	!	+---+---+---+---+---+---+---+---+	!
;;	!	! 7 ! 6 ! 5 ! 4 ! 3 ! 2 ! 1 ! 0 !	!
;;	!	+---+---+---+---+---+---+---+---+	!
;;	!	ПРЙГБОЙЕ ВЙФПЧ ЖМБЗБ:			!
;;	!		(D0-D1):  ЧЙД "ФЕОЙ"		!
;;	!			00 -> ПФУХФУФЧХЕФ	!
;;	!			01-11 -> 1-3 ФЙРЩ	!
;;	!		(D2-D3):  ЧЙД "ТБНЛЙ"		!
;;	!			00 -> ПФУХФУФЧХЕФ	!
;;	!			01 -> ПДЙОБТОБС		!
;;	!			10 -> ДЧПКОБС		!
;;	!			11 -> ФПЦЕ ПДЙОБТОБС	!
;;	!		   (D4):  РБТЙФЕФ ПЛОБ		!
;;	!			0  -> ВЕЪ ЧПУФБОПЧМЕОЙС	!
;;	!			1  -> У ЧПУФБОПЧМЕОЙЕН	!
;;	+------[ OBJ: 06D0H ]----------[ End remark ]---+



DOUBLE:         DB	098h,099h,08Bh,08Ch,08Ah,09Dh
INTEG:		DB	090h,0AAh,08Fh,0A9h,083h,094h

;+--------[ ФЕОШ ]------+
;* ЧИПД:  DE,HL -WINDOW *
;+----------------------+
TEN:
	PUSH	H	;
	PUSH	D	;
	ADD	A	;
	ADI	7	;
	MOV	B,A	;
	INR	H	;
	DCR	L	;
	DCR	E	;
TE1:
	MOV	A,B	;
	INR	D	;
	CALL	PUTCXY	;
	MOV	A,D	;
	CMP	H	;
	JNZ	TE1	;
	INR	B	;
TE3:	MOV	A,B	;
	INR	E	;
	CALL	PUTCXY	;
	MOV	A,E	;
	CMP	L	;
	JNZ	TE3	;
	POP	D	;
	POP	H	;
	RET		;
;
;+--------------[ DRAW BOARD ]----------+
;*	ЧИПД:	DE,HL -> ЛППТД.ПЛОБ	*
;*		A -> ЖМБЗ		*
;+--------------------------------------+
BORT:
	PUSH	B	
	PUSH	D	
	PUSH	H	
	PUSH	PSW	
	LDAX	B	
	CALL	PUTCXY	
	PUSH	D	
	MOV	E,L	
	INX	B	
	LDAX	B	
	CALL	PUTCXY	
	XCHG		
	INX	B	
	LDAX	B	
	CALL	PUTCXY	
	XTHL		
	MOV	E,L	
	INX	B	
	LDAX	B	
	CALL	PUTCXY	
	XTHL		
	DCR	L	
	PUSH	D	
	INX	B	
BORT02:
	LDAX	B	
	INR	E	
	CALL	PUTCXY	
	MOV	A,E	
	CMP	L	
	JNZ	BORT02	
	POP	D	
	XCHG		
	PUSH	D	
	INR	L	
BORT03:
	LDAX	B	
	CALL	PUTCXY	
	DCR	E	
	MOV	A,E	
	CMP	L	
	JNC	BORT03	
	POP	D	
	POP	PSW	
	INX	B	
	INR	E	
	DCR	L	
CONT:
	INR	D	
	DCR	H	
	LDAX	B	
	CALL	PUTCXY	
	PUSH	D	
	MOV	E,L	
	CALL	PUTCXY	
	POP	D	
	XCHG		
	CALL	PUTCXY	
	PUSH	D	
	MOV	E,L	
	CALL	PUTCXY	
	POP	D	
	XCHG		
	MOV	A,D	
	CMP	H	
	JC	CONT	
	JMP	NEXT

;-----------[ MAIN HELP ]----------+
;*  ЗМПВБМШОЩЕ ЧУРПНПЗБФ. РПДРТПЗТ.*
;+---------------------------------+
HL_SUB_DE:
	MOV	A,H	
	SUB	D	
	INR	A	
	MOV	B,A	
	MOV	A,L	
	SUB	E	
	INR	A	
	MOV	C,A	
	RET		

;+------[ SCROLLING HELP ]-------+
;*		--//--		 *
;+-------------------------------+

SCH1:
	PUSH	B	
	PUSH	D	
	PUSH	H	
SH10:
	CALL	LDIR	
	DCR	H	
	DCR	D	
	DCR	C	
	JNZ	SH10	
	POP	H	
	POP	D	
	POP	B	
	MOV	A,H	
	ADI	20H	
	MOV	H,A	
	MOV	A,D	
	ADI	20H	
	MOV	D,A	
SH11:
	CALL	LDIR	
	DCR	H	
	DCR	D	
	DCR	C	
	JNZ	SH11	
	RET		
SCH2:
	PUSH	B	
	PUSH	D	
	PUSH	H	
SH20:
	CALL	LIIR	
	INR	H	
	INR	D	
	DCR	C	
	JNZ	SH20	
	POP	H	
	POP	D	
	POP	B	
	MOV	A,H	
	ADI	20H	
	MOV	H,A	
	MOV	A,D	
	ADI	20H	
	MOV	D,A	
SH21:
	CALL	LIIR	
	INR	H	
	INR	D	
	DCR	C	
	JNZ	SH21	
	RET		

;+-----[ РТПХЕДХТБ ПФЮЙУФЛЙ ПЛОБ ]------+
;*	ЧИПД:	DE,HL -> WINDOW COORD	*
;+--------------------------------------+
CLS:
	PUSH	B	
	PUSH	D	
	PUSH	H	
	PUSH	PSW	
	CALL	HL_SUB_DE	
	MOV	A,C	
	ANI	0FH	
	RLC		
	RLC		
	RLC		
	RLC		
	MOV	B,A	
	MOV	A,D	
	RRC		
	JNC	HOM1	
	CALL	STOLB	
	INR	D	
HOM1:
	MOV	A,H	
	RRC		
	JC	HOM2	
	XCHG		
	PUSH	D	
	MOV	E,L	
	CALL	STOLB	
	POP	D	
	XCHG		
	DCR	H	
HOM2:
	MOV	A,H	
	SUB	D	
	RAR	
	INR	A	
	MOV	C,A	
	CALL	ADDRSC	
	XRA	A	
	PUSH	B	
	MOV	D,B	
	MOV	E,L	
HOM3:
	MOV	M,A	
	INR	L	
	DCR	B	
	JNZ	HOM3	
	MOV	B,D	
	MOV	L,E	
	INR	H	
	DCR	C	
	JNZ	HOM3	
	DCR	H	
	POP	B	
	MOV	A,H	
	ADI	20H	
	MOV	H,A	
	XRA	A	
HOM5:
	MOV	M,A	
	INR	L	
	DCR	B	
	JNZ	HOM5	
	MOV	B,D	
	MOV	L,E	
	DCR	H	
	DCR	C	
	JNZ	HOM5	
	JMP	NEXT

;+--------[ STOLB ]---------+
STOLB:
	PUSH	D	
	PUSH	B	
	MVI	A,' '	
ST1:
	CALL	PUTCXY	
	INR	E	
	DCR	C	
	JNZ	ST1	
	POP	B	
	POP	D	
	RET		

;+--------[ SCROLL WINDOW ]---------+
;*    РТПГЕДХТЩ УЛТПМЙОЗБ ПЛПО 	    *
;+----------------------------------+
;ЯЯЯЯЯЯЯЯЯЯЯЯЯЯ  ЧРТБЧП ЯЯЯЯЯЯЯЯЯЯЯЯЯ
SCROL3:
	PUSH	B	
	PUSH	D	
	PUSH	H	
	PUSH	PSW	
	CALL	HL_SUB_DE	
	MOV	A,C	
	MOV	C,B	
	PUSH	D	
	PUSH	H	
	ANI	0FH	
	RLC		
	RLC		
	RLC		
	RLC		
	MOV	B,A	
	MOV	A,C	
	RAR		
	DCR	A	
	MOV	C,A	
	XCHG		
	INR	E	
	CALL	ADDRSC	
	DCX	H	
	MOV	D,H	
	MOV	E,L	
	DCR	H	
	CALL	SCH1	
	POP	H	
	POP	D	
	MOV	H,D	
	INR	H	
	CALL	CLS
	JMP	NEXT
;ЯЯЯЯЯЯЯЯЯЯЯЯЯЯ ЧМЕЧП ЯЯЯЯЯЯЯЯЯЯЯЯЯ
SCROL4:
	PUSH	B	
	PUSH	D	
	PUSH	H	
	PUSH	PSW	
	CALL	HL_SUB_DE	
	PUSH	D	
	PUSH	H	
	MOV	A,C	
	MOV	C,B	
	ANI	0FH	
	RLC		
	RLC		
	RLC		
	RLC		
	MOV	B,A	
	MOV	A,C	
	RAR		
	DCR	A	
	MOV	C,A	
	CALL	ADDRSC	
	MOV	D,H	
	MOV	E,L	
	INR	H	
	CALL	SCH2	
	POP	H	
	POP	D	
	MOV	D,H	
	DCR	D	
	CALL	CLS	
	JMP	NEXT
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
PUTCXY:
	PUSH	B	
	PUSH	D	
	PUSH	H	
	PUSH	PSW	
	MOV	B,A	
	CALL	ADDRSC	
	XCHG		
	MOV	A,H	
	RRC		
	MOV	A,B	
	MVI	B,16	
	PUSH	PSW
	PUSH	D		;ПРТЕДЕМЕОЙС ОБЮБМБ ЪОБЛПЗЕОЕТБФПТБ
	MVI	H,0
	MOV	L,A	
	DAD	H	
	DAD	H	
	DAD	H	
	DAD	H	
	LXI	D,W_ZG		;ХЛБЪБФЕМШ ОБ ЪОБЛПЗЕОЕТБФПТ
	DAD	D
	POP	D	
	POP	PSW
	XCHG		
	JC	SHET	
	MVI	C,0FH	
SCA:
	MOV	A,M	
	ANA	C	
	MOV	M,A
	LDAX	D	
	ANI	0F0H	
	ORA	M	
	MOV	M,A	
	INR	L	
	INX	D	
	DCR	B	
	JNZ	SCA	
	MVI	B,16	
	MOV	A,H	
	ADI	20H	
	MOV	H,A	
SCC:
	DCX	D	
	DCR	L	
	MOV	A,M	
	ANA	C	
	MOV	M,A	
	LDAX	D	
	ANA	C	
	RLC		
	RLC		
	RLC		
	RLC		
	ORA	M	
	MOV	M,A	
	DCR	B	
	JNZ	SCC	
	JMP	NEXT	
SHET:
	MVI	C,0F0H	
SCA0:
	MOV	A,M	
	ANA	C	
	MOV	M,A	
	LDAX	D	
	ANA	C	
	RRC		
	RRC		
	RRC		
	RRC		
	ORA	M	
	MOV	M,A	
	INR	L	
	INX	D	
	DCR	B	
	JNZ	SCA0	
	MVI	B,16	
	MOV	A,H	
	ADI	20H	
	MOV	H,A	
SCC0:
	DCX	D	
	DCR	L	
	MOV	A,M	
	ANA	C	
	MOV	M,A	
	LDAX	D	
	ANI	0FH	
	ORA	M	
	MOV	M,A	
	DCR	B	
	JNZ	SCC0	
NEXT:
	POP	PSW	
	POP	H	
	POP	D	
	POP	B	
	RET
		

;___________ MOVE PROCEDURE ___________
LIIR:
	PUSH	B
	PUSH	D	
	PUSH	H	
LI1:
	MOV	A,M	
	STAX	D	
	INX	D	
	INX	H	
	DCR	B	
	JNZ	LI1	
	POP	H	
	POP	D	
	POP	B	
	RET		

LDIR:
	PUSH	B	
	PUSH	D	
	PUSH	H	
LD1:
	MOV	A,M	
	STAX	D	
	DCX	H	
	DCX	D	
	DCR	B	
	JNZ	LD1	
	POP	H	
	POP	D	
	POP	B	
	RET		

;______________ ADDDR SCREEN _______________
ADDRSC:
	PUSH	PSW	
	MOV	A,E	
	ANI	0FH	
	RLC		
	RLC		
	RLC		
	RLC		
	MOV	L,A	
	MOV	A,D	
	RAR		
	ORI	0A0H	
	MOV	H,A	
	POP	PSW	
	RET		
	END



	END

X	D	
	ANA	C	
	RLC		
	RLC		
	RLC		
	RLC		
	ORA	M	
	MOV	M,A	
	DCR	B	
	JNZ	SCC	
	JMP	NEXT	
SHET:
	MVI	C,0F0H	
SCA0:
	MOV	A,M	
	ANA	C	
	MOV	M,A	
	LDAX	D	
	ANA	C	
	RRC		
	RRC		
	RRC		
	RRC		
	ORA	M	
	MOV	M,A	
	INR	L	
	INX	D	
	DCR	B	
	JNZ	SCA0	
	MVI	B,16	
	MOV	A,H	
	ADI	20H	
	MOV	H,A	
SCC0:
	DCX	D	
	DCR	L	
	MOV	A,M	
	ANA	C	
	MOV	M,A	
	LDAX	D	
	ANI	0FH	
	ORA	M	
	MOV	M,A	
	DCR	B	
	JNZ	SCC0	
NEXT:
	POP	PSW	
	POP	H	
	POP	D	
	POP	B	
	RET
		

;___________ MOVE PROCEDееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееее;;	/* 31.03.1993 PPA Systems Utilites */
;========= ПУОПЧОБС ФБВМЙГБ РЕТЕИПДПЧ ==========
	Public	W_PUTCXY ;ЧЩЧПД УЙНЧПМБ ЛППТД. Ч 'DE'
	Public	ACTIV	;ПФЛТЩФЙЕ ПЛОБ (DE),(HL),Б-ЖМБЗ
	Public	BORT	;ОБТЙУПЧБФШ ТБНЛХ
	Public	SCROL3	;--//-- ЧРТБЧП (ОБ 2 УЙНЧПМБ)
	Public	SCROL4	;--//-- ЧМЕЧП --//--
	Public	PUTCXY	
	Public	ABS_DE
	Public	LIIR
	Public	LDIR
	Public	HL_DE_WIND
	Public	HL_SUB_DE
	Public	ADDRSC	

;______________ ТБВПЮЙЕ СЮЕКЛЙ ________________
	Public	CURSOR
	Public	WIND1
	Public	WIND2
	Public	NUM
	Public	BUF_SEK
	Public	FLAGW
;;
;;      йУИПДОЙЛ ХОЙЧЕТУБМШОПЗП ДТБКЧЕТБ ПЛПООПК УФТХЛФХТЩ
;; ЬЛТБОБ.  рТПЗТБННБ  РПМОПУФША  ОБРЙУБОБ  ОБ  БУУЕНВМЕТЕ
;; ( Intel 8080 )  Й  РТЕДОБЪОБЮЕОБ  ДМС  ОБРЙУБОЙС ЗЙВЛЙИ
;; ДЙБМПЗПЧЩИ    РТПЗТБНН   (  ПЛПООЩЕ  ТЕДБЛФПТЩ  ФЕЛУФБ,
;; ЙОУФТХНЕОФБМШОЩЕ ХФЙМЙФЩ ,Й Ф.Д.)
;;
;;  рПУМЕДОСС НПДЙЖЙЛБГЙС : 31.03.1993  З.лБТБЗБОДБ
;;
;;	+----[ 13.10.1992 ]-------------[ ЛБТБЗБОДБ ]---+
;;	!  БЧФПТ:	рЙНЕОПЧ р.б.			!
;;	!	"дТБКЧЕТ ПЛПООПЗП ЙОФЕТЖЕКУБ"		!
;;	! ПВЕУРЕЮЙЧБЕФ ЧЩЧПД УЙНЧПМШОПК ЙОЖПТНБГЙЙ Ч	!
;;	! ФБЛ ОБЪЩЧБЕНЩЕ "ПЛОБ" ТЕБМЙЪПЧБОЩ УМЕДХАЭЙЕ	!
;;	! ПРЕТБГЙЙ:	ЧЩЧПД ПДЙОПЮОПЗП УЙНЧПМБ	!
;;	!		ПТЗБОЙЪБГЙС ЧУРМЩЧБАЭЙИ ПЛПО	!
;;	!		ПФЮЙУФЛБ ПЛПО (ПВМБУФЕК ЬЛТБОБ)	!
;;	!		ЮФЕОЙЕ УЙНЧПМБ Ч ЪБД. РПЪЙГЙЙ	!
;;	! ЛППТДЙОБФЩ:	ПЛПООЩЕ	(ПФОПУЙФЕМШОЩЕ)		!
;;	!		ЬЛТБООЩЕ (БВУПМ`ФОЩЕ)		!
;;	!________ ТБУРТЕДЕМЕОЙЕ ТПО РТПГЕУУПТБ__________!
;;	!	DE  ->  ЛППТД. ЧЩЧПДБ УЙНЧПМБ МЙВП ХЛБЪ.!
;;	!		МЕЧ. ОЙЦОЕЗП ХЗМБ ПЛОБ (ПВМБУФЙ)!
;;	!		D -> ЗПТЙЪПОФБМШОБС ЛППТДЙОБФБ	!
;;	!		E -> ЧЕТФЙЛБМШОБС --//-- (Y)	!
;;	!	HL  ->	ЛППТД.РТБЧ. ЧЕТИО. ХЗМБ ПЛОБ 	!
;;	!	BC  ->	ХЛБЪБФЕМШ ОБ УФТПЛХ УЙНЦПМПЧ	!
;;	!	A   ->	ЖМБЗ ПЛОБ			!
;;	!	+---+---+---+---+---+---+---+---+	!
;;	!	! 7 ! 6 ! 5 ! 4 ! 3 ! 2 ! 1 ! 0 !	!
;;	!	+---+---+---+---+---+---+---+---+	!
;;	!	ПРЙГБОЙЕ ВЙФПЧ ЖМБЗБ:			!
;;	!		(D0-D1):  ЧЙД "ФЕОЙ"		!
;;	!			00 -> ПФУХФУФЧХЕФ	!
;;	!			01-11 -> 1-3 ФЙРЩ	!
;;	!		(D2-D3):  ЧЙД "ТБНЛЙ"		!
;;	!			00 -> ПФУХФУФЧХЕФ	!
;;	!			01 -> ПДЙОБТОБС		!
;;	!			10 -> ДЧПКОБС		!
;;	!			11 -> ФПЦЕ ПДЙОБТОБС	!
;;	!		   (D4):  РБТЙФЕФ ПЛОБ		!
;;	!			0  -> ВЕЪ ЧПУФБОПЧМЕОЙС	!
;;	!			1  -> У ЧПУФБОПЧМЕОЙЕН	!
;;	+------[ OBJ: 06D0H ]----------[ End remark ]---+


;;============== ТБВПЮЙЕ СЮЕКЛЙ WINDOW.DRIWE =============
CURSOR:		DW	000AH
;;
;;     сЮЕКЛБ ИБТБЛФЕТЕЪХЕФ РПМПЦЕОЙЕ МПЛБМШОПЗП ЛХТУПТБ Ч
;; ЛБЦДПН ПФЛТЩФПН ПЛОЕ Й РТЙ ПФЛТЩФЙЙ ОПЧЩИ ПЛПО ПОБ УПИ-
;; ТБОСЕФУС Ч ВХЖЕТЕ У РПУМЕДХАЭЙН ЧПУФБОПЧМЕОЙЕН РТЙ ЪБЛ-
;; ТЩФЙЙ ПЛОБ.
;;

WIND1:		DW	0	;; (DE) ЛППТДЙОБФЩ ПЛОБ
WIND2:		DW	3F0FH	;; (HL) ---//----//---
;;
;;	дБООЩЕ СЮЕКЛЙ ИТБОСФ БВУПМАФОЩЕ ЛППТДЙОБФЩ РПМПЦЕ-
;; ФЕЛХЭЕЗП ПЛОБ, ЛПФПТЩЕ ФБЛЦЕ ДЙОБНЙЮЕУЛЙ ЧПУФБОБЧМЙЧБА-
;; ФУС РТЙ ПРЕТБГЙСИ ПФЛТЩФЙС Й ЪБЛТБФЙС ОПЧЩИ ПЛПО
;;

NUM:		DB	0
;;
;;	уПДЕТЦЙФ ЛПМЙЮЕУФЧП ПФЛТЩФЩИ ОБ ДБООЩК НПНЕОФ ПЛПО.
;;

BUF_SEK:	DW	BUF_BEGIN	;
;;
;;	дЙОБНЙЮЕУЛБС СЮЕКЛБ ПФТБЦБАЭБС ЧЕМЙЮЕОХ ЪБРПМОЕОЙС
;; ВХЖЕТБ ПЛПО.
;;

FLAGW:		DB	0
;;
;;	вЙФПЧЩК ЖМБЗ ФЕЛХЭЕЗП ПЛОБ У РПНПЭЙА ЕЗП НПЦОП ХЪ-
;; ОБФШ П ФЙРЕ ФЕЛХЭЕЗП ПФЛТЩФПЗП ПЛОБ.
;;
BUF1:		DW	0000h
;;
;;	чУРПНПЗБФЕМШОБС ТБВПЮБС СЮЕКЛБ РБНСФЙ ЙУРПМШЪХЕФУС
;; РТПГЕДХТБНЙ ПФЛТЩФЙС Й ЪБЛТЩФЙС ПЛПО.
;;

DOUBLE:         DB	098h,099h,08Bh,08Ch,08Ah,09Dh
INTEG:		DB	090h,0AAh,08Fh,0A9h,083h,094h
;;
;;     вМПЛЙ ДБООЩИ ОЕПВИПДЙНЩЕ РТЙ ЧЩВПТЕ ТБЪМЙЮОЩИ ФЙРПЧ
;; ТБНПЛ ПВТБНМСАЭЙИ ПЛОП.
;;

;+-------------[ OPEN WINDOW ]----------+
;*	ЧИПД:	DE -> М.О ХЗПМ		*
;*		HL -> Р.Ч ХЗПМ		*
;*		A  -> ЖМБЗ ПЛОБ		*
;*	ЧЩИПД:	A  ->   = 0  - ХУРЕЫОП	*
;*			<> 0 - ПЫЙВЛБ	*
;+--------------------------------------+
ACTIV:
	PUSH	B	; УПИТБОЙН ЧУЕ ТЕЗЙУФТЩ
	PUSH	D	; РТПГЕУУПТБ
	PUSH	H	;
	PUSH	PSW	;
	LDA	FLAGW	; РТПЮЙФБЕН РТЕДЩДХЭЙК
	STA	BUF1	; ЖМБЗ ПЛОБ Й УПИТБОЙН
	POP	PSW	; ЧП ЧТЕНЕООПН ВХЖЕТЕ
	STA	FLAGW	; ХУФБОБЧМЙЧБЕН ОПЧЩК ЖМБЗ
	MOV	A,H	; РТПЙЪЧПДЙН РТПЧЕТЛХ ОБ
	SUB	D	; ЛПТЕЛФОПУФШ ЧИПДОЩИ
	JC	WSQ1	; ДБООЩИ
	MOV	B,A	;
	MOV	A,L	;
	SUB	E	;
	JC	WSQ1	;
	MOV	C,A	;
	LDA	FLAGW	;
	ANI	0FH	;
	JNZ	OP1	;
	MOV	A,B	;
	CPI	3FH	;
	JC	OP2	;
	MVI	B,3FH	;
	MVI	D,0	;
	MVI	H,3FH	;
OP2:
	MOV	A,C	;
	CPI	0FH	;
	JC	SLED1	;
	MVI	C,0FH	;
	MVI	E,0	;
	MVI	L,0FH	;
SLED1:
	CALL	WSAVE	;РХУФПЕ ПЛОП
	CALL	CLS	;
	JMP	DALHE	;
OP1:
	CPI	04H	;
	JC	OP3	;РЕТЕИПД ЕУМЙ ОЕФ ТБНЛЙ
	ANI	03H	;
	JNZ	OP3	;
	MOV	A,B	;
	CPI	3DH	;
	JC	OP4	;
	MVI	B,3DH	;
	MVI	D,01H	;
	MVI	H,3EH	;
OP4:
	MOV	A,C	;
	CPI	0DH	;
	JC	SLED2	;
	MVI	C,0DH	;
	MVI	E,01H	;
	MVI	L,0EH	;
SLED2:
	DCR	D	;
	DCR	E	;
	INR	H	;
	INR	L	;
	CALL	WSAVE	;
	CALL	CLS	;
	CALL	RAMKA	;
	DCR	H	;
	DCR	L	;
	INR	D	;
	INR	E	;
	JMP	DALHE	;
OP3:
	MOV	A,B	;
	CPI	3CH	;
	JC	OP5	;
	MVI	B,3CH	;
	MVI	D,01H	;
	MVI	H,3DH	;
OP5:
	MOV	A,C	;
	CPI	0CH	;
	JC	SLED3	;
	MVI	C,0CH	;
	MVI	E,02H	;
	MVI	L,0EH	;
SLED3:
	DCR	D	;
	DCR	E	;
	DCR	E	;
	INR	H	;
	INR	H	;
	INR	L	;
	CALL	WSAVE	;
	INR	E	;
	DCR	H	;
	CALL	CLS	;
	CALL	RAMKA	;
	CALL	TEN	;
	INR	E	;
	INR	D	;
	DCR	H	;
	DCR	L	;
DALHE:
	SHLD	WIND2	;
	XCHG		;
	SHLD	WIND1	;
	LXI	H,0	;
	SHLD	CURSOR	;
	XRA	A	;
WSQ1:
	POP	H	;
	POP	D	;
	POP	B	;
	EI		;
	RET		;
;+--------[ ФЕОШ ]------+
;* ЧИПД:  DE,HL -WINDOW *
;+----------------------+
TEN:
	PUSH	H	;
	PUSH	D	;
	LDA	FLAGW	;
	ANI	3	;
	ADD	A	;
	ADI	7	;
	MOV	B,A	;
	INR	H	;
	DCR	L	;
	DCR	E	;
TE1:
	MOV	A,B	;
	INR	D	;
	CALL	PUTCXY	;
	MOV	A,D	;
	CMP	H	;
	JNZ	TE1	;
	INR	B	;
TE3:	MOV	A,B	;
	INR	E	;
	CALL	PUTCXY	;
	MOV	A,E	;
	CMP	L	;
	JNZ	TE3	;
	POP	D	;
	POP	H	;
WSAVE:
	RET		;
;
;+--------------[ DRAW BOARD ]----------+
;*	ЧИПД:	DE,HL -> ЛППТД.ПЛОБ	*
;*		A -> ЖМБЗ		*
;+--------------------------------------+
BORT:
	PUSH	B	
	PUSH	D	
	PUSH	H	
	PUSH	PSW	
	ANI	4	
	LXI	B,DOUBLE
	JZ	BORT01	
	LXI	B,INTEG	
BORT01:
	LDAX	B	
	CALL	PUTCXY	
	PUSH	D	
	MOV	E,L	
	INX	B	
	LDAX	B	
	CALL	PUTCXY	
	XCHG		
	INX	B	
	LDAX	B	
	CALL	PUTCXY	
	XTHL		
	MOV	E,L	
	INX	B	
	LDAX	B	
	CALL	PUTCXY	
	XTHL		
	DCR	L	
	PUSH	D	
	INX	B	
BORT02:
	LDAX	B	
	INR	E	
	CALL	PUTCXY	
	MOV	A,E	
	CMP	L	
	JNZ	BORT02	
	POP	D	
	XCHG		
	PUSH	D	
	INR	L	
BORT03:
	LDAX	B	
	CALL	PUTCXY	
	DCR	E	
	MOV	A,E	
	CMP	L	
	JNC	BORT03	
	POP	D	
	POP	PSW	
	INX	B	
	INR	E	
	DCR	L	
CONT:
	INR	D	
	DCR	H	
	LDAX	B	
	CALL	PUTCXY	
	PUSH	D	
	MOV	E,L	
	CALL	PUTCXY	
	POP	D	
	XCHG		
	CALL	PUTCXY	
	PUSH	D	
	MOV	E,L	
	CALL	PUTCXY	
	POP	D	
	XCHG		
	MOV	A,D	
	CMP	H	
	JC	CONT	
	JMP	NEXT

;-----------[ MAIN HELP ]----------+
;*  ЗМПВБМШОЩЕ ЧУРПНПЗБФ. РПДРТПЗТ.*
;+---------------------------------+
HL_SUB_DE:
	MOV	A,H	
	SUB	D	
	INR	A	
	MOV	B,A	
	MOV	A,L	
	SUB	E	
	INR	A	
	MOV	C,A	
	RET		

HL_DE_WIND:
	LHLD	WIND1	
	XCHG		
	LHLD	WIND2	
	RET		

;+------[ SCROLLING HELP ]-------+
;*		--//--		 *
;+-------------------------------+

SCH1:
	PUSH	B	
	PUSH	D	
	PUSH	H	
SH10:
	CALL	LDIR	
	DCR	H	
	DCR	D	
	DCR	C	
	JNZ	SH10	
	POP	H	
	POP	D	
	POP	B	
	MOV	A,H	
	ADI	20H	
	MOV	H,A	
	MOV	A,D	
	ADI	20H	
	MOV	D,A	
SH11:
	CALL	LDIR	
	DCR	H	
	DCR	D	
	DCR	C	
	JNZ	SH11	
	RET		
SCH2:
	PUSH	B	
	PUSH	D	
	PUSH	H	
SH20:
	CALL	LIIR	
	INR	H	
	INR	D	
	DCR	C	
	JNZ	SH20	
	POP	H	
	POP	D	
	POP	B	
	MOV	A,H	
	ADI	20H	
	MOV	H,A	
	MOV	A,D	
	ADI	20H	
	MOV	D,A	
SH21:
	CALL	LIIR	
	INR	H	
	INR	D	
	DCR	C	
	JNZ	SH21	
	RET		

;+----------[ CURSOR ABSOLUTE ]---------+
;*	ЧИПД:	DE -> ПФОПУЙФ.ЛППТД.	*
;*	ЧЩИПД:	DE -> БВУПМ`ФОЩЕ ЛППТД.	*
;+--------------------------------------+

ABS_DE:
	PUSH	PSW	
	PUSH	H	
	LHLD	WIND1	
	MOV	A,D	
	ADD	H	
	MOV	D,A	
	MOV	A,E	
	ADD	L	
	MOV	E,A	
	POP	H	
	POP	PSW	
	RET


;+--------[ SCROLL WINDOW ]---------+
;*    РТПГЕДХТЩ УЛТПМЙОЗБ ПЛПО 	    *
;+----------------------------------+
;ЯЯЯЯЯЯЯЯЯЯЯЯЯЯ  ЧРТБЧП ЯЯЯЯЯЯЯЯЯЯЯЯЯ
SCROL3:
	PUSH	B	
	PUSH	D	
	PUSH	H	
	PUSH	PSW	
	CALL	HL_DE_WIND	
SC3P:
	CALL	HL_SUB_DE	
	MOV	A,C	
	MOV	C,B	
	PUSH	D	
	PUSH	H	
	ANI	0FH	
	RLC		
	RLC		
	RLC		
	RLC		
	MOV	B,A	
	MOV	A,C	
	RAR		
	DCR	A	
	MOV	C,A	
	XCHG		
	INR	E	
	CALL	ADDRSC	
	DCX	H	
	MOV	D,H	
	MOV	E,L	
	DCR	H	
	CALL	SCH1	
	POP	H	
	POP	D	
	MOV	H,D	
	INR	H	
	CALL	CLS
	JMP	NEXT
;ЯЯЯЯЯЯЯЯЯЯЯЯЯЯ ЧМЕЧП ЯЯЯЯЯЯЯЯЯЯЯЯЯ
SCROL4:
	PUSH	B	
	PUSH	D	
	PUSH	H	
	PUSH	PSW	
	CALL	HL_DE_WIND	
SC4L:
	CALL	HL_SUB_DE	
	PUSH	D	
	PUSH	H	
	MOV	A,C	
	MOV	C,B	
	ANI	0FH	
	RLC		
	RLC		
	RLC		
	RLC		
	MOV	B,A	
	MOV	A,C	
	RAR		
	DCR	A	
	MOV	C,A	
	CALL	ADDRSC	
	MOV	D,H	
	MOV	E,L	
	INR	H	
	CALL	SCH2	
	POP	H	
	POP	D	
	MOV	D,H	
	DCR	D	
	CALL	CLS	
	JMP	NEXT
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
W_PUTCXY:
	PUSH	D	
	CALL	ABS_DE	
	CALL	PUTCXY	
	POP	D	
	RET		

PUTCXY:
	PUSH	B	
	PUSH	D	
	PUSH	H	
	PUSH	PSW	
	MOV	B,A	
	CALL	ADDRSC	
	XCHG		
	MOV	A,H	
	RRC		
	MOV	A,B	
	MVI	B,16	
	PUSH	PSW
	PUSH	D		;ПРТЕДЕМЕОЙС ОБЮБМБ ЪОБЛПЗЕОЕТБФПТБ
	MVI	H,0
	MOV	L,A	
	DAD	H	
	DAD	H	
	DAD	H	
	DAD	H	
	LXI	D,W_ZG		;ХЛБЪБФЕМШ ОБ ЪОБЛПЗЕОЕТБФПТ
	DAD	D
	POP	D	
	POP	PSW
	XCHG		
	JC	SHET	
	MVI	C,0FH	
SCA:
	MOV	A,M	
	ANA	C	
	MOV	M,A
	LDAX	D	
	ANI	0F0H	
	ORA	M	
	MOV	M,A	
	INR	L	
	INX	D	
	DCR	B	
	JNZ	SCA	
	MVI	B,16	
	MOV	A,H	
	ADI	20H	
	MOV	H,A	
SCC:
	DCX	D	
	DCR	L	
	MOV	A,M	
	ANA	C	
	MOV	M,A	
	LDAX	D	
	ANA	C	
	RLC		
	RLC		
	RLC		
	RLC		
	ORA	M	
	MOV	M,A	
	DCR	B	
	JNZ	SCC	
	JMP	NEXT	
SHET:
	MVI	C,0F0H	
SCA0:
	MOV	A,M	
	ANA	C	
	MOV	M,A	
	LDAX	D	
	ANA	C	
	RRC		
	RRC		
	RRC		
	RRC		
	ORA	M	
	MOV	M,A	
	INR	L	
	INX	D	
	DCR	B	
	JNZ	SCA0	
	MVI	B,16	
	MOV	A,H	
	ADI	20H	
	MOV	H,A	
SCC0:
	DCX	D	
	DCR	L	
	MOV	A,M	
	ANA	C	
	MOV	M,A	
	LDAX	D	
	ANI	0FH	
	ORA	M	
	MOV	M,A	
	DCR	B	
	JNZ	SCC0	
NEXT:
	POP	PSW	
	POP	H	
	POP	D	
	POP	B	
	RET
		

;___________ MOVE PROCEDURE ___________
LIIR:
	PUSH	B
	PUSH	D	
	PUSH	H	
LI1:
	MOV	A,M	
	STAX	D	
	INX	D	
	INX	H	
	DCR	B	
	JNZ	LI1	
	POP	H	
	POP	D	
	POP	B	
	RET		

LDIR:
	PUSH	B	
	PUSH	D	
	PUSH	H	
LD1:
	MOV	A,M	
	STAX	D	
	DCX	H	
	DCX	D	
	DCR	B	
	JNZ	LD1	
	POP	H	
	POP	D	
	POP	B	
	RET		

;______________ ADDDR SCREEN _______________
ADDRSC:
	PUSH	PSW	
	MOV	A,E	
	ANI	0FH	
	RLC		
	RLC		
	RLC		
	RLC		
	MOV	L,A	
	MOV	A,D	
	RAR		
	ORI	0A0H	
	MOV	H,A	
	POP	PSW	
	RET		
	END

h,0C5h,0D2h,0D7h
	DB	0C9h,0D3h,020h,15,15
	DB	" 7 - ",0F7h,0D9h,0C8h,0CFh
	DB	0C4h,0
START_END:
	END

ееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееее* щ  ГГ  НbНёГ{#ё##ГwГ{Г–ГаГЕГјГHГГ!ГKГ]ГjГUшН2НµГб^#V#е*~#foЙб^#е *~#foЙб^#V#е*nЙб^#е *nЙб^#V#ел	~#foЙб^#ел& 	~#foЙ! И+Й!  И#Й! Ш+Й!  Ш#Й! р+Й! ш+Й ИЙ  ИЙ ШЙ  ШЙ рЙ шЙ}»А|єЙлzјА{ЅЙл|єА}»Йл|Єтмz·р7Йл|Єту|·р7ЙzхНZлНZлН)с·р|/g}/o#Й  |µИХеН‰СНk|/g}/o#СЙЇ2hНZлНZНk:hР|/g}/o#Й|·р/g}/o#:h<2hЙЕНqБЙDM!  x±ИxGyOТѓл)лГv|µИЕН”`iБЙ|·ъ )Г–лx  хНЭЪ·Хz/W{/_СЇzW{_с=ИхyOxGГ¦Ї2hНZлНZлН‰ГM|єША}»ЙлИЇ|g}oГжлИ)Гф|/g}/o#Йz/W{/_Й! 9~#foЙ! Г! Г!
 Г! Г! Г! ГP! 9Е~#ВAБЙ!  9"w* МчщГ*wщЙб"j!zе*"d!и"f!ЬY"H>Ы2^>У2a>Й2`2cН>Ї2s2t>2r>2v! М"@! "D!@ "B! "FН · КЙН !Ђ щF#x·ВЬ Г:~#ВЬЇ!щ |Ї2i~#ю Ку·К:ю"В	2iГ
+}|~#·К:ЕG:i·xБК.ю"ВЇ2i+w#ю В+6 #ГуХ!Ю6 #В@НAЇ2n2?*jй*л*Нъ|µИ+ЇГ`Й"d!и"f!!яяЙ>хНЕЪЊo& еН–бс=юВ}Г	Н
НЕЪw~Н2жКёеНЕНјлН БбН56 юя!  А+ЙWЦШю	?ШХ_ !Ю~ж7СzИ?ЙЕН§ею:> ВчНћЦ@w#НН5ю.ВНЇw w#w#w#wСБЙЕю*>?К@НЊЪ>w#ВБНЊШГ5> w#В@БЙЕеН§НµТgХ яН С2qбБГ& ХЦ0Ox‡‡‡ЂЂЃGНµТjю/К†СГSбxГ\Нћю.7Ию:7Ию7Ию!ЙюaШю{РЦ Йю КЁю	КЁЙю0Шю:?ЙЕ·OВж	Ю!љжyВХБЙХ$ СВМ7БЙНЕЪгЦo& ))T])))л!љyБЙЕеХх яН 2pсхж_ Н сСбБЙЕеХх:pГ                                                                                     ѓ6ЙЕел)))®Y~хжюЉ0Мї7сж‡G~хж`°2Ћ@сж2“@#~ж2Ќ@~ж?>Кв&=2†@#^#V#Х^#V#л"Џ@л^#Vл"‘@С:“@·К'*{@ л!  :Ћ@ж@К'"‘@бБЙе*Ґ@#w"Ґ@бЙе*Ґ@~юяК9'·ВD'Ь/Нї7Н€?бЙ+"Ґ@бЙе*Ґ@+"Ґ@бЙе!6D"Ґ@6я!^D"§@бЙе*Ґ@~·бИюяЙех*Ќ@л*§@s#r#л*Џ@лs#r#л*‘@лs#r#л*‰@лs#r#л*‹@лs#r#:“@w#"§@Но'сбЙех*@л*§@s#r#л*љ@лs#r#л*њ@лs#r#л*”@лs#r#л*–@лs#r#:ћ@w#"§@Но'сбЙ|юEШВщ'}юXШО2Гк7ех*§@+~2“@+V+^+л"‹@лV+^+л"‰@лV+^+л"‘@лV+^+л"Џ@лV+^"§@л"Ќ@сбЙех*§@+~2ћ@+V+^+л"–@лV+^+л"”@лV+^+л"њ@лV+^+л"љ@лV+^"§@л"@сбЙНp'Н;(ЙНЇ'Ня'ЙеН‹(бЙ! "џ@"K@Ї2¤@<2Ј@2ў@2Ў@НҐ)Ки(НЪ)Ки(Н*Вѕ(Ї2ў@2Ў@Гг(НS*ВП(Н#)Ї2ў@2Ј@ЙНЖ)ИНl*КГЦГГtГ‰ГсГКГBГд
ГлГџЕ!|я9щDM!
еН»СНђ€++|µКщ!u
еНѕС! е!Љ 	~#fo##~#foеНБССл`is#rНђ #|µВ)	!Њ
еНѕС! е!  еНђ еНДСССл! 	s#r!  е!  еНђ еНДСССНђе!Љ 	~#fo##~#foе!”
еНЗССС! 	^#Vr+szіКй	! е! 	еНђ еНКССС#|µВЁ	!­
еНѕС! 	еННС! е!яяеНђ еНДССС! е! 	еНђ еНРССС#|µВж	!Ѕ
еНѕСГu	!О
еН»С!  еНУСл!„ 9щлБЙ(C)  Pasha  Systems.Ltd   1992     fone:  52-81-95
           Special for MAR.COM and M80.COM    link:  1.2.1993

 Format: tp <file.ext>
 No file file: %s real bloc = %d
 Error read file Error write file 
Process complete !!! Гк
ГЕ!юя9щDM`iЇw#wНђ Ђя|Тi! 	~#foеНђ Сn& `я|Ъ]! 	~#foеНђ Сn& @я|Т]! 	~#foеНђ Сеn& Ђялбs!rеНз
С`i^#Vr+sГш
л! 9щлБЙ+ Г}ГГџЕ!  9щDMНђеНwС!яяеНzСБЙГћГўЕ!  9щDMНђn}·КИ! 	^#Vr+sлn& еН›СГ¦БЙГУГўГнЕ!  9щDM*Ое! 	еНРССБЙБЙГьГжГЋГЅГ Е!Yя9щDM!« 	^#Vr+sл~#foл! 	s#rНђ«л!Ґ 	s#r! 	^#Vr+sлnл`is{·КЧ`in}ю%ВЁ! 	л!њ 	s#r!Ј 	6#6 !  	 s!ћ 	s!џ 	sНђn}ю-ВЊ! 	^#Vr+s!џ 	4Нђn}ю0Вњ!  	4Нђn& еНуС}·К№! 	еНцСГј!  л!Ў 	s#r! 	^#Vr+sлnл`is{ю.В! 	еНцСл!Ј 	s#r!ћ 	4! 	^#Vr+sлnл`is`in& еНщС}юDК5юUКqюXКzюOКѓюCКЙюSКъю КsГyНђҐ~#fo|Тq!њ 	^#Vr+sл6-НђҐеНђҐ~#foНълбs#r!Ў 	^#Vr+s! 	6
Г‰! 	6Г‰! 	6!Ў 	е~#foе! 	n& е!Ґ 	^#Vr+sл~#foе!њ 	еНрССССЇgНълбs#rГr!њ 	^#Vr+sХ!Ґ 	^#Vr+sл~#foлбs!Ў 	^#Vr+sГr!ћ 	n}·В!Ј 	6И#6 !Ґ 	^#Vr+sл~#foл! 	s#rНђn}·КrНђЈ|µКr!њ 	^#Vr+sХ! 	^#Vr+sлnлбs!Ј 	^#Vr+s!Ў 	^#Vr+sГ(Нђњ6 ! 	л!њ 	s#r!џ 	n}·Ва!Ў 	^#Vr+s!яя|ЪаНђ­еНђЇе!  	n}·КЅ!0 ГА!  е!Ое! 9~#foйССС#|µВЭ!яяГЭГЋНђњn}·К$Нђ­еНђЇе!њ 	^#Vr+sлn& е!е! 9~#foйССС#|µВ!!яяГЭГа!џ 	n}·Кp!Ў 	^#Vr+s!яя|ЪpНђ­еНђЇе!  е!^е! 9~#foйССС#|µВm!яяГЭГ.ГҐ!  ГЭНђ­еНђЇе`in& е!–е! 9~#foйССС#|µВҐ!яяГЭГФНђ­еНђЇе`in& е!Ее! 9~#foйССС#|µВФ!яяГЭГ+!  ГЭл!§ 9щлБЙГмГжЕ!яя9щDMНђеНђ	СНмТ:Нђ^#Vr+sХНђцяЪ'Нђ0 Г/Нђ7 лбs! & Г…Нђ	еНђеНђ	СН‰еНђеНйСССл`isНђ	еНђеНђ	СН)еНђеНйССС`in& #& Г…л! 9щлБЙЕ!  9щDM! 	n& Ря|НЇЪ№! 	n& Жя|Н©БЙБЙГГГЋЕ!юя9щDM`iЇw#wНђ~#fon& еНАС}·КНђ 
 Н?еНђ^#Vr+sлnСЇgРял`is#rГСНђ Гл! 9щлБЙГ&ГZЕ!  9щDM! 	n& еН#С|µКM! 	n& аяГT! 	n& & БЙБЙЕ!  9щDM! 	n& џя|НЇЪ…! 	n& …я|Н©БЙБЙН7ЇН,Т>
Г2hл*PлЕН/:qН2Н юяБ>Ки:hН):R·КФ=КФ=>Ви:q‚w#Їw#w:ho& Н5ЙН52?ГГчГСН7Е:PН,>Т2?БГе! ^#V*R:T·К6=В'Г6*PХеНфССл*Rг! Сs#rлБЙН7:PН)V>Ъеzж>КеЕzН2:PН,"j!  "l*T|µ*lВ}Н5БЙ*RлН *jл!ХН С·К®2?юКЁюКЁ!яяГx*lГx*T+"T*RЂ "R*l#"l*j! 	N#Fp+qx±Вm##6>2?Гr2?ГН7:PН)"XV>Ъ™zж>	К™ЕzН2:PН,"j!  "l*T|µВG*j! ^#VХ*X#^#VглНЭбТ?r+s*lН5БЙ*RелН бЂ "R*jл"Н *l·Кo2?ГB#"l*T+"T*j! 	N#Fp+qx±В##6>2?Г?2?ГГ Н
Ею
В¶Н >
_Н Н ·ВЕБЙН юК БЙН
Н,Тв>2?ГЕеНН)~Н2#"jС!! е~#foе#Н Бб^#Vp+q*jе~#foНЭТгs#rлСН5БЙН& Г…л! 9щлБЙЕ!  9щDM! 	n& Ря|НЇЪ№! 	n& Жя|Н©БЙБЙГГГЋЕ!юя9щDM`iЇw#wНђ~#fon& еНАС}·КНђ 
 Н?еНђ^#Vr+sлnСееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееее;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;		   Title    VGEQU.ASM
;;      (C) 1993 лБТБЗБОДБ Copyright  by  рЙНЕОПЧ рБЫБ
;;      Header  -  ЖБКМ  ПРТЕДЕМЕОЙС  ЛПОУФБОФ ДМС РТПЗТБНН
;; ОБ  БУУЕНВМЕТЕ  У  ПТЕОФБГЙЕК ОБ ТБВПФХ У ОБЛПРЙФЕМЕН ОБ
;; ЗЙВЛЙИ НБЗОЙФОЩИ ДЙУЛБИ (ознд) УРЕГЙБМШОП ДМС чЕЛФПТ-06г
;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

DS_STATUS	EQU 1BH	; ТЕЗЙУФТ УФБФХУБ EQU COM
DS_COM		EQU 1BH	; ТЕЗЙУФТ ЛПНБОД Й УФБФХУБ
DS_TRACK	EQU 1AH	; ТЕЗЙУФТ ДПТПЦЛЙ
DS_SECTOR	EQU 19H	; ТЕЗЙУФТ УЕЛФПТБ
DS_DATA		EQU 18H	; ТЕЗЙУФТ ДБООЩИ
DS_MOTOR	EQU 1CH	; ЪБРХУЛ ДЧЙЗБФЕМС

;;				/* PPA Systems */
;;ыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыы
;;
;;    пРТЕДЕМЕОЙЕ ПУОПЧОЩИ ЧУРПНПЗБФЕМШОЩИ ЛПОУФБОФ
;;
SYS_MDOS	EQU 5	; system point CP/M
SECSIZ		EQU 80H	; дМЙООБ ЪБРЙУЙ Ч CP/M
CR		EQU 0DH ; лПОЕГ УФТПЛЙ
LF		EQU 0AH	; рЕТЕЧПД УФТПЛЙ

;;ыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыы
;;
;;    лПОУФБОФЩ ДМС ТБВПФЩ У FCB ЖБКМПЧ
;;
DR_OFSET	EQU 0	; уНЕЭЕОЙЕ ОПНЕТБ ОБЛПРЙФЕМС Ч ВМПЛЕ FCB
NM_OFSET	EQU 1	; уНЕЭЕОЙЕ ЙНЕОЙ ЖБКМБ Ч ВМПЛЕ FCB
ET_OFSET	EQU 9	; уНЕЭЕОЙЕ ТБУЫЙТЕОЙС Ч ВМПЛЕ FCB
EX_OFSET	EQU 12	; уНЕЭЕОЙЕ ОПНЕТБ ФЕЛХЭЕЗП ЬЛУФЕОФБ
RC_OFSET	EQU 15	; уНЕЭЕОЙЕ ЮЙУМБ ЪБРЙУЕК ДБООПЗП ЬЛУФЕОФБ
CR_OFSET	EQU 32	; уНЕЭЕОЙЕ ОПНЕТБ ФЕЛХЭЕК ЪБРЙУЙ

;;ыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыы
;;
;;    пУОПЧОЩЕ ЖХОЛГЙЙ РТЕДПУФБЧМСЕНЩЕ пу CP/M
;;
_OUT_STRING	EQU 9	; чЩЧПД УФТПЛЙ Ё Terminated '$' )
_DISK_RESET	EQU 13	; УВТПУ ДЙУЛПЧПК РПДУЙУФЕНЩ
_SELECT		EQU 14	; ЧЩВПТ ДЙУЛБ
_OPENC		EQU 15	; ПФЛТЩФЙЕ ЖБКМБ
_CLOSEC		EQU 16	; ЪБЛТЩФЙЕ ЖБКМБ
_SEARCH_1	EQU 17	; РПЙУЛ РЕТЧПЗП ЧИПДБ
_SEARCH_N	EQU 18	; РПЙУЛ УМЕДХАЭЕЗП ЧИПДБ
_DELC		EQU 19	; ХДБМЕОЙЕ ЖБКМБ
_READS		EQU 20	; ЮЙФБФШ ФЕЛХЭАА ЪБРЙУШ Ч DMA
_WRITS		EQU 21	; ЪБРЙУБФШ ---//----///----
_GREATS		EQU 22	; УПЪДБФШ ЖБКМ ОБ ДЙУЛЕ
_RENC		EQU 23	; РЕТЕЙНЕОПЧБФШ ЖБКМ
_IN_DISK	EQU 25	; РПМХЮЙФШ ФЕЛХЭЙК ДЙУЛ
_SET_DMA	EQU 26	; ХУФБОПЧЙФШ DMA
_GSUSER		EQU 32	; РПМХЮЕОЙЕ/ХУФБОПЧЛБ ЛПДБ РПМШЪПЧ.
_READR		EQU 33	; РТПЙЪЧПМШОПЕ ЮФЕОЙЕ
_WRITR		EQU 34	; РТПЙЪЧПМШОБС ЪБРЙУШ
_SFSIZC		EQU 35	; ПРТЕДЕМЕОЙЕ ТБЪНЕТБ ЖБКМБ
_SRRECC		EQU 36	; ХУФБОПЧЛБ ХЛБЪБФЕМС ДМС РТПЙЪЧПМШОПЗП
			; ПВНЕОБ У ЖБЙМПН
_SETMUL		EQU 44	; ХУФБОПЧЛБ НХМШФЙУЕЛФПТОПК ПВТБВПФЛЙ
;;ыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыыы
ыыыыыыыыыыыыыыыыыыыыыыыыыыы
;;
;;    пУОПЧОЩЕ ЖХОЛГЙЙ РТЕДПУФБЧМСЕНЩЕ пу CP/M
;;
_OUT_STRING	EQU 9	; чЩЧПД УФТПЛЙ Ё Terminated '$' )
_DISK_RESET	EQU 13	; УВТПУ ДЙУЛПЧПК РПДУЙУФЕНЩ
_SELECT		EQU 14	; ЧЩВПТ ДЙУЛБ
_OPENC		EQU 15	; ПФЛТЩФЙЕ ЖБКМБ
_CLOSEC		EQU 16	; ЪБЛТЩФЙЕ ЖБКМБ
_SEARCH_1	EQU 17	; РПЙУЛ РЕТЧПЗП ЧИПДБ
_SEARCH_N	EQU 18	; РПЙУЛ УМЕДХАЭЕЗП ЧИПДБ
_DELC		EQU 19	; ХДБМЕОЙЕ ЖБКМБ
_READS		EQU 20	; ЮЙФБФШ ФЕЛХЭАА ЪБРЙУШ Ч DMA
_WRITS		EQU 21	; ЪБРЙУБФШ ---//----///----
_GREATS		EQU 22	; УПЪДБФШ ЖБКМ ОБ ДЙУЛЕ
_RENC		EQU 23	; РЕТЕЙНЕОПЧБФШ ЖБКМ
_IN_DISK	EQU 25	; РПМХЮЙФШ ФЕЛХЭЙК ДЙУЛ
_SET_DMA	EQU 26	; ХУФБОПЧЙФШ DMAееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееее                    зZ~<з       зяЅ™яяЫяз   f f f f f язffB f f f f f f f f  BBffзя f f f f      "fооf"                         DfwwfD            рррррррррррррррррррррррр         яяяяяяяяяяяяяяяяяяяяяяя        $’I$’I$’’I$’I$’I$’I$’I$’ пппппппппппппп    Ђ„ДЖжзжЖД„Ђ     !#cgзgc#!   яяяяяяяяяяяяя      ҐҐ ҐҐҐҐҐҐ       eeeеmmmmз     ж©"F¦©©¦F„©ж      ппп            зBfзBBBзfB       BBBBBBзfB       BfзBBBBBB         B"п"B           D„п„D                                                                                         BB BBBBBB              ҐҐҐ      ¦¦п¦¦¦п¦¦       	 F¦¦F 	        ©ҐDB"©‰         еЄЄкеF¦¦F             DBBB      "BDDDDDB"       DB"""""BD         ҐfяfҐ           BBзBB        DBBB                 з           BB              €„DB"!        ж©©­нл«©ж       зBBBBBЖFB       п©„DB"!©ж       ж©!!fB"©п       c""пЄ¦fb"       ж©!!о€€€п       ж©©©о€€„F       DDDDB"!©п       ж©©©ж©©©ж       Ж"!!з©©©ж        BB   BB        DBB   BB        !"BD„DB"!         з  з          „DB"!"BD„       BB BB"©©ж       ж€кллл©©ж       ©©©п©©¦F@       оҐҐҐжҐҐҐо       fҐ‰€€€‰Ґf       О¦ҐҐҐҐҐ¦О       пҐ…†Ж†…Ґп       М„„†Ж†…Ґп       GҐ©«€€‰Ґf       ©©©©п©©©©       fBBBBBBBf       ЖЄЄ"""""c       ­Ґ¦¦Ж¦¦Ґ­       пҐ…„„„„„М       ©©©©©йпЇ©       ©©©«лн­©©       F¦©©©©©¦F       М„„„жҐҐҐо      #"жлй©©©©ж       ­ҐҐ¦жҐҐҐо       ж©©"F„©©ж       fBBBBBZЫя       ж©©©©©©©©       @F¦©©©©©©       ¦Їпйй©©©©       ©©©¦FF¦©©       fBBBfҐ™™™       п©‰„DB*©п       fDDDDDDDf       !"BD„€        f"""""""f              ©¦F@   я                         "@B     еЄЄж"Ж          кҐҐҐ¦Ж„„Њ       ж©€€©ж          еЄЄЄ¦f""b       ж©€п©ж          ЖDDDЖDEeb     ЖЄ"жЄЄЄе          ­ҐҐҐе¦„„Њ       fBBBBF BB     F¦¦""""b ""       ­Ґ¦Ж¦Ґ„„Њ       fBBBBBBBF       ййййй®          ҐҐҐҐҐж          ж©©©©ж        М„„жҐҐҐо        c""жЄЄЄе          М„„Ґек          ж©bД©ж          beDDоDD@        еЄЄЄЄЄ          @F¦©©©          ¦пйй©©          ©¦FF¦©        Ж"!з©©©©          пҐDBЄп          #BBBDBBB#       BBBBBBBBB       ДBBB"BBBД                я    я             ] » ] » ] » ] » рррррррр’I$’I$’I$’I$’I$’BBBBBBBBBBBBBBBBBBBBBBBООBBBBBBBBBBBBBОBBОBBBBBB$$$$$$$¬¬$$$$$$$$$$$$$$оо       BBBBBBОBBО      $$$$$$¬  ¬$$$$$$$$$$$$$$$$$$$$$$$$$$$$¬  о            о  ¬$$$$$$       оо$$$$$$$      ОBBОBBBBBBBBBBBBBОО              ssBBBBBBB       яяBBBBBBBBBBBBBBяя       BBBBBBBssBBBBBBB       яя       BBBBBBBяяBBBBBBBBBBBBBsBBsBBBBBB$$$$$$$55$$$$$$$      w5$$$$$$$$$$$$5w            я  Ѕ$$$$$$$$$$$$Ѕ  я      $$$$$$55$$$$$$      я  я      $$$$$$Ѕ  Ѕ$$$$$$      я  яBBBBBB       яя$$$$$$$BBBBBBя  я      $$$$$$$яя              ww$$$$$$$      sBBsBBBBBBBBBBBBsBBs      $$$$$$$ww       $$$$$$$ЅЅ$$$$$$$BBBBBBя  яBBBBBB       ООBBBBBBBBBBBBBBss                                                                                                                                                                                                                                                                                                        "T0pшp0T"  ZfҐЫз з зЫҐfZ  ЂD**DЂ      ЄййнйЄ          еЄЄж"Ж          ж©©©©о€ж!     !пЄЄЄЄЄ        	©п¦¦¦¦F          ж©€п©ж        BBBзЫЫЫз          М„„…Ґп          ©¦FF¦©          ©­нл«©          ©­нл«© F       ­¦ЖЖ¦­          Ґeeec#          ©©йпЇ©          ©©©п©©          ж©©©©ж          ©©©©©п          «¦жЄЄз        М„„жҐҐҐо          ж©€€©ж          BBBBГз        ж!!з©©©©          ййжжйй          оҐҐжҐо          оҐҐж„М          нллн©©          ж©!b©ж          пййййй          ж©!c©ж        !пййййй          !!з©©©          feefLМ          ЄйййнйййЄ       ©©©п©©¦F@       оҐҐҐж„…Ґп     !пЄЄЄЄЄЄЄЄ     	©п¦¦¦¦¦¦¦f       пҐ…†Ж†…Ґп       fBBзЫЫЫЫз       М„„„„„…Ґп       ©©©¦FF¦©©       ©©­нл«©©©       ©©­нл«©©©F     ­Ґ¦¦Ж¦¦Ґ­       ©ҐҐҐҐҐec#       ©©©©©йпЇ©       ©©©©п©©©©       F¦©©©©©¦F       ©©©©©©©©п       «Є¦fжЄЄЄз       М„„„жҐҐҐо       fҐ‰€€€‰Ґf       fBBBBBZЫя       ж!!!з©©©©       йййжFжййй       оҐҐҐжҐҐҐо       оҐҐҐж„„„М       нлллн©©©©       ж©!!f!!©ж       пйййййййй       ЖЄ!!g!!ЄЖ     !пйййййййй       !!!!з©©©©       feeefDDLМ   

 PPA Soft  /* (C) 30.3.1993 Karaganda written by Pimenov Pavel OBJ: 100H-337FH ASM: 116 K_byte Link: 16:32:12 30.03.1993 */    ©¦FF¦©          ©­нл«©          ©­нл«© F       ­¦ЖЖ¦­          Ґeeec#          ©©йпЇ©          ©©©п©©          ж©©©©ж          ©©©©©п          «¦жЄЄз        М„„жҐҐҐо          ж©€€©ж          BBBBГз        ж!!з©©©©          ййжжйй          оҐҐжҐо          оҐҐж„М          нллн©©          ж©!b©ж          пййййй          ж©!c©ж        !пййййй          !!з©©©          feefLМ          ЄйййнйййЄ       ©©©п©©¦F@       оҐҐҐж„…Ґп     !пЄЄЄЄЄЄЄЄ     	©п¦¦¦¦¦¦¦f       пҐ…†Ж†…Ґп       fBBзЫЫЫЫз       М„„„„„…Ґп       ©©©¦FF¦©©       ©©­нл«©©©       ©©­нл«©©©F     ­Ґ¦¦Ж¦¦Ґ­       ©ҐҐҐҐҐec#       ©©©©©йпЇ©       ©©©©п©©©©       F¦©©©©©¦F       ©©©©©©©©п       «Є¦fжЄЄЄз       М„„„жҐҐҐо       fҐ‰€€€‰Ґf       fBBBBBZЫя       ж!!!з©©©©       йййжFжййй       оҐҐҐжҐҐҐо       оҐҐҐж„„„М       нлллн©©©©       ж©!!f!!©ж       пйййййййй       ЖЄ!!g!!ЄЖ     !пйййййййй       !!!!з©©©©       feeefDDLМ   ееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееееее ТЕЦЙНБ РЕТЕЛПДЙТПЧЛЙ ЙУИПДОПЗП ФЕЛУФБ
;;

SV_TEXT:	LXI	D,1015H		;
		LXI	H,3519H		;
		MVI	A,16H		;
		CALL	US_OPEN + 2	;
;;	нПДХМШ РЕТЕЛПДЙТПЧЛЙ TextAsm - PPA Text Editor
	LXI	D,1204h		;
S_T_Loop:			;
	DCR	E		;
	MVI	A,7		;
	CALL	W_Put_Char	;
	INR	A		;
	INR	D		;
	CALL	W_Put_Char	;
	DCR	E		;
	DCR	D		;
	INR	E		;
	JNZ	S_T_Loop	;	
	LXI	D,0203h		;
	LXI	B,S_T_Mess_Text_Asm
	PUSH	B		;
	CALL	W_DOP_INX	;
	POP	B		;
	LXI	D,1502h		;
	CALL	W_DOP_INX	;
	PUSH	B		;
	MVI	E,0		;
	CALL	W_DOP_INX	;
	POP	B		;
	LXI	D,0201h		;
	CALL	W_DOP_INX	;
	PUSH	B		;
	DCR	E		;
	CALL	W_DOP_INX	;
	POP	B		;
	PUSH	B		;
	INR	E		;
	INR	E		;
	CALL	W_DOP_INX	;
	POP	B		;
	PUSH	B		;
	LXI	D,1503h		;
	CALL	W_DOP_INX	;
	POP	B		;
	DCR	E		;
	DCR	E		;
	CALL	W_DOP_INX	;
	LXI	D,0404h		;
	CALL	W_DOP_INX	;
S_T_Loop_2:			;
	CALL	MENU		;
	CPI	0Eh		;
	CZ	W_Close		;
	RZ			;
	MOV	B,A		;
	LXI	D,2914h		;
	LXI	H,3914h		;
	CALL	S_ARE_YOU	;
	JNZ	S_T_Loop_2	;
	MOV	A,B		;
	POP	D		;
	CALL	S_Code_Convert	;
	CALL	W_Close		;
	CALL	W_Close		;
	CALL	RS_STR		;
	ORI	2		;
	STA	OFSET		;
	CALL	DOMOY		;
	RET			;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;	хОЙЧЕТУБМЙОБС РТПГЕДХТБ ЛПОЧЕТФБГЙЙ ФЕЛУФПЧ.	;;
;; A:							;;
;;	0 - PPA Text Editor 	-> RETEX		;;
;;	1 - RETEX		-> PPA Text Editor	;;
;;	2 - PPA Text Editor	-> TEXTASM		;;
;;	3 - TEXTASM		-> PPA Text Editor	;;
;;	4 - рЕТЕЧПД Ч УЕНЙВЙФОХА ФБВМЙГХ		;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
S_Code_Convert:
	LXI	H,BTEXT+1	;
	LXI	B,6020h		;
	LXI	D,80FFh		;
	ORA	A		;
	JZ	S_Vector_IBM_Code
	CPI	1		;
	JZ	S_IBM_Vector_Code
	CPI	4		;
	JZ	S_C_7bit	;
	CPI	3		;
	JNZ	S_Code_Done	;
	LXI	B,80A0h		; TextASM - PPA
	MVI	D,0E0h		;
S_Code_Done:			;
;; фЕРЕТШ НПЦОП РТЙУФХРБФШ Л РЕТЕЛПДЙТПЧЛЕ.
;; TextASM <--> PPA Text
;;	C0 <-> 60
;;	60 <-> E0
;;	E0 <-> C0
;;
S_PT_Loop:
	INX	H		;
	MOV	A,M		;
	CMP	E		; Stop_Byte
	RZ			; хКФЙ ЕУМЙ ЛПОЕГ ФЕЛУФБ
	CPI	60h		;
	JC	S_PT_Loop	;
	CPI	80h		;
	JNC	S_PT_Done	;
	ADD	B		;
	MOV	M,A		;
	JMP	S_PT_Loop	;
S_PT_Done:			;
	CPI	0C0h		;
	JC	S_PT_Loop	;
	CPI	0E0h		;
	JC	S_PT_2Done	;
	ADD	D		;
	MOV	M,A		;
	JMP	S_PT_Loop	;
S_PT_2Done:			;
	ADD	C		;
	MOV	M,A		;
	JMP	S_PT_Loop	;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;	нПДХМШ РЕТЕЧПДБ ЙЪ нЙЛТПдПУ Ч IBM		;;
;; бМЗПТЙФН РЕТЕЛПДЙТПЧЛЙ:				;;
;; 80 - AF : рЕТЕИПД ЛПНБОДБК ADI 30h			;;
;; B0 - BF : лПНБОДБ ADI 40h				;;
;; C0 - DF : юЕТЕЪ ФБВМЙГХ ЛПТТЕЛГЙЙ			;;
;; E0 - FF : фПЦЕ ОП У ЪБНЕОПК УФБТЫПК ФЕФТБДЩ:		;;
;;	     е -> 9 , б -> 8				;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
S_Vector_IBM_Code:
	INX	H	;
	MOV	A,M	;
	CPI	STOPBYTE
	RZ		;
	CPI	80h	;
	JC	S_Vector_IBM_Code
	CPI	0B0h	;
	JNC	S_Vector_IBM_1Done
	ADI	30h	;
S_Vector_IBM_2Code:
	MOV	M,A	;
	JMP	S_Vector_IBM_Code
S_Vector_IBM_1Done:
	CPI	0C0h	;
	JNC	S_Vector_IBM_1_5Done
	ADI	40h	;
	JMP	S_Vector_IBM_2Code
S_Vector_IBM_1_5Done:
	ANI	11011111b
	SUI	0C0h	;
	MOV	C,A	;
	MVI	B,0	;
	LXI	D,S_Dump_Vector_IBM
	XCHG		;
	DAD	B	;
	MOV	B,M	;
	XCHG		;
	MOV	A,M	;
	MOV	M,B	;
	ANI	20h	;
	JZ	S_Vector_IBM_Code
	MOV	A,B	;
	SUI	20h	;
	CPI	0C0h	;
	JC	S_Vector_IBM_3Done
	SUI	30h	;
S_Vector_IBM_3Done:	;
	MOV	M,A	;
	JMP	S_Vector_IBM_Code
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;	нПДХМШ РЕТЕЧПДБ ЙЪ ЖПТНБФБ IBM Ч нЙЛТПдПУ	;;
;; бМЗПТЙФН ПВТБВПФЛЙ:					;;
;; 1.л ФБВМЙГЕ(1) ПВТБЭБФУС РТЙ ХУМПЧЙЙ ЮФП ЧИПДОПК ЛПД	;;
;; ВПМШЫЕ ЙМЙ ТБЧЕО 80h ОП НЕОШЫЕ B0h			;;
;; 2. еУМЙ ЛПД Ч ЪПОЕ B0h - DFh ФП ЧЩРПМОЙФШ ЛПНБОДХ	;;
;; SUI 30h.						;;
;; 3. (E0h - F0h) - ФП ЮЕТЕЪ ФБВМЙГХ (2)		;;
;; 4. (F0h - FFh) - ЧЩРПМОЙФШ ЙОУФТХЛГЙА SUI 40h	;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
S_IBM_Vector_Code:
	INX	H		;
	MOV	A,M		;
	CPI	STOPBYTE	;
	RZ			;
	CPI	80h		;
	JC	S_IBM_Vector_Code
	CPI	0B0h		;
	JNC	S_IBM_Vector_Done
	LXI	D,S_Dump1_IBM_Vector
	SUI	80h		;
	MOV	C,A		;
	MVI	B,0		;
	XCHG			;
	DAD	B		;
	MOV	A,M		;
	XCHG			;
	MOV	M,A		;
	JMP	S_IBM_Vector_Code
S_IBM_Vector_Done:		;
	CPI	0E0h		;
	JNC	S_IBM_Vector_1Done
	SUI	30h		;
	MOV	M,A		;
	JMP	S_IBM_Vector_Code
S_IBM_Vector_1Done:		;
	CPI	0F0h		;
	JNC	S_IBM_Vector_2Done
	LXI	D,S_Dump2_IBM_Vector
	SUI	0E0h		;
	MOV	C,A		;
	MVI	B,0		;
	XCHG			;
	DAD	B		;
	MOV	A,M		;
	XCHG			;
	MOV	M,A		;
	JMP	S_IBM_Vector_Code
S_IBM_Vector_2Done:		;
	SUI	40h		;
	MOV	M,A		;
	JMP	S_IBM_Vector_Code
	
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;	вМПЛ РЕТЕИПДБ Л УЕНВЙФОПК ФБВМЙГХ		;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
S_C_7bit:
	INX	H		;
	MOV	A,M		;
	CMP	E		;
	RZ			;
	CMP	B		; B=60h
	JC	S_C_7bit	;
	CMP	D		; D=80h
	JNC	S_C_Done	;
	SUB	C		; C=20h
	MOV	M,A		;
S_C_Done:			;
	CPI	0E0h		;
	JNC	S_C_7bit	;
	CPI	0C0h		;
	JC	S_C_7bit	;
	ADD	C		;
	MOV	M,A		;
	JMP	S_C_7bit	;	
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;	дБНР ТЕТЕЛПДЙТПЧЛЙ ЙЪ IBM Ч нЙЛТПдПУ		;;
S_Dump1_IBM_Vector:
	DB	0E1h,0E2h,0F7h,0E7h,0E4h,0E5h,0F6h,0FAh
		0E9h,0EAh,0EBh,0ECh,0EDh,0EEh,0EFh,0F0h
		0F2h,0F3h,0F4h,0F5h,0E6h,0E8h,0E3h,0FEh
		0FBh,0FDh,"'",0F9h,0F8h,0FCh,0E0h,0F1h
		0C1h,0C2h,0D7h,0C7h,0C4h,0C5h,0D6h,0DAh
		0C9h,0CAh,0CBh,0CCh,0CDh,0CEh,0CFh,0D0h
S_Dump2_IBM_Vector:
	DB	0D2h,0D3h,0D4h,0D5h,0C6h,0C8h,0C3h,0DEh
		0DBh,0DDh,0DFh,0D9h,0D8h,0DCh,0C0h,0D1h
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
S_Dump_Vector_IBM:
	DB	0EEh,0A0h,0A1h,0E6h,0A4h,0A5h,0E4h,0A3h
		0E5h,0A8h,0A9h,0AAh,0ABh,0ACh,0ADh,0AEh
		0AFh,0EFh,0E0h,0E1h,0E2h,0E3h,0A6h,0A2h
		0ECh,0EBh,0A7h,0E8h,0EDh,0E9h,0E7h,0EAh

S_T_Mess_Text_Asm:
	DB	"TextAsm",CR
S_T_Mess_RETEX:
	DB	"RETEX",CR
S_T_Mess_PPA_Text_Editor:
	DB	"PPA Text Editor",CR
	Rus_DB	рЕТЕЧПД_Ч_УЕНЙВЙФОХА_ЛПДЙТПЧЛХ
	DB	CR

;;
;;  рТПГЕДХТБ ЧЩЧПДБ ЪБРТПУБ: чЩ ХЧЕТЕОЩ ???
;;		
S_ARE_YOU:	PUSH	B		;
		MVI	A,15h		;
		CALL	W_Open		;
		CALL	YESNO		;
		LXI	D,200H		;
		LXI	B,SV_TS2	;
		CALL	WPUTSDOP	;
		CALL	Key_Wait	;
		POP	B		;
		LDA	Key_Number	;
		CPI	57		; лМБЧЙЫБ "Y" ???
		CALL	W_Close		;
		RET			;


;; пВТБВПФБЕН ЧЩВПТ ТЕДБЛФЙТПЧЙОЙС ГЧЕФБ РЕТЕДОЕЗП РМБОБ
;; ДМС ЬФПЗП ДПРПМОЙФЕМШОП ПФЛТПЕН ПЛОП Й РТЙ РПНПЭЙ ЛМБЧЙЫ
;; ХРТБЧМЕОЙС ЛХТУПТПН РТПЙЪЧЕДЕН ЛПТЕЛГЙА СЮЕКЛЙ COLOR
;; ЙЪ ВМПЛБ ТБВПЮЙИ СЮЕЕЛ РПДРТПЗТБННЩ ПВТБВПФЛЙ ЛБДТПЧПЗП
;; РТЕТЩЧБОЙС - ДТБКЧЕТ ЛМБЧЙБФХТЩ.
;;
SV_COLOR:	LXI	D,1417H		;
		LXI	H,1C18H		;
		MOV	A,E		;
		CALL	W_Open		;
		LXI	D,201H		;
		LXI	B,SV_SOOB2	;
		CALL	W_DOP_INX	;
		DCR	E		;
		CALL	WPUTSDOP	;

SV_POVTOR:	CALL	MENU		;
		CPI	0EH		;
		CZ	W_Close		;
		RZ			;
		MOV	B,A		;
		XRA	A		;
		CALL	SV_VARIAL	;
		JMP	SV_POVTOR	;
;;
;;	B - оПНЕТ ВБКФБ ЛПФПТЩК ОЕПВИПДЙНП ЙЪНЕОЙФШ.
;;	A - РПДРТПЗТБННБ ЙЪНЕОЕОЙС ГЧЕФБ ФП 0
;;	    ЙОБЮЕ ЙЪНЕОЕОЙЕ ЛПОУФБОФ ЮФЕОЙС-ЪБРЙУЙ
SV_VARIAL:
		PUSH	PSW		;
		PUSH	B		;
		LXI	D,1716H		;
		LXI	H,2E16H		;
		MVI	A,16H		;
		CALL	US_OPEN + 2	;
		LXI	B,SV_SOOB3	;
		LXI	D,100H		;
		CALL	WPUTSDOP	;
		POP	B		;
		POP	PSW		;
		STA	KORBUF		;
		ORA	A		;
		LHLD	COLOR		;
		JZ	SV_LOOP		;
		LHLD	PUT_CONST	;
SV_LOOP:
		LDA	KORBUF		;
		ORA	A		;
		JNZ	SV_V_10		;
		SHLD	COLOR		;
		JZ	SV_V_00		;
SV_V_10:	SHLD	PUT_CONST	;
SV_V_00:	XRA	A		;
		STA	Flag_Color	;
		LXI	D,SV_LOOP	;
		PUSH	D		;
		LXI	D,1400H		;
		MOV	A,B		;
		ORA	A		;
		MOV	A,H		;
		JNZ	$ + 4		;
		MOV	A,L		;
		CALL	WJHEX		;
		CALL	Key_Wait	;
		MOV	C,A		;
		CPI	0EH		; "F4"
		JZ	SV_EX0		;
		CPI	2H		; "чл"
		JZ	SV_EX0		;
		CPI	05H		;
		JNZ	SV_OBHOD	;
; пВТБВПФБЕН ОБЦБФЙЕ ЛМБЧЙЫЙ ЧЧЕТИ
		MOV	A,B		;
		INR	H		;
		ORA	A		;
		RNZ			;
		DCR	H		;
		INR	L		;		
		RET			;
SV_OBHOD:	MOV	A,C		;
		CPI	07H		;
		RNZ			;
; пВТБВПФБЕН ОБЦБФЙЕ ЛМБЧЙЫЙ ЧОЙЪ
		MOV	A,B		;
		DCR	H		;
		ORA	A		;
		RNZ			;
		INR	H		;
		DCR	L		;
		RET			;

SV_EX0:		CALL	W_Close		;
		POP	D		;
		RET			;


; ; ========= ху + 3 ======= GOTO =======
GOTOLINE:	LXI	D,081BH
		LXI	H,1D1BH
		CALL	US_OPEN
GOTODONE:	LXI	D,100H
		LXI	B,WARNGOTO	;ЧЩДБФШ УППВЭЕОЙЕ
		XRA	A
		CALL	WPUTSDOP
		MVI	D,0FH		;ЛПОЕГ УППВЭЕОЙС
		MVI	A,4H
		MOV	H,B
		MOV	L,C
		CALL	EDLINE
		CPI	0EH		;ЧЩИПД ЕУМЙ F4
		PUSH	PSW
		CZ	COPYS
		POP	PSW
		CZ	W_Close
		RZ
; РТЙУФХРЙФШ Л РПЙУЛХ УФТПЛЙ				
		DI		;ХЧЕМЙЮЙФШ ВЩУФТПДЕКУФЧЙЕ
		MVI	A,30H
		STA	Key_Kode	;ЬНХМСГЙС ОХМС
		LXI	B,STR
DOPLOOP:	CALL	EDINSERT	;ЧУФБЧЛБ ОХМС
		JZ	DOPLOOP		;ДПРПМОЕОЙЕ ЪБЧЕТЫЕОП ???
		EI
		CALL	KORREKT
		CALL	W_Close
		CALL	NULL_POS
POLOP1:		LXI	H,CURDY
		LXI	B,KORBUF
		MVI	D,3
POILOOP:	LDAX	B
		CMP	M
		JNZ	POIDONE		;РТПДПМЦБФШ РПЙУЛ
		INX	B
		INX	H
		DCR	D
		JNZ	POILOOP
;ОБКДЕОБ ОХЦОБС УФТПЛБ		
POIEXIT:	CALL	PRINT_POS
		CALL	Key_Reset
		CALL	RS_STR
		RET

POIDONE:	CALL	SINC
		CNZ	INCY
		JNZ	POLOP1
		JMP	POIEXIT
;&&&&&&&&&&&&& KORREKTOR &&&&&&&&&&&&&&&&&
KORREKT:	LXI	B,STR
		LXI	H,KORBUF+2
		CALL	CLEAR3
		MVI	E,5
POVTOR:		LDAX	B
		CPI	30H
		JC	KORERROR
		CPI	3AH
		JNC	KORERROR
		ANI	0FH		;ЧЩДЕМЙФШ ГЙЖТХ
		MOV	D,A
		MOV	A,E
		RRC
		MOV	A,D
		JC	KORNOHET	;ОЕЮЕФ
		RLC
		RLC
		RLC
		RLC
		INX	H		;УЮЕФЮЙЛ ДЕУСФЙЮОПЗП ЮЙУМБ
KORNOHET:	INX	B		;ХЛБЪБФЕМШ УФТПЛЙ
		ORA	M
		MOV	M,A
		DCR	E
		JNZ	POVTOR
		RET

KORERROR:
		CALL	W_Cls
		CALL	Key_Reset
		POP	H
		JMP	GOTODONE

;============== ЧУРПНПЗБФЕМШОЩЕ УЕТЧЙУОЩЕ РТПГЕДХТЩ =============
;РТПГЕДХТБ ХУФБОБЧМЙЧБЕФ ЧУЕ ЗМПВБМШОЩЕ РЕТЕНЕООЩЕ Ч ОЕМЕЧПЕ РПМПЦЕОЙЕ

NULL_POS:	CALL	CCLEFT
		LXI	H,BTEXT+2
		SHLD	POS
		LXI	H,0
		SHLD	CURHY
		LXI	H,CURDY+2
		CALL	CLEAR3
		RET

;РТПГЕДХТБ ТБУРЕЮБФЩЧБЕФ ЛБТФЙОЛХ ОБЮЙОБС У ФЕЛХЭЕЗП POS
PRINT_POS:	LXI	H,1AH
		SHLD	W_Cursor
		XCHG
		CALL	W_Cls
		LHLD	POS
		MOV	B,H
		MOV	C,L
		CALL	PRSCREEN
		CALL	DON		;ЛПТЕЛГЙС УЭЕФЮЙЛБ
		CNZ	UP
		RET
;;  рТПГЕДХТБ РТПЙЪЧПДЙФ ПФЮЙУФЛХ НБУЙЧБ РБНСФЙ
;;  HL - ОБЮБМШОЩК БДТЕУ
;;  B  - УЛПМШЛП ПФЮЙЭБФШ

CLEAR_MEM:	PUSH	PSW		;
		XRA	A		;
CL_00:		MOV	M,A		;
		INX	H		;
		DCR	B		;
		JNZ	CL_00		;
		POP	PSW		;
		RET			;
;;
FILE:
		CALL	DOMOY		;
		LXI	D,0819H		; ПФЛТЩЧБЕН ТБВПЮЕЕ ПЛОП
		LXI	H,171BH		; ЧЩЧПДЙН РПСУОСАЭЙЕ ОБДРЙУЙ
		CALL	US_OPEN		;
		LXI	D,202H		;
		LXI	B,F_S00		;
		CALL	W_DOP_INX	;
		DCR	E		;
		CALL	W_DOP_INX	;
		DCR	E		;
		CALL	WPUTSDOP	;

F_MENU:		LXI	H,F_MENU	;
		PUSH	H		;
		CALL	MENU		;
		CPI	0EH		;
		JZ	F_MENU_EXIT	;
		ORA	A		; "рПДЗТХЪЛБ"
		JZ	F_MERGE		;
		DCR	A		; "ъБРЙУШ ЖБКМБ"
		JZ	F_SAVE		;
		JMP	F_LOAD		; "юФЕОЙС ЖБКМБ"
F_MENU_EXIT:				;
		LDA	BTEXT+3		;
		CPI	STOPBYTE	;
		CALL	W_Close		;
		CZ	W_Cls		;
		POP	H		;
		RET			;

;;
;;   рТПГЕДХТБ РТПЙЪЧПДЙФ ПФЛТЩФЙЕ ДЙБМПЗПЧПЗП ПЛОБ
;; ЪБРТБЫЙЧБЕФ ЙНС ФТЕВХЕНПЗП ЖБКМБ РТЙ ЬФПН
;;
F_INPUT_NAME:
		LXI	D,1018H		;
		LXI	H,2618H		;
		MVI	A,16H		;
		CALL	US_OPEN + 2	; ПВИПДЙН A=15h
F_I_LOOP:	LXI	B,F_S10		;
		LDA	Stat_Small	;
		MOV	H,A		;
		LDA	Stat_RUS_LAT	;
		MOV	L,A		;
		PUSH	H		;
		XRA	A		;
		STA	Stat_Small	;
		STA	Stat_RUS_LAT	;
		LXI	D,100H		;
		CALL	WPUTSDOP	;
		MVI	D,7		;
		LXI	H,F_F_ASCII	;
		MVI	A,13		;
		CALL	EDLINE		;		
		CPI	0EH		;
		CZ	W_Close		;
		POP	H		;
		RZ			;
		PUSH	H		;
		LXI	H,STR		;
		LXI	D,F_F_ASCII	;
		MVI	B,13		;
		CALL	Inc_Copy	;
		POP	H		;
		MOV	A,H		;
		STA	Stat_Small	;
		MOV	A,L		;
		STA	Stat_RUS_LAT	;
		RET			;

F_F_ASCII:	DB	CR	; оБЮБМШОБС ЪБЗМХЫЛБ
				; ЙНС ЖБКМБ Ч ASCII ЖПТНБФЕ
		DB	CR,CR,CR,CR,CR,CR,CR,CR,CR,CR,CR,CR

;; ======= ху + 7 ====== Search ======
SEARCH:		CALL	S_LINE_INPUT	; ЪБРТПУЙФШ УФТПЛЙ РПЙУЛБ Й ЪБНЕОЩ

; ;ОБЮБФШ РПЙУЛ ЪБДБООПК УФТПЛЙ Й РТЙ ОЕПВИПДЙНПУФЙ ЪБНЕОСФШ
; ;   BUF_ETALON:	--> ВХЖЕТ ДМС ЬФБМПОБ
; ;   BUF_PODM:		--> ВХЖЕТ ДМС ЪБНЕОСЕНПК УФТПЛЙ
; ;   DL_ETALON:	--> ДМЙОБ ЬФБМПОПК УФТПЛЙ
; ;   DL_PODM:		--> ДМЙОБ ЪБНЕОСЕНПК УФТПЛЙ

		CALL	NULL_POS	;ХЛБЪБФЕМШ ОБ ОБЮБМП ФЕЛУФБ
		LDA	DL_ETALON	;ВЕТЕН ДМЙОХ ЬФБМПОБ
		MOV	B,A		;УПИТБОСЕН Ч ТЕЗЙУФТБИ
		MOV	C,A		;
		LHLD	POS		;ЮЙФБЕН ХЛБЪБФЕМШ ОБ УФТПЛХ Ч HL
S_LOOP:		MOV	B,C		;ЧПУФБОБЧМЙЧБЕН "B"
		LXI	D,BUF_ETALON	;
S_LOOP1:	MOV	A,M		;УТБЧОЙЧБЕН У УЙНЧПМПН "ЛПОЕГ УФТПЛЙ"
		CPI	CR		;
		JZ	S_END_LINE	;ЛПОЕГ УФТПЛЙ ???
		LDAX	D		;ЕУМЙ ОЕ ЛПОЕГ ФП РТПЮЙФБЕН ЬФБМПО
		CMP	M		;Й УТБЧОЙН ЕЗП У ФЕЛХЭЙН УЙНЧПМПН ЕУМЙ
		INX	H		;ОЕ ТБЧОЩ ФП ЧПУФБОПЧЙФШ ХЛБЪБФЕМШ
		INX	D		;ЬФБМПОБ Й ДМЙООХ ЬФБМПОБ
		JNZ	S_LOOP		;ЙОБЮЕ ХНЕОШЫЙФШ УЮЕФЮЙЛ ХДБЮОЩИ
		DCR	B		;УТБЧОЕОЙК ЕУМЙ ТБЧОП ОХМА ФП
		JNZ	S_LOOP1		;ОБЫМЙ ЬФБМПООХА РПУМЕДПЧБФЕМШОПУФШ
;
; ; ОБЫМЙ ЙУЛПНХА УФТПЛХ ФЕРЕТШ ОЕПВИПДЙНП ПРТЕДЕМЙФШ
; ; ЮФП У ОЕК ДЕМБФШ Б ФБЛЦЕ ЧЩДБФШ УППФЧЕФУФЧХАЭЙЕ
; ; РПСУОЕОЙС РПМШЪБЧБФЕМА Й РТЙОСФШ ТЕЫЕОЙЕ П ДБМШ-
; ; ОЕЫЕН ИПДЕ ТБВПФЩ МЙВП ЪБЛПОЮЙФШ РПЙУЛ ,МЙВП РТП-
; ; ДПМЦЙФШ РПЙУЛ
; 
		PUSH	B		;УПИТБОЙН ТЕЗЙУФТЩ РТПГЕУУПТБ
		PUSH	D		;
		PUSH	H		;
		PUSH	B		;
		CALL	PRINT_POS	;ТБУРЕЮБФБЕН ОБКДЕОХС УФТПЛХ Ч
		POP	B		;
		POP	H		;
		PUSH	H		;
		MOV	A,C		;РПНЕФЙН ЙОЧЕТУОЩН ГЧЕФПН ОБКДЕОПЕ
S_LOOP2:	DCX	H		;УМПЧП
		DCR	C		;дМЙОБ ЬФБМПООПК УФТПЛЙ
		JNZ	S_LOOP2		;
		MOV	B,H		;
		MOV	C,L		;
		LXI	D,001AH		;++
		CALL	WPUTS1		;
		MOV	B,A		;
		LHLD	ENDLINE		;
		XCHG			;
		LXI	H,3D1DH		;
		MOV	A,D		;
		CMP	H		;
		CC	Cls_XY		;
		LXI	H,W_Cursor + 1	;
		CALL	LINE_I_DOP	;
		MVI	M,0		;
		LXI	D,0519H		;ЧЕТИХ ЬЛТБОБ Й РПДЗПФПЧЙН ДБООЩЕ
		LXI	H,181AH		;ДМС ПФЛТЩФЙС ПЛОБ
		LXI	B,S_SOOB1	;
		LDA	DL_PODM		;
		ORA	A		;
		PUSH	PSW		;
		JZ	S_DONE0		;
		LXI	B,S_SOOB2	;ЕУМЙ ТЕЦЙН РПЙУЛ-ЪБНЕОБ ФП
		DCR	E		;ПЛОП ЙНЕЕФ ФТЙ УФТПЛЙ ЙОБЮЕ ДЧЕ
		MVI	H,13H		;
S_DONE0:	
		PUSH	B		;
		CALL	US_OPEN		;
		POP	B		;
		LXI	D,0200H		;ЧЩЧПДЙН БМШФЕТОБФЙЧОЩЕ УФТПЛЙ
		CALL	W_DOP_INX	;Ч УППФЧЕФУФЧЙЙ У ФЕЛХЭЙН ТЕЦЙНПН
					;Й ЧЩЪЩЧБЕН РТПГЕДХТХ MENU:
		POP	PSW		;
		MVI	E,1		;
		CNZ	WPUTSDOP	;
		LXI	B,S_SOOBHLP	;
		CZ	WPUTSDOP	;
		INR	E		;
		CNZ	WPUTSDOP	;
MEN_LOOP:	CALL	MENU		;
;
; ; рПУМЕ ЧПЪЧТБФБ КЪ РПДРТПТБННЩ Ч БЛБНХМСФПТЕ ОБИПДЙФУС ОПНЕТ
; ; УФТПЛЙ Ч ЛПФПТПК ПУФБМУС ЛХТУПТ РТЙ ОБЦБФЙЙ чл ЕУМЙ
; ; ЧЩИПД РТПЙЪПЫЕМ РПУМЕ ОБЦБФЙС ЛМБЧЙЫЙ F4 ФП Ч б ВХДЕФ
; ; ОБИПДЙФУС ЛПД 0EH (Ф.Е Ч НЕОА ОЕ НПЦЕФ ВЩФШ РПЪЙГЙК
; ; ВПМШЫЕ 15
;
		CPI	0EH		; ОБЦБФБ ЛМБЧЙЫБ F4 ???
		JZ	S_EXIT_REJ	; ЕУМЙ ДБ ФП ФБЛЦЕ ЧЩИПД
		MOV	B,A		; УПИТБОСЕН РПЪЙГЙА ХЛБЪБФЕМС
		LDA	DL_PODM		; ПРТЕДЕМСЕН ФЕЛХЭЙК ТЕЦЙН
		ORA	A		; ( РПЙУЛ ЙМЙ РПЙУЛ-ЪБНЕОБ)
		JZ	ALT_POISK	; РЕТЕИПДЙН ЕУМЙ рпйул
; ; ПВТБРПФБЕН ПЛОП ДМС рпйулб Й ъбнеощ
		MOV	A,B		; ЧПУФБОПЧЙН ХЛБЪБФЕМШ
		CPI	2H		; "ртпунпфт"
		CZ	PROSMOTR	;
		JZ	MEN_LOOP	; ЧПЪЧТБФЙФУС Ч "НЕОА"
		ORA	A		; "ое ЪБНЕОСФШ"
		JZ	S_OBHOD		;
; рТПЙЪЧПДЙН ЪБНЕОХ ЬФБМПООПЗП УМПЧБ ОБ РПДНЕОСЕНПЕ
		CALL	W_Close		; ъБЛТЩЧБЕФ ПЛОП ЪБРТПУПЧ
		POP	D		; ЮЙФБЕН ФПЮЛХ ЗДЕ ОБЫМЙ УФТПЛХ
		PUSH	D		; 
		LHLD	POS		; ЮЙФБЕН ОБЮБМП УФТПЛЙ
		XCHG			;
		CALL	NEG_DE		; ЖПТНЙТХЕН ДПРПМОЙФЕМШОЩК
		DAD	D		; ЛПД ДМС ТЕЗЙУФТБ DE
					; (ЮФПВЩ РТПЧЕУФЙ ЧЩЮЙФБОЙЕ)
					; HL - УНЕЭЕОЙЕ УМПЧБ Ч STR
		CALL	COPYS		;
		CPI	200		; РТПЧЕТЛБ ДМЙООЩ УФТПЛЙ
		JNC	S_OVERFLOM	;
		LXI	B,STR		;
		DAD	B		;
		MOV	B,H		;
		MOV	C,L		;
		LDA	DL_ETALON	;
		MOV	D,A		;
S_LOOP4:	DCX	B		; РТПЙЪЧПДЙН ХДБМЕОЙЕ ЙУИПДПК
		CALL	MOVEDEL		; УФТПЛЙ У УППФЧЕФУФЧХАЭЕК
		DCR	D		; ЛПТЕЛГЙЕК ХЛБЪБФЕМС
		JNZ	S_LOOP4		;
		LDA	DL_PODM		;
		LXI	D,BUF_PODM	;
		PUSH	B		;
S_LOOP5:	PUSH	PSW		; РТПЙЪЧПДЙН ЧУФБЧЛХ
		CALL	MOVEINS		; ОПЧПК УФТПЛЙ
		LDAX	D		;
		STAX	B		;
		INX	B		;
		INX	D		;
		POP	PSW		;
		DCR	A		;
		JNZ	S_LOOP5		;		
		POP	B		;
		LXI	D,021DH		; ПФПВТБЦБЕН РТПЙЪЧЕДЕООХА
		LXI	H,3D1DH		; ЪБНЕОХ
		CALL	Cls_XY		;
		LXI	D,001Ah		;
		CALL	WPUTSDOP	;
		CALL	NARUSHENIE	; РТПЙЪЧПДЙН ЙУЛХУФЧ.ТЕЗ. ВХЖЕТБ
		CALL	REGENER		; ФЕЛУФБ
; ; рТПЙЪЧЕДЕОБ ЪБНЕОБ ФЕРЕТШ ЧЩЧПДЙН ПЛОП У ЪБРТПУПН
; ; ОБ РТПДПМЕОЙЕ РПЙУЛБ Й ЪБНЕОЩ

S_ZAPROS:	LXI	D,081AH		;
		LXI	H,151AH		;
		CALL	US_OPEN		;
		LXI	B,S_SOOBHLP3	;
		LXI	D,0100H		;
		CALL	WPUTSDOP	;
		CALL	Key_Wait	;	
		CPI	0EH		; F4
		JZ	S_EXIT_REJ	;
		JMP	S_OBHOD		;

S_OVERFLOM:	LXI	B,SOOBR		;
		CALL	WARNING		;
		JZ	S_ZAPROS	; РТПДПМЦЙФШ РПЙУЛ
; ; ПВТБВПФБЕН ПЛОП рпйул
ALT_POISK:	DCR	B		; ЧПУФБОПЧЙН ХЛБЪБФЕМШ "ртпунпфт"
		CZ	PROSMOTR	; РТПУНПФТЕФШ УФТЛХ
		JZ	MEN_LOOP	; ЧПЪЧТБФЙФУС Ч НЕОА
S_OBHOD:	POP	H		;
		POP	D		;
		POP	B		;
		CALL	W_Close		;
		JMP	S_LOOP		;
		
S_EXIT_REJ:	CALL	W_Close		;
		POP	D		;
		POP	D		;
		POP	D		;
		LXI	D,1AH		;
		LHLD	POS		;
		MOV	B,H		;
		MOV	C,L		;
		CALL	WPUTS1		;
		CALL	RS_STR		; тЕУФБТФ ВХЖЕТБ
		RET			;

;+++++++++++ ртпгедхтб пвтбвпфлй ртпунпфтб уфтплй +++++++++++
PROSMOTR:	PUSH	PSW		;
		LXI	D,0A17H		;
		LXI	H,3617H		;
		MVI	A,16H		;
		CALL	US_OPEN + 2	; пВИПДЙН ЛПНБОДХ MVI A,15h
		LXI	B,S_SOOBHLP2	;
		CALL	WIND_PR_TOP	;
		LHLD	POS		;
		MOV	B,H		;
		MOV	C,L		;
		LXI	D,0		;
		PUSH	B		;
		CALL	WPUTS1		;
		POP	B		;
PROS_LOOP:	LXI	H,PROS_LOOP	;
		PUSH	H		;
		CALL	Key_Wait	;
		LXI	D,0		;
		CPI	04H		; ЧМЕЧП
		JZ	PROS_LEFT	;
		CPI	06H		; ЧРТПЧП
		JZ	PROS_RIG	;
		CPI	0EH		;
		RNZ			;
		POP	H		;
		XRA	A		;
		STA	OFSET		;
		CALL	W_Close		;
		POP	PSW		;
		RET			;

PROS_LEFT:	LXI	H,OFSET		;
		INR	M		;
		PUSH	B		;
		CALL	WPUTS1		;
		POP	B		;
		LDA	ENDLINE + 1	;
		MOV	D,A		;
		MVI	E,17H		;
		CPI	37H		;
		MVI	A,' '		;
		CC	Put_XY_Char	;
		DCR	M		;
		MOV	A,D		;
		CPI	0BH		; ОБЮБМБ ДБООПЗП ПЛОБ
		CZ	PLAY		;
		RZ			;
		INR	M		;
		RET			;

PROS_RIG:	LXI	H,OFSET		;
		XRA	A		;
		ORA	M		;
		CZ	PLAY		;
		RZ			;
		DCR	M		;
		PUSH	B		;
		CALL	WPUTS1		;
		POP	B		;
		RET			;

S_END_LINE:	INX	H		;РЕТЕИПДЙН ОБ УМЕДХАЭХА УФТПЛХ
;;		INX	H		;Й РТПЧЕТСЕН ОЕ ДПУФЙЗОХФ МЙ ЛПОЕГ
		MVI	A,STOPBYTE	;ФЕЛУФБ ЕУМЙ ДБ ФП Й ОЕ ВЩМП ОБКДЕОП
		CMP	M		;ОЙ ПДОПЗП ЕФБМПОБ ФП ЧЩДБФШ УППВЭЕОЙЕ
		JZ	S_END_TXT	;П ФПН ЮФП РПУМЕДПЧБФЕМШОПУФШ ОЕ
		SHLD	POS		;ОБКДЕОБ (ЛХТУПТ ХУФБОБЧМЙЧБЕФУС
		CALL	INCY		;Ч ЛПОЕГ ФЕЛУФБ !!!!!!!!! )
		JMP	S_LOOP		;РТПДПМЦЙФШ РПЙУЛ У ОПЧПК УФТПЛЙ

		CALL	W_Close
S_END_TXT:	CALL	PRINT_POS
		CALL	RS_STR
		RET
		
WIND_PR_TOP:	CALL	HL_DE_Window	;
		PUSH	B		;
		CALL	HL_Sub_DE	;
		MOV	E,C		;
		MVI	D,1		;
		POP	B		;
		XRA	A		;
		CALL	WPUTSDOP	;
		RET			;

; ; РТПГЕДХТБ ПФЛТЩЧБЕФ ДПРПМОЙФЕМШОПЕ ПЛОП Й ЪБРТБЫЙЧБЕФ
; ; УФТПЛЙ ДМС РПЙУЛБ Й ЪБНЕОЩ РТЙ РПНПЭЙ ЧУФТПЕООПЗП ТЕ-
; ; ДБЛФПТБ EDLINE РПМХЮЕООЩЕ УФТПЛЙ ЛПРЙТХАФУС ЧП ЧТЕНЕ-
; ; ИЩЕ ВХЖЕТЩ (BUF_ETALON , BUF_PODM) Б ФБЛЦЕ Ч СЮЕКЛЙ
; ; DL_ETALON Й DL_PODM ЪБОПУСФУСДМЙОЩ ЬФЙИ УФТПЛ ЬФП
; ; ДМС РПУМЕДХАЭЙИ ПРЕТБГЙК РПЙУЛБ Й ЪБНЕОЩ Ч ПУОПЧОПН
; ; ФЕЛУФПЧПН ВХЖЕТЕ

S_LINE_DL   	SET	20		; ЛПОУФБОФБ ДМЙОЩ

S_LINE_INPUT:	LXI	D,081AH		;ПФЛТЩЧБА ПЛОП ДМС ЧЧПДБ
		LXI	H,251BH		;ЬФБМПООЩИ УФТПЛ
		CALL	US_OPEN		;
		LXI	B,ETALON	;РЕЮБФБА РПСУОЙФЕМШОЩЕ
		LXI	D,101H		;ЧЩТБЦЕОЙС
		XRA	A		;
		CALL	W_DOP_INX	;
		MOV	E,A		;
		CALL	WPUTSDOP	;
		LXI	H,STR		;РПДЗПФБЧМЙЧБА ДБООЩЕ ДМС ТЕДБЛФПТБ
		MVI	M,CR		;УФТПЛЙ EDLINE
		LXI	D,801H		;
		MVI	A,S_LINE_DL - 1	;
		PUSH	H		;
		CALL	EDLINE		;
		POP	H		;
		CPI	0EH		;ЧПЪЧТБФ РП F4 ???
		JZ	SEA_EXIT	;ЕУМЙ ДБ ФП ЧЩКФЙ ЙЪ ТЕЦЙНБ РПЙУЛБ
		MOV	A,M		;ЕУМЙ ЧПЪЧТБЭБЕНБС ТЕДБЛФПТПН УФТПЛБ
		CPI	CR		;РХУФБС ФП ЧЩКФЙ ЛБЛ РТЙ ОБЦБФЙЙ F4
		JZ	SEA_EXIT	;
		CALL	COPYSDOP	;ПРТЕДЕМСА ДМЙООХ УФТПЛЙ
		MOV	B,A		;
		STA	DL_ETALON	;УПИТБОЙФШ ДМЙООХ УФТПЛЙ ETALON
		LXI	D,BUF_ETALON	;ХЛБЪБФЕМШ ОБ ВХЖЕТ ДМС РЕТЕОПУБ
		CALL	Inc_Copy		;УФТПЛЙ ЙЪ STR
		MVI	M,CR		;
; рТЙУФХРЙФШ Л ЧЧПДХ УФТПЛЙ ЪБНЕОЩ (ЕУМЙ ПОБ РТПЙЪЧПДЙФУС)
		LXI	D,800H		;ЧЧЕУФЙ У ЛПОУПМЙ УФТПЛХ ЪБНЕОЩ
		MVI	A,S_LINE_DL - 1	;
		PUSH	H		;
		CALL	EDLINE		;
		POP	H		;ЕУМЙ ОБЦБФБ F4 ФП ЧЩИПД ХЪ ТЕЦЙНБ
		CPI	0EH		;
		JZ	SEA_EXIT	;
		CALL	COPYSDOP	;
		MOV	B,A		;
		STA	DL_PODM		;УПИТБОЙН ДМЙООХ РПДНЕОСЕНПК УФТПЛЙ
		LXI	D,BUF_PODM	;ХЛБЪБФЕМЙ ОБ ВХЖЕТ ДМС РЕТЕОПУ
		ORA	A		;ЕУМЙ УФТПЛБ ОЕ РХУФБС ФП РПЙУЛ-ЪБН.
		CNZ	Inc_Copy	;УПИТБОСЕН ЧЧЕДЕООХА УФТПЛХ
		CALL	W_Close		;
		RET			;

SEA_EXIT:	CALL	W_Close		;
		JMP	F_MAIN_EXIT	; чЩИПД

;;DL_ETALON:	DB	0H		;ДМЙОБ ЬФБМПОПК УФТПЛЙ
;;DL_PODM:	DB	0H		;ДМЙОБ ЪБНЕОСЕНПК УФТПЛЙ

; ; РТПГЕДХТБ ПВТБВПФЛЙ ЙОЖПТНБГЙПООПЗП ЧЩЪПЧБ
; ; УЕЗПДОС: 05.01.1992
M_INFO:		LXI	D,081AH		;
		LXI	H,221BH		;
		CALL	US_OPEN
		LXI	D,101H		;
		LXI	B,I_SOOB1	;
		CALL	W_DOP_INX	;
		DCR	E		;
		CALL	W_DOP_INX	;
		PUSH	B		;
		MVI	D,13H		;
		CALL	WPUTSDOP	;
		INR	E		;
		POP	B		;
		CALL	WPUTSDOP	;
		LHLD	ENDTEXT		;
		PUSH	H		;
		LXI	D, BTEXT + 2	;
		CALL	NEG_DE		;
		DAD	D		;
		LXI	D,0F01H		;
		CALL	HL_PRINT	;
		POP	D		;
		LXI	H,TEXT_LIMIT	;
		CALL	NEG_DE		;
		DAD	D		;
		LXI	D,0F00H		;
		CALL	HL_PRINT	;
		CALL	Key_Wait	;
		CALL	W_Close		;
		RET			;

HL_PRINT:	PUSH	D		;
		MOV	A,H		;
		CALL	WJHEX		;
		MOV	A,L		;
		CALL	JHEX		;
		POP	D		;
		RET			;


;////////////// ТБВПЮЙЕ СЮЕКЛЙ ТЕДБЛФПТБ ////////////////
;; рЕТЕОЕУ ЬФЙ СЮЕКЛЙ ОБ УЙУФЕНОХА УФТБОЙГХ (EUQ - ПРТЕДЕМЕОЙС)
;; 11.03.1994
;;OFSET:	DB	0	;УНЕЭЕОЙЕ ПЛОБ ПФОПУЙФ.УФТПЛЙ
;;CURHY:	DW	0	
;;CURDY:	DB	0,0,0	;РСФЙЪО. ДЕУ. ЙУМП-ОПНЕТ УФТПЛЙ
;;CURHX:	DB	0	
;;CURDX:	DB	0,0	;ДЕУ. ОПНЕТ РПЪЙГЙЙ
POS:	DW	BTEXT+2	

;;DLINNA:		DB	0H	;ОБЮБМШОБС ДМЙООБ УФТПЛЙ
;;FLAGLINE:	DB	0H	;=0 УФТПЛБ ОЕ КЪНЕОСМБУШ <>0 ЙЪН.

;;F_SL_BUF:
;;KORBUF:		DB	0,0,0	;ВХЖЕТ ЛПТЕЛФПТБ
;;ENDLINE:	DW	0000H	;ЛПТД. ЛПОГБ УФТПЛЙ
ENDTEXT:	DW	TEXT_END;БДТЕУ ИЧПУФБ ФЕЛУФБ
;;MAXDLINNA:	DB	0H	;ОБЙВПМШЫБС ДМЙООБ ТЕДБЛФЙТХЕНПК УФТПЛЙ


;$$$$$$$$$ ВБЪПЧЩЕ РТПГЕДХТЩ $$$$$$$$$
REGENER:	LXI	H,FLAGLINE
		MOV	A,M
		ORA	A
		RZ			;ЧЩИПД ТЕЗЕОЕТБГЙС ОЕ ОХЦОБ
		DCR	M		;УВТПУЙФШ ЖМБЗ РТЙУФХРЙФШ Л ТЕЗЕОЕТБГЙЙ
		DCX	H
		MOV	B,M		;УФБТБС ДМЙООБ УФТПЛЙ
		MOV	C,B		;
		LXI	H,STR
		CALL	COPYSDOP
		SUB	B
		MOV	B,A		;ТБЪОПУФШ
		LHLD	POS
		JZ	NOSDVIG		;ДМЙООЩ УФТПЛ ОЕ ЙЪНЕОЙМЙУШ
		CC	COPUINC		;ДМЙОБ ХНЕОШЫЙМБУШ
; ДМЙООБ ХЧЕМЙЮЙМБУШ
		CNC	COPUDEC		;УДЧЙОХФШ ФЕЛУФ Ч ПУОПЧО.ВХЖЕТЕ
NOSDVIG:	MOV	A,C
		ADD	B
		MOV	B,A
		XCHG
		INR	B
		LXI	H,STR
		CALL	Inc_Copy		;ЧУФБЧЛБ  ОПЧПК УФТПЛЙ
		CALL	RS_STR
		RET
;%%%%%%%%%%%%%% COPUINCSTOP %%%%%%%%%%%
COPUINC:	PUSH	B
		PUSH	D
		PUSH	H
		PUSH	PSW
		MOV	A,B
		MVI	B,0
		DAD	B
		MOV	D,H
		MOV	E,L		;DE---> ПФЛХДБ
		MOV	C,A		;HL --> ЛХДБ
		DCR	B		;B=0FFH
		DAD	B
		PUSH	H
		LHLD	ENDTEXT
		DAD	B
		SHLD	ENDTEXT
		POP	H
		MVI	B,STOPBYTE	
COILOP0:	LDAX	D
		MOV	M,A
		CMP	B
		INX	D
		INX	H
		JNZ	COILOP0
		POP	PSW
		POP	H
		POP	D
		POP	B
		RET
;%%%%%%%%%%%%%% COPUDEC %%%%%%%%%%%
;; HL ---> БДТЕУ ФЕЛХЭЕК УФТПЛЙ Ч ФЕЛУФЕ
;; B  ---> ТБЪОПУФШ НБЦДХ УФБТПК Й ОПЧПК УФТПЛПК
;; C  ---> УФБТБС ДМЙООБ УФТПЛЙ
COPUDEC:	PUSH	B
		PUSH	D
		PUSH	H
		PUSH	PSW
		MOV	A,B
		MVI	B,0
		DAD	B		;DE -> ДП ЛХДБ
		DCX	H
		XCHG
		MOV	C,A
		LHLD	ENDTEXT
		PUSH	H
		DAD	B		;HL -> ЛХДБ
		SHLD	ENDTEXT
		PUSH	H
		LXI	B,TEXT_LIMIT

	MOV	A,B
	CMA
	MOV	B,A
	MOV	A,C
	CMA
	MOV	C,A
	INX	B

		DAD	B
		POP	H
		POP	B		;BC -> ПФЛХДБ
		JNC	COLOOP1
		LXI	B,SOOBF		;ОЕФ РБНСФЙ
		CALL	WARNING
		CALL	COPYS
		XRA	A
		STA	FLAGLINE	;ПВПТЧБФШ ТЕЗЕОЕТБГЙА УФТПЛЙ
		INR	A
		STA	OFSET		;ЗЕОЕТБГЙС ДБМЙОЕЗП РЕТЕИПДБ ДПНПК
		CALL	DOMOY
		POP	PSW		
		POP	H
		POP	D
		POP	B
		POP	PSW		;ЪБВПТ ЙЪ УФЕЛБ ДЧХИ БДТЕУПЧ
		POP	PSW		;Й ==> * REGENER
		RET

COLOOP1:	LDAX	B
		MOV	M,A
		DCX	B
		DCX	H
		MOV	A,C
		CMP	E
		JNZ	COLOOP1
		MOV	A,B
		CMP	D
		JNZ	COLOOP1
		POP	PSW
		POP	H
		POP	D
		POP	B
		RET
;$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$
NARUSHENIE:	LXI	H,FLAGLINE
		MOV	A,M
		ORA	A
		RNZ			;УФТБЛБ ЙУРТПЧМСЕФУС
		INR	M		;ЖМБЗ =1 РЕТЧПЕ ЙУРТБЧМЕОЙЕ
		RET


CINV:	PUSH	B	;
	PUSH	D	;
	PUSH	H	;
	PUSH	PSW	;
	LHLD	W_Cursor;	
	XCHG		;
	CALL	Abs_DE	;
	CALL	Addr_Screen	
	MVI	E,Cursor_Zise
	MOV	B,E	;ЧЩУПФБ
	MOV	A,D	;
	RRC		;
	MVI	A,0FH	;
	JC	CV2	;
	CMA		;
CV2:	MOV	C,A	;
CV0:	MOV	A,M	;
	XRA	C	;
	MOV	M,A	;
	INR	L	;
	DCR	B	;
	JNZ	CV0	;
	DCR	L	;
	MOV	B,E	;
	MOV	A,H	;
	ADI	20h	;
	MOV	H,A	;
CV1:	MOV	A,M	;
	XRA	C	;
	MOV	M,A	;
	DCR	L	;
	DCR	B	;
	JNZ	CV1	;
	POP	PSW	;
	POP	H	;
	POP	D	;
	POP	B	;
	RET		;

;+--[ ТЙУ ЧЕТФ.УФТЕМЛХ ]---+
STL2:		PUSH	D	
		PUSH	PSW	
		MVI	A,5	
		CALL	Put_XY_Char	
		DCR	B	
		DCR	B	
		DCR	A	
ST0:		DCR	E	
		CALL	Put_XY_Char	
		DCR	B	
		JNZ	ST0	
		DCR	E	
		DCR	A	
		CALL	Put_XY_Char	
		POP	PSW	
		POP	D	
		RET	

;+----[ ТЙУ ЗПТ. УФТЕМЛХ ]----+
PAR1:		PUSH	D	
		PUSH	PSW	
		MVI	A,6	
		CALL	Put_XY_Char	
		INR	A	
		DCR	B	
		DCR	B	
PA0:		INR	D	
		CALL	Put_XY_Char	
		DCR	B	
		JNZ	PA0	
		INR	A	
		INR	D	
		CALL	Put_XY_Char	
		POP	PSW	
		POP	D	
		RET		

;РТПГЕДХТБ PRSCREEN ТБУРЕЮБФЩЧБЕФ ФЕЛХЭЕЕ УПД ВХЖЕТБ ФЕЛУФБ ДП ЛПОГБ ПЛОБ
;
PRSCREEN:
		LDAX	B
		CPI	STOPBYTE
		RZ
		CALL	WPUTS1	
PRINL3:		LDAX	B	
		INX	B	
		CPI	CR	
		JNZ	PRINL3	
		DCR	E	
		MOV	A,E
		INR	A
		JNZ	PRSCREEN
		RET
;$$$$$$$$$$$$$$$$$$$$$$$$$$$
PLAY:		PUSH	B	
		PUSH	PSW	
		MVI	A,36H	
		OUT	08H	
		LXI	B,200H	
PLJ0:		MOV	A,C	
		OUT	0BH	
		MOV	A,B	
		OUT	0BH	
		INX	B	
		MOV	A,B	
		CPI	10	
		JNZ	PLJ0	
		MVI	A,36H	
		OUT	08H	
		POP	PSW	
		POP	B	
		RET		
;////////////////////////////
COPYSDOP:	PUSH	B
		PUSH	D
		PUSH	H
		JMP	CODOP
COPYS:		PUSH	B	
		PUSH	D	
		PUSH	H	
		LHLD	POS	
CODOP:		XCHG			;ФПЮЛБ ЧИПДБ ДМС ЛПРЙТПЧЙОЙС РП HL
		LXI	H,STR	
		DCX	H
		LXI	B,0D00H
		MOV	M,B	;вМПЛЙТПЧЛБ ДМС EDLINE
COJ0:		LDAX	D	
		INX	H	
		INX	D	
		CMP	B	
		JZ	COQ	
		INR	C	;---//----
		JZ	COQ	;ЪБЭЙФБ ПФ РЕТЕРПМОЕОЙС
		MOV	M,A	
		JMP	COJ0	
COQ:		MOV	M,B	
		MOV	A,C	;ЮЙУМП УЛПРЙТПЧБООЩИ УЙНЧПМПЧ
		POP	H
		POP	D
		POP	B
		RET
;////////////////////
DECX:		PUSH	B	
		PUSH	D	
		PUSH	H	
		PUSH	PSW	
		LXI	H,CURHX	
		XRA	A	
		ORA	M	
		JZ	JINQ	
		DCR	M	
		LXI	B,9999H	
		JMP	JXINM	
;////////////////////
INCX:		PUSH	B	
		PUSH	D	
		PUSH	H	
		PUSH	PSW	
		LXI	H,CURHX	
		INR	M	
		JNZ	JXIN0	
		DCR	M	
		JMP	JINQ	
JXIN0:		LXI	B,100H	
JXINM:		INX	H	
		INX	H	
		MOV	A,M	
		ADD	B	
		DAA		
		MOV	M,A	
		DCX	H	
		MOV	A,M	
		ADC	C	
		DAA		
		MOV	M,A	
		MVI	B,1	
		LXI	D,0E1EH	
		JMP	JINQ2	
;//////////////////////
DECY:		PUSH	B	
		PUSH	D	
		PUSH	H	
		PUSH	PSW	
		LHLD	CURHY	
		MOV	A,H	
		ORA	L	
		JZ	JINQ	
		DCX	H	
		SHLD	CURHY	
		LXI	B,9999H	
		JMP	JIN1	
;////////////////////
INCY:		PUSH	B	
		PUSH	D	
		PUSH	H	
		PUSH	PSW	
		LHLD	CURHY	
		INX	H	
		MOV	A,H	
		ORA	L	
		JZ	JINQ	
		SHLD	CURHY	
		LXI	B,100H	
JIN1:		LXI	H,CURDY+2
		MOV	A,M	
		ADD	B	
		DAA		
		MOV	M,A	
		DCX	H	
		MOV	A,M	
		ADC	C	
		DAA		
		MOV	M,A	
		DCX	H	
		MOV	A,M	
		ADC	C	
		DAA		
		MOV	M,A	
JMAI:		MVI	B,2	
		LXI	D,81EH	
JINQ2:
		CALL	JDES	
JINQ:		POP	PSW	
		POP	H	
		POP	D	
		POP	B	
		RET		
;#################### ЧУРПНПЗБФЕМШОЩЕ РТПГЕДХТЩ ###################
;$$$$$$$$$$$$ CLEAR 3 BYTE $$$$$$$$$
CLEAR3:		MVI	D,3
CL00:		MVI	M,0
		DCX	H
		DCR	D
		JNZ	CL00
		INX	H
		RET
;;
;;	рТПГЕДХТБ РТПЙЪЧПДЙФ ТЕУФБТФ ВХЖЕТБ УФТПЛЙ.
;;
RS_STR:
	
	CALL	COPYS
	STA	DLINNA
	RET

;;; ртпгедхтб пфлтщфйс фйрпчпзп плоб ъбртпуб ;;;
US_OPEN:
	MVI	A,15h		; ПДЙОБТОПЕ ПЛОП У ФЕОША ФЙРБ-2
	CALL	W_Open		;
;; ИЙФТЩК ЧЩЪПЧ РТПГЕДХТЩ ESCF4
;$$$$$$$$$$$$ ESC F4 $$$$$$$$$$$$
ESCF4:		LXI	B,F4ESC
		JMP	YESDOP
;$$$$$$$$$$$$ YES NO $$$$$$$$$$$$
YESNO:		LXI	B,PPAYESNO
YESDOP:		CALL	HL_DE_Window
		INR	D
		DCR	E
		CALL	WRITE
		RET
;$$$$$$$$$$$$ WRITE $$$$$$$$$$$$$
WRITE:		LDAX	B
		ORA	A
		INX	B
		RZ
		CALL	Put_XY_Char
		INR	D
		JMP	WRITE
;;;;;;;;; INC_REMOVE ;;;;;;;
;; HL -ПФЛХДБ
;; DE -ЛХДБ
;; BC -УЛПМШЛП.
I_REMOVE:
	MOV	A,M	;
	STAX	D	;
	INX	H	;
	DCX	B	;
	INX	D	;
	MOV	A,B	;
	ORA	C	;
	JNZ	I_REMOVE;
	RET		;
;;;;;;;;; DEC_REMOVE ;;;;;;;;
;; HL - ПФЛХДБ
;; DE - ЛХДБ
;; BC - УЛПМШЛП
D_REMOVE:
	MOV	A,M	;
	STAX	D	;
	DCX	D	;
	DCX	H	;
	DCX	B	;
	MOV	A,B	;
	ORA	C	;
	JNZ	D_REMOVE;
	RET		;
;РТПГЕДХТЩ SINC Й SDEC РПТФСФ ЧУЕ ТЕЗЙУФТБ ЛТПНЕ BC
;ТЕЪХМШФБФ:    
;SINC ->  ЛПОЕГ ФЕЛУФБ ФП "Z=1"
;SDEC ->  ОБЮБМП ФЕЛУФБ ФП "C=0"

SINC:		LHLD	POS	
		MVI	E,CR	
SI1:		MOV	A,M	
		INX	H	
		CMP	E	
		JNZ	SI1	
		MOV	A,M	
		CPI	STOPBYTE
		RZ
SSM:		SHLD	POS	
		RET		

;//////////////
SDEC:		LHLD	POS	
		LXI	D,BTEXT+3
		CALL	NEG_DE			;;;;
		DAD	D
		RNC
		LHLD	POS
		DCX	H
		MVI	E,CR
SD1:		DCX	H	
		MOV	A,M	
		CMP	E	
		JNZ	SD1	
		INX	H	
		STC
		JMP	SSM

;;   рТПЗТБННБ ПТЗБОЙЪБГЙЙ ЙОФЕТЖЕКУБ У НБЗОЙФПЖПОПН Ч ЖПТ-
;; НБФЕ "EDASM" /* (C)18.06.1993 лБТБЗБОДБ */
;; ///////////// рЙНЕОПЧ рБЧЕМ бМЕЛУЕЕЧЙЮ. //////////////
NO_SINHRO	EQU	08h	; вЕЪ РПЙУЛБ УЙОИТПВБКФБ.
YES_SINHRO	EQU	0FFh	; у РПЙУЛПН УЙОИТПВБКФБ.

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;	 рТПГЕДЕТБ ЪБРЙУЙ ЖБКМБ ОБ НБЗОЙФПЖПО.		;;
F_SAVE:
	CALL	F_INPUT_NAME	;
	SUI	0Eh		;
	RZ			;
	XRA	A		;
	MOV	H,A		;
	MOV	L,A		;
	DAD	SP		;
	SHLD	STACK_BUFER	;
	DCR	A		;
	STA	F_FLAG		; ъбрйуш жбкмб.
	LXI	H,BTEXT+2	;
	PUSH	H		;
	CALL	CONTR_ADD	;
	POP	D		;
	PUSH	B		; лпофтпмшобс ухннб
	LHLD	ENDTEXT		;
	CALL	NEG_DE		;
	DAD	D		;
	XCHG			;
	IN	01h		;
	ANI	20h		;
	CZ	NEG_DE		;
	PUSH	D		; тбънет жбкмб ч дпрпмо лпде.
	DI			;
;; жПТНЙТХЕН ФПОБМШОЩК ЪБЗПМПЧПЛ ЖБКМБ.
	MVI	D,04h		;
	XRA	A		;
F_S_TONE1:
	MVI	E,040h		;
	XRI	55h		;
F_S_TONE0:
	CALL	PUT_REC_BYTE	;
	loop	E,F_S_TONE0	;
	loop	D,F_S_TONE1	;
;; чЩЧПДЙН ЙНС ЖБКМБ
	MVI	A,0E6h		;
	LXI	H,F_F_ASCII	;
	MVI	B,4		;
F_S_NAME0:
	CALL	PUT_REC_BYTE	;
	loop	B,F_S_NAME0	;
F_S_NAME1:
	CALL	PUT_REC_BYTE	;
	MOV	A,M		;
	INX	H		;
	CPI	0Dh		;
	JNZ	F_S_NAME1	;

	XRA	A		;
	MOV	B,A		;
F_S_NULL:			;
	CALL	PUT_REC_BYTE	; вМПЛ ОХМЕЧЩИ ВБКФПЧ.
	loop	B,F_S_NULL	;
;;
;; ъБРЙЫЕН ТБЪНЕТ ЖБКМБ.
;;
	POP	H		;
	MVI	A,0E6h		;
	CALL	PUT_REC_BYTE	;
	MOV	A,L		;
	CALL	PUT_REC_BYTE	;
	MOV	A,H		;
	CALL	PUT_REC_BYTE	;
;;
;; ъБРЙЫЕН НБУЙЧ ФЕЛУФБ.
;;
	LXI	H,BTEXT+2	;
F_S_TEXT:
	MOV	A,M		;
	CALL	PUT_REC_BYTE	;
	XTHL			;
	XTHL			;
	INX	H		;
	CPI	0FFh		;
	JNZ	F_S_TEXT	;
	POP	B		;
	MOV	A,C		;
	CALL	PUT_REC_BYTE	;
	MOV	A,B		;
	CALL	PUT_REC_BYTE	;
	EI			;
	CALL	W_Close		;
	CALL	W_Close		;
F_MAIN_EXIT:			;
	POP	H		;
F_3EXIT:			;
	CALL	RS_STR		;
	CALL	INCY		;
	CALL	DECY		;
	RET			;
F_MERGE:
	MVI	A,01h		; лПНБОДБ РПДЗТХЪЛЙ.
	JMP	F_L_M		;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;	   рТПГЕДХТБ ЮФЕОЙС ЖБКМБ У НБЗОЙФПЖПОБ.	;;
F_LOAD:
	XRA	A		;
F_L_M:
	STA	F_FLAG		; лПНБОДБ ЮФЕОЙС.
	XRA	A		;
	MOV	H,A		;
	MOV	L,H		;
	DAD	SP		;
	SHLD	STACK_BUFER	;

	LXI	D,1018h		;
	LXI	H,3018h		;
	MVI	A,16h		;
	CALL	W_Open		;
	LXI	B,F_L_MESSAGE	;
	LXI	D,0500h		;
	CALL	WPUTSDOP	;
	DI			;	
	CALL	WAIT_HEADER_ASM	;пЦЙДБЕН УФБТФПЧПЗП ТБЛПТДБ.
	CALL	LOAD_NAME_ASM	;рТПЮЙФБЕН ЙНС ЖБКМБ.
	LXI	D,2B1Eh		;
	LXI	H,361Eh		;
	CALL	Cls_XY		;
	LXI	B,F_F_ASCII	;
	LXI	D,2B1Eh		;
F_L_LOOP_NAME:
	LDAX	B		;
	CPI	CR		;
	CNZ	Put_XY_Char	;
	INX	B		;
	PUSH	PSW		;
	INR	D		;
	POP	PSW		;
	JNZ	F_L_LOOP_NAME	;
	CALL	GET_YES_SINHRO	;рТПРХУФЙН ОХМЕЧХА ЪБРЙУШ.
	CALL	GET_NOT_SINHRO	;Й ТБЪНЕТ ЖБКМБ.
;; рЕТЕИПДЙН Л ЪБЗТХЪЛЕ ЖБКМБ.
	LDA	F_FLAG		;
	DCR	A		;
	LXI	H,BTEXT+2	; ОБЮБМП ФЕЛУФПЧПЗП ВХЖЕТБ
	JNZ	F_LM_MERGE	;
	LHLD	ENDTEXT		; хЛБЪБФЕМШ ОБ ЛПОЕГ ЖБКМБ
F_LM_MERGE:			; 
	LXI	D,TEXT_LIMIT	; ЛПОЕГ ФЕЛУФПЧПЗП ВХЖЕТБ
LOAD_LOOP:
	CALL	GET_NOT_SINHRO	; РТПЮЙФБЕН ВБКФ
	MOV	M,A		; уЛЙОЕН Ч РБНСФШ
	INR	A		; РТПЧЕТЙН ОБ ЛПОЕГ ФЕЛУФБ
	JZ	LOAD_EXIT	; ХИПД ЕУМЙ дб
	INX	H		; ЙОБЮЕ РТДПМЦБЕН
	CALL	MEMORY_OVER	; РТПЧЕТЛБ ОБ ТЕЪЕТЧ РБНСФЙ
	JNZ	LOAD_LOOP	;
	JC	LOAD_LOOP	;
;;;;;;;;;;;;;;;;; рЕТЕРПМОЕОЙЕ РБНСФЙ ;;;;;;;;;;;;;;;;
	MVI	M,0FFh		;
	SHLD	ENDTEXT		;
	LXI	B,F_LOAD_OVER	;
	LXI	D,0400h		;
	JMP	F_L_QUIT	;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
LOAD_EXIT:			;
	PUSH	H		; хЛБЪБФЕМШ ЛПОГБ.
	CALL	GET_NOT_SINHRO	;
	MOV	E,A		;
	CALL	GET_NOT_SINHRO	;
	MOV	D,A		;
	LDA	F_FLAG		;
	DCR	A		;
	LXI	H,BTEXT+2	;
	JNZ	F_LM_2MERGE	;
	LHLD	ENDTEXT		;
F_LM_2MERGE:			;
	CALL	CONTR_ADD	;
	EI			;
	MOV	A,D		;
	CMP	B		;
	POP	H		; чпуфбопчйн лпоег.
	JNZ	F_LOAD_ERROR	;
	MOV	A,E		;
	CMP	C		;
	JNZ	F_LOAD_ERROR	;
	SHLD	ENDTEXT		;
	CALL	W_Close		;
	CALL	W_Close		;
F_2MAIN_EXIT:
	CALL	NULL_POS	;
	CALL	PRINT_POS	;
	JMP	F_MAIN_EXIT	;

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;; пЫЙВЛБ ЮФЕОЙС ЖБКМБ. хОЙЮФПЦЙН РТЕДЙДХЭЙК Й РПЧФПТЙН.
F_LOAD_ERROR:
	CALL	F_RESTART	;
	LXI	B,ERROR_LOAD	;
	LXI	D,0D00h		;
F_L_QUIT:
	CALL	W_Cls		;
	CALL	WPUTSDOP	;
	MVI	A,50		;
F_L_ERR_LOOP:
	HLT			;
	loop	A,F_L_ERR_LOOP	;
	CALL	W_Close		;
	JMP	F_3EXIT		;
;;;;;;;;;;;;;;;;;;; I N T E R R U P T ;;;;;;;;;;;;;;;;;;;;
REC_EXIT:
	EI			;
	LHLD	STACK_BUFER	;
	SPHL			;
	LXI	B,F_INTERRUPT	;
	LXI	D,0600h		;
	LDA	F_FLAG		;
	INR	A		;
	JZ	F_L_QUIT	;
	CALL	F_RESTART	;
	MVI	D,0Bh		;
	JMP	F_L_QUIT	;

;_______________________ ртпгеуущ _________________________
	Public	PUT_REC_BYTE	; ЧЩЧПД ВБКФБ ОБ НБЗОЙФПЖПО
	Public	GET_REC_BYTE	; ЧЧПД ВБКФБ У НБЗОЙФПЖПОБ
	Public	GET_NOT_SINHRO	; ЮФЕОЙЕ ВЕЪ УЙОИТП РПЙУЛБ
	Public	GET_YES_SINHRO	; ЮФЕОЙЕ У УЙОИТП РПЙУЛПН
	Public	WAIT_HEADER_ASM	; ПЦЙДБОЙС ЪБЗПМПЧЛБ ЖБКМБ
	Public	LOAD_NAME_ASM	; ЮФЕОЙЕ ЙНЕОЙ ЖБКМБ
	Public	MEMORY_OVER	; лПОФТПМШ РЕТЕРПМОЕОЙС.

;________________________ рбнсфш __________________________
	Public	PUT_CONST	; ЛПОУФБОФБ ЪБРЙУЙ
	Public	GET_CONST	; ЛПОУФБОФБ ЮФЕОЙС

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;	рТПГЕДХТБ ТЕУФБТФБ ПРГЙЙ ЮФЕОЙС ЖБКМПЧ.		;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
F_RESTART:
	LXI	H,0FF0Dh	;
	LDA	F_FLAG		;
	DCR	A		;
	JZ	F_RES_00	;
DEL_TEXT:
	LXI	H,0FF0Dh	;
	SHLD	BTEXT+2		;
	LXI	H,BTEXT+3	;
	SHLD	ENDTEXT		;
	RET			;
F_RES_00:
	LHLD	ENDTEXT		;
	MVI	M,0FFh		;	
	RET			;

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;   рТПГЕДХТБ РПДУЮЕФБ ЛПОФТПМШОПК УХННЩ РТПЮЙФБОПЗП	;;
;; ЖБКМБ.	теъхмшфбф: BC				;;
;;	чипд: HL - хлбъбфемш обюбмб рпдуюефб.		;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
CONTR_ADD:
	LXI	B,0000h		;
CONT_LOOP:			;
	MOV	A,M		;
	INR	A		;
	RZ			;
	DCR	A		;
	ADD	C		;
	MOV	C,A		;
	MVI	A,0		;
	ADC	B		;
	MOV	B,A		;
	INX	H		;
	JMP	CONT_LOOP	;

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;	рТПГЕДХТБ ПРТЕДЕМЕОЙС ЛПОГБ РБНСФЙ ьчн		;;
;; чипд:	HL - фЕЛХЭЙК БДТЕУ.			;;
;;		DE - рТЕДЕМШОЩК БДТЕУ.			;; 
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
MEMORY_OVER:		;
	MOV	A,H	;
	CMP	D	;
	RNZ		;
	MOV	A,L	;
	CMP	E	;
	RET		;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;   рТПГЕДХТБ ЮФЕОЙС ЙНЕОЙ ЖБКМБ Ч УРЕГЙБМШОЩК ВХЖЕТ	;;
;; BUF_NAME   ( ТБЪНЕТ ЙНЕОЙ ПЗТБОЙЮЕО 12 УЙНЧПМБНЙ )	;;
;;		 тезйуфтщ ое упитбосафус !!!		;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
LOAD_NAME_ASM:			;
	LXI	H,F_F_ASCII-1	; хЛБЪБФЕМШ ОБ ВХЖЕТ.
	MVI	B,13		; УЮЕФЮЙЛ УЙНЧПМПЧ.
LOAD_NAME_LOOP:			;
	INX	H		;
	CALL	GET_NOT_SINHRO	;
	DCR	B		;
	MVI	M,0Dh		; УФБЧЙН ЧТЕНЕОХА ЪБЗМХЫЛХ.
	RZ			; ЧЩИПДЙН ЕУМЙ ВХЖЕТ ЙНЕОЙ
	MOV	M,A		; РЕТЕРПМОЕО.
	ORA	A		; ЧЩИПДЙН ЕУМЙ ТЕБМШОПЕ ЙНС
	JNZ	LOAD_NAME_LOOP	; ЪБЛПОЮЙМПУШ.
	MVI	M,0Dh		;
	RET			;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;	рТПГЕДХТБ ПЦЙДБОЙС ЪБЗПМПЧЛБ ЖБКМБ "*.ASM"	;;
;;  рТПГЕДХТБ ПУХЭЕУФЧМСЕФ РПЙУЛ ОБ МЕОФЕ УФБОДБТФОПЗП	;;
;; ЪБЗПМПЧЛБ ФЕЛУФПЧПЗП ЖБКМБ Й ЧПЪЧТБЭБЕФ ХРТБЧМЕОЙЕ	;;
;; ДМС РТПЙЪЧЕДЕОЙС ЮФЕОЙС ЙНЕОЙ ЖБКМБ.			;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
WAIT_HEADER_ASM:		;
	PUSH	PSW		;
	PUSH	B		;
WAIT_H_LOOP_00:			;
	MVI	B,4		;
	MVI	A,YES_SINHRO	;
WAIT_H_LOOP_10:			;
	CALL	GET_REC_BYTE	;
	CPI	0E6h		;
	JNZ	WAIT_H_LOOP_00	;
	DCR	B		;
	MVI	A,NO_SINHRO	;
	JNZ	WAIT_H_LOOP_10	;
	POP	B		;
	POP	PSW		;
	RET			;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;    рТПГЕДХТБ ЮФЕОЙС ВБКФБ У НБЗОЙФПЖПОБ ВЕЪ уйоитп.	;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
GET_NOT_SINHRO:
	MVI	A,NO_SINHRO	;
	JMP	GET_REC_BYTE	;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;	рТПГЕДХТБ ЮФЕОЙС ВБКФБ У УЙОИТПОЙЪБГЙЕК		;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
GET_YES_SINHRO:
	MVI	A,YES_SINHRO	;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;	рТПГЕДХТБ ЮФЕОЙС ВБКФБ У НБЗОЙФПЖПОБ.		;;
;; чипд:	б = 0FFh - У РПЙУЛПН УЙОИТПВБКФБ	;;
;;		A = 008h - ВЕЪ РПЙУЛБ УЙОИТПВБКФБ	;;
;; чщипд:	б = РТПЮЙФБОЩК ВБКФ.			;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
GET_REC_BYTE:
	PUSH	B		; УПИТБОСЕН ТЕЗЙУФТЩ.
	PUSH	D		;
	MVI	C,0		; УЖПТНЙТХЕН ЪБЗПФПЧЛХ.
	MOV	D,A		; УПИТБОЙН РБТБНЕФТ.
GET_REC_LOOP:
	IN	01h		;
	ANI	10h		; ПЦЙДБЕН РЕТЕРБДБ ХТПЧОС
	MOV	E,A		; УЙЗОБМБ.
GET_REC_00:			; ( УЙОИТПОЙЪБГЙС РП ЖБЪЕ )
	IN	01h		;
	ANI	10h		;
	CMP	E		;
	JZ	GET_REC_00	; ГЙЛМ ЦЙДБОЙС.
	RLC			;
	RLC			;
	RLC			;
	RLC			;
	MOV	A,C		;
	RAL			;
	MOV	C,A		;
	LDA	GET_CONST	;РТПЮЙФБЕН ЛПОУФБОФХ ЮФЕОЙС
	CALL	WAIT_LOOP	;
	MOV	A,D		;
	ORA	A		;
	JP	GET_REC_NO_SINHRO;
	MOV	A,C		;
	CPI	0E6h		;
	JNZ	GET_REC_01	;
	XRA	A		;
	STA	GET_INVERSE	;
GET_REC_01:			;
	CPI	19h		;
	JNZ	GET_REC_LOOP	;
	MVI	A,0FFh		;
	STA	GET_INVERSE	;
	MVI	D,9		;
GET_REC_NO_SINHRO:		;
	DCR	D		;
	JNZ	GET_REC_LOOP	;
	LDA	GET_INVERSE	;
	XRA	C		;
	POP	D		;
	POP	B		;
	RET			;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;	рТПГЕДХТБ ЧЩЧПДБ ВБКФБ ОБ НБЗОЙФОХА МЕОФХ.	;;
;; чипд:	б = чЩЧПДЙНЩК ВБКФ.			;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
PUT_REC_BYTE:
	PUSH	D		; УПИТБОЙН ТЕЗЙУФТЩ
	PUSH	PSW		;
	MOV	D,A		;
	MVI	C,8		; УЮЕФЮЙЛ ВЙФПЧ.
PUT_REC_00:			;
	MOV	A,D		; УДЧЙОЕН
	RLC			; ФЕЛХЭЙК ВЙФ ВБКФБ
	MOV	D,A		;
	MVI	A,1		; УДЕМБЕН ЕЗП ЙОЧЕТУЙА
	XRA	D		;
	ANI	01h		; ЧЩДЕМЙН
	OUT	00h		; Й ЧЩДБДЙН Ч РПТФ
	CALL	PUT_REC_WAIT	; УДЕМБЕН ЪБДЕТЦЛХ.
	MVI	A,0		;
	XRA	D		; РТПДЕМБЕН ФПЦЕ УБНПЕ ОП ВЕ ЙОЧТУЙ
	ANI	01h		;
	OUT	00h		;
	CALL	PUT_REC_WAIT	;
	DCR	C		; ВЙФЩ ЛПОЮЙМЙУШ ???
	JNZ	PUT_REC_00	;
	POP	PSW		;
	POP	D		;
	RET			;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;	рТПГЕДХТБ ПТЗБОЙЪБГЙЙ ЪБДЕТЦЛЙ ДМС РТПГЕДХТЩ	;;
;; ЧЩЧПДБ ВБКФБ ОБ НБЗОЙФПЖПО.				;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
PUT_REC_WAIT:
	LDA	PUT_CONST	;
WAIT_LOOP:
	loop	A,WAIT_LOOP	;
	IN	01h		;
	ANI	40h		;
	JZ	REC_EXIT	;
	RET			;

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;    вМПЛ УЙУФЕНОЩИ СЮЕЕЛ ДМС ТБВПФЩ У НБЗОЙФПЖПОПН	;;
;;F_FLAG:		DB	00h ; жМБЗ ПРЕТБГЙЙ У НБЗОЙФПЖ.
		;; 00 - ЮФЕОЙЕ ЖБМБ.
		;; 01 - РПДЗТХЪЛБ ЖБКМБ.
		;; 0FFh - ъбрйуш жбкмб.

;;GET_INVERSE:	DB	00h ; хЛБЪБФЕМШ ЙОЧЕТУОПК "УЙОИТП".
;;STACK_BUFER:	DW	'20'; ВХЖЕТ УПИТБОЕОЙС УФЕЛБ.
;;TMP_BUFER:	DW	'07'; ЧТЕНЕОЩК ВХЖЕТ.
ERROR_LOAD:
	Rus_DB	пЫЙВЛБ
	DB	CR
SOOBF:
F_LOAD_OVER:
	Rus_DB	рЕТЕРПМОЕОЕЙЕ
	DB	CR
;;; юФЕОЙЕє ху ­ рТЕТЩЧБОЙЕ
F_L_MESSAGE:	DB	0FEh,0D4h,0C5h,0CEh,0C9h,0C5h,', '
		DB	0F5h,0F3h,' - '
F_INTERRUPT:	DB	0F0h,0D2h,0C5h,0D2h
		DB	0D9h,0D7h,0C1h,0CEh,0C9h,0C5h,CR

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;	рТПГЕДХТБ ПВТБВПФЛЙ ЛПНБОДЩ 1-Copy		;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
BLOCK:
	LDA	BL_D_FLAG	;
	ORA	A		;
	JNZ	BLO_DONE	;
;;;;;;;;;;;; пВТБВПФБЕН УМХЮБК РХУФПЗП ВХЖЕТБ ;;;;;;;;;;;;
	LXI	B,BLO_SOOB	;
	CALL	BL_OVERFLOM	;
	RET			;

BLO_SOOB:
	DB 'Free',CR	;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;	   рТПЙЪЧЕДЕН ЧУФБЧЛХ ВМПЛБ ЙЪ ВХЖЕТБ		;;
BLO_DONE:
;; РТПЧЕТЛБ ОБ УППФЧЕФУФЧЙЕ ТБЪНЕТПЧ ВМПЛБ Й УЧПВПДОПК
;; РБНСФЙ ПФЧЕДЕООПК РПД ФЕЛУФ.
	LHLD	ENDTEXT		;
	XCHG			;
	CALL	NEG_DE		;
	LXI	H,TEXT_LIMIT	;
	DAD	D		; ТБЪНЕТ УЧПВПДОПК
	XCHG			; РБНСФЙ
	LHLD	BL_DUMP_ZISE	;
	CALL	NEG_DE		;
	DAD	D		;
	JNC	BLO_YES		; рБНСФЙ ИЧБФБЕФ !!!
;;;;;;;;;;;; пВТБВПФБЕН ЧЕФЧШ ОЕИЧБФЛЙ РБНСФЙ ;;;;;;;;;;;;
	LXI	B,SOOBF		;
	CALL	BL_OVERFLOM	;
	RET			;
BLO_YES:
;; уЖПТНЙТХЕН "ДЩТЛХ" Ч ФЕЛУФЕ ;;
	LHLD	POS		;
	XCHG			;
	LHLD	ENDTEXT		;
	CALL	NEG_DE		;
	DAD	D		;
	MOV	B,H		; BC - уЛПМШЛП.
	MOV	C,L		;
	INX	B		;
	LHLD	ENDTEXT		;
	XCHG			; DE - пФЛХДБ.
	LHLD	BL_DUMP_ZISE	;
	DAD	D		; HL - лХДБ.
	PUSH	H		;
	XCHG			; DE <-> HL
	CALL	D_REMOVE	;
	POP	H		;
	SHLD	ENDTEXT		; лПТЕЛГЙС ХЛБЪБФЕМС ЛПОГБ
;;  уЛПРЙТХЕН ВХЖЕТ Ч "ДЩТЛХ".	;;
	LHLD	POS		;
	XCHG			;
	LHLD	BL_DUMP_ZISE	;
	MOV	B,H		;
	MOV	C,L		;
	LXI	H,DUMP_GUT	;
	CALL	I_REMOVE	;
	LHLD	W_Cursor	;
	PUSH	H		;
	INR	L		;
	INR	L		;
	INR	L		;
	MVI	H,3Dh		;
	LXI	D,0203h		;
	CALL	Cls_XY		;
	POP	D		;
	MVI	D,0		;
	LHLD	POS		;
	MOV	B,H		;
	MOV	C,L		;
	CALL	PRSCREEN	;	
	CALL	CCLEFT		;
	JMP	BL_EXIT_M	;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;	рТПГЕДХТБ ПВТБВПФЛЙ  ОБЦБФЙС  ЛМБЧЙЫЙ "F1" Ф.Е	;;
;; ЧЩВПТ ЛПНБОДЩ ХУФБОПЧЛЙ ОБЮБМБ ВМПЛБ.		;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
BL_BEGIN:
	LHLD	POS		;
	INX	H		;
	MOV	A,M		;
	CPI	STOPBYTE	; хЛБЪБФЕМШ Ч ЛПОГЕ ЖБКМБ?
	JZ	BL_ERROR	;
	LDA	BL_B_FLAG	; рТПЮЙФБЕН ЖМБЗ ХУФБОПЧЛЙ
	ORA	A		;
	JZ	BL_B_DONE	;
;;  пВТБВПФБЕН УЙФХБГЙА РПЧФПТОПК ХУФБОПЧЛЙ НБТЛЕТБ ОБЮБМБ
;; ВМПЛБ Ф.Л ЧПЪНПЦОП ПЫЙВПЮОПЕ ОБЦБФЙЕ ОБ ЛМБЧЙЫХ.
	LXI	D,281Ch		;
	LXI	H,381Ch		;
	CALL	S_ARE_YOU	;
	RNZ			;
BL_B_DONE:			;
	DCR	A		;
	STA	BL_B_FLAG	; хУФБОПЧЙН НБТЛЕТ "ОБЮБМП"
	LHLD	POS		; Й УПИТБОЙН БДТЕУ.
	SHLD	BL_F1_POS	;
	LHLD	CURDY		; уПИТБОЙН ХЛБЪБФЕМШ
	SHLD	BL_CURDY	; ОБ НЕУФПОБИПЦДЕОЙЕ
	LDA	CURDY + 2	; РПНЕФЛЙ.
	STA	BL_CURDY + 2	;
	LHLD	CURHY		;
	SHLD	BL_CURHY	;
	LXI	D,151Bh		;
	LXI	B,BL_B_VIEW	;
	CALL	WPUTSDOP	;
	RET			; чПЪЧТБФ.
;;;;;;;;;;;;;;;;; дПРПМОЙФЕМШОЩЕ СЮЕКЛЙ ;;;;;;;;;;;;;;;;;;
;BL_B_FLAG:
;	DB	0h	; !0 -  нБТЛЕТ ХУФБОПЧМЕО.
;			; 0  - оЕ ХУФБОПЧМЕО.
;BL_D_FLAG:
;	DB	0h	; 0 -  вХЖЕТ РХУФПК.
;			; !0 - вХЖЕТ ЪБРПМОЕО.
;BL_F1_POS:
;	DW	0h	; бДТЕУ УФТПЛЙ ЛПФПТХА РПНЕФЕМЙ.
;BL_DUMP_ZISE:
;	DW	0h	; тБЪНЕТ ЧЩДЕМЕОПЗП ВМПЛБ
;BL_CURDY:
;	DB	0,0,0	; чТЕНЕОПЕ УПИТБОЕОЙЕ ЛППТДЙОБФ
;			; ОБЮБМБ ВМПЛБ
;BL_CURHY:
;	DW	0h	; ---//---//---//---
;;;;;;;; уМПЧП РПСЧМСЕФУС РТЙ ХУФБОПЧЛЙ НБТЛЕТБ ;;;;;;;;;;
BL_B_VIEW:
	DB	'View',CR
BL_B_ERROR:
	DB	'Error',CR
BL_B_EDIT:
	DB	'Mode:Edit',CR
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;	рТПГЕДХТБ ПВТБВПЛЙ ОБЦБФЙС ЛМБЧЙЫЙ "F3"		;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
BL_END:
	CALL	CCLEFT		;
	CALL	BL_ZISE		; пРТЕДЕМЙН ТБЪНЕТ ВМПЛБ.
;; еУМЙ ЖМБЗ C РПДОСФ ФП ТБЪОПУФШ РПМПЦЙФЕМШОБ.
	JC	BL_E_DONE	;
BL_ERROR:
	LXI	B,BL_B_ERROR	; чЩДЕН УППВЭЕОЙЕ П ОЕЧПЪ-
	CALL	WARNING		; НПЦОПУФЙ ХУФБОПЧЛЙ НБТЛЕТБ
	RET			;
;;	вМПЛ  ХУРЕЫОП  ЧЩДЕМЕО  ФЕРЕТШ  ПФЛТПЕН ПЛОП У
;; ОХЦОЩНЙ "ВМАДБНЙ".
;;
BL_E_DONE:
	LXI	D,2A1Ah		;
	LXI	H,391Ch		;
	CALL	US_OPEN		;
	LXI	D,0202h		;
	LXI	B,BL_SOOB1	;
	CALL	W_DOP_INX	;
	DCR	E		;
	CALL	W_DOP_INX	;
	DCR	E		;
	CALL	W_DOP_INX	;
BL_LOOP:			;
	CALL	MENU		;
	CPI	0Eh		; еУМЙ ОБЦБМЙ F4 ФП УЮЙФБЕН	
	CZ	W_Close		; ОБЦБФЙЕ  ЛМБЧЙЫЙ F3 ВЩМП
	RZ			; ПЫЙВПЮОЩН.
	ORA	A		;
	JZ	BL_MOVE		; "ретенеэеойе"
	DCR	A		;
	JZ	BL_COPY		; "лпрйтпчбойе"
;;;;;;;;;;; рТПЙЪЧЕДЕН ХДБМЕОЙЕ ЧЩДЕМЕОПЗП ВМПЛБ;;;;;;;;;;
	CALL	BL_ARE_YOU	;
	CALL	W_Close		;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;; рТПЙЪЧЕДЕН ЖЙЪЙЮЕУЛПЕ ХДБМЕОЙЕ
BL_DELETE:			;
	CALL	SINC		;
	JNZ	BL_DEL_00	; JMP еУМЙ ОЕ ЛПОЕГ ФЕЛУФБ.
;;;;; пВТБВПФЛБ "F3" ОБ ЛПОГЕ ФЕЛУФБ ;;;;
	LHLD	BL_F1_POS	;
BL_EXIT1:			;
	SHLD	ENDTEXT		;
	MVI	M,STOPBYTE	;
BL_EXIT2:			;
	LHLD	BL_CURHY	;
	SHLD	CURHY		;
	LHLD	BL_CURDY	;
	SHLD	CURDY		;
	LDA	BL_CURDY + 2	;
	STA	CURDY + 2	;
	LHLD	BL_F1_POS	;
	SHLD	POS		;
	CALL	W_Cls		;
	CALL	PRINT_POS	;
BL_EXIT_M:
	CALL	RESTORE_EDIT	;
	RET			;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;	 чЕФЧШ РПМОПГЕООПЗП ХДБМЕОЙС ЛХУЛБ ФЕЛУФБ.	;;
BL_DEL_00:
	LHLD	POS		;
	PUSH	H		;
	XCHG			;
	LHLD	ENDTEXT		;
	CALL	NEG_DE		;
	DAD	D		;
	MOV	B,H		; BC - уЛПМШЛП
	MOV	C,L		;
	LHLD	BL_F1_POS	;
	XCHG			; DE - лХДБ
	POP	H		; HL - пФЛХДБ
	CALL	I_REMOVE	;
	XCHG			;
	JMP	BL_EXIT1	;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;	рТПГЕДХТБ ПТЗБОЙЪБГЙЙ РЕТЕНЕЭЕОЙС Ч ВХЖЕТ	;;
BL_MOVE:
	CALL	BL_ARE_YOU	;
	CALL	BL_LOC_COPY	;
	CALL	W_Close		;
	JMP	BL_DELETE	;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;	рТПГЕДХТБ ПТЗБОЙЪБГЙЙ ЛПРЙТПЧБОЙС Ч ВХЖЕТ	;;
BL_COPY:			;
	CALL	BL_ARE_YOU	; ъБРТПУ РПДФЧЕТЦДЕОЙС
	CALL	BL_LOC_COPY	; лПРЙТПЧБОЙЕ
	CALL	W_Close		; ЪБТЩЧБЕН ПЛОП Й ЧЩИПДЙН
	CALL	RESTORE_EDIT	;
	RET			;
;;;;;;;;;;;;; рТПГЕДХТБ ЛПРЙТПЧБОЙС Ч ВХЖЕТ ;;;;;;;;;;;;;
BL_LOC_COPY:			;
	CALL	SINC		;
	PUSH	PSW		;
	JNZ	BL_LOC_C_DONE	;
	LHLD	BL_F1_POS	; лПОЕГ ФЕЛУФБ.
	XCHG			;
	LHLD	ENDTEXT		;
	DCX	H		;
	CALL	BL_ZISE_DOP	;
	XRA	A		;
BL_LOC_C_DONE:			;	
	CNZ	BL_ZISE		; пРТЕДЕМЙН ТБЪНЕТ ВМПЛБ.
	PUSH	H		;
	XCHG			;
	CALL	NEG_DE		;
	LXI	H,DUMP_ZISE	;
	DAD	D		;
	POP	B		; BC - тБЪНЕТ ВМПЛБ
	JC	BL_C_DONE	; РПНЕУФЙМЙ Ч ВХЖЕТ.
;;;;;;;;;;;;;; вМПЛ ОЕ РПНЕЭБЕФУС Ч ВХЖЕТ ;;;;;;;;;;;;;;;;
	LXI	B,SOOBF		;
	CALL	BL_OVERFLOM	;
	CALL	W_Close		;
BL_MAIN_EXIT:			;
	POP	PSW		;
	CNZ	SDEC		;
	RET			;
;;;;;;;;; рТПЙЪЧЕДЕН ЛПРЙТПЧБОЙЕ ВМПЛБ Ч ВХЖЕТ ;;;;;;;;;;;
BL_C_DONE:
	ORI	38h		;
	STA	BL_D_FLAG	; вХЖЕТ ЪБРПМОЕО.
	MOV	H,B		;
	MOV	L,C		;
	SHLD	BL_DUMP_ZISE	; уПИТБОЙН ТБЪЕТ ВМПЛБ
	LHLD	BL_F1_POS	; HL - пФЛХДБ
	LXI	D,DUMP_GUT	; DE - KХДБ
	CALL	I_REMOVE	;
	JMP	BL_MAIN_EXIT	;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;	рТПГЕДХТБ ЧЩЧПДБ УППВЭЕОЙС Out of memory	;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
BL_OVERFLOM:			;
	MVI	A,5		;
BL_O_LOOP:			;
	PUSH	B		;
	PUSH	PSW		;
	CALL	WARNING		;
	POP	PSW		;
	POP	B		;
	DCR	A		;
	JNZ	BL_O_LOOP	;
	RET			;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;	рТПГЕДХТБ РТПЙЪЧПДЙФ ЪБРТПУ "чЩ ХЧЕТЕОЩ ???"	;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
BL_ARE_YOU:			;
	LXI	D,2019h		;
	LXI	H,3019h		;
	CALL	S_ARE_YOU	;
	RZ			;
	POP	H		;
	JMP	BL_LOOP		;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;	рТПГЕДХТБ ДМС ПРТЕДЕМЕОЙС ТБЪНЕТБ ВМПЛБ		;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
BL_ZISE:
	LHLD	BL_F1_POS	; HL = рПЪЙГЙС ЛПОГБ.
	XCHG			;
	LHLD	POS		; DE = рПЪЙГЙС ОБЮБМБ.
BL_ZISE_DOP:
	CALL	NEG_DE		; РТПЙЪЧЕДЕН ЧЩЮЙФБОЙЕ
	DAD	D		;
	RET			;	
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;	рТПГЕДХТБ ЧУФБОПЧМЕОЙС ТЕЦЙНБ ТЕДБЛФЙТПЧБОЙС	;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
RESTORE_EDIT:
	LXI	D,101Bh		;
	LXI	B,BL_B_EDIT	;
	CALL	WPUTSDOP	;
	XRA	A		;
	STA	BL_B_FLAG	;
	CALL	RS_STR		;
	RET			;
;;;;;;;;;;; фЕЛУФПЧЩЕ УППВЭЕОЙС ;;;;;;;;;;;
BL_SOOB1:
	Rus_DB	хДБМЙФШ_ВМПЛ
	DB	CR
	Rus_DB	уЛПРЙТПЧБФШ
	DB	CR
	Rus_DB	рЕТЕНЕУФЙФШ
	DB	CR

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;	рТПГЕДХТБ ЙЪНЕОЕОЙС ЛПОУФБОФ ЮФЕОЙС-ЪБРЙУЙ	;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
SV_CONST:
	LXI	D,1017h		;
	LXI	H,2318h		;
	MVI	A,17h		;
	CALL	US_OPEN + 2	;
	LXI	D,201h		;
	LXI	B,SV_C_SOOB0	;
	CALL	W_DOP_INX	;
	DCR	E		;
	CALL	W_DOP_INX	;
SV_C_LOOP:			;
	CALL	MENU		;
	MOV	B,A		;
	CPI	0Eh		; F4 - ??? ФП ЧЩИПД
	CZ	W_Close		;
	RZ			;
	ORI	038h		; йУЛХУФЕООЩК ОЕ "0"
	CALL	SV_VARIAL	;
	JMP	SV_C_LOOP	;
SV_C_SOOB0:
	Rus_DB	лПОУФБОФБ_ЮФЕОЙС
	DB	CR
	Rus_DB	лПОУФБОФБ_ЪБРЙУЙ
	DB	CR

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;	вМПЛ ПВТБВПФЛЙ ЛПНБОДЩ "ХДБМЕОЙЕ ФЕЛУФБ"	;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
NEW_TEXT:
	LXI	D,081Bh		;
	LXI	H,181Bh		;
	CALL	S_ARE_YOU	; ъБРТТПУ ОБ ХДБМЕОЙЕ.
	RNZ			; оЕ ХДБМСФШ Й ЧЩКФЙ.
	CALL	DOMOY		;
	CALL	NULL_POS	;
	CALL	INCY		;
	CALL	DECY		;
	CALL	DEL_TEXT	;
	CALL	W_Cls		;
	CALL	RS_STR		;
	RET			;

	Title	WD8.ASM
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;	 дТБКЧЕТ ПЛПООПЗП ЙОФЕТЖЕКУБ чЕТУЙС 2.00	;;
;;______________________________________________________;;
;; бЧФПТУЛПЕ РТБЧП:	 рЙНЕОПЧ рБЧЕМ бМЕЛУЕЕЧЙЮ	;;
;;________________ (C) 17.04.1994 PPA Soft Systems _____;;
;;	рЕТЕРЙУБО 17.04.1994 ОБ ПУОПЧЕ "УФБТПЗП" 16 - Й ;;
;; ВЙФОПЗП ДТБКЧЕТБ. пУОПЧОЩЕ  ПФМЙЮЙС  ЪБЛМАЮБАФУС  Ч	;;
;; ХДБМЕОЙЙ "ОЕ ОХЦОЩИ" РТПЧЕТПЛ ОБ ЛПТТЕЛФОПУФШ ЧИПД-  ;;
;; ОЩИ  ДБООЩИ  Ф.Л. НПДХМШ РТЕДОБЪОБЮЕО ДМС ОБРЙУБОЙС 	;;
;; РТПЗТБНН Ч ЛПФПТЩИ ОЕ ЙНЕФУС ( рплб !) ЧПЪНПЦОПУФШ	;;
;; ЧМЙСФШ ОБ  ЧИПДОЩЕ РБТБНЕФТЩ  РЕТЕДБЧБЕНЩЕ ДТБКЧЕТХ	;;
;; Й ЛБЛ УМЕДУФЧЙЕ ПФУХФУФЧЙЕ ОЕЛПТЕЛФОПУФЕК.		;;
;; лТПНЕ ФПЗП ЙЪНЕОЕО БМЗПТЙФН ПФЛТЩФЙС Й ЪБЛТЩФЙС ПЛПО ;;
;;	чУЕ ЬФЙ ДЕКУФЧЙС РТЙЧЕМЙ Л ХНЕОШЫЕОЙА ТБЪНЕТБ	;;
;; НПДХМС Б ФБЛЦЕ Л ОЕЛПФПТХНХ ХЧЕМЙЮЕОЙА УЛПТПУФЙ.	;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;


;;;;;;;;;;;;; жХОЛГЙЙ РПДДЕТЦЙЧБЕНЩЕ ДТБКЧЕТПН ;;;;;;;;;;;;
	Public W_Put_Char	;ЧЩЧПД УЙНЧПМБ ЛППТД. Ч 'DE'
	Public W_Get_Char	;ЮФЕОЙЕ УЙНЧПМБ -//-
	Public W_Open		;ПФЛТЩФЙЕ ПЛОБ (DE),(HL),Б-ЖМБЗ
	Public W_Close  	;ЪБЛТЩФЙЕ ПЛОБ
	Public W_Cls		;ПФЮЙУФЛБ ПЛОБ
	Public W_Up_Scroll	;УЛТПММЙОЗ ПЛОБ ЧЧЕТИ
	Public W_Down_Scroll	;ЧОЙЪ
	Public W_Right_Scroll	;ЧРТБЧП (ОБ 2 УЙНЧПМБ)
	Public W_Left_Scroll	;ЧМЕЧП  (ОБ 2 УЙНЧПМБ)
	Public	Put_XY_Char	;
	Public	Get_XY_Char	;
	Public	Cls_XY		;
	Public	Box_XY		;
	Public	Abs_DE		;
	Public	Inc_Copy	;
	Public	Dec_Copy	;
	Public	HL_DE_Window	;
	Public	HL_Sub_DE	;
	Public	Addr_Screen	;
;;;;;;;;;;;;;;; пРТЕДЕМЕОЙЕ ЗМПВБМШОЩИ СЮЕЕЛ ;;;;;;;;;;;;;
	Public	W_Cursor	;
	Public	W_1Window	;
	Public	W_2Window	;
	Public	W_Number	;
	Public	W_Buf_Seek	;

;;;;;;;;;;;;;;; вМПЛ ТБВПЮЙИ СЮЕЕЛ РТПЗТБННЩ ;;;;;;;;;;;;;;
W_Cursor:	DW	001Ah	;;
;;     сЮЕКЛБ ИБТБЛФЕТЕЪХЕФ РПМПЦЕОЙЕ МПЛБМШОПЗП ЛХТУПТБ Ч
;; ЛБЦДПН ПФЛТЩФПН ПЛОЕ Й РТЙ ПФЛТЩФЙЙ ОПЧЩИ ПЛПО ПОБ УПИ-
;; ТБОСЕФУС Ч ВХЖЕТЕ У РПУМЕДХАЭЙН ЧПУФБОПЧМЕОЙЕН РТЙ ЪБЛ-
;; ТЩФЙЙ ПЛОБ.

;W_1Window:	DW	0h	;; (DE) ЛППТДЙОБФЩ ПЛОБ ++++ EXT

W_2Window:	DW	3F1Fh	;; (HL) ---//----//---
;;	дБООЩЕ СЮЕКЛЙ ИТБОСФ БВУПМАФОЩЕ ЛППТДЙОБФЩ РПМПЦЕ-
;; ФЕЛХЭЕЗП ПЛОБ, ЛПФПТЩЕ ФБЛЦЕ ДЙОБНЙЮЕУЛЙ ЧПУФБОБЧМЙЧБА-
;; ФУС РТЙ ПРЕТБГЙСИ ПФЛТЩФЙС Й ЪБЛТБФЙС ОПЧЩИ ПЛПО

;W_Number:	DB	00h	;++++ EXT
;;	уПДЕТЦЙФ ЛПМЙЮЕУФЧП ПФЛТЩФЩИ ОБ ДБООЩК НПНЕОФ ПЛПО.

W_Buf_Seek:	DW	Buf_Begin	;
;;	дЙОБНЙЮЕУЛБС СЮЕКЛБ ПФТБЦБАЭБС ЧЕМЙЮЕОХ ЪБРПМОЕОЙС
;; ВХЖЕТБ ПЛПО.
;Box_Control_PTR:			;
;		DW	0000h		; ++++ EXT
;; сЮЕКЛБ ЧТЕНЕОПЗП ИТБОЕОЙС ХЛБЪБФЕМС ОБ ДБООЩЕ.
Box_Two_Dump:
	DB	098h,08Ah,099h
		09Dh,020h,09Dh
		08Ch,08Ah,08Bh
Box_One_Dump:
	DB	090h,083h,0AAh
		094h,020h,094h
		0A9h,083h,08Fh	

;;     вМПЛЙ ДБООЩИ ОЕПВИПДЙНЩЕ РТЙ ЧЩВПТЕ ТБЪМЙЮОЩИ ФЙРПЧ
;; ТБНПЛ ПВТБНМСАЭЙИ ПЛОП.
;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;	рТПГЕДХТБ ПФЛТЩФЙС ОПЧПЗП БЛФЙЧОПЗП ПЛОБ.	;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
W_Open:
	PUSH	B	; УПИТБОЙН ЧУЕ ТЕЗЙУФТЩ
	PUSH	D	; РТПГЕУУПТБ
	PUSH	H	;
	PUSH	PSW	;
	DCR	D	; уЛПТТЕЛФЙТХЕН ТБЪНЕТЩ ПЛОБ.
	DCR	E	;
	INR	H	;
	INR	L	;
	DCR	E	;
	INR	H	;
	CALL	W_Backup;
	INR	E	;
	DCR	H	;
	CALL	Box_XY	;
	POP	PSW	;
	CALL	W_Ten	;
	PUSH	PSW	;
W_O_Terminat:		;
	POP	PSW	;
	INR	E	;
	INR	D	;
	DCR	H	;
	DCR	L	;
	SHLD	W_2Window;
	XCHG		;
	SHLD	W_1Window;
	LXI	H,0	;
	SHLD	W_Cursor;
	POP	H	;
	POP	D	;
	POP	B	;
	RET		;
;;;;;;;;;; чУРПНПЗБФЕМШОБС РТПГЕДХТБ ЧЩЧПДБ ФЕОЙ ;;;;;;;;;
W_Ten:	PUSH	H	;
	PUSH	D	;
	ANI	00000011b;
	ADD	A	;
	ADI	7	;
	MOV	B,A	;
	INR	H	;
	DCR	L	;
	DCR	E	;
W_Ten1:	MOV	A,B	;
	INR	D	;
	CALL	Put_XY_Char;
	MOV	A,D	;
	CMP	H	;
	JNZ	W_Ten1	;
	INR	B	;
W_Ten3:	MOV	A,B	;
	INR	E	;
	CALL	Put_XY_Char;
	MOV	A,E	;
	CMP	L	;
	JNZ	W_Ten3	;
	POP	D	;
	POP	H	;
	RET		;
;;;;;;; рТПГЕДХТБ УПИТБОЕОЙС ЙОЖПТНБГЙЙ РПД ПЛОПН ;;;;;;;
W_Backup:	
	PUSH	PSW	;
	PUSH	D	;
	PUSH	H	;
	PUSH	H	; хЧЕМЙЮЙЧБЕН ЮЙУМП ПФЛТЩФЩИ ПЛПО.
	LXI	H,W_Number;
	INR	M	;
	POP	H	;
	CALL	HL_Sub_DE;
	LHLD	W_Buf_Seek
	PUSH	B	;
	PUSH	D	;
;; гЙЛМ  "жЙТНЕООПЗП"  ЛПРЙТПЧБОЙС  ЬЛТБООПК  ПВМБУФЙ Ч
;; ВХЖЕТ ПЛПО ОЙЦЕ ПРЙУБОБ ЕЗП УФТХЛФХТБ:
;;	(?)	 	- дБООЩe ОБИПДСЭЙЕУС РПД ПЛОПН.
;;	(Beg_PTR)	- уФБТЩК ХЛБЪБФЕМШ.
;;	(W_Cursor)	- лППТДЙОБФЩ ЛХТУПТБ Ч ПЛОЕ.
;;	(W_2Window)	- лППТДЙОБФЩ ЧЕТИОЕЗП ХЗМБ ПЛОБ.
;;	(W_1Window)	- лППТДЙОБФБ ОЙЦОЕЗП ХЗМБ ПЛОБ.
;;	(Dx_Dy)		- тБЪНЕТЩ ПЛОБ.
;;	(Load_PTR)	- хЛБЪБФЕМШ ОБЮБМБ ЧПУФБОПЧМЕОЙС.

W_Backup_Loop:		; уПИТБОЙН ПДОХ РБМПУЛХ У МЕЧПЗП
	CALL	W_Open_Help2; ЛТБС.
	PUSH	D	;
	MOV	A,D	;
	ADD	B	;
	DCR	A	; уПИТБОЙН РПМПУЛХ У РТБЧПЗП ЛТБС
	MOV	D,A	;
	CALL	W_Open_Help2;
	POP	D	;
	INR	D	;
	DCR	B	;
	DCR	B	;
	MOV	A,B	; рТПДПМЦБЕН РПЛБ ОЕ ЪБЛПОЮЙФУС
	CPI	02h	; ПЛПЫЛП.
	JNC	W_Backup_Loop;
	DCR	B	;
	CZ	W_Open_Help2
	POP	D	;
	POP	B	;
;; DE - лППТДЙОБФЩ МЕЧПЗП ОЙЦОЕЗП ХЗМБ ПЛОБ.
;; BC - тБЪНЕТЩ ПЛОБ.
	PUSH	D	;
	XCHG		;
	LHLD	W_Buf_Seek
	CALL	W_Open_Help1
	LHLD	W_Cursor
	CALL	W_Open_Help1
	LHLD	W_2Window
	CALL	W_Open_Help1
	LHLD	W_1Window
	CALL	W_Open_Help1
	MOV	H,B	;
	MOV	L,C	;
	CALL	W_Open_Help1
	POP	H	; оБЮБМШОЩЕ ЛППТДЙОБФЩ.
	CALL	W_Open_Help1
	XCHG		;
	SHLD	W_Buf_Seek
	POP	H	;
	POP	D	;
	POP	PSW	;
	RET		;
;;;;;;;; рТПГЕДХТЛБ ЗЕОЕТБГЙЙ ЙОЖПТНБГЙПООПЗП ВМПЛБ ;;;;;;;
W_Open_Help1:		;
	MOV	A,L	;
	STAX	D	;
	INX	D	;
	MOV	A,H	;
	STAX	D	;
	INX	D	;
	RET		;
;;;;;;;;;;;; рТПГЕДХТЛБ "УЛБОЙТПЧБОЙС" ЬЛТБОБ ;;;;;;;;;;;;
;; DE - лППТДЙОБФЩ ОБЮБМШОПЗП УЙНЧПМБ.
;; BC - ТБЪНЕТЩ УПИТБОСЕНПЗП ПЛОБ
W_Open_Help2:		;
	PUSH	B	;
	PUSH	D	;
W_O_Help2_1:		;
	CALL	Get_XY_Char
	MOV	M,A	;
	INX	H	;
	INR	E	;
	DCR	C	;
	JNZ	W_O_Help2_1
	POP	D	;
	POP	B	;
	RET		;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;		рТПГЕДХТБ ЪБЛТЩФЙС ПЛОБ			;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
W_Close:
	PUSH	B	;
	PUSH	D	;
	PUSH	H	;
	PUSH	PSW	;
	LXI	H,W_Number
	MOV	A,M	;
	ORA	A	;
	JZ	W_Main_Exit
	DCR	M	;
	LHLD	W_Buf_Seek;
	DCX	H	;
	MOV	D,M	; оБЮБМП ЧПУФБОПЧМЕОЙС.
	DCX	H	;
	MOV	E,M	;
	DCX	H	;
	MOV	B,M	; тБЪНЕТ ЧПУФБОПЧМЕОЙС.
	DCX	H	;
	MOV	C,M	;
;; DE - лХДБ ЧПУФБОБЧМЙЧБФШ?
;; BC - тБЪНЕТ ЧПУФБОБЧМЙЧБЕНПЗП ВМПЛБ.
	DCX	H	;
	PUSH	D	;
	XCHG		;
	CALL	W_Close_Help1	;
	SHLD	W_1Window	;
	CALL	W_Close_Help1	;
	SHLD	W_2Window	;
	CALL	W_Close_Help1	;
	SHLD	W_Cursor	;
	CALL	W_Close_Help1	;
	SHLD	W_Buf_Seek	;
	POP	D	;
W_Close_Loop1:		;
	CALL	W_Close_Help2
	PUSH	D	;
	MOV	A,D	;
	ADD	B	;
	DCR	A	;
	MOV	D,A	;
	CALL	W_Close_Help2
	POP	D	;
	INR	D	;
	DCR	B	;
	DCR	B	;
	MOV	A,B	;
	CPI	02h	;
	JNC	W_Close_Loop1
	DCR	B	;
	CZ	W_Close_Help2
	JMP	W_Main_Exit

;;;;;;;;;;; рТПГЕДХТЛБ ЧПУФБОПЧМЕОЙС "УФПМВЙЛБ";;;;;;;;;;;
;; HL - хЛБЪБФЕМШ ОБ ВХЖЕТ УФПМВЙЛБ.
;; DE - хЛБЪБФЕМШ ЛППТДЙОБФ ЬЛТБОБ.
W_Close_Help2:		;
	PUSH	B	;
	PUSH	D	;
W_C_Help1:		;
	MOV	A,M	;
	CALL	Put_XY_Char
	INX	H	;
	INR	E	;
	DCR	C	;
	JNZ	W_C_Help1;
	POP	D	;
	POP	B	;
	RET		;
;;;;;; рТПГЕДХТЛБ ЧЩВПТЛЙ ДБООЩИ ЙЪ ВМПЛБ РБТБНЕФТПЧ ;;;;;
W_Close_Help1:
	LDAX	D	;
	MOV	H,A	;
	DCX	D	;
	LDAX	D	;
	MOV	L,A	;
	DCX	D	;
	RET		;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;	рТПГЕДХТБ ЧЩЧПДБ ТБНЛЙ ЪБДБОПК ЛПОЖЙЗХТБГЙЙ	;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
Box_XY:
	PUSH	B		;
	PUSH	D		;
	PUSH	H		;
	PUSH	PSW		;
	CALL	HL_Sub_DE	;
	DCR	C		;
	DCR	C		;
	DCR	B		;
	POP	PSW		;
	PUSH	PSW		;
	ANI	04h		;
	PUSH	H		;
	LXI	H,Box_Two_Dump	;
	JZ	W_O_Two		;
	LXI	H,Box_One_Dump	;
W_O_Two:			;
	SHLD	Box_Control_PTR	;
	POP	H		;
;; HL - хЛБЪБФЕМШ ОБ ОХЦОХА УЙУФЕНХ ТБНПЛ
;;	(ПДЙОБТОБС МЙВП ДЧПКОБС)
	POP	PSW		;
	PUSH	PSW		;
	ANI	20h		; C == 0
	JNZ	Box_Fast	;
	MOV	A,B		;
	RAR			;
	PUSH	PSW		;
	MOV	B,A		;
	MOV	A,D		;
	ADD	B		;
	MOV	D,A		;
	INR	D		;
	POP	PSW		;
	MVI	A,1		;
	DCR	D		;
	MOV	H,D		; HL - лППТДЙОБФЩ РТБЧПК
	MOV	L,E		; УФЕОЛЙ ПЛОБ. DE - мЕЧПК.
	JNC	Box_Loop_00	;
	INR	H		;
Box_Loop_00:
	MVI	A,1		;
	CALL	Box_Stolb	;
	DCR	D		;
	XRA	A		;
	CALL	Box_Stolb	;
	XCHG			;
	MVI	A,1		;
	CALL	Box_Stolb	;
	INR	D		;
	MVI	A,2		;
	CALL	Box_Stolb	;
	XCHG			;
	DCR	B		;
	JNZ	Box_Loop_00	;
	JMP	W_Main_Exit	;
;; чЕФЧШ ПТЗБОЙЪБГЙЙ ВЩУФТПК РТПТЙУПЧЛЙ ТБНЛЙ
Box_Fast:
	CALL	Cls_XY		;
	XRA	A		;
	CALL	Box_Stolb	;
	XCHG			;
	PUSH	D		;
	MOV	E,L		;
	MVI	A,2		;
	CALL	Box_Stolb	;
	DCR	D		;
	MVI	A,1		;
	CALL	Box_Stolb	;
	CALL	Get_XY_Char	;
	POP	H		;
	DCR	D		;
	MOV	H,D		;
	DCR	B		;
	DCR	B		;
Box_Fast_Loop:			;
	CALL	Put_XY_Char	;
	XCHG			;
	CALL	Put_XY_Char	;
	XCHG			;
	DCR	D		;
	DCR	H		;
	DCR	B		;
	JNZ	Box_Fast_Loop	;
	JMP	W_Main_Exit	;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;   рТПГЕДХТБ ЧЩЧПДБ "УФПМВЙЛБ" ТБЪМЙЮОПК ЛПОЖЙЗХТБГЙЙ	;;
;; DE - лППТДЙОБФЩ ЧЩЧПДБ.				;;
;; C  - тБЪНЕТ УФПМВЙЛБ.				;;
;; A  - "оПНЕТ" УФПМВЙЛБ				;;
;;	0 - мЕЧБС УЛПВЛБ.				;;
;;	1 - рЕТЕЗПТПДЛБ.				;;
;;	2 - рТБЧБС УЛПВЛБ.				;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;; 
Box_Stolb:
	PUSH	D		;
	PUSH	H		;
	PUSH	B		;
	LHLD	Box_Control_PTR	;
	MOV	B,A		;
	ADD	A		;
	ADD	B		;
	PUSH	D		;
	MOV	E,A		;
	MVI	D,0		;
	DAD	D		;
	POP	D		;
;; HL - рПМХЮЙМЙ ЖЙЪЙУЕУЛЙК БДТЕУ ГЕРПЮЛЙ.
	MOV	A,M		;
	CALL	Put_XY_Char	;
	INR	E		;
	INX	H		;
	MOV	A,M		;
Box_S_Loop:			;
	CALL	Put_XY_Char	;
	INR	E		;
	DCR	C		;
	JNZ	Box_S_Loop	;
	INX	H		;
	MOV	A,M		;
	CALL	Put_XY_Char	;
	POP	B		;
	POP	H		;
	POP	D		;
	RET			;

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;     рТПГЕДХТЛБ ПВТБВПФЛЙ НБФЕНБФЙЛЙ ДМС УЛТПММЕТБ	;;
Scroll_Match:
	MOV	A,H	;
	SUB	D	;
	ORA	A	;
	RAR		;
	MOV	C,A	;зПТЙЪПОФБМШОЩК тБЪНЕТ ПЛОБ Ч ВБКФБИ
	INR	C	;
	MOV	A,L	;
	SUB	E	;
	MOV	B,A	; чЕТФЙЛБМШОЩК ТБЪНЕТ.
	RET		;

Copy_Main:
	REPT	8	;
	LDAX	D	;
	MOV	M,A	;
	INR	L	;
	INR	E	;
	ENDM		;
	RET		;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;  рТПГЕДХТБ DEC-ЛПРЙТПЧБОЙС 2-И ЬЛТБООЩИ РМПУЛПУФЕК	;;
Scroll_DEC_Copy:	;
	PUSH	B	;
	PUSH	D	;
	PUSH	H	;
S_DEC_Loop1:		;
	CALL	Dec_Copy;	
	DCR	H	;
	DCR	D	;
	DCR	C	;
	JNZ	S_DEC_Loop1
	POP	H	;
	POP	D	;
	POP	B	;
	MOV	A,H	;
	ADI	20h	;
	MOV	H,A	;
	MOV	A,D	;
	ADI	20h	;
	MOV	D,A	;
S_DEC_Loop2:		;
	CALL	Dec_Copy;	
	DCR	H	;
	DCR	D	;
	DCR	C	;
	JNZ	S_DEC_Loop2
	RET		;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;    рТПГЕДХТБ INC - ЛПРЙТПЧБОЙС ЬЛТБООЩИ РМПУЛПУФЕК	;;
Scroll_INC_Copy:	;
	PUSH	B	;
	PUSH	D	;
	PUSH	H	;
S_INC_Loop1:		;
	CALL	Inc_Copy;	
	INR	H	;
	INR	D	;
	DCR	C	;
	JNZ	S_INC_Loop1
	POP	H	;
	POP	D	;
	POP	B	;
	MOV	A,H	;
	ADI	20h	;
	MOV	H,A	;
	MOV	A,D	;
	ADI	20h	;
	MOV	D,A	;
S_INC_Loop2:		;
	CALL	Inc_Copy;	
	INR	H	;
	INR	D	;
	DCR	C	;
	JNZ	S_INC_Loop2
	RET		;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;	рТПГЕДХТБ ПФЮЙУФЛЙ ЪБДБОПК ПВМБУФЙ ЬЛТБОБ	;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
Cls_XY:			;
	PUSH	B	;
	PUSH	D	;
	PUSH	H	;
	PUSH	PSW	;
	JMP	W_Cls_DH;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;	   рТПГЕДХТБ ПФЮЙУФЛЙ БЛФЙЧОПЗП "ПЛОБ"		;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
W_Cls:			;
	PUSH	B	;
	PUSH	D	;
	PUSH	H	;
	PUSH	PSW	;
	CALL	HL_DE_Window	
W_Cls_DH:		;
	CALL	HL_Sub_DE	
	PUSH	B	;
	PUSH	D	;
	PUSH	H	;
	CALL	Addr_PPA_Emulator
W_Cls_7:		;
	PUSH	H	;
	PUSH	B	;
W_Cls_6:		;
	MVI	M,' '	;
	INX	H	;
	DCR	B	;
	JNZ	W_Cls_6	;
	POP	B	;
	POP	H	;
	LXI	D,40h	;
	DAD	D	;
	DCR	C	;
	JNZ	W_Cls_7	;
	POP	H	;
	POP	D	;
	POP	B	;
	MOV	A,C	;
	RLC		;
	RLC		;
	RLC		;
;;;;	DCR	A	;
	MOV	B,A	;
	MOV	A,D	;
	RRC		;
	JNC	W_Cls_1	;
	CALL	W_Cls_Stok
	INR	D	;
W_Cls_1:		;
	MOV	A,H	;
	RRC		;
	JC	W_Cls_2	;
	XCHG		;
	PUSH	D	;
	MOV	E,L	;
	CALL	W_Cls_Stok	
	POP	D	;
	XCHG		;
	DCR	H	;
W_Cls_2:		;
	MOV	A,H	;
	SUB	D	; рТЙ ЛПТТЕЛФОЩИ ДБООЩИ Carry = 0
	RAR		;
	INR	A	;
	MOV	C,A	;
	CALL	Addr_Screen	
	XRA	A	;
	PUSH	B	;
	MOV	D,B	;
	MOV	E,L	;
W_Cls_3:		;
	MOV	M,A	;
	INR	L	;
	DCR	B	;
	JNZ	W_Cls_3	;
	MOV	B,D	;
	MOV	L,E	;
	INR	H	;
	DCR	C	;
	JNZ	W_Cls_3	;
	DCR	H	;
	POP	B	;
	MOV	A,H	;
	ADI	20h	;
	MOV	H,A	;
	XRA	A	;
W_Cls_5:		;
	MOV	M,A	;
	INR	L	;
	DCR	B	;
	JNZ	W_Cls_5	;
	MOV	B,D	;
	MOV	L,E	;
	DCR	H	;
	DCR	C	;
	JNZ	W_Cls_5	;
	JMP	W_Main_Exit
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;	рТПГЕДХТБ ЮЙУФСЭБС "УФПМВЙЛ" ЬЛТБООПК ПВМБУФЙ	;;
W_Cls_Stok:		;
	PUSH	D	;
	PUSH	B	;
	MVI	A,' '	;
W_Cls_Loop1:		;
	CALL	Put_XY_Char	
	INR	E	;
	DCR	C	;
	JNZ	W_Cls_Loop1
	POP	B	;
	POP	D	;
	RET		;
;;;;;  вМПЛ РТПГЕДХТ РПДДЕТЦЛЙ РТПЗТБНОПЗП УЛТПММЕТБ ;;;;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;	рТПГЕДХТБ УЛТПМЙОЗБ ЧРТБЧП (ОБ 2 ЪОБЛБ)		;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
W_Right_Scroll:		;
	PUSH	B	;
	PUSH	D	;
	PUSH	H	;
	PUSH	PSW	;
	CALL	HL_DE_Window	
	CALL	HL_Sub_DE	
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;     вМПЛ  УЛТПМЙОЗБ ЧРТБЧП Ч ПВМБУФЙ ЬНХМСГЙЙ	;;
	PUSH	B	;
	PUSH	D	;
	PUSH	H	;
	XCHG		;
	DCR	B	;
	DCR	B	;
	CALL	Addr_PPA_Emulator	
W_Right_PPA_Loop:	;
	MOV	D,H	;
	MOV	E,L	;
	DCX	D	;
	DCX	D	;
	XCHG		;
	CALL	Dec_Copy;	
	XCHG		;
	LXI	D,-40h	;
	DAD	D	;
	DCR	C	;
	JNZ	W_Right_PPA_Loop
	POP	H	;
	POP	D	;
	POP	B	;
	MOV	A,C	;
	MOV	C,B	;
	RLC		;
	RLC		;
	RLC		;
	MOV	B,A	;
	MOV	A,C	;
	RAR		;
	MOV	C,A	;
	DCR	C	;
	XCHG		;
	INR	E	;
	CALL	Addr_Screen	
	DCX	H	;
	MOV	D,H	;
	MOV	E,L	;
	DCR	H	;
	CALL	Scroll_DEC_Copy	
	CALL	HL_DE_Window
	MOV	H,D	;
	INR	H	;
	CALL	Cls_XY	;
	JMP	W_Main_Exit
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;	рТПГЕДХТБ УЛТПМЙОЗБ ЧМЕЧП ( ОБ 2 УЙНЧПМБ )	;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
W_Left_Scroll:		;
	PUSH	B	;
	PUSH	D	;
	PUSH	H	;
	PUSH	PSW	;
	CALL	HL_DE_Window	
	CALL	HL_Sub_DE
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;    вМПЛ  "УЛТПМЙОЗБ ЧМЕЧП" Ч ПВМБУФЙ ЬНХМСГЙЙ	;;
	PUSH	B	;
	PUSH	D	;
	PUSH	H	;
	DCR	B	;
	DCR	B	;
	CALL	Addr_PPA_Emulator	
W_Left_PPA_Loop:	;
	MOV	D,H	;
	MOV	E,L	;
	INX	H	;
	INX	H	;
	CALL	Inc_Copy;	
	LXI	H,40h	;
	DAD	D	;
	DCR	C	;
	JNZ	W_Left_PPA_Loop	
W_LR_PPA_Exit:		;
	POP	H	;
	POP	D	;
	POP	B	;
	MOV	A,C	;
	MOV	C,B	;
	RLC		;
	RLC		;
	RLC		;
	MOV	B,A	;
	ORA	A	;
	MOV	A,C	;
	RAR		;
	DCR	A	;
	MOV	C,A	;
	CALL	Addr_Screen	
	MOV	D,H	;
	MOV	E,L	;
	INR	H	;
	CALL	Scroll_INC_Copy	
	CALL	HL_DE_Window
	MOV	D,H	;
	DCR	D	;
	CALL	Cls_XY	;
	JMP	W_Main_Exit
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;	     рТПГЕДХТБ УЛТПМЙОЗБ ПЛОБ ЧОЙЪ		;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
Down_Scroll:
	PUSH	B	;
	PUSH	D	;
	PUSH	H	;
	PUSH	PSW	;
	JMP	Down_Local
W_Down_Scroll:		;
	PUSH	B	;
	PUSH	D	;
	PUSH	H	;
	PUSH	PSW	;
	CALL	HL_DE_Window	
Down_Local:		;
	PUSH	H	;
	PUSH	D	;
	CALL	HL_Sub_DE	
	DCR	C	;
	JZ	Down_Quit
	INR	C	;
	CALL	Addr_PPA_Emulator
W_Down_Loop:		;
	LXI	D,40h	;
	XCHG		;
	DAD	D	;
	CALL	Inc_Copy;	
	DCR	C	;
	JNZ	W_Down_Loop
	POP	D	;
	POP	H	;
	PUSH	H	;
	PUSH	D	;
	CALL	Scroll_Match	

	CALL	Addr_Screen
W_D_S_Ext_Loop:		;
	MOV	D,H	;
	MOV	A,L	;
	ADI	8h	;
	MOV	E,A	;
	PUSH	D	;
	PUSH	B	;
	MOV	B,C	;
W_D_S_Main_Loop:	;
	PUSH	H	;
	PUSH	D	;
	CALL	Copy_Main
	POP	D	;
	POP	H	;
	INR	H	;
	INR	D	;
	DCR	C	;
	JNZ	W_D_S_Main_Loop
	MOV	C,B	;
	DCR	H	;
	DCR	D	;
	MOV	A,D	;
	ADI	20h	;
	MOV	D,A	;
	MOV	A,H	;
	ADI	20h	;
	MOV	H,A	;
W_D_S_2Main_Loop:	;
	PUSH	H	;
	PUSH	D	;	
	CALL	Copy_Main
	POP	D	;
	POP	H	;
	DCR	D	;
	DCR	H	;
	DCR	C	;
	JNZ	W_D_S_2Main_Loop
	POP	B	;
	POP	H	;
	DCR	B	;
	JNZ	W_D_S_Ext_Loop
Down_Quit:		;
	POP	D	;
	POP	H	;
	MOV	E,L	;
	CALL	Cls_XY	;
	JMP	W_Main_Exit
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;	рТПГЕДХТБ УЛТПМЙОЗБ БЛФЙЧОПЗП ПЛОБ ЧЧЕТИ	;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
Up_Scroll:
	PUSH	B	;
	PUSH	D	;
	PUSH	H	;
	PUSH	PSW	;
	JMP	Up_Local
W_Up_Scroll:		;
        PUSH	B	;
	PUSH	D	;
	PUSH	H	;
	PUSH	PSW	;
	CALL	HL_DE_Window	
Up_Local:		;
	PUSH	H	;
	PUSH	D	;
	CALL	HL_Sub_DE	
	DCR	C	; ЙЪМЙЫОЙК ВМПЛ РТПЧЕТПЛ
	JZ	Up_Quit	;
	INR	C	;
	XCHG		;
	CALL	Addr_PPA_Emulator
W_Up_Loop:		;
	LXI	D,-40h	;
	XCHG		;
	DAD	D	;
	CALL	Dec_Copy;	
	DCR	C	;
	JNZ	W_Up_Loop
	POP	D	;
	POP	H	;
	PUSH	H	;
	PUSH	D	;
	CALL	Scroll_Match	
	XCHG		;
	CALL	Addr_Screen
W_U_S_Ext_Loop:		;
	MOV	D,H	;
	MOV	A,L	;
	SUI	8h	;
	MOV	E,A	;
	PUSH	D	;
	PUSH	B	;
	MOV	B,C	;
W_U_S_Main_Loop:	;
	PUSH	H	;
	PUSH	D	;
	CALL	Copy_Main
	POP	D	;
	POP	H	;
	DCR	H	;
	DCR	D	;
	DCR	C	;
	JNZ	W_U_S_Main_Loop
	MOV	C,B	;
	INR	H	;
	INR	D	;
	MOV	A,D	;
	ADI	20h	;
	MOV	D,A	;
	MOV	A,H	;
	ADI	20h	;
	MOV	H,A	;
W_U_S_2Main_Loop:	;
	PUSH	H	;
	PUSH	D	;	
	CALL	Copy_Main
	POP	D	;
	POP	H	;
	INR	D	;
	INR	H	;
	DCR	C	;
	JNZ	W_U_S_2Main_Loop
	POP	B	;
	POP	H	;
	DCR	B	;
	JNZ	W_U_S_Ext_Loop

Up_Quit:		;
	POP	D	;
	POP	H	;
	MOV	L,E	;
	CALL	Cls_XY	;
	JMP	W_Main_Exit
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;	рТПГЕДХТБ ЮФЕОЙС УЙНЧПМБ ЙЪ ЪБДБОПК РПЪЙГЙЙ	;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
W_Get_Char:		;
	PUSH	H	;
	CALL	Abs_DE	;
	JMP	Get_Local
;;;;;;;;; фПЮЛБ ЧИПДБ РП БВУПМАФОПК ЛППТДЙОБФЕ. ;;;;;;;;;;
Get_XY_Char:		;
	PUSH	H	;
Get_Local:		;
	CALL	Addr_PPA_Emulator
	MOV	A,M	;
	POP	H	;
	RET		;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;	рТПГЕДХТБ ЧЩЧПДБ УЙНЧПМБ Ч ФЕЛХЭЕЕ ПЛОП.	;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
W_Put_Char:		;
	PUSH	D	;
	CALL	Abs_DE	;
	CALL	Put_XY_Char	
	POP	D	;
	RET		;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;  рТПГЕДХТБ ЧЩЧПДБ УЙНЧПМБ РП БВУПМАФОЩН ЛППТДЙОБФБН	;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
Put_XY_Char:		;
	PUSH	B	;
	PUSH	D	;
	PUSH	H	;
	PUSH	PSW	;
	CALL	Addr_PPA_Emulator
	MOV	M,A	;
	MOV	B,A	;
	CALL	Addr_Screen	
	XCHG		;
	MOV	A,H	;
	RRC		;
	MOV	A,B	;
	MVI	B,8	;
	PUSH	PSW	;
	PUSH	D	;ПРТЕДЕМЕОЙС ОБЮБМБ ЪОБЛПЗЕОЕТБФПТБ
	MVI	H,0	;
	MOV	L,A	;
	DAD	H	;
	DAD	H	;
	DAD	H	;
	LXI	D,W_Zg	;
	DAD	D	;
	POP	D	;
	POP	PSW	;
	XCHG		;
	JC	Put_Done;
	MVI	C,0Fh	;	
Put_Loop_AXXX:		;
	MOV	A,M	;
	ANA	C	;
	MOV	M,A	;
	LDAX	D	;
	ANI	0F0h	;
	ORA	M	;
	MOV	M,A	;
	INR	L	;
	INX	D	;
	DCR	B	;
	JNZ	Put_Loop_AXXX
	MVI	B,8	;
	MOV	A,H	;
	ADI	20h	;
	MOV	H,A	;
Put_Loop_CXXX:		;
	DCX	D	;
	DCR	L	;
	MOV	A,M	;
	ANA	C	;
	MOV	M,A	;
	LDAX	D	;
	ANA	C	;
	RLC		;
	RLC		;
	RLC		;
	RLC		;
	ORA	M	;
	MOV	M,A	;
	DCR	B	;
	JNZ	Put_Loop_CXXX
	JMP	W_Main_Exit
Put_Done:		;
	MVI	C,0F0h	;
Put_Loop2_AXXX:		;
	MOV	A,M	;
	ANA	C	;
	MOV	M,A	;
	LDAX	D	;
	ANA	C	;
	RRC		;
	RRC		;
	RRC		;
	RRC		;
	ORA	M	;
	MOV	M,A	;
	INR	L	;
	INX	D	;
	DCR	B	;
	JNZ	Put_Loop2_AXXX
	MVI	B,8	;
	MOV	A,H	;
	ADI	20h	;
	MOV	H,A	;
Put_Loop2_CXXX:		;
	DCX	D	;
	DCR	L	;
	MOV	A,M	;
	ANA	C	;
	MOV	M,A	;
	LDAX	D	;
	ANI	0Fh	;
	ORA	M	;
	MOV	M,A	;
	DCR	B	;
	JNZ	Put_Loop2_CXXX
W_Main_Exit:		;
	POP	PSW	;
	POP	H	;
	POP	D	;
	POP	B	;
	RET		;
		
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;	вМПЛ УРЕГЙБМЙЪЙТПЧБОЩИ РТПГЕДХТ - "РЮЕМПЛ"	;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;_______________________ Abs_DE _________________________
;;	рТПГЕДХТБ РЕТЕИПДБ ОБ БВУПМАФОЩЕ ЛППТДЙОБФЩ
Abs_DE:			;
	PUSH	PSW	;
	PUSH	H	;
	LHLD	W_1Window	
	MOV	A,D	;
	ADD	H	;
	MOV	D,A	;
	MOV	A,E	;
	ADD	L	;
	MOV	E,A	;
	POP	H	;
	POP	PSW	;
	RET		;
;;_____________________ HL_Sub_DE ________________________
;; чЩЮЙУМСЕФ ТПЪОПУФШ НЕЦДХ ТЕЗЙУФТБНЙ HL Й DE ТЕЪХМШФБФ
;; РПНЕЭБЕФУС Ч ТЕЗЙУФТПЧХА РБТХ BC.
HL_Sub_DE:		;
	MOV	A,H	;
	SUB	D	;
	INR	A	;
	MOV	B,A	;
	MOV	A,L	;
	SUB	E	;
	INR	A	;
	MOV	C,A	;
	RET		;
;;_____________________ HL_DE_Window _____________________
;; рТПЙЪЧПДЙФ ЙОЙГЙБМЙЪБГЙА ТЕЗЙУФТПЧ ЛППТДЙОБФБНЙ
;; БЛФЙЧОПЗП Ч ДБООЩК НПНЕОФ ПЛОБ.
HL_DE_Window:		;
	LHLD	W_1Window	
	XCHG		;
	LHLD	W_2Window	
	RET		;
;;_______________________ Inc_Copy _______________________
;; рТПГЕДХТБ ЛПРЙТПЧБОЙС У ЙОЛТЕНЕОФПН
Inc_Copy:		;
	PUSH	B	;
	PUSH	D	;
	PUSH	H	;
I_Copy_loop:		;
	MOV	A,M	;
	STAX	D	;
	INX	D	;
	INX	H	;
	DCR	B	;
	JNZ	I_Copy_Loop
	POP	H	;
	POP	D	;
	POP	B	;
	RET		;
;;______________________ Dec_Copy ________________________
;; рТПГЕДХТБ ДЕЛТЕНЕОФТПЗП ЛПРЙТПЧБОЙС
Dec_Copy:		;
	PUSH	B	;
	PUSH	D	;
	PUSH	H	;
D_Copy_Loop:		;
	MOV	A,M	;
	STAX	D	;
	DCX	H	;
	DCX	D	;
	DCR	B	;
	JNZ	D_Copy_Loop	
	POP	H	;
	POP	D	;
	POP	B	;
	RET		;
;;___________________ Addr_PPA_Emulator __________________
;; рТПГЕДХТБ ПРТЕДЕМЕОЙС БДТЕУБ ЬНХМСГЙЙ УЙНЧПМБ.
Addr_PPA_Emulator:	;
	PUSH	B	;
;;	LXI	B,W_Emul_Txt;ХЛБЪБФЕМШ ОБ ПВМБУФШ ЬНХМСГЙЙ
	MVI	H,0	;
	MOV	L,E	;
	DAD	H	;
	DAD	H	;
	DAD	H	;
	DAD	H	;
	DAD	H	;
	DAD	H	;
;	DAD	B	;
	MVI	B,0E8h	; - ПВМБУФШ ЬНХМСГЙЙ ОБЮЙОБЕФУС - 0E800h
	MOV	C,D	;
	DAD	B	;
	POP	B	;
	RET		;
;;____________________ Addr_Screen ______________________
;; рТПГЕДХТБ ПРТЕДЕМЕОЙС БДТЕУБ РЕТЧПК УФТБОЙГЙ ЬЛТБОБ.
Addr_Screen:		;
	PUSH	PSW	;
	MOV	A,E	;
	RLC		;
	RLC		;
	RLC		;
	MOV	L,A	;
	MOV	A,D	;
	RAR		;
	ORI	0A0h	;
	MOV	H,A	;
	POP	PSW	;
	RET		;
		Title	KD.ASM
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;	нПДХМШ РТЕДОБЪОЕЮЕО  ДМС УВПТЛЙ У ДТХЗЙНЙ  РТП-	;;
;; ГЕУУБНЙ  ЛПФПТЩН  ФТЕВХЕФУС  ТБВПФБФШ  У ЛМБЧЙБФХТПК	;;
;; ЛТПНЕ  ЬФПЗП  ДТБКЧЕТ РТПЙЪЧПДЙФ ОБЮБМШОХА ХУФБОПЧЛХ	;;
;; ТЕЦЙНБ  ЬЛТБОБ  ( 512 * 256 - 2 ГЧЕФБ ПДОПЧТЕНЕООП )	;;
;; БДТЕУБ ЬЛТБООПК ПВМБУФЙ: 0A000h - 0DFFFh.		;;
;;	23.02.1994 дПТБВПФЛБ ДТБКЧЕТБ.- йЪНЕОЕО ТБЪНЕТ	;;
;; ВХЖЕТБ ЛМБЧЙБФХТЩ.					;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;; (C) PPA Soft Systems ;;;;;;;

	Public	Beep_Key; ЗЕОЕТБГЙС УЙЗОБМБ ФЙРБ "ЭЕМЮЕЛ"
	Public	Input_Key	; РТПЮЙФБФШ ЛПД ЛМБЧЙЫЙ ЙЪ ВХЖЕТБ
	Public	Key_Interrupt	; ПВТБВПФЮЙЛ РТЕТЩЧБОЙС.
	Public	Key_Reset	; УВТПУ ЛМБЧЙБФХТЩ.
	Public	Key_Wait	; пЦЙДБОЙС ОБЦБФЙС.
	Public	Flag_Color	; ЖМБЗ БЛФЙЧОПУФЙ ГЧЕФПЗЕОЕТБФПТБ
	Public	Color		; ЛПД ФЕЛХЭЕЗП ГЧЕФБ.
	Public	Stat_RUS_LAT	; УФБФХУ ЛМБЧЙБФХТЩ РП БМЖБЧЙФХ
	Public	Stat_Small	; ---//----//----//--- ТЕЗЙУФТХ
	Public	Key_Seek	; ХЛБЪБФЕМШ ЪБРПМОЕОЙС
	Public	Key_Kode	; ДЙОБНЙЮЕУЛЙК ЛПД ЛМБЧЙБФХТЩ
	Public	Key_Number	; ЖЙЪЙЮЕУЛЙК ОПНЕТ ЛМБЧЙЫЙ
;;;;;;;;;;;; тБВПЮЙЕ СЮЕКЛЙ ДТБКЧЕТБ ЛМБЧЙБФХТЩ ;;;;;;;;;;;
;; тБВПЮЙЕ СЮЕКЛЙ РЕТЕОПУЙФШ ДТХЗ ПФОПУЙФЕМШОП ДТХЗБ ОЕМШЪС
Flag_Color:	DB	0	;
RAB0:		DB	0	;
Color:		DW	0FF00h	;
Stat_RUS_LAT:	DB	0	;
Stat_Small:	DB	0	;
Key_Kode:	DB	0	;
KOOL:		DB	0	;
DREB:		DB	0	;
Key_Seek:	DB	1	;
		DB	0,0,0	; вХЖЕТ ЛМБЧЙБФХТЩ.
;;
;;  "F5" - фТЙЗЕТОБС  ЛМБЧЙЫБ РЕТЕЛМАЮБЕФ  РТЙП-
;;         ТЕФЕФОПЕ УПУФПСОЙЕ ДБФЮЙЛБ  РТПРЙУОЩЕ
;;         - УФТПЮОЩЕ  ВХЛЧЩ  ФЕЛХЭЕЗП  БМЖБЧЙФБ
;;
;;  "уу" - лМБЧЙЫБ РТПЙЪЧПДЙФ ЧТЕНЕООПЕ РЕТЕЛМА-
;;         ЮЕОЙЕ НБМЕОШЛЙИ-ВПМШЫЙИ ВХЛЧ
;;
;;;;;;;;;;;; рТПГЕДХТБ ПВТБВПФЛЙ РТЕТЩЧБОЙС ;;;;;;;;;;;;;;
Key_Interrupt:
	PUSH	B	; рТПЙЪЧПЦХ РПМОПЕ УПИТБОЕОЙЕ
	PUSH	D	; УПУФПСОЙС РТПГЕУУПТБ Ч НПНЕОФ
	PUSH	H	; ЧПЪОЙЛОПЧЕОЙС РТЕТЩЧБОЙС
	PUSH	PSW	;
	LXI	H,Flag_Color; юЙФБЕН ЖМБЗ РПДНЕОЩ РБМЙФТЩ
	MOV	A,M	;
	ORA	A	;
	JNZ	Key_DO0	; ЕУМЙ =0 ФП РЕТЕРТПЗТБНЙТПЧБФШ ФБВМЙГХ
	DCR	M	;
	LHLD	Color	; юЙФБА ДЧБ ВБКФБ ЖЙЪЙЮЕУЛЙИ ГЧЕФПЧ
	LXI	D,100Fh	; ЖПОБ Й РЕТЕДОЕЗП РМБОБ
Key_00:
	MOV	A,E	; H - ГЧЕФ ретдоезп рмбоб
	OUT	02	; L - ГЧЕФ жпоб
	ANI	06	; Й РЕТЕИПДЙН Л ТБУРТЕДЕМЕОЙА
	MOV	A,L	; ЕФЙИ ВБКФПЧ Ч УППФЧЕФУФЧЙЙ
	JZ	Key_01	; У НБФЕНБФЕНБФЙЮЕУЛЙНЙ ГЧЕФБНЙ
	MOV	A,H	;
Key_01:
	OUT	0Fh	; РТПЙЪЧПДЙН НОПЗПЛТБФОХА ЪБРЙУШ
	DCR	E	; РПМХЮЕОПЗП ЛПДБ Ч УЧСЪЙ У НБМПК
	OUT	0Ch	; УЛПТПУФША ТБВПФЩ пъх -л155тх2-
	OUT	0Fh	;
	OUT	0Ch	;
	DCR	D	;
	OUT	0Fh	;
	JNZ	Key_00	;
Key_DO0:
	MVI	A,8Ah	; оБУФТБЙЧБЕН УЙУФЕНОЩК РПТФ ОБ
	OUT	00	; УЛБОЙТПЧБОЙЕ ЛМБЧЙБФХТЩ
	LXI	H,RAB0	;
	IN	01	; РТПЮЙФБФШ УПУФПСОЙЕ РПТФБ "C"
	ANI	80h	; бОБМЙЪЙТХЕН ВЙФ ЛМБЧЙЫЙ "тху/мбф"
	JNZ	M5	; РЕТЕИПД ЕУМЙ ПОБ ОЕ ОБЦБФБ !!!
	MOV	A,M	; РТПЧЕТСЕН УПДЕТЦЙНПЕ ЧУРПНПЗБФЕ-
	ORA	A	; МШОПК СЮЕКЛЙ ЕУМЙ ПОБ ТБЧОБ ОХМА
	JZ	DONE01	; ФП ЛМБЧЙЫБ тху/мбф еЭЕ ОБЦБФБ
	DCR	M	; Й РПЧФПТОХА РЕТЕХУФБОПЧЛХ РТПЙ-
	LDA	Stat_RUS_LAT	; ЪЧПДЙФШ ОЕ ОБДП
	XRI	08H	; РТПЙЪЧПДЙН ЙОЧЕТУЙА Ч ВЙФЕ УЧЕФП-
	STA	Stat_RUS_LAT	; ДЙПДБ
	JMP	DONE01	;
M5:
	MVI	M,1	; ЖЙЛУЙТХЕН ОЕ ОБЦБФПЕ УПУФПСОЙЕ
DONE01:
	XRA	A	; ЧЩДБЕН ОБ НБФТЙГЕ ЪБРТПУ П ОБЦ-
	OUT	03	; БФЩИ ЛМБЧЙЫБИ
	IN	02	; 
	INR	A	; РТПЙЪЧПДЙН РТПЧЕТЛХ ОБ ОБЦБФЙЕ
	JZ	EXIT1	; ХИПДЙН ЕУМЙ ОЕ ОБЦБФБ ОЙ ПДОБ
	LXI	B,0FE08h; ЛМБЧЙЫБ
	LXI	D,0800H	; РЕТЕИПДЙН Л РПДУЮЕФХ НЕУФБ ОБЦБФЙС
	MOV	A,B	; РП УТЕДУФЧПН ЗПОЕТБЮЙЙ ОБ ЧИПДОЩИ
Key01:
	OUT	03	; МЙОЙСИ ЛПДБ : "вЕЗХЭЙК ОПМШ"
	IN	02	; Й БОБМЙЪПН ЛПДБ ОБ ЧЩИПДОЩИ
	INR	A	; МЙОЙСИ НБФТЙГЙ ЛМБЧЙБФХТЩ
	JNZ	Key010	;
	MOV	A,E	;
	ADD	D	;
	MOV	E,A	;
	MOV	A,B	;
	RLC		;
	MOV	B,A	;
	DCR	C	;
	JNZ	Key01	;
EXIT1:
	CALL	HLP	; РТПЙЪЧЕДЕН ХУФБОПЧЛХ РБТБНЕФТПЧ
	MVI	A,0FFh	; ЬЛТБОБ Й ЪБЧЕТЫЙН РТЕТЩЧБОЙЕ
	STA	Key_Kode	; У ЛПДПН ОЕ ОБЦБФПК ЛМБЧЙЫЙ
	JMP	Key_Main_Exit;
Key010:
	DCR	A	;
Key00:
	RAR		;
	INR	E	;
	JC	Key00	;
	DCR	E	;
	CALL	HLP	;
	LXI	H,Key_Number;
	MOV	M,E	; УПИТБОСЕН ОПНЕТ ЛМБЧЙЫЙ
	INX	H	; DONEM-LABEL
	PUSH	H	; ЧЕЛФПТ РЕТЕИПДБ УПИТБОСЕН Ч УФЕЛЕ
	IN	01H	; ЮЙФБЕН УФБФХУ ХРТБЧМСАЭЙИ ЛМБЧЙЫ
	LXI	B,1020H	; BC - ТБВПЮЙЕ ЛПОУФБОФЩ
	ANA	C	; ЧЩДЕМСЕН ЛМБЧЙЫХ "уу"
	MOV	D,A	; УПИТБОСЕН Ч ТЕЗЙУФТЕ MPU
	MOV	A,E	; РТПЮЙФБЕН ОПНЕТ ЛМБЧЙЫЙ
	CMP	B	; УТБЧОЙН У ЛПДПН == 10H ===
	JNC	DONE03	; РЕТЕИПД ЕУМЙ ОПНЕТ ВПМШЫЕ 10H
;; рТПЙЪЧПДЙН ПВТБВПФЛХ ОБЦБФЙС ЛМБЧЙЫ УМХЦЕВОПК ЛМБЧЙБФХТЩ
;; ЙНЕАЭЙЕ УМЕДХАЭЙЕ ОПНЕТБ:
;;
	CPI	03H	; ОПНЕТ ЛМБЧЙЫЙ НЕОЙЫЕ 10H
	RNZ		; Ф.Е. ОБЦБФБ ЛМБЧЙЫБ УМХЦЕВОПК
	MOV	A,D	; ЛМБЧЙБФХТЩ ( РЕТЧЩЕ ДЧЕ МЙОЙЙ ОБ
	ORA	A	; УИЕНЕ ОЕПВИПДЙНП РПНЕОСФШ НЕУФБНЙ)
	MOV	A,E	; ЪДЕУШ ОЕПВИПДЙНП РТПЧЕТЙФШ ФПМШЛП
	RNZ		; ЛМБЧЙЫХ "ъв" Ч ЪБЧЙУЙНПУФЙ ПФ
	MVI	A,5FH	; ОБЦБФЙС ЛМБЧЙЫЙ "уу"
	RET		;

DONE03:
	CMP	C	; УТБЧОЙН У ЛПДПН == 20H ==
	JNC	DONE05	; РЕТЕИПД ЕУМЙ ВПМЙЫЕ ЙМЙ ТБЧОП
;; пВТБВПФБЕН ЧБТЙБОФ ОБЦБФЙС ЛМБЧЙЫ У ОПНЕТБНЙ
;; ПФ 10H-20H - ГЙЖТЩ Й УРЕГ ЪОБЛЙ
	MOV	A,D	; ЧПЪШНЕН УФБФХУ ЛМБЧЙЫЩ "уу"
	ORA	A	; ЕУМЙ ФБН 0 ФП ЪОБЮЙФ ОБЦБФБ
	MOV	A,E	; ЙОБЮЕ ОЕ ОБЦБФБ
	JZ	Key02	; 
	ADD	B	;
Key02:
	ADD	B	;
	MOV	L,A	;
	MOV	A,E	;
	CPI	1CH	;
	MOV	A,L	;
	RC		;
	XRA	B	;
	RET		;
;;
;; пВТБВПФБЕН ЧБТЙБОФ ОБЦБФЙС ВХЛЧЕОЩИ ЛМБЧЙЫ
;;
DONE05:
	CPI	3FH	; ЕУМЙ ЬФП РТПВЕМ ФП ЧПЪЧТ.
	MOV	A,C	; ЛПД 20H
	RZ		;
	MOV	A,D	;
	ORA	A	;
	LDA	Stat_Small	; ЮЙФБЕН УФБФХУ СЮЕКЛЙ ТЕЗЙУФТПЧ
	JNZ	D_5_OBH	;
	CMA		;
D_5_OBH:
	ORA	A	; РТПЧЕТСЕН ОБ ТБЧЕОУФЧП 0
	MOV	A,E	; ЕУМЙ = 0 ФП РТПРЙУОЩЕ ВХЛЧЩ
	JZ	Key04	; ЙОБЮЕ УФТПЮОЩЕ ВХЛЧЩ
	ADD	C	;
Key04:
	ADD	C	;
	MOV	E,A	;
	LDA	Stat_RUS_LAT	;
	ORA	A	;
	MOV	A,E	;
	RZ		;
	ADI	80H	; ЛПТЕЛГЙС ОБ ТХУЛЙЕ ВХЛЧЩ
	XRA	C	;
	RET		;
Key_Number:	DB	00h	;ОПНЕТ ЛМБЧЙЫЙ
DONEM:
	LXI	H,Key_Main_Exit;	
	PUSH	H	;
	MOV	C,A	;
	LDA	Key_Kode;
	CMP	C	;
	LXI	H,KOOL	;
	JNZ	M22	;
	MOV	A,M	;
AL1:
	CPI	30	;
	JZ	M24	;
M23:
	INR	M	;
	RET		;
M22:
	MVI	M,0	;
	MVI	A,30	;ЧТЕН.ПЦЙДБОЙС
	STA	AL1+1	;
	INX	H	;DREB
	MOV	A,M	;
	DCR	A	;
	JNZ	M23	;
	DCR	M	;
	DCX	H	;
	JMP	DONE10	;
M24:
	MVI	M,0	;
	MVI	A,2	;CONST AUTO
	STA	AL1+1	;
DONE10:
	MOV	A,C	;
	DCX	H	;
	MOV	M,A	;
	DCX	H	;
	DCR	B	;
	CMP	B	;
	JNZ	M31	;
	MOV	A,M	;Stat_Small
	CMA		;
	MOV	M,A	;
M31:
	LXI	H,Key_Seek	;
	MOV	A,M	;
	CPI	4	; тБЪНЕТ ВХЖЕТБ ЛМБЧЙБФХТЩ.
	CALL	Beep_Key;
	RZ		;
	INR	M	;
	MOV	C,A	;
	MVI	B,0	;
	DAD	B	;
	LDA	Key_Kode;
	MOV	M,A	;
	RET		;
Key_Main_Exit:
	POP	PSW	;
	POP	H	;
	POP	D	;
	POP	B	;
	EI		;
	RET		;
;;;;;;;;;;;;;;;; чУРПНПЗБФЕМШОБС РТПГЕДХТБ ;;;;;;;;;;;;;;;
HLP:
	MVI	A,88h	;
	OUT	00h	;
	LDA	Stat_RUS_LAT	;
	OUT	01h	;
	MVI	A,0FFh	;УЛТПМЙОЗ
	OUT	03h	;
	MVI	A,10h	;ТЕЦЙН Й ВПТДАТ
	OUT	02h	;
	RET		;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;	рТПГЕДХТБ РПДБЮЙ ЭЕМЮЛБ РП УТЕДУФЧПН ЫФБФОПЗП	;;
;; ЗЕОЕТБФПТБ "ЫХНБ" (РПТФ НБЗОЙФПЖПОБ)			;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
Beep_Key:
	PUSH	PSW	;
	MVI	B,4	;
	MVI	E,30H	;
	LDA	Stat_RUS_LAT;
	MOV	C,A	;
BEEP0: 	INR	A	;
	ANI	1	;
	ORA	C	;
	OUT	1	;
	PUSH	D	;
BEEP:	DCR	E	;
	JNZ	BEEP	;
	POP	D	;
	DCR	B	;
	JNZ	BEEP0	;
	POP	PSW	;
	RET		;

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;	рТГЕДХТБ  ПЦЙДБЕФ  ОБЦБФЙЕ ЛМБЧЙЫЙ Й ЧПЪЧТБЭБЕФ	;;
;; РПМХЮЕОЩК ASCII ЛПД Ч ТЕЗЙУФТЕ "б"			;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
Key_Wait:
	CALL	Input_Key	;
	INR	A		;
	JZ	Key_Wait	;
	DCR	A		;
	RET			;

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;     рТПГЕДХТБ ЧЪСФЙС ЛПДБ ЛМБЧЙЫЙ ЙЪ ТБВПЮЕЗП ВХЖЕТБ	;;
;; ЕУМЙ ВХЖЕТ РХУФ ФП ЧПЪЧТБЭБЕФУС 0xFF			;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
Input_Key:
	PUSH	B	;
	PUSH	D	;
	PUSH	H	;
	LXI	H,Key_Seek;
	MVI	C,255	;
	DI		;
	DCR	M	;
	JZ	INQ	;
	MOV	B,M	;
	INX	H	;
	MOV	C,M	;
	EI		;
	MOV	D,H	;
	MOV	E,L	;
IN0:			;
	INX	H	;
	MOV	A,M	;
	STAX	D	;
	INX	D	;
	DCR	B	;
	JNZ	IN0	;
	DCR	M	;
INQ:			;
	EI		;
	INR	M	;
	MOV	A,C	;
	POP	H	;
	POP	D	;
	POP	B	;
	RET		;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;	рТГЕДХТБ ПУХЭЕУФЧМСЕФ УВТПУ ЛМБЧЙБФХТЩ		;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
Key_Reset:
	MVI	A,1	; хЛБЪБФЕМШ ЪБРПМОЕОЙС ОБ БЮБМП.
	STA	Key_Seek;
	RET		;


BTEXT:
	DB	CR,CR,CR
TEXT_END:
	DB	STOPBYTE

VERSION:
	DB	6,7,' ',0F7h,0C5h,0D2h,0D3h,0C9h,0D1h,' 2.00 ',7,8,CR
	DB	6,7,' ',0F0h,0C9h,0CDh,0C5h,0CEh,0CFh,0D7h,' '
	DB	0F0h,0C1h,0D7h,0C5h,0CCh,' ',0D0h,0D2h,0C5h,0C4h,0D3h
	DB	0D4h,0C1h,0D7h,0CCh,0D1h,0C5h,0D4h,' ',7,8,CR
POD1:	DB	6,7,' 00000/000 Mode:Edit ',7,8,CR
	DB	6,7,' File  :noname  .txt ',7,8,CR
	DB	15,' Us + ',8,' ',15,' 2-File ',15,' 3-Goto '
	DB	15,'4-Search',15,'5-Extend',15,' 6-Info '
	DB	15,'7-Delete',15,CR
	DB	'Message:',CR
	DB	6,7,7,8,CR


;; (C) уЙУФЕНПФЕИОЙЛБ
AVT:	
	DB	31,"("-1,'B','(',31
	DB	0F2h,0C8h,0D2h,0D3h,0C4h,0CCh,0CEh,0D3h
	DB	0C4h,0C7h,0CDh,0C8h,0CAh,0C0h,31,31

;+-------[ INVERS ]-----+
;* ЙОЧЕТФЙТХЕФ ЬЛТБО ПФ *
;* (HL) -ЧЩУПФБ:(D)	*
;* 	-ЫЙТЙОБ:(Е)	*
;+----------------------+
INV:		PUSH	B	
		MOV	B,D	
		MOV	C,E	
		CALL	IV2	
		MOV	A,H	
		ADI	20H	
		MOV	H,A	
		CALL	IV2	
		POP	B	
		RET		

IV2:		PUSH	H	
IV1:		PUSH	H	
IV0:		MOV	A,M	
		CMA		
		MOV	M,A	
		INR	L	
		DCR	E	
		JNZ	IV0	
		POP	H	
		MOV	E,C	
		INR	H	
		DCR	D	
		JNZ	IV1	
		MOV	D,B	
		POP	H	
		RET		

;;;;;;;;
PPASTART:
;;
;;   пУХЭЕУФЧМСЕН ЛПОФТПМШ ЛПОФТПМШОПК УХННЩ ЖБКМБ
;;
		DI			;
		LXI	H,100h		;
		SPHL			;
		LXI	D,1700h		;
		PUSH	D		;
		POP	B		;
PPA_CONTR_LOOP:
		MOV	A,M		;
		ADD	B		;
		MOV	B,A		;
		INX	H		;
		MOV	A,C		;
		SUB	M		;
		MOV	C,A		;
		DCX	D		;
		INX	H		;
		MOV	A,D		;
		ORA	E		;
		JNZ	PPA_CONTR_LOOP	;
		PUSH	B		;
		POP	H		;
VZLOM_CONTR:				;
		NOP			;
		NOP			;
		NOP			;
		SHLD	0003h		;
		XRA	A		;
		OUT	10h		;
		MOV	H,A		;
		MOV	L,A		;
PPA_LOOP:				;
		MOV	M,A		;
		INR	L		;
		JNZ	PPA_LOOP	;
		ADI	0C3h		;
		STA	0038h		;
		STA	0000h		;
		LXI	H,IM_ZG		;
		LXI	B,800h		;
		LXI	D,W_Zg		;
		CALL	I_REMOVE	;
		LXI	D,001Fh		;
		MOV	A,D		;
		CALL	Put_XY_Char	;
		MVI	D,03Fh		;
		CALL	Put_XY_Char	;

		LXI	H,Key_Interrupt	;
		SHLD	0039h		;
;;;;;;;;;;; вМПЛ РТПТЙУПЧЛЙ ЪБУФБЧЛЙ ;;;;
		LXI	D,0	;
		LXI	H,3F1Eh	;
		CALL	Cls_XY	;
		LXI	D,102h	;
		LXI	H,3E1Fh	;
		MVI	A,20h	;
		CALL	Box_XY	;
		DCR	L	;
		CALL	Box_XY	;
		EI		;
		MVI	D,3	;
		DCR	L	;
		XCHG		;
		MVI	B,27	;
		CALL	STL2	
		MVI	A,9CH	
		LXI	D,11EH
		CALL	Put_XY_Char	
		MVI	D,3EH	
		MVI	A,89H	
		CALL	Put_XY_Char	
		LXI	D,2902H
		LXI	B,VERSION
		CALL	W_DOP_PUTS
		MVI	D,05h
		CALL	W_DOP_PUTS
		LXI	D,51EH	
		CALL	W_DOP_PUTS	
		MVI	D,21H	
		CALL	W_DOP_PUTS	
		LXI	H,3F1FH	
		SHLD	W_2Window	
		LXI	H,EDITING
		PUSH	H
		LXI	H,0	
		SHLD	W_1Window	
		MOV	D,H	
		MOV	E,L	
		CALL	INFO	
		PUSH	B	
		LXI	D,51FH	
		CALL	W_DOP_PUTS	
		POP	B	
		MVI	D,36H	
		CALL	W_DOP_PUTS	
		LXI	H,203H	
		SHLD	W_1Window	
		LXI	H,3D1DH	
		SHLD	W_2Window	
		LXI	H,Restart
		SHLD	0001h
;; вМПЛ ЖПТНЙТПЧБОЙС ЛПРЙТБКФБ ЖЙТНЩ уЙУФЕНПФЕИОЙЛБ.

	LXI	D,0C0Eh		;
	LXI	H,331Bh		;
	MVI	A,15h		;
	CALL	W_Open		;
	LXI	B,Systemotehnic	;
	LXI	D,010Eh		;
	CALL	PRSCREEN	;
	CALL	Key_Wait	;
	LXI	D,0A12h		;
	LXI	H,3518h		;
	MVI	A,16h		;
	CALL	W_Open		;
	INX	B		;
	LXI	D,0106h		;
	CALL	PRSCREEN	;
	CALL	Key_Wait	;
	CALL	W_Close		;
	LXI	H,AVT0		;
	PUSH	H		;
	LXI	H,AVT+20	;
	LXI	B,1715H		;
BL8:				;
	LXI	D,71FH		;
	CALL	SPPAR		;
	MOV	A,M		;
	INR	A		;
	CALL	Put_XY_Char	;
	DCX	H		;
	XTHL			;
	MVI	D,20H		;
	CALL	SPPAL		;
	MOV	A,M		;
	INR	A		;
	MVI	D,37H		;
	CALL	Put_XY_Char	;
	INX	H		;
	XTHL			;
	DCR	C		;
	JNZ	BL8		;
	POP	H		;
	CALL	Key_Wait	;
	CALL	W_Close		;
	RET			;

Systemotehnic:
	DB	6,7,' 14.04.1994 ',7,8,CR,CR
	Rus_DB	__уРЕГЙБМШОП_ДМС_фпп_
	DB	'"'
	Rus_DB	уЙУФЕНПФЕИОЙЛБ
	DB	'"'
	DB	CR
	Rus_DB	______рЙНЕОПЧ_р
	DB	'.'
	Rus_DB	б
	DB	'.'
	Rus_DB	__РТЕДУФБЧМСЕФ
	DB	CR
	Rus_DB	_________ОПЧЕКЫХА_ТБЪТБВПФЛХ
	DB	CR
	DB	CR
	DB	'    "PPA Text Editor Version 2.00"'
	DB	CR
	DB	CR
	Rus_DB	_____бДТЕУ_фпп_
	DB	'"'
	Rus_DB	уЙУФЕНПФЕИОЙЛБ
	DB	'"',CR
	Rus_DB	___тПУУЙС_
	DB	"400074 "
	Rus_DB	З
	DB	'.'
	Rus_DB	чПМЗПЗТБД_Б
	DB	'/'
	Rus_DB	С
	DB	" 40"
	DB	CR
	DB	CR
	Rus_DB	____жЙТНБ_ПВЕУРЕЮЙФ_ЧБУ_ХОЙЛБМШОЩН
	DB	CR
	Rus_DB	РТПЗТБННОЩН__Й_БРРБТБФОЩН_ПВЕУРЕЮЕОЙЕН
	DB	CR
	Rus_DB	_________ДМС_рл
	DB	'"'
	Rus_DB	чЕЛФПТ
	DB	'-06'
	Rus_DB	г
	DB	'"!',CR
	DB	STOPBYTE
	Rus_DB	____ъБНЕЮБОЙС_Й_РТЕДМПЦЕОЙС_ПФОПУСЭЙЕУС
	DB	CR
	Rus_DB	Л_РТПЗТБННБН_РПД_ЪОБЮЛПН
	DB	' "PPA" '
	Rus_DB	ОБРТБЧМСКФЕ
	DB	CR
	Rus_DB	___________БЧФПТХ_РП_БДТЕУХ
	DB	':',CR,CR
	Rus_DB	_тЕУРХВМЙЛБ_лБЪБИУФБО_
	DB	"470075 "
	Rus_DB	З
	DB	'. '
	Rus_DB	лБТБЗБОДБ
	DB	CR
	Rus_DB	____ХМ
	DB	'. 40 '
	Rus_DB	МЕФ_лБЪБИУФБОБ_Д
	DB	'. 39/3 '
	Rus_DB	ЛЧ
	DB	'.1'
	DB	CR
	Rus_DB	_________рЙНЕОПЧ_рБЧЕМ_бМЕЛУЕЕЧЙЮ
	DB	'.',CR
	DB	STOPBYTE

;+-------[ INFO ]-------+
;* ЧЩДБЕФ 'РПДЧБМ'	*
;+----------------------+
INFO:		CALL	W_DOP_PUTS	
		INR	E
		MVI	D,1	
		CALL	W_DOP_PUTS	
		LXI	H,0A000H
		LXI	D,2008H	
		CALL	INV	
		RET
;;; дПРПМОЙФЕМШОБС РТПГЕДХТБ ;;;
W_DOP_PUTS:
	CALL	WPUTS1
	INX	B
	RET
;PPA-EDITOR
AVT0:		DB	31,'Sgd',31,'OO@',31,'Sdws',31
		DB	'Dchsnq',31
;+------[ SPPAR ]-------+
;* УДЧЙЗБЕФ ПФ (DE) (B)	*
;* ЬМЕН. УФТПЛЙ Ч РТБЧП *
;+----------------------+
SPPAR:		PUSH	D	
		PUSH	B	
		PUSH	PSW	
		MOV	A,D	
		ADD	B	
		DCR	A	
		MOV	D,A	
SP0:		DCR	D	
		CALL	Get_XY_Char	
		INR	D	
		CALL	Put_XY_Char	
		DCR	D	
		DCR	B	
		JNZ	SP0	
		POP	PSW	
		POP	B	
		POP	D	
		RET		
;+-----[ SPPAL ]--------+
SPPAL:		PUSH	D	
		PUSH	B	
		PUSH	PSW	
SL0:		INR	D	
		CALL	Get_XY_Char	
		DCR	D	
		CALL	Put_XY_Char	
		INR	D	
		DCR	B	
		JNZ	SL0	
		POP	PSW	
		POP	B	
		POP	D	
		RET		
IM_ZG:
	END
OV	A,C		;
	CALL	PUT_REC_BYTE	;
	MOV	A,B		;
	CALL	PUT_REC_BYTE	;
	EI			;
	CALL	DEACTI		;
	CALL	DEACTI		;
F_MAIN_EXIT:			;
	POP	H		;
F_3EXIT:			;
	CALL	RS_STR		;
	CALL	INCY		;
	CALL	DECY		;
	RET			;
FIRMA_PPA:
	DB	"(C) 20.07.1993 KARAGANDA PPA TEXT EDITOR "
	DB	"PRESENT BY PIMENOV PAVEL",0
F_MERGE:
	MVI	A,01h		; лПНБОДБ РПДЗТХЪЛЙ.
	JMP	F_L_M		;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;	   рТПГЕДХТБ ЮФЕОЙС ЖБКМБ У НБЗОЙФПЖПОБ.	;;
F_LOAD:
	XRA	A		;
F_L_M:
	STA	F_FLAG		; лПНБОДБ ЮФЕОЙС.
	XRA	A		;
	MOV	H,A		;
	MOV	L,H		;
	DAD	SP		;
	SHLD	STACK_BUFER	;

	LXI	D,1008h		;
	LXI	H,3008h		;
	MVI	A,16h		;
	CALL	ACTIV		;
	LXI	B,F_L_MESSAGE	;
	LXI	D,0300h		;
	CALL	WPUTSDOP	;
	DI			;	
	CALL	WAIT_HEADER_ASM	;пЦЙДБЕН УФБТФПЧПЗП ТБЛПТДБ.
	CALL	LOAD_NAME_ASM	;рТПЮЙФБЕН ЙНС ЖБКМБ.
	LXI	D,2B0Eh		;
	LXI	H,360Eh		;
	CALL	CLS		;
	LXI	B,F_F_ASCII	;
	LXI	D,2B0Eh		;
F_L_LOOP_NAME:
	LDAX	B		;
	CPI	0Dh		;
	CNZ	PUTCXY		;
	INX	B		;
	PUSH	PSW		;
	INR	D		;
	POP	PSW		;
	JNZ	F_L_LOOP_NAME	;
	CALL	GET_YES_SINHRO	;рТПРХУФЙН ОХМЕЧХА ЪБРЙУШ.
	CALL	GET_NOT_SINHRO	;Й ТБЪНЕТ ЖБКМБ.
;; рЕТЕИПДЙН Л ЪБЗТХЪЛЕ ЖБКМБ.
	LDA	F_FLAG		;
	DCR	A		;
	LXI	H,BTEXT+2	; ОБЮБМП ФЕЛУФПЧПЗП ВХЖЕТБ
	JNZ	F_LM_MERGE	;
	LHLD	ENDTEXT		; хЛБЪБФЕМШ ОБ ЛПОЕГ ЖБКМБ
F_LM_MERGE:			; 
	LXI	D,TEXT_LIMIT	; ЛПОЕГ ФЕЛУФПЧПЗП ВХЖЕТБ
LOAD_LOOP:
	CALL	GET_NOT_SINHRO	; РТПЮЙФБЕН ВБКФ
	MOV	M,A		; уЛЙОЕН Ч РБНСФШ
	INR	A		; РТПЧЕТЙН ОБ ЛПОЕГ ФЕЛУФБ
	JZ	LOAD_EXIT	; ХИПД ЕУМЙ дб
	INX	H		; ЙОБЮЕ РТДПМЦБЕН
	CALL	MEMORY_OVER	; РТПЧЕТЛБ ОБ ТЕЪЕТЧ РБНСФЙ
	JNZ	LOAD_LOOP	;
	JC	LOAD_LOOP	;
;;;;;;;;;;;;;;;;; рЕТЕРПМОЕОЙЕ РБНСФЙ ;;;;;;;;;;;;;;;;
	MVI	M,0FFh		;
	SHLD	ENDTEXT		;
	LXI	B,F_LOAD_OVER	;
	LXI	D,0400h		;
	JMP	F_L_QUIT	;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
LOAD_EXIT:			;
	PUSH	H		; хЛБЪБФЕМШ ЛПОГБ.
	CALL	GET_NOT_SINHRO	;
	MOV	E,A		;
	CALL	GET_NOT_SINHRO	;
	MOV	D,A		;
	LDA	F_FLAG		;
	DCR	A		;
	LXI	H,BTEXT+2	;
	JNZ	F_LM_2MERGE	;
	LHLD	ENDTEXT		;
F_LM_2MERGE:			;
	CALL	CONTR_ADD	;
	EI			;
	MOV	A,D		;
	CMP	B		;
	POP	H		; чпуфбопчйн лпоег.
	JNZ	F_LOAD_ERROR	;
	MOV	A,E		;
	CMP	C		;
	JNZ	F_LOAD_ERROR	;
	SHLD	ENDTEXT		;
	CALL	DEACTI		;
	CALL	DEACTI		;
F_2MAIN_EXIT:
	CALL	NULL_POS	;
	CALL	PRINT_POS	;
	JMP	F_MAIN_EXIT	;

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;; пЫЙВЛБ ЮФЕОЙС ЖБКМБ. хОЙЮФПЦЙН РТЕДЙДХЭЙК Й РПЧФПТЙН.
F_LOAD_ERROR:
	CALL	F_RESTART	;
	LXI	B,ERROR_LOAD	;
	LXI	D,0D00h		;
F_L_QUIT:
	CALL	HOME		;
	CALL	WPUTSDOP	;
	MVI	A,50		;
F_L_ERR_LOOP:
	HLT			;
	loop	A,F_L_ERR_LOOP	;
	CALL	DEACTI		;
	JMP	F_3EXIT		;
;;;;;;;;;;;;;;;;;;; I N T E R R U P T ;;;;;;;;;;;;;;;;;;;;
REC_EXIT:
	LHLD	STACK_BUFER	;
	SPHL			;
	LDA	F_FLAG		;
	INR	A		;
	JZ	F_L_QUIT	;
	CALL	F_RESTART	;
	LXI	B,F_INTERRUPT	;
	LXI	D,0B00h		;
	JMP	F_L_QUIT	;

;_______________________ ртпгеуущ _________________________
	Public	PUT_REC_BYTE	; ЧЩЧПД ВБКФБ ОБ НБЗОЙФПЖПО
	Public	GET_REC_BYTE	; ЧЧПД ВБКФБ У НБЗОЙФПЖПОБ
	Public	GET_NOT_SINHRO	; ЮФЕОЙЕ ВЕЪ УЙОИТП РПЙУЛБ
	Public	GET_YES_SINHRO	; ЮФЕОЙЕ У УЙОИТП РПЙУЛПН
	Public	WAIT_HEADER_ASM	; ПЦЙДБОЙС ЪБЗПМПЧЛБ ЖБКМБ
	Public	LOAD_NAME_ASM	; ЮФЕОЙЕ ЙНЕОЙ ЖБКМБ
	Public	MEMORY_OVER	; лПОФТПМШ РЕТЕРПМОЕОЙС.

;________________________ рбнсфш __________________________
	Public	PUT_CONST	; ЛПОУФБОФБ ЪБРЙУЙ
	Public	GET_CONST	; ЛПОУФБОФБ ЮФЕОЙС

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;	рТПГЕДХТБ ТЕУФБТФБ ПРГЙЙ ЮФЕОЙС ЖБКМПЧ.		;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
F_RESTART:
	LXI	H,0FF0Dh	;
	LDA	F_FLAG		;
	DCR	A		;
	JZ	F_RES_00	;
DEL_TEXT:
	LXI	H,0FF0Dh	;
	SHLD	BTEXT+2		;
	LXI	H,BTEXT+3	;
	SHLD	ENDTEXT		;
	RET			;
F_RES_00:
	LHLD	ENDTEXT		;
	MVI	M,0FFh		;	
	RET			;

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;   рТПГЕДХТБ РПДУЮЕФБ ЛПОФТПМШОПК УХННЩ РТПЮЙФБОПЗП	;;
;; ЖБКМБ.	теъхмшфбф: BC				;;
;;	чипд: HL - хлбъбфемш обюбмб рпдуюефб.		;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
CONTR_ADD:
	LXI	B,0000h		;
CONT_LOOP:			;
	MOV	A,M		;
	INR	A		;
	RZ			;
	DCR	A		;
	ADD	C		;
	MOV	C,A		;
	MVI	A,0		;
	ADC	B		;
	MOV	B,A		;
	INX	H		;
	JMP	CONT_LOOP	;

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;	рТПГЕДХТБ ПРТЕДЕМЕОЙС ЛПОГБ РБНСФЙ ьчн		;;
;; чипд:	HL - фЕЛХЭЙК БДТЕУ.			;;
;;		DE - рТЕДЕМШОЩК БДТЕУ.			;; 
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
MEMORY_OVER:		;
	MOV	A,H	;
	CMP	D	;
	RNZ		;
	MOV	A,L	;
	CMP	E	;
	RET		;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;   рТПГЕДХТБ ЮФЕОЙС ЙНЕОЙ ЖБКМБ Ч УРЕГЙБМШОЩК ВХЖЕТ	;;
;; BUF_NAME   ( ТБЪНЕТ ЙНЕОЙ ПЗТБОЙЮЕО 12 УЙНЧПМБНЙ )	;;
;;		 тезйуфтщ ое упитбосафус !!!		;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
LOAD_NAME_ASM:			;
	LXI	H,F_F_ASCII-1	; хЛБЪБФЕМШ ОБ ВХЖЕТ.
	MVI	B,13		; УЮЕФЮЙЛ УЙНЧПМПЧ.
LOAD_NAME_LOOP:			;
	INX	H		;
	CALL	GET_NOT_SINHRO	;
	DCR	B		;
	MVI	M,0Dh		; УФБЧЙН ЧТЕНЕОХА ЪБЗМХЫЛХ.
	RZ			; ЧЩИПДЙН ЕУМЙ ВХЖЕТ ЙНЕОЙ
	MOV	M,A		; РЕТЕРПМОЕО.
	ORA	A		; ЧЩИПДЙН ЕУМЙ ТЕБМШОПЕ ЙНС
	JNZ	LOAD_NAME_LOOP	; ЪБЛПОЮЙМПУШ.
	MVI	M,0Dh		;
	RET			;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;	рТПГЕДХТБ ПЦЙДБОЙС ЪБЗПМПЧЛБ ЖБКМБ "*.ASM"	;;
;;  рТПГЕДХТБ ПУХЭЕУФЧМСЕФ РПЙУЛ ОБ МЕОФЕ УФБОДБТФОПЗП	;;
;; ЪБЗПМПЧЛБ ФЕЛУФПЧПЗП ЖБКМБ Й ЧПЪЧТБЭБЕФ ХРТБЧМЕОЙЕ	;;
;; ДМС РТПЙЪЧЕДЕОЙС ЮФЕОЙС ЙНЕОЙ ЖБКМБ.			;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
WAIT_HEADER_ASM:		;
	PUSH	PSW		;
	PUSH	B		;
WAIT_H_LOOP_00:			;
	MVI	B,4		;
	MVI	A,YES_SINHRO	;
WAIT_H_LOOP_10:			;
	CALL	GET_REC_BYTE	;
	CPI	0E6h		;
	JNZ	WAIT_H_LOOP_00	;
	DCR	B		;
	MVI	A,NO_SINHRO	;
	JNZ	WAIT_H_LOOP_10	;
	POP	B		;
	POP	PSW		;
	RET			;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;    рТПГЕДХТБ ЮФЕОЙС ВБКФБ У НБЗОЙФПЖПОБ ВЕЪ уйоитп.	;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
GET_NOT_SINHRO:
	MVI	A,NO_SINHRO	;
	JMP	GET_REC_BYTE	;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;	рТПГЕДХТБ ЮФЕОЙС ВБКФБ У УЙОИТПОЙЪБГЙЕК		;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
GET_YES_SINHRO:
	MVI	A,YES_SINHRO	;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;	рТПГЕДХТБ ЮФЕОЙС ВБКФБ У НБЗОЙФПЖПОБ.		;;
;; чипд:	б = 0FFh - У РПЙУЛПН УЙОИТПВБКФБ	;;
;;		A = 008h - ВЕЪ РПЙУЛБ УЙОИТПВБКФБ	;;
;; чщипд:	б = РТПЮЙФБОЩК ВБКФ.			;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
GET_REC_BYTE:
	PUSH	B		; УПИТБОСЕН ТЕЗЙУФТЩ.
	PUSH	D		;
	MVI	C,0		; УЖПТНЙТХЕН ЪБЗПФПЧЛХ.
	MOV	D,A		; УПИТБОЙН РБТБНЕФТ.
GET_REC_LOOP:
	IN	01h		;
	ANI	10h		; ПЦЙДБЕН РЕТЕРБДБ ХТПЧОС
	MOV	E,A		; УЙЗОБМБ.
GET_REC_00:			; ( УЙОИТПОЙЪБГЙС РП ЖБЪЕ )
	IN	01h		;
	ANI	10h		;
	CMP	E		;
	JZ	GET_REC_00	; ГЙЛМ ЦЙДБОЙС.
	RLC			;
	RLC			;
	RLC			;
	RLC			;
	MOV	A,C		;
	RAL			;
	MOV	C,A		;
	LDA	GET_CONST	;РТПЮЙФБЕН ЛПОУФБОФХ ЮФЕОЙС
	CALL	WAIT_LOOP	;
	MOV	A,D		;
	ORA	A		;
	JP	GET_REC_NO_SINHRO;
	MOV	A,C		;
	CPI	0E6h		;
	JNZ	GET_REC_01	;
	XRA	A		;
	STA	GET_INVERSE	;
GET_REC_01:			;
	CPI	19h		;
	JNZ	GET_REC_LOOP	;
	MVI	A,0FFh		;
	STA	GET_INVERSE	;
	MVI	D,9		;
GET_REC_NO_SINHRO:		;
	DCR	D		;
	JNZ	GET_REC_LOOP	;
	LDA	GET_INVERSE	;
	XRA	C		;
	POP	D		;
	POP	B		;
	RET			;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;	рТПГЕДХТБ ЧЩЧПДБ ВБКФБ ОБ НБЗОЙФОХА МЕОФХ.	;;
;; чипд:	б = чЩЧПДЙНЩК ВБКФ.			;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
PUT_REC_BYTE:
	PUSH	D		; УПИТБОЙН ТЕЗЙУФТЩ
	PUSH	PSW		;
	MOV	D,A		;
	MVI	C,8		; УЮЕФЮЙЛ ВЙФПЧ.
PUT_REC_00:			;
	MOV	A,D		; УДЧЙОЕН
	RLC			; ФЕЛХЭЙК ВЙФ ВБКФБ
	MOV	D,A		;
	MVI	A,1		; УДЕМБЕН ЕЗП ЙОЧЕТУЙА
	XRA	D		;
	ANI	01h		; ЧЩДЕМЙН
	OUT	00h		; Й ЧЩДБДЙН Ч РПТФ
	CALL	PUT_REC_WAIT	; УДЕМБЕН ЪБДЕТЦЛХ.
	MVI	A,0		;
	XRA	D		; РТПДЕМБЕН ФПЦЕ УБНПЕ ОП ВЕ ЙОЧТУЙ
	ANI	01h		;
	OUT	00h		;
	CALL	PUT_REC_WAIT	;
	DCR	C		; ВЙФЩ ЛПОЮЙМЙУШ ???
	JNZ	PUT_REC_00	;
	POP	PSW		;
	POP	D		;
	RET			;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;	рТПГЕДХТБ ПТЗБОЙЪБГЙЙ ЪБДЕТЦЛЙ ДМС РТПГЕДХТЩ	;;
;; ЧЩЧПДБ ВБКФБ ОБ НБЗОЙФПЖПО.				;;
;;;;;;;;;;	Title	RE.ASM	; Version 1.00
	Include	MACRO.PPA	; My Macro #define.
;;   рТПЗТБННБ ПТЗБОЙЪБГЙЙ ЙОФЕТЖЕКУБ У НБЗОЙФПЖПОПН Ч ЖПТ-
;; НБФЕ "EDASM" /* (C)18.06.1993 лБТБЗБОДБ */
;; ///////////// рЙНЕОПЧ рБЧЕМ бМЕЛУЕЕЧЙЮ. //////////////
NO_SINHRO	EQU	08h	; вЕЪ РПЙУЛБ УЙОИТПВБКФБ.
YES_SINHRO	EQU	0FFh	; у РПЙУЛПН УЙОИТПВБКФБ.

	JMP	PPASTART
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;	 рТПГЕДЕТБ ЪБРЙУЙ ЖБКМБ ОБ НБЗОЙФПЖПО.		;;
F_SAVE:
	CALL	F_INPUT_NAME	;
	SUI	0Eh		;
	RZ			;
	XRA	A		;
	MOV	H,A		;
	MOV	L,A		;
	DAD	SP		;
	SHLD	STACK_BUFER	;
	DCR	A		;
	STA	F_FLAG		; ъбрйуш жбкмб.
	LXI	H,BTEXT+2	;
	CALL	CONTR_ADD	;
	PUSH	B		;
	DI			;
;; жПТНЙТХЕН ФПОБМШОЩК ЪБЗПМПЧПЛ ЖБКМБ.
	MVI	D,04h		;
	XRA	A		;
F_S_TONE1:
	MVI	E,040h		;
	XRI	55h		;
F_S_TONE0:
	CALL	PUT_REC_BYTE	;
	loop	E,F_S_TONE0	;
	loop	D,F_S_TONE1	;
;; чЩЧПДЙН ЙНС ЖБКМБ
	MVI	A,0E6h		;
	LXI	H,F_F_ASCII	;
	MVI	B,4		;
F_S_NAME0:
	CALL	PUT_REC_BYTE	;
	loop	B,F_S_NAME0	;
F_S_NAME1:
	CALL	PUT_REC_BYTE	;
	MOV	A,M		;
	INX	H		;
	ORA	A		;
	JNZ	F_S_NAME1	;
	LXI	H,FIRMA_PPA	;
F_S_COPYRIGHT:
	CALL	PUT_REC_BYTE	;
;;
;; жПТНЙТХЕН ЖЙТНЕОХА ЧУФБЧЛХ : (C)1993 KARAGANDA PPA TEXT EDITOR
;;
	LXI	H,FIRMA_PPA	;
	MOV	A,M		;
	INX	H		;
	ORA	A		;
	JNZ	F_S_COPYRIGHT	;
	MVI	B,230		;
F_S_NULL:
	CALL	PUT_REC_BYTE	;
	loop	B,F_S_NULL	;

	RET
FIRMA_PPA:
	DB	"(C)1993 PPA TEXT EDITOR PRESENT BY"
	DB	"PIMENOV PAVEL (3212)52-81-95",0
F_MERGE:
	MVI	A,01h		; лПНБОДБ РПДЗТХЪЛЙ.
	JMP	F_L_M		;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;	   рТПГЕДХТБ ЮФЕОЙС ЖБКМБ У НБЗОЙФПЖПОБ.	;;
F_LOAD:
	XRA	A		;
F_L_M:
	STA	F_FLAG		; лПНБОДБ ЮФЕОЙС.
	XRA	A		;
	MOV	H,A		;
	MOV	L,H		;
	DAD	SP		;
	SHLD	STACK_BUFER	;

	LXI	D,1008h		;
	LXI	H,3008h		;
	MVI	A,15h		;
	CALL	ACTIV		;
	LXI	B,F_L_MESSAGE	;
	LXI	D,0300h		;
	CALL	WPUTSDOP	;
	DI			;	
	CALL	WAIT_HEADER_ASM	;пЦЙДБЕН УФБТФПЧПЗП ТБЛПТДБ.
	CALL	LOAD_NAME_ASM	;рТПЮЙФБЕН ЙНС ЖБКМБ.
	LXI	D,2B0Eh		;
	LXI	H,360Eh		;
	CALL	CLS		;
	LXI	B,F_F_ASCII	;
	LXI	D,2B0Eh		;
F_L_LOOP_NAME:
	LDAX	B		;
	ORA	A		;
	JZ	F_L_DONE	;
	CALL	PUTCXY		;
	INX	B		;
	INR	D		;
	JMP	F_L_LOOP_NAME	;
F_L_DONE:
	CALL	GET_YES_SINHRO	;рТПРХУФЙН ОХМЕЧХА ЪБРЙУШ.
	CALL	GET_NOT_SINHRO	;Й ТБЪНЕТ ЖБКМБ.
;; рЕТЕИПДЙН Л ЪБЗТХЪЛЕ ЖБКМБ.
	LDA	F_FLAG		;
	DCR	A		;
	LXI	H,BTEXT+2	; ОБЮБМП ФЕЛУФПЧПЗП ВХЖЕТБ
	JNZ	F_LM_MERGE	;
	LHLD	ENDTEXT		; хЛБЪБФЕМШ ОБ ЛПОЕГ ЖБКМБ
F_LM_MERGE:			; 
	LXI	D,TEXT_LIMIT	; ЛПОЕГ ФЕЛУФПЧПЗП ВХЖЕТБ
LOAD_LOOP:
	CALL	GET_NOT_SINHRO	; РТПЮЙФБЕН ВБКФ
	MOV	M,A		; уЛЙОЕН Ч РБНСФШ
	INR	A		; РТПЧЕТЙН ОБ ЛПОЕГ ФЕЛУФБ
	JZ	LOAD_EXIT	; ХИПД ЕУМЙ дб
	INX	H		; ЙОБЮЕ РТДПМЦБЕН
	CALL	MEMORY_OVER	; РТПЧЕТЛБ ОБ ТЕЪЕТЧ РБНСФЙ
	JNZ	LOAD_LOOP	;
	JC	LOAD_LOOP	;
;;;;;;;;;;;;;;;;; рЕТЕРПМОЕОЙЕ РБНСФЙ ;;;;;;;;;;;;;;;;
	MVI	M,0FFh		;
	SHLD	ENDTEXT		;
	LXI	B,F_LOAD_OVER	;
	LXI	D,0400h		;
	JMP	F_L_QUIT	;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
LOAD_EXIT:			;
	PUSH	H		; хЛБЪБФЕМШ ЛПОГБ.
	CALL	GET_NOT_SINHRO	;
	MOV	E,A		;
	CALL	GET_NOT_SINHRO	;
	MOV	D,A		;
	LDA	F_FLAG		;
	DCR	A		;
	LXI	H,BTEXT+2	;
	JNZ	F_LM_2MERGE	;
	LHLD	ENDTEXT		;
F_LM_2MERGE:
	CALL	CONTR_ADD	;
	EI			;
	MOV	A,D		;
	CMP	B		;
	POP	H		; чпуфбопчйн лпоег.
	JNZ	F_LOAD_ERROR	;
	MOV	A,E		;
	CMP	C		;
	JNZ	F_LOAD_ERROR	;
	SHLD	ENDTEXT		;
	CALL	DEACTI		;
	CALL	DEACTI		;
	CALL	NULL_POS	;
	CALL	PRINT_POS	;
	POP	H		;
	RET			;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;; пЫЙВЛБ ЮФЕОЙС ЖБКМБ. хОЙЮФПЦЙН РТЕДЙДХЭЙК Й РПЧФПТЙН.
F_LOAD_ERROR:
	CALL	F_RESTART	;
	LXI	B,ERROR_LOAD	;
	LXI	D,0D00h		;
F_L_QUIT:
	CALL	HOME		;
	CALL	WPUTSDOP	;
	MVI	A,50		;
F_L_ERR_LOOP:
	HLT			;
	loop	A,F_L_ERR_LOOP	;
	CALL	DEACTI		;
	RET			;
;;;;;;;;;;;;;;;;;;; I N T E R R U P T ;;;;;;;;;;;;;;;;;;;;
REC_EXIT:
	LHLD	STACK_BUFER	;
	SPHL			;
	LDA	F_FLAG		;
	INR	A		;
	JZ	F_L_QUIT	;
	CALL	F_RESTART	;
	LXI	B,F_INTERRUPT	;
	LXI	D,0B00h		;
	JMP	F_L_QUIT	;

;_______________________ ртпгеуущ _________________________
	Public	PUT_REC_BYTE	; ЧЩЧПД ВБКФБ ОБ НБЗОЙФПЖПО
	Public	GET_REC_BYTE	; ЧЧПД ВБКФБ У НБЗОЙФПЖПОБ
	Public	GET_NOT_SINHRO	; ЮФЕОЙЕ ВЕЪ УЙОИТП РПЙУЛБ
	Public	GET_YES_SINHRO	; ЮФЕОЙЕ У УЙОИТП РПЙУЛПН
	Public	WAIT_HEADER_ASM	; ПЦЙДБОЙС ЪБЗПМПЧЛБ ЖБКМБ
	Public	LOAD_NAME_ASM	; ЮФЕОЙЕ ЙНЕОЙ ЖБКМБ
	Public	MEMORY_OVER	; лПОФТПМШ РЕТЕРПМОЕОЙС.

;________________________ рбнсфш __________________________
	Public	PUT_CONST	; ЛПОУФБОФБ ЪБРЙУЙ
	Public	GET_CONST	; ЛПОУФБОФБ ЮФЕОЙС

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;	рТПГЕДХТБ ТЕУФБТФБ ПРГЙЙ ЮФЕОЙС ЖБКМПЧ.		;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
F_RESTART:
	LXI	H,0FF0Dh	;
	LDA	F_FLAG		;
	DCR	A		;
	JZ	F_RES_00	;
	SHLD	BTEXT+2		;
	LXI	H,BTEXT+2	;
	SHLD	ENDTEXT		;
	RET			;
F_RES_00:
	LHLD	ENDTEXT		;
	MVI	M,0FFh		;	
	RET			;

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;   рТПГЕДХТБ РПДУЮЕФБ ЛПОФТПМШОПК УХННЩ РТПЮЙФБОПЗП	;;
;; ЖБКМБ.	теъхмшфбф: BC				;;
;;	чипд: HL - хлбъбфемш обюбмб рпдуюефб.		;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
CONTR_ADD:
	LXI	B,0000h		;
CONT_LOOP:			;
	MOV	A,M		;
	INR	A		;
	RZ			;
	DCR	A		;
	ADD	C		;
	MOV	C,A		;
	MVI	A,0		;
	ADC	B		;
	MOV	B,A		;
	INX	H		;
	JMP	CONT_LOOP	;

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;	рТПГЕДХТБ ПРТЕДЕМЕОЙС ЛПОГБ РБНСФЙ ьчн		;;
;; чипд:	HL - фЕЛХЭЙК БДТЕУ.			;;
;;		DE - рТЕДЕМШОЩК БДТЕУ.			;; 
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
MEMORY_OVER:		;
	MOV	A,H	;
	CMP	D	;
	RNZ		;
	MOV	A,L	;
	CMP	E	;
	RET		;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;   рТПГЕДХТБ ЮФЕОЙС ЙНЕОЙ ЖБКМБ Ч УРЕГЙБМШОЩК ВХЖЕТ	;;
;; BUF_NAME   ( ТБЪНЕТ ЙНЕОЙ ПЗТБОЙЮЕО 12 УЙНЧПМБНЙ )	;;
;;		 тезйуфтщ ое упитбосафус !!!		;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
LOAD_NAME_ASM:			;
	LXI	H,F_F_ASCII	; хЛБЪБФЕМШ ОБ ВХЖЕТ.
	MVI	B,13		; УЮЕФЮЙЛ УЙНЧПМПЧ.
LOAD_NAME_LOOP:			;
	CALL	GET_NOT_SINHRO	;
	DCR	B		;
	MVI	M,00h		; УФБЧЙН ЧТЕНЕОХА ЪБЗМХЫЛХ.
	RZ			; ЧЩИПДЙН ЕУМЙ ВХЖЕТ ЙНЕОЙ
	MOV	M,A		; РЕТЕРПМОЕО.
	INX	H		;
	ORA	A		; ЧЩИПДЙН ЕУМЙ ТЕБМШОПЕ ЙНС
	RZ			; ЪБЛПОЮЙМПУШ.
	JMP	LOAD_NAME_LOOP	;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;	рТПГЕДХТБ ПЦЙДБОЙС ЪБЗПМПЧЛБ ЖБКМБ "*.ASM"	;;
;;  рТПГЕДХТБ ПУХЭЕУФЧМСЕФ РПЙУЛ ОБ МЕОФЕ УФБОДБТФОПЗП	;;
;; ЪБЗПМПЧЛБ ФЕЛУФПЧПЗП ЖБКМБ Й ЧПЪЧТБЭБЕФ ХРТБЧМЕОЙЕ	;;
;; ДМС РТПЙЪЧЕДЕОЙС ЮФЕОЙС ЙНЕОЙ ЖБКМБ.			;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
WAIT_HEADER_ASM:		;
	PUSH	PSW		;
	PUSH	B		;
WAIT_H_LOOP_00:			;
	MVI	B,4		;
	MVI	A,YES_SINHRO	;
WAIT_H_LOOP_10:			;
	CALL	GET_REC_BYTE	;
	CPI	0E6h		;
	JNZ	WAIT_H_LOOP_00	;
	DCR	B		;
	MVI	A,NO_SINHRO	;
	JNZ	WAIT_H_LOOP_10	;
	POP	B		;
	POP	PSW		;
	RET			;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;    рТПГЕДХТБ ЮФЕОЙС ВБКФБ У НБЗОЙФПЖПОБ ВЕЪ уйоитп.	;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
GET_NOT_SINHRO:
	MVI	A,NO_SINHRO	;
	JMP	GET_REC_BYTE	;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;	рТПГЕДХТБ ЮФЕОЙС ВБКФБ У УЙОИТПОЙЪБГЙЕК		;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
GET_YES_SINHRO:
	MVI	A,YES_SINHRO	;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;	рТПГЕДХТБ ЮФЕОЙС ВБКФБ У НБЗОЙФПЖПОБ.		;;
;; чипд:	б = 0FFh - У РПЙУЛПН УЙОИТПВБКФБ	;;
;;		A = 008h - ВЕЪ РПЙУЛБ УЙОИТПВБКФБ	;;
;; чщипд:	б = РТПЮЙФБОЩК ВБКФ.			;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
GET_REC_BYTE:
	PUSH	B		; УПИТБОСЕН ТЕЗЙУФТЩ.
	PUSH	D		;
	MVI	C,0		; УЖПТНЙТХЕН ЪБЗПФПЧЛХ.
	MOV	D,A		; УПИТБОЙН РБТБНЕФТ.
GET_REC_LOOP:
	IN	01h		;
	ANI	10h		; ПЦЙДБЕН РЕТЕРБДБ ХТПЧОС
	MOV	E,A		; УЙЗОБМБ.
GET_REC_00:			; ( УЙОИТПОЙЪБГЙС РП ЖБЪЕ )
	IN	01h		;
	ANI	10h		;
	CMP	E		;
	JZ	GET_REC_00	; ГЙЛМ ЦЙДБОЙС.
	RLC			;
	RLC			;
	RLC			;
	RLC			;
	MOV	A,C		;
	RAL			;
	MOV	C,A		;
	LDA	GET_CONST	;РТПЮЙФБЕН ЛПОУФБОФХ ЮФЕОЙС
	CALL	WAIT_LOOP	;
	MOV	A,D		;
	ORA	A		;
	JP	GET_REC_NO_SINHRO;
	MOV	A,C		;
	CPI	0E6h		;
	JNZ	GET_REC_01	;
	XRA	A		;
	STA	GET_INVERSE	;
GET_REC_01:			;
	CPI	19h		;
	JNZ	GET_REC_LOOP	;
	MVI	A,0FFh		;
	STA	GET_INVERSE	;
	MVI	D,9		;
GET_REC_NO_SINHRO:		;
	DCR	D		;
	JNZ	GET_REC_LOOP	;
	LDA	GET_INVERSE	;
	XRA	C		;
	POP	D		;
	POP	B		;
	RET			;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;	рТПГЕДХТБ ЧЩЧПДБ ВБКФБ ОБ НБЗОЙФОХА МЕОФХ.	;;
;; чипд:	б = чЩЧПДЙНЩК ВБКФ.			;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
PUT_REC_BYTE:
	PUSH	D		; УПИТБОЙН ТЕЗЙУФТЩ
	PUSH	PSW		;
	MOV	D,A		;
	MVI	C,8		; УЮЕФЮЙЛ ВЙФПЧ.
PUT_REC_00:			;
	MOV	A,D		; УДЧЙОЕН
	RLC			; ФЕЛХЭЙК ВЙФ ВБКФБ
	MOV	D,A		;
	MVI	A,1		; УДЕМБЕН ЕЗП ЙОЧЕТУЙА
	XRA	D		;
	ANI	01h		; ЧЩДЕМЙН
	OUT	00h		; Й ЧЩДБДЙН Ч РПТФ
	CALL	PUT_REC_WAIT	; УДЕМБЕН ЪБДЕТЦЛХ.
	MVI	A,0		;
	XRA	D		; РТПДЕМБЕН ФПЦЕ УБНПЕ ОП ВЕ ЙОЧТУЙ
	ANI	01h		;
	OUT	00h		;
	CALL	PUT_REC_WAIT	;
	DCR	C		; ВЙФЩ ЛПОЮЙМЙУШ ???
	JNZ	PUT_REC_00	;
	POP	PSW		;
	POP	D		;
	RET			;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;	рТПГЕДХТБ ПТЗБОЙЪБГЙЙ ЪБДЕТЦЛЙ ДМС РТПГЕДХТЩ	;;
;; ЧЩЧПДБ ВБКФБ ОБ НБЗОЙФПЖПО.				;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
PUT_REC_WAIT:
	LDA	PUT_CONST	;
WAIT_LOOP:
	loop	A,WAIT_LOOP	;
	IN	01h		;
	ANI	40h		;
	JZ	REC_EXIT	;
	RET			;

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
HELP_TRANSEVER:
	LXI	H,DUMP_HELP	;
	LXI	B,DUMP_END_HELP-DUMP_HELP;
	MVI	E,'P'		;
HL_TRANS_00:
	MOV	A,M		;
	XRA	E		;
	MOV	M,A		;
	INX	H		;
	DCX	B		;
	DCR	E		;
	MOV	A,B		;
	ORA	C		;
	JNZ	HL_TRANS_00	;
	RET			;
HELP:
	CALL	HELP_TRANSEVER	;
	CALL	HOME		;
	LXI	D,000Ah		;
	LXI	B,DUMP_HELP	;
	CALL	PRSCREEN	;
	MVI	D,0Ch		;
	MVI	B,28h		;
HELP_LOOP_0:
	MVI	E,03h		;
	MVI	A,7Eh		;
	CALL	PUTCXY		;
	MVI	E,07h		;
	MVI	A,5Fh		;
	CALL	PUTCXY		;
	INR	D		;
	loop	B,HELP_LOOP_0	;
	CALL	HELP_TRANSEVER	;
	CALL	KEYDELAU	;
	CALL	HOME		;
	CALL	PRINT_POS	;
	RET			;
DUMP_HELP:
       DB     009h,020h,0F5h,0F3h,020h,02Bh,020h,03Ch
       DB     020h,0E3h,0C9h,0C6h,0D2h,0C1h,03Eh,020h
       DB     02Dh,020h,020h,0F7h,0D9h,0C2h,0CFh,0D2h
       DB     020h,020h,0D3h,0C5h,0D2h,0D7h,0C9h,0D3h
       DB     0CEh,0CFh,0CAh,020h,0C6h,0D5h,0CEh,0CBh
       DB     0C3h,0C9h,0C9h,02Eh,00Dh
	DB	009h,020h
       DB     0F3h,0F3h,020h,020h,02Dh,020h,0F7h
       DB     0D2h,0C5h,0CDh,0C5h,0CEh,0CEh,0C1h,0D1h,020h
       DB     0D3h,0CDh,0C5h,0CEh,0C1h,020h,0D2h,0C5h
       DB     0C7h,0C9h,0D3h,0D4h,0D2h,0C1h,020h,0CBh
       DB     0CCh,0C1h,0D7h,0C9h,0C1h,0D4h,0D5h,0D2h
       DB     0D9h,02Eh,00Dh
	DB	009h,020h,046h,035h
       DB     020h,020h,02Dh,020h,0F0h,0C5h,0D2h
       DB     0C5h,0CBh,0CCh,0C0h,0DEh,0C5h,0CEh,0C9h
       DB     0C5h,020h,020h,020h,0D2h,0C5h,0C7h,0C9h,0D3h
       DB     0D4h,0D2h,0C1h,020h,020h,0CBh,0CCh,0C1h
       DB     0D7h,0C9h,0C1h,0D4h,0D5h,0D2h,0D9h,02Eh
       DB     00Dh
	DB	009h,020h,046h,032h,020h,020h
       DB     02Dh,020h,0F5h,0C4h,0C1h,0CCh,0C5h
       DB     0CEh,0C9h,0C5h,020h,020h,020h,0D3h,0C9h
       DB     0CDh,0D7h,0CFh,0CCh,0C1h,020h,020h,022h
       DB     0D0h,0CFh,0C4h,020h,020h,0CBh,0D5h,0D2h,0D3h
       DB     0CFh,0D2h,0CFh,0CDh,022h,02Eh,00Dh

	DB     009h,020h,043h,043h,020h,020h,02Bh
       DB     020h,0F7h,0CCh,0C5h,0D7h,0CFh,02Fh,0F7h
       DB     0D0h,0D2h,0C1h,0D7h,0CFh,020h,020h,02Dh,020h
       DB     0EEh,0C1h,0DEh,0C1h,0CCh,0CFh,02Fh,0EBh
       DB     0CFh,0CEh,0C5h,0C3h,020h,0D3h,0D4h,0D2h
       DB     0CFh,0CBh,0C9h,02Eh,00Dh
	DB	009h,020h
       DB     0F3h,0F3h,020h,020h,02Bh,020h,0F7h
       DB     0D7h,0C5h,0D2h,0C8h,02Fh,0F7h,0CEh,0C9h
       DB     0DAh,020h,020h,02Dh,020h,020h,020h,022h
       DB     0ECh,0C9h,0D3h,0D4h,0C1h,0CEh,0C9h,0C5h
       DB     022h,020h,020h,020h,0D4h,0C5h,0CBh,0D3h,0D4h
       DB     0C1h,02Eh,00Dh
       DB     00Dh

	DB	009h,020h,020h,020h,020h,034h,037h,030h
       DB     037h,035h,020h,020h,020h,0C7h,02Eh,0EBh
       DB     0C1h,0D2h,0C1h,0C7h,0C1h,0CEh,0C4h,0C1h
       DB     020h,020h,028h,033h,032h,031h,032h,029h
       DB     020h,035h,032h,02Dh,038h,031h,02Dh,039h
       DB     035h,00Dh
	DB	009h,020h,020h,020h,0D5h,0CCh,02Eh
       DB     020h,020h,020h,034h,030h,020h,0ECh,0C5h
       DB     0D4h,020h,0EBh,0C1h,0DAh,0C1h,0C8h,0D3h
       DB     0D4h,0C1h,0CEh,0C1h,020h,020h,0C4h,02Eh
       DB     033h,039h,02Fh,033h,020h,020h,020h,0CBh
       DB     0D7h,02Eh,031h,00Dh
	DB	009h,009h,020h,020h
       DB     020h,020h,020h,0F0h,0C9h,0CDh,0C5h,0CEh
       DB     0CFh,0D7h,020h,0F0h,0C1h,0D7h,0C5h,0CCh
       DB     00Dh,0FFh
DUMP_END_HELP:
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;    вМПЛ УЙУФЕНОЩИ СЮЕЕЛ ДМС ТБВПФЩ У НБЗОЙФПЖПОПН	;;
F_FLAG:		DB	00h ; жМБЗ ПРЕТБГЙЙ У НБЗОЙФПЖ.
		;; 00 - ЮФЕОЙЕ ЖБМБ.
		;; 01 - РПДЗТХЪЛБ ЖБКМБ.
		;; 0FFh - ъбрйуш жбкмб.

PUT_CONST:	DB	32h ; лПОУФБОФБ ЪБРЙУЙ.
GET_CONST:	DB	4Bh ; лПОУФБОФБ ЮФЕОЙС.
GET_INVERSE:	DB	00h ; хЛБЪБФЕМШ ЙОЧЕТУОПК "УЙОИТП".
STACK_BUFER:	DW	'00'; ВХЖЕТ УПИТБОЕОЙС УФЕЛБ.
TMP_BUFER:	DW	'00'; ЧТЕНЕОЩК ВХЖЕТ.
ERROR_LOAD:	DB	'Error',0Dh
F_LOAD_OVER:	DB	'Overflom',0Dh
F_L_MESSAGE:	DB	'Scaning:  /us/ - '
F_INTERRUPT:	DB	'Interrupt',0Dh

	Public		F_LOAD	;
	Public		F_SAVE	;
	Public		F_MERGE	;
	Public		HELP	;

	External	F_INPUT_NAME	;
	External	F_F_ASCII	;
	External	PPASTART	;
	External	F_F_ASCII	;
	External	BTEXT		;
	External	MENU		;
	External	TEXT_LIMIT	;
	External	ENDTEXT		;
	External	WPUTS1		;
	External	WPUTSDOP	;
	External	NULL_POS	;
	External	PRSCREEN	;
	External	COPYS		;
	External	DLINNA		;
	External	PRINT_POS	;
	External	DOMOY		;
	External	UP		;
	External	DON		;

;;///////////// KD.ASM - дТБКЧЕТ ЛМБЧЙБФХТЩ //////////////

	External BEEP	; эЕМЮЕЛ.
	External INKEY	; ЧЪСФШ ЛПД ЙЪ ВХЖЕТБ
	External KEYRESET; УВТПУ ЛМБЧЙБФХТЩ
	External KEYDELAU; пЦЙДБЕФ ОБЦБФЙС.

	External FLAGC	; ЖМБЗ ГЧЕФПЗЕОЕТБФПТБ
	External COLOR	; ЛПД ГЧЕФПЧПК РБМЙФТЩ
	External RUSLAT	; УФБФХУ РП БМЖБЧЙФХ
;;;	External SMALL	; УФБФХУ РП ТЕЗЙУФТХ
	External KEYKOD; ДЙОБНЙЮЕУЛЙК ЛПД ЛМБЧЙЫ
	External SEEK	; ХЛБЪБФЕМШ ЪБРПМОЕОЙС

;;//////// WD.ASM - дТБКЧЕТ ПЛПООПЗП ЙОФЕТЖЕКУБ //////////

;========= ПУОПЧОБС ФБВМЙГБ РЕТЕИПДПЧ ==========
	External GETC	;ЮФЕОЙЕ УЙНЧПМБ -//-
	External ACTIV	;ПФЛТЩФЙЕ ПЛОБ (DE),(HL),Б-ЖМБЗ
	External DEACTI  ;ЪБЛТЩФЙЕ ПЛОБ
	External BORT	;ОБТЙУПЧБФШ ТБНЛХ
	External HOME	;ПФЮЙУФЛБ ПЛОБ
	External SCROL1	;УЛТПММЙОЗ ПЛОБ ЧЧЕТИ
	External SCROL2	;--//-- ЧОЙЪ
	External SCROL3	;--//-- ЧРТБЧП (ОБ 2 УЙНЧПМБ)
	External SCROL4	;--//-- ЧМЕЧП --//--
;;
;========== ДПРПМОЙФЕМШОБС ФБВМЙГБ РЕТЕИПДПЧ ==========
;ТЕБМЙЪХЕФ ФЕЦЕ ЖХОЛГЙЙ ОП ЙУРПМШЪХАФ БВУПМАФОЩЕ ЛППТДЙОБФЩ
;;
	External PUTCXY	
	External GETCXY	
	External RAMKA	;ЖМБЗ РЕТЕДПЧБФШ ОЕ ОХЦОП
	External TEN	;
	External CLS	
	External SCRN	
	External SCRV	
	External SCRP	
	External SCRL	
;;	External ABS_DE
	External LIIR
	External LDIR
;;	External HL_DE_WIND
;;	External HL_SUB_DE
	External ADDREM
	External ADDRSC	

;______________ ТБВПЮЙЕ СЮЕКЛЙ ________________
	External CURSOR
	External WIND1
	External WIND2
	External NUM
;;	External BUF_SEK
	External FLAGW

	END

D	
		DCR	C	
		JNZ	SH10	
		POP	H	
		POP	D	
		POP	B	
		MOV	A,H	
		ADI	20H	
		MOV	H,A	
		MOV	A,D	
		ADI	20H	
		MOV	D,A	
SH11:		CALL	LDIR	
		DCR	H	
		DCR	D	
		DCR	C	
		JNZ	SH11	
		RET		
SCH2:		PUSH	B	
		PUSH	D	
		PUSH	H	
SH20:		CALL	LIIR	
		INR	H	
		INR	D	
		DCR	C	
		JNZ	SH20	
		POP	H	
		POP	D	
		POP	B	
		MOV	A,H	
		ADI	20H	
		MOV	H,A	
		MOV	A,D	
		ADI	20H	
		MOV	D,A	
SH21:		CALL	LIIR	
		INR	H	
		INR	D	
		DCR	C	
		JNZ	SH21	
		RET		

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

;+----------[ CURSOR ABSOLUTE ]---------+
;*	ЧИПД:	DE -> ПФОПУЙФ.ЛППТД.	*
;*	ЧЩИПД:	DE -> БВУПМ`ФОЩЕ ЛППТД.	*
;+--------------------------------------+

ABSJDE:		PUSH	PSW	
		PUSH	H	
		LHLD	WIND1	
		MOV	A,D	
		ADD	H	
		MOV	D,A	
		MOV	A,E	
		ADD	L	
		MOV	E,A	
		POP	H	
		POP	PSW	
		RET		
;+-----[ РТПХЕДХТБ ПФЮЙУФЛЙ ПЛОБ ]------+
;*	ЧИПД:	DE,HL -> WINDOW COORD	*
;+--------------------------------------+
CLS:		PUSH	B	
		PUSH	D	
		PUSH	H	
		PUSH	PSW	
		                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              @ 
 Ђ P  ЃR @ B                                                                                                            ю?  Ђ р   p  я? ря я    ш аяЂя я Ђя я  |    я? xx`рр а    ь ряАяА   яАя я ю <а я ю? ь ` ьАяАя ш @  юая ш юр  ю р юЂя ь  ю р? яЂя ш  шАя ь? яа 0А юАяа ю   ьая ш? юА  А ю юАя     яряЂя ю   р бяая ю    я шя А      ь  А      Ђ    €ў    P(  @ђ B   0„# D  „@A   „   @   @      
                                                               @   Ђ Ђ  р   рЂ  ЂАЂ   ш а            я я Ђ  Ђя  Ая ая    ю  я Ђя    Ђя ая шя     ря  юя Ђя     шя  я? Ая     шя  яя  я     шя  ря ря    шя  я        Ђя                                                                                                                     Ѓ    D ‘$&’D$	 D @ !ЃЂD   $  ‘`Њ                                Ђя Ђя     я ря ю? ш   ш ря Ђя Ђ?    ь я  ? а    ь П   F      юЂ Аш;      Ђяp        ь  Ђ`        ю           ~ю                         Ђ                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      Ѓ @Ђ$Hђ$$€J  $ђ @	”H)  ‚B ў

‘„‚  Љ HA+ ‘Ѓ(
ЂP…
 T J)P(                           ря  ю?    Ђя Ђя  ф    Ая  я‡      Ая  ю      Ая  юя x    а Ђя? я    ь шяш А Ђя Аяая Ђ?  яАя р ю  яа? ьа  Ђ юа? я а шА? юр а  ьр  рА     ю шра а  ьря шА юря ь   Ђя ь?    ьЂя     АяP     ря     Ая     Ая?      Ђяя      Ая      я?      Ая       яя      Ђя       ья     Ђя ь    ю? р   АяЂя 0   я яр  ь? ь   ЂяАяЂ  Аяря ш  р ь ш  ая ш? Ђ   Аяая а    ь аз     я шя      ю? ря `     ю ю ь    я я я ю?  яЂя я >  ш? ш аяая  АяАя я ю  р? шя Ђя я  р Ая ш? р    я шя ю А   шя П  ?      я? ршА       рп          я  А     P! Ая  8     Ђ ря  8р        ш             шї              я             Ая              А      Р~ 8  ья  яя | б  я? Ая ь? ш  шяЂя шя я | ю? шя Ая ь? АЂя я шяЂя 0 ш? ря юяр    я ья шяа   ая  юя ряа  Ая  шя Аяа   ря  ья р рЂ   ю Ая ЂяЂя   ря  я ья ю 0 я ю ь?  я  ш ш? ш? ш @  ш? ь юЂ ь   ь? юЂярА?  ЂяАя р?Ђ p  ю яа А |  яАя р ьЂ ая ш? юЂя   Ђяр ш? я   Ђяая Ая  Ђ Ђю    @ @     ья  ю 0   ая я?  я  Ђя я яяЂ ю шя Ая   ь? ря ь   ш ая а   ш Ая Ая   ш? Ая Ая  ш? Ђя Ђя  ь Ая Ая   ю ая р   я шя ю  Ая я? Ђя  ря Ая ш?   ь шя  ю  Ђя я ш?  ая ая ш   ю ю  я  Ђя юя а   Ђя ЂП                                                                                                      ь ь       Ђ                                                                                                                                                           шьа? яр? я”? р @|А  а рЂ ь? ю Ђаюр? яшр ЂаАяьрЃ | ааая я|а  >шр? я ь Ђ ?ра?Ђя я ш > юр?pА     ььшЃ        яА    ~ЂрЂ     ш ~ ю ?  шx  Ђ ~ А  `р   | |чш А я    р  шА                                                                                                                                 "шЂ@p 0            юЂя яА  р? ю юАя  Ђя ш шЂя<   ьЂяр ьр  А ь яА?    ьЂяр ьр   я ш ьЂ |  ар я яш     юаяЂяЂ   Ђя ря ья а    ю                                                                                                                А          Ђ         А                                 Ая       Ая  АяЂ       яя   я_       ря  ря       шя  ья А      ря  юя Ђ      ая  я  ю  ю  Ђя?  яя  шя  ш  ья ая ая Ая  ья шя шя И   ря ая ря? А    ш  ья  юя      я Ђя  яя     Ая Ая  яя      ая  я  ь?       шя  я   ю         f                                                                                                            `      @† @„ 1cД(@@"33‰Њ1	 Cд™1cfЖ€!fД1bОњ1#ЙDF 1„Ња fЊЂ@„@Ж€!"#bbЊЊ † В9ЃБЊaDЖ8†b0А8cаѓaLЊqЗ8Зp†Ѓ В  Ђ   Ђ      Ђ          ш  шя ая  И                а                                                                                                              Ђю              8      0  @А      0800       @                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          @                                                                Ђ                                                                                                                                                                                                                                                                                                                                                        Ая  0                                  А р         Ђ            Ђ       р<А `     р? Ђя      р а? а Ая юя я  Ая  шя я  ю Ая ь  ья Ая? ря  ь Ая ря  ю?  я? А? Ђя  я    ря А    Ђяя ш   Ђяя р    ья ая    ья? Ая    ряя Ђя   Аяя  я   Ђяџ ю   Ђя? ь   Ђя?  ь   аяю?    рЂя  рЂя < шА   я ша    ьр  Ђ юь | а? я ю < А? яю @ А яш    яюБpа  рш ь    ья?  ю     юя  >@    шя?  @      яя        Ђ?ю          ья         Ђ|          а‡   `   Ая ЂррА  ш Аяя р? А ь ья ю А  ь яЂАяp<  ьѓxшАЂ     ря   <`|  я Ђяя ш? А ш яЂя я  я р ьА  ь  ш яш  Ђ ьЂяь  А? юАя ь Аа яр ю арАяр? я Аьаяр? я аьая а ь   ю ю?юЂ    ю  яяЂя    я Аяя     я Ђяя њ   ь?  аяя  >  Аяw  ья Ар   ая  ю а    ш? Ђяаю АЏ   ая р? АяЂя    ь ю я? ш   АяАя ар ю    аяЂя а     шя  ЂА ш      ря    я      ря?    ю      ья   Ђя      шя?    я      ря?    ш       яя   ря       ая?   ?       юя  юшЂбЂ?    Ая а юшш    а ш  ра   Ђя а шЂя      юЂАБаьр   а? шю ьяшЂ  р ь  ря~     юЂ р ?ю Я   юА р  яя      Ђя АЃ   а       юз             Ая?      а?      ая      А      ря       о     Ђя              ря       Ђ?      ая  ‡    ья Ђ    р? ь ц аяь    ря ь ю        юАя ш юш рр   яА я Ђ        а юАя Ђ        а                а                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  А      |  >    А  ь  ш     Ая?  я    я  ряЯ  т?  ряЏ  яя  ая  яя 0яя  Ая Шя; @ья  ш шяw  Ая  ь  Ђэя  °c       ья           а            @                                                    т           ря          аяП  ря      Ђя Аяя `  яя  яя Ђ?  ряп  ря  ь Ая? Ая  а  шяg  яя    @ ья а     Ђ@ K   Q `Ђ€‚ђ$I"’ґђDЩ%D6Йd’Мf™L™&›D‰&љdІНd‘М2Y&іJ@(’€€$d’lЃ  Ђ  L”PeМ€: @€Њ †Ё(3A¦’Ђ		"`6$Ќђ‘`ўЂ€$QРDQA”P‰€rЃЊH $‘b+D3‘d2lѓЂ !Ђ 2aDИ A&€А‡@   А        юя ь     яЂя ю? ь   р ь? ш р? ш  юр ш ь я  ьАяря шЂя   юая р? юА а Ая ш? юЂя ш | Ђяря ш? ьЂя    яЂяЂя я     я я ая ь     я  я            ш0                А               а              Ђб                Ђ                                          @              Аш                              Ђ        А     `          ю           ша  x                        я  xр `     р?  я  ?      А Ђя я ш p  ь ю ю?ЂГ ш р я яАя ш    я ш юЂяа? р  рАя ш яА а   я ьЂя р я     юшА? юА    аа? я рЂ    шр ?  Ђ    ша ?Ђ      ьшЂю<    рА ?ь |    рА я? ? p  я ьаяшА ша я  А шАЂ < ш  ь шрАЂ Ђ рАААюш~   x 0 ь Ђ      ьЃ       8                                                                                                                                                                                                                                                                                                                                                                                                                                                         я                         я       юА ьр юp    Ђя           яр ю  ь  ая   яь ь |   ш аЂаа  ая а ш    я`Ђя  ьа  я а  я  ш  я ряАя а  ю шя я ю?  ш ря я? а?   яЂьяая ю  аЂя юяЂя      Ая Ая    а   Ашь а@4	 А $ђЂN ‘
$Y&Њ"‘l$DЁ ‰Ђ$@ЂH@A ™$3 *ђ"‘L¦L‰D P!I– 	$D!Ш$‰Ф(‘$B"M*d©И@“LvSih2‘B™(3Ѓ$™Lf“Мcў€Йd™ Z`2*DЂЂ !И @&™ "           ая аяз      ю  я   ю     ья      ь     яя     Ђя     юя     Ђ      ья  `  Ая     Аяя     ш       яя    А           р  `   <ЂЂра>аАГ шЂ @АЂ( ђ	$RЂ% ± $BЂВ­  A   
”¤	`ЃJ‚	&	ЄЕTP°Щ`@‘@ 2$ЂЂЂ#@   @ ђ                                                                                 <               Ђ                р? шяая    яаяЂяАя Ђ?  Ая ря АяАяА  р шя ая ая а  ря ря Ая ш 8  ря ая юя я   ая ю Ђя? а?   ря  Ая  я      а?а             ЂџA              а               Ђ               ж	              Ья               аwM  @Ђ 	аю `Ж      @яя	 аяя  0   Ая?  ья?      шя Ая       Ђя  яя  џ    я?  я? р    Ая яЂя     яЂяАя     ЂяЂяр?     ря рэая     Ђя ю     я?~  ая    юя  А    я   А    Ђя   А     я?   а     ю?   ю    Ђя?   0      Ая      ья   а       р        иа          ,                 Ђ                                                                                                                                                                                                                                                                                                                я        яя             яя   b        яя             ®                    АА                                      ‰     ‘`  $ ‘ыg  P#‰"ЂD шяG  ьg       яя  Аяя      Ђя?  шяя      Ая?  ьяя       Аяя  шяѓ9      ья Ђя       Ђя?  юїЂ      ая Ђя а      шя ря я      ю?  я? шя     аяЂя Ая     я я  ю     р р ш ь     ш? ш@x  ш     шя      Ая    Ђяя       я      юя      ю     шя     шw     ая      Ђ      яя      pю    яАа xя      яА ь8Ђбя    Ђ р я АПя@   Ђ р ь Ђ?ю8   аАэ8я Аяр    я яАяряр  Ђ яаььа   яА? рьА  Ђ р ьс    ь 8Ая     р ьрЃ   А, ш ь    ¤@ђ A‚ЂЃ"HP $$љ$@I&@$’MH$ $BJЂ‰ђ B”(@‚-Тґ!h‚Ђ-$Т%ђi’I$Тe’)&i’$‚ 
$$  ђЃH@ $D H‚I                                                                                     А @ Гю `   0              ря аяА  АяАя я я Ая Ая я ю  я я? шя а  ря Ая ш Ђя  шя ья        ююя             р                                                                                                                                           ;>  Ђ АБ ?0АА    аА     Ђя шя я  ая  я ья  я   Ђя я ь р Ђ Ђя я ю? ю ю рЏяая ая аяр?    яая ря шя р? ~  юАяАя ря р    ая ш? ь юАяАя   ш я я яа     ая ш ая Ая ша   Ђяая ю ря |    ю ря ь? Ђя      ш?                                                                                                          ЂЂ  Ђ P „Ѓ   ! @ @"H         H   `       А      ЂЂ   ЂБ   Ђ                     Ђ                                                Ђ                                                                                                                                                                                                                                                           А @ Гю `   0              ря аяА  АяАя я я Ая Ая я ю  я я? шя а  ря Ая ш Ђя  шя ья        ююя             р                                                                                                                ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
PUT_REC_WAIT:
	LDA	PUT_CONST	;
WAIT_LOOP:
	loop	A,WAIT_LOOP	;
	IN	01h		;
	ANI	40h		;
	JZ	REC_EXIT	;
	RET			;

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;HELP:
;	CALL	HOME		;
;	LXI	D,000Ah		;
;	LXI	B,DUMP_HELP	;
;	CALL	PRSCREEN	;
;	MVI	D,0Ch		;
;	MVI	B,28h		;
;HELP_LOOP_0:
;	MVI	E,03h		;
;	MVI	A,7Eh		;
;	CALL	PUTCXY		;
;	MVI	E,07h		;
;	MVI	A,5Fh		;
;	CALL	PUTCXY		;
;	INR	D		;
;	loop	B,HELP_LOOP_0	;
;	CALL	KEYDELAU	;
;	CALL	HOME		;
;	CALL	PRINT_POS	;
;	RET			;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;    вМПЛ УЙУФЕНОЩИ СЮЕЕЛ ДМС ТБВПФЩ У НБЗОЙФПЖПОПН	;;
F_FLAG:		DB	00h ; жМБЗ ПРЕТБГЙЙ У НБЗОЙФПЖ.
		;; 00 - ЮФЕОЙЕ ЖБМБ.
		;; 01 - РПДЗТХЪЛБ ЖБКМБ.
		;; 0FFh - ъбрйуш жбкмб.

;; PUT_CONST:	DB	32h ; лПОУФБОФБ ЪБРЙУЙ.
;; GET_CONST:	DB	4Bh ; лПОУФБОФБ ЮФЕОЙС.
GET_INVERSE:	DB	00h ; хЛБЪБФЕМШ ЙОЧЕТУОПК "УЙОИТП".
STACK_BUFER:	DW	'20'; ВХЖЕТ УПИТБОЕОЙС УФЕЛБ.
TMP_BUFER:	DW	'07'; ЧТЕНЕОЩК ВХЖЕТ.
ERROR_LOAD:	DB	'Error',0Dh
F_LOAD_OVER:	DB	'Overflom',0Dh
F_L_MESSAGE:	DB	'Scaning:  /us/ - '
F_INTERRUPT:	DB	'Interrupt',0Dh

BTEXT:
	DB	CR,CR,CR
TEXT_END:
	DB	STOPBYTE

VERSION:
;;;	DB	6,7,' Version 2.00 for ROM present by Pimenov Pavel ',7,8,CR
	DB	6,7,' ',0F7h,0C5h,0D2h,0D3h,0C9h,0D1h,' 2.00 ',7,8,CR
	DB	6,7,' ',0F0h,0C9h,0CDh,0C5h,0CEh,0CFh,0D7h,' '
	DB	0F0h,0C1h,0DBh,0C1h,' ',0D0h,0D2h,0C5h,0C4h,0D3h
	DB	0D4h,0C1h,0D7h,0CCh,0D1h,0C5h,0D4h,' ',7,8,CR
POD1:		DB	6,7,' 00000/000 Mode:Edit ',7,8,CR
		DB	6,7,' Text1 :noname  .txt ',7,8,CR
		DB	15,'1- Block',15,' 2-File ',15,' 3-Goto '
		DB	15,'4-Search',15,'5-Servis',15,' 6-Info '
		DB	15,'7-Delete',18,CR
		DB	'Message:',CR
;;;		DB	15,'8- Block',18,CR ;ДМС УМЕДХАЭЙИ ЧЕТУЙК
		DB	6,7,7,8,CR


;ЛБТБЗБОДБ 06.01.94З
AVT:	DB	31,0EAH,0C0H,0D1H,0C0H,0C6H,0C0H,0CDH
	DB	0C3H,0C0H,31,2Fh,'5',2Dh,2Fh,'0',2Dh
	DB	'83',0C6h,31
;+-------[ INVERS ]-----+
;* ЙОЧЕТФЙТХЕФ ЬЛТБО ПФ *
;* (HL) -ЧЩУПФБ:(D)	*
;* 	-ЫЙТЙОБ:(Е)	*
;+----------------------+
INV:		PUSH	B	
		MOV	B,D	
		MOV	C,E	
		CALL	IV2	
		MOV	A,H	
		ADI	20H	
		MOV	H,A	
		CALL	IV2	
		POP	B	
		RET		

IV2:		PUSH	H	
IV1:		PUSH	H	
IV0:		MOV	A,M	
		CMA		
		MOV	M,A	
		INR	L	
		DCR	E	
		JNZ	IV0	
		POP	H	
		MOV	E,C	
		INR	H	
		DCR	D	
		JNZ	IV1	
		MOV	D,B	
		POP	H	
		RET		

;; HL -ПФЛХДБ
;; DE -ЛХДБ
;; BC -УЛПМШЛП.
REMOVE:
	MOV	A,M	;
	STAX	D	;
	INX	H	;
	DCX	B	;
	INX	D	;
	MOV	A,B	;
	ORA	C	;
	JNZ	REMOVE	;
	RET		;
;;;;;;;;
PPASTART:
;;
;;   пУХЭЕУФЧМСЕН ЛПОФТПМШ ЛПОФТПМШОПК УХННЩ ЖБКМБ
;;
		DI			;
		MVI	A,0C3h		;
		STA	0038h		;
		LXI	SP,STACKSEG	;
		XRA	A		;
		OUT	10H		;
		LXI	H,EDITING	;
		PUSH	H		;
		LXI	D,1800h		;
		PUSH	D		;
		POP	B		;
PPA_CONTR_LOOP:
		MOV	A,M		;
		ADD	B		;
		MOV	B,A		;
		INX	H		;
		MOV	A,C		;
		SUB	M		;
		MOV	C,A		;
		DCX	D		;
		INX	H		;
		MOV	A,D		;
		ORA	E		;
		JNZ	PPA_CONTR_LOOP	;
		PUSH	B		;
		POP	H		;
VZLOM_CONTR:
		NOP			;
		NOP			;
		NOP			;
		SHLD	0002h		;
		LXI	H,IM_ZG		;
		LXI	B,1000h		;
		LXI	D,0E000h	;
		CALL	REMOVE		;
		CALL	SCREENCLS	;
		LXI	H,KEY_INT	;
		SHLD	0039H		;
		LXI	H,76F3h		;
		SHLD	0000h		;
		EI			;
;;;;;;;;;;; вМПЛ РТПТЙУПЧЛЙ ЪБУФБЧЛЙ »»»»
		LXI	H,MEMU
		MVI	D,20H
		LXI	B,400H
EMGLS:		MOV	M,D
		INX	H
		DCX	B
		MOV	A,B
		ORA	C
		JNZ	EMGLS
		LXI	D,102H	
		LXI	H,3E0FH
		CALL	BORT	
		DCR	L	
		CALL	BORT	
		MVI	D,3	
		DCR	L	
		XCHG		
		MVI	B,11	
		CALL	STL2	
		MVI	A,9CH	
		LXI	D,10EH
		CALL	PUTCXY	
		MVI	D,3EH	
		MVI	A,89H	
		CALL	PUTCXY	
		LXI	D,2902H
		LXI	B,VERSION
		CALL	W_INX_PUTS
		MVI	D,05h
		CALL	W_INX_PUTS
		LXI	D,50EH	
		CALL	W_INX_PUTS	
		MVI	D,21H	
		CALL	W_INX_PUTS	
		MVI	A,0F8H		; ъБЦЗЕН ЙЪПВТБЦ.
		STA	COLOR+1		;
		XRA	A		;
		STA	FLAGC		;
		LXI	H,3F0FH	
		SHLD	WIND2	
		LXI	H,0	
		SHLD	WIND1	
		MOV	D,H	
		MOV	E,L	
		CALL	INFO	
		PUSH	B	
		LXI	D,50FH	
		CALL	W_INX_PUTS	
		POP	B	
		MVI	D,36H	
		CALL	W_INX_PUTS	
		LXI	H,AVT0	
		PUSH	H	
		LXI	H,AVT+20
		LXI	B,1715H	
BL8:		LXI	D,70FH	
		CALL	SPPAR	
		MOV	A,M	
		INR	A	
		CALL	PUTCXY	
		DCX	H	
		XTHL		
		MVI	D,20H	
		CALL	SPPAL	
		MOV	A,M	
		INR	A	
		MVI	D,37H	
		CALL	PUTCXY	
		INX	H	
		XTHL		
		DCR	C	
		JNZ	BL8	
		POP	H	
		LXI	H,203H	
		SHLD	WIND1	
		LXI	H,3D0DH	
		SHLD	WIND2	
		RET		
;+-------[ INFO ]-------+
;* ЧЩДБЕФ 'РПДЧБМ'	*
;+----------------------+
INFO:		CALL	W_INX_PUTS	
		INR	E
		MVI	D,1	
		CALL	W_INX_PUTS	
		LXI	H,0A001H
		LXI	D,200EH	
		CALL	INV	
;;		INX	B
;;		LXI	D,3601h
;;		CALL	W_INX_PUTS
;;		LXI	H,0BB11h
;;		LXI	D,050Eh
;;		CALL	INV
		RET		
;;; дПРПМОЙФЕМШОБС РТПГЕДХТБ ;;;
W_INX_PUTS:
	CALL	WPUTS1
	INX	B
	RET
;PPA-EDITOR
AVT0:		DB	31,0BCH,0BDH,0BEH,31,'OO@',31,'Sdws',31
		DB	'Dchsnq',31
;+------[ SPPAR ]-------+
;* УДЧЙЗБЕФ ПФ (DE) (B)	*
;* ЬМЕН. УФТПЛЙ Ч РТБЧП *
;+----------------------+
SPPAR:		PUSH	D	
		PUSH	B	
		PUSH	PSW	
		MOV	A,D	
		ADD	B	
		DCR	A	
		MOV	D,A	
SP0:		DCR	D	
		CALL	GETCXY	
		INR	D	
		CALL	PUTCXY	
		DCR	D	
		DCR	B	
		JNZ	SP0	
		POP	PSW	
		POP	B	
		POP	D	
		RET		
;+-----[ SPPAL ]--------+
SPPAL:		PUSH	D	
		PUSH	B	
		PUSH	PSW	
SL0:		INR	D	
		CALL	GETCXY	
		DCR	D	
		CALL	PUTCXY	
		INR	D	
		DCR	B	
		JNZ	SL0	
		POP	PSW	
		POP	B	
		POP	D	
		RET		
IM_ZG:
	END
 INFO ]-------+
;* ЧЩДБЕФ 'РПДЧБМ'	*
;+----------------------+
INFO:		CALL	W_INX_PUTS	
		INR	E
		MVI	D,1	
		CALL	W_INX_PUTS	
		LXI	H,0A001H
		LXI	D,200EH	
		CALL	INV	
;;		INX	B
;;		LXI	D,3601h
;;		CALL	W_INX_PUTS
;;		LXI	H,0BB11h
;;		LXI	D,050Eh
;;		CALL	INV
		RET		
;;; дПРПМОЙФЕМШОБС РТПГЕДХТБ ;;;
W_INX_PUTS:
	CALL	WPUTS1
	INX	B
	RET
;PPA-EDITOR
AVT0:		DB	31,0BCH,0BDH,0BEH,31,'OO@',31,'Sdws',31
		DB	'Dchsnq',31
;+------[ SPPAR ]-------+
;* УДЧЙЗБЕФ ПФ (DE) (B)	*
;* ЬМЕН. УФТПЛЙ Ч РТБЧП *
;+----------------------+
SPPAR:		PUSH	D	
		PUSH	B	
		PUSH	PSW	
		MOV	A,D	
		ADD	B	
		DCR	A	
		MOV	D,A	
SP0:		DCR	D	
		CALL	GETCXY	
		INR	D	
		CALL	PUTCXY	
		DCR	D	
		DCR	B	
		JNZ	SP0	
		POP	PSW	
		POP	B	
		POP	D	
		RET		
;+---W
		JMP	BOT01
BOTEXIT:	POP	PSW
		RET

;		INCLUDE	US.ASM
; ;
; ; рТПЗТБНОЩК НПДХМШ ПВТБВПФЛЙ рбоемек ТЕДБЛФПТБ: PPA-Editor
; ; ( ху + ГЙЖТПЧБС ЛМБЧЙЫБ ПУОПЧОПК ЛМБЧЙБФХТЩ )
; ; РПУМЕДОСС ЛПТЕЛГЙС : 7.1.1993
; ;
;;
SERVIS:		LXI	D,0819H		; ПФЛТПЕН ПЛОП Й РТПЙЪЧЕДЕН
		LXI	H,191BH		; ЧЩЧПД УППВЭЕОЙК 
		CALL	US_OPEN		; РПУМЕ ЬФПЗП РТПЙЪЧПДЙН ЧЩЪПЧ
					; "ПЖЙГБОФБ"
		LXI	D,202H		; ЛПФПТЩК ПРТЕДЕМСЕФ РП УТЕДУФЧПН
		LXI	B,SV_SOOB1	; НЕОА ,ФП ЮФП ОЕПВИПДЙНП
		CALL	W_DOP_INX	; РПМШЪПЧБФЕМА
		DCR	E		;
		CALL	W_DOP_INX	;
		DCR	E		;
		CALL	W_DOP_INX	;
SV_POVT2:				;
		CALL	MENU		;
		CPI	0Eh		; Key F4 ???
		CZ	W_Close		;
		RZ			;
		LXI	D,SV_POVT2	; хУФБОПЧЙН ЧПЪЧТБФ.
		PUSH	D		;
		ORA	A		; "лПОУФБОФЩ" ???
		JZ	SV_CONST	; 
		DCR	A		; "гЧЕФ" ???
		JZ	SV_COLOR	; ЕУМЙ ДБ ФП ====//=====
;;
;; пВТБВПФБЕН ЧЩВПТ ТЕЦЙНБ РЕТЕЛПДЙТПЧЛЙ ЙУИПДОПЗП ФЕЛУФБ
;;

SV_TEXT:	LXI	D,1016H		;
		LXI	H,3219H		;
		MVI	A,16H		;
		CALL	US_OPEN + 2	;
		LXI	D,2115H		;
		MVI	A,091H		;
		CALL	Put_XY_Char	;
		MVI	A,83H		;
		MVI	C,4		;
SV_00:		INR	E		;
		CALL	Put_XY_Char	;
		DCR	C		;
		JNZ	SV_00		;
		INR	E		;
		MVI	A,092H		;
		CALL	Put_XY_Char	;
		LXI	D,404H		;
		LXI	B,SV_TS1	;
		CALL	W_DOP_INX	;
		MVI	D,17H		;
		CALL	WPUTSDOP	;
		LXI	D,203H		;
		LXI	B,SV_TS0	;
		CALL	SV_PRINT	;
		INX	B		;
		LXI	D,201H		;
		CALL	SV_PRINT	;
		INX	B		;
		LXI	D,0C03H		;
		PUSH	B		;
		CALL	SV_PRLR		;
		POP	B		;
		LXI	D,1E03H		;
		CALL	SV_PRLR		;
		LXI	H,2019H		;
		SHLD	W_2Window	;
		CALL	MENU		;
		CPI	0EH		;
		CZ	W_Close		;
		RZ			;
		LXI	D,1016H		;
		PUSH	PSW		;
		ADD	E		;
		MOV	E,A		;
		MVI	A,8		;
		CALL	Put_XY_Char	;
		LXI	H,3219H		;
		SHLD	W_2Window	;
		LXI	H,2216H		;
		SHLD	W_1Window	;
		POP	B		;
SV_TLOOP:	PUSH	B		;
		CALL	MENU		;
		CPI	0EH		;
		CZ	W_Close		;
		POP	B		;
		RZ			;
;;
;;  рПМХЮЙМЙ ДБООЩЕ П РЕТЕЛПДЙТПЧЛЙ ФЕЛУФБ
;;
					; C - РЕТЧЩК ЧЩВПТ
		MOV	C,A 		; B - ЧФПТПК ЧЩВПТ
		CMP	B		;
		JZ	SV_TLOOP	;
		LXI	D,2216H		;
		ADD	E		;
		MOV	E,A		;
		MVI	A,8		;
		CALL	Put_XY_Char	;
		LXI	H,1016H		;
		SHLD	W_2Window	;
		LXI	D,2815H		;
		LXI	H,3915H		;
		CALL	S_ARE_YOU	; чЩ ХЧЕТЕОЩ
		CNZ	W_Close		;
		RNZ			;
;;
;; рТЙУФХРЙФШ Л РЕТЕЛПДЙТПЧЛЕ ФЕЛУФБ
;;
		MOV	A,C		;
		MOV	C,B		; BC - йОДЕЛУ ЛПДБ РПЙУЛБ
		MVI	B,0		;
		LXI	H,SV_COD	;
		PUSH	H		;
		DAD	B		;
		MOV	D,M		; D - оБЮБМШОЩК ЛПД РПЙУЛБ
		MOV	C,A		;
		POP	H		;
		DAD	B		;
		MOV	E,M		; E - оБЮБМШОЩК ЛПД ЪБНЕОЩ
		MOV	A,D		;
		ADI	20H		;
		MOV	B,A		; B - лПО. ЛПД РПЙУЛБ
		ORA	A		;
		MVI	A,0D2H		; ЛПД ЛПНБОДЩ JNC
		JNZ	SV_02		; ОЕ ЪБНЕОСЕН ЛПНБОДХ
		MVI	A,0DAH		; ЛПД ЛПНБОДЩ JC
SV_02:		STA	SV_ALT		;	
		LXI	H,BTEXT + 1	;
SV_01:		INX	H		;
		MOV	A,M		;
		CPI	STOPBYTE	;
		JZ	SV_1TEXIT	;
		CMP	D		;
		JC	SV_01		;
		CMP	B		;
SV_ALT:		JNC	SV_01		;
		SUB	D		;
		ADD	E		;
		MOV	M,A		;
		JMP	SV_01		;

SV_COD:		DB	0C0H		; УФТПЮОЩЕ ТХУУЛЙЕ
		DB	060H		; УФТПЮОЩЕ МБФЙОУЛЙЕ
		DB	0E0H		; РТПРЙУОЩЕ ТХУУЛЙЕ
		DB	040H		; РТПРЙУОЩЕ МБФЙОУЛЙЕ

SV_1TEXIT:	STA	OFSET		;
		CALL	W_Close		;
		CALL	W_Close		;
		POP	PSW		;
		CALL	DOMOY		;
		RET			;
;;
;;  рТПГЕДХТБ ЧЩЧПДБ ЪБРТПУБ: чЩ ХЧЕТЕОЩ ???
;;		
S_ARE_YOU:	PUSH	B		;
		MVI	A,17H		;
		CALL	W_Open		;
		CALL	YESNO		;
		LXI	D,200H		;
		LXI	B,SV_TS2	;
		CALL	WPUTSDOP	;
		CALL	KEYDELAU	;
		POP	B		;
		LDA	Key_Number	;
		CPI	57		; лМБЧЙЫБ "Y" ???
		CALL	W_Close		;
		RET			;

SV_PRLR:	PUSH	B		;
		CALL	W_DOP_INX	;
		DCR	E		;
		CALL	WPUTSDOP	;
		POP	B		;
		DCR	E		;
		CALL	W_DOP_INX	;
		DCR	E		;
		CALL	WPUTSDOP	;
		RET			;

SV_PRINT:	PUSH	B		;
		CALL	WPUTSDOP	;
		POP	B		;
		PUSH	B		;
		MVI	D,14H		;
		CALL	WPUTSDOP	;
		POP	B		;
		PUSH	B		;
		DCR	E		;
		CALL	WPUTSDOP	;
		POP	B		;
		MVI	D,2		;
		CALL	WPUTSDOP	;
		RET			;

;; пВТБВПФБЕН ЧЩВПТ ТЕДБЛФЙТПЧЙОЙС ГЧЕФБ РЕТЕДОЕЗП РМБОБ
;; ДМС ЬФПЗП ДПРПМОЙФЕМШОП ПФЛТПЕН ПЛОП Й РТЙ РПНПЭЙ ЛМБЧЙЫ
;; ХРТБЧМЕОЙС ЛХТУПТПН РТПЙЪЧЕДЕН ЛПТЕЛГЙА СЮЕКЛЙ COLOR
;; ЙЪ ВМПЛБ ТБВПЮЙИ СЮЕЕЛ РПДРТПЗТБННЩ ПВТБВПФЛЙ ЛБДТПЧПЗП
;; РТЕТЩЧБОЙС - ДТБКЧЕТ ЛМБЧЙБФХТЩ.
;;
SV_COLOR:	LXI	D,1417H		;
		LXI	H,1C18H		;
		MOV	A,E		;
		CALL	W_Open		;
		LXI	D,201H		;
		LXI	B,SV_SOOB2	;
		CALL	W_DOP_INX	;
		DCR	E		;
		CALL	WPUTSDOP	;

SV_POVTOR:	CALL	MENU		;
		CPI	0EH		;
		CZ	W_Close		;
		RZ			;
		MOV	B,A		;
		XRA	A		;
		CALL	SV_VARIAL	;
		JMP	SV_POVTOR	;
;;
;;	B - оПНЕТ ВБКФБ ЛПФПТЩК ОЕПВИПДЙНП ЙЪНЕОЙФШ.
;;	A - РПДРТПЗТБННБ ЙЪНЕОЕОЙС ГЧЕФБ ФП 0
;;	    ЙОБЮЕ ЙЪНЕОЕОЙЕ ЛПОУФБОФ ЮФЕОЙС-ЪБРЙУЙ
SV_VARIAL:
		PUSH	PSW		;
		PUSH	B		;
		LXI	D,1716H		;
		LXI	H,2E16H		;
		MVI	A,16H		;
		CALL	US_OPEN + 2	;
		LXI	B,SV_SOOB3	;
		LXI	D,100H		;
		CALL	WPUTSDOP	;
		POP	B		;
		POP	PSW		;
		STA	KORBUF		;
		ORA	A		;
		LHLD	COLOR		;
		JZ	SV_LOOP		;
		LHLD	PUT_CONST	;
SV_LOOP:
		LDA	KORBUF		;
		ORA	A		;
		JNZ	SV_V_10		;
		SHLD	COLOR		;
		JZ	SV_V_00		;
SV_V_10:	SHLD	PUT_CONST	;
SV_V_00:	XRA	A		;
		STA	Flag_Color	;
		LXI	D,SV_LOOP	;
		PUSH	D		;
		LXI	D,1400H		;
		MOV	A,B		;
		ORA	A		;
		MOV	A,H		;
		JNZ	$ + 4		;
		MOV	A,L		;
		CALL	WJHEX		;
		CALL	KEYDELAU	;
		MOV	C,A		;
		CPI	0EH		; "F4"
		JZ	SV_EX0		;
		CPI	2H		; "чл"
		JZ	SV_EX0		;
		CPI	05H		;
		JNZ	SV_OBHOD	;
; пВТБВПФБЕН ОБЦБФЙЕ ЛМБЧЙЫЙ ЧЧЕТИ
		MOV	A,B		;
		INR	H		;
		ORA	A		;
		RNZ			;
		DCR	H		;
		INR	L		;		
		RET			;
SV_OBHOD:	MOV	A,C		;
		CPI	07H		;
		RNZ			;
; пВТБВПФБЕН ОБЦБФЙЕ ЛМБЧЙЫЙ ЧОЙЪ
		MOV	A,B		;
		DCR	H		;
		ORA	A		;
		RNZ			;
		INR	H		;
		DCR	L		;
		RET			;

SV_EX0:		CALL	W_Close		;
		POP	D		;
		RET			;


; ; ========= ху + 3 ======= GOTO =======
GOTOLINE:	LXI	D,081BH
		LXI	H,1D1BH
		CALL	US_OPEN
GOTODONE:	LXI	D,100H
		LXI	B,WARNGOTO	;ЧЩДБФШ УППВЭЕОЙЕ
		XRA	A
		CALL	WPUTSDOP
		MVI	D,0FH		;ЛПОЕГ УППВЭЕОЙС
		MVI	A,4H
		MOV	H,B
		MOV	L,C
		CALL	EDLINE
		CPI	0EH		;ЧЩИПД ЕУМЙ F4
		PUSH	PSW
		CZ	COPYS
		POP	PSW
		CZ	W_Close
		RZ
; РТЙУФХРЙФШ Л РПЙУЛХ УФТПЛЙ				
		DI		;ХЧЕМЙЮЙФШ ВЩУФТПДЕКУФЧЙЕ
		MVI	A,30H
		STA	Key_Kode	;ЬНХМСГЙС ОХМС
		LXI	B,STR
DOPLOOP:	CALL	EDINSERT	;ЧУФБЧЛБ ОХМС
		JZ	DOPLOOP		;ДПРПМОЕОЙЕ ЪБЧЕТЫЕОП ???
		EI
		CALL	KORREKT
		CALL	W_Close
		CALL	NULL_POS
POLOP1:		LXI	H,CURDY
		LXI	B,KORBUF
		MVI	D,3
POILOOP:	LDAX	B
		CMP	M
		JNZ	POIDONE		;РТПДПМЦБФШ РПЙУЛ
		INX	B
		INX	H
		DCR	D
		JNZ	POILOOP
;ОБКДЕОБ ОХЦОБС УФТПЛБ		
POIEXIT:	CALL	PRINT_POS
		CALL	Key_Reset
		CALL	RS_STR
		RET

POIDONE:	CALL	SINC
		CNZ	INCY
		JNZ	POLOP1
		JMP	POIEXIT
;&&&&&&&&&&&&& KORREKTOR &&&&&&&&&&&&&&&&&
KORREKT:	LXI	B,STR
		LXI	H,KORBUF+2
		CALL	CLEAR3
		MVI	E,5
POVTOR:		LDAX	B
		CPI	30H
		JC	KORERROR
		CPI	3AH
		JNC	KORERROR
		ANI	0FH		;ЧЩДЕМЙФШ ГЙЖТХ
		MOV	D,A
		MOV	A,E
		RRC
		MOV	A,D
		JC	KORNOHET	;ОЕЮЕФ
		RLC
		RLC
		RLC
		RLC
		INX	H		;УЮЕФЮЙЛ ДЕУСФЙЮОПЗП ЮЙУМБ
KORNOHET:	INX	B		;ХЛБЪБФЕМШ УФТПЛЙ
		ORA	M
		MOV	M,A
		DCR	E
		JNZ	POVTOR
		RET

KORERROR:
		CALL	W_Cls
		CALL	Key_Reset
		POP	H
		JMP	GOTODONE

;============== ЧУРПНПЗБФЕМШОЩЕ УЕТЧЙУОЩЕ РТПГЕДХТЩ =============
;РТПГЕДХТБ ХУФБОБЧМЙЧБЕФ ЧУЕ ЗМПВБМШОЩЕ РЕТЕНЕООЩЕ Ч ОЕМЕЧПЕ РПМПЦЕОЙЕ

NULL_POS:	CALL	CCLEFT
		LXI	H,BTEXT+2
		SHLD	POS
		LXI	H,0
		SHLD	CURHY
		LXI	H,CURDY+2
		CALL	CLEAR3
		RET

;РТПГЕДХТБ ТБУРЕЮБФЩЧБЕФ ЛБТФЙОЛХ ОБЮЙОБС У ФЕЛХЭЕЗП POS
PRINT_POS:	LXI	H,1AH
		SHLD	W_Cursor
		XCHG
		CALL	W_Cls
		LHLD	POS
		MOV	B,H
		MOV	C,L
		CALL	PRSCREEN
		CALL	DON		;ЛПТЕЛГЙС УЭЕФЮЙЛБ
		CNZ	UP
		RET
;;  рТПГЕДХТБ РТПЙЪЧПДЙФ ПФЮЙУФЛХ НБУЙЧБ РБНСФЙ
;;  HL - ОБЮБМШОЩК БДТЕУ
;;  B  - УЛПМШЛП ПФЮЙЭБФШ

CLEAR_MEM:	PUSH	PSW		;
		XRA	A		;
CL_00:		MOV	M,A		;
		INX	H		;
		DCR	B		;
		JNZ	CL_00		;
		POP	PSW		;
		RET			;
;;
FILE:
		CALL	DOMOY		;
		LXI	D,0819H		; ПФЛТЩЧБЕН ТБВПЮЕЕ ПЛОП
		LXI	H,171BH		; ЧЩЧПДЙН РПСУОСАЭЙЕ ОБДРЙУЙ
		CALL	US_OPEN		;
		LXI	D,202H		;
		LXI	B,F_S00		;
		CALL	W_DOP_INX	;
		DCR	E		;
		CALL	W_DOP_INX	;
		DCR	E		;
		CALL	WPUTSDOP	;

F_MENU:		LXI	H,F_MENU	;
		PUSH	H		;
		CALL	MENU		;
		CPI	0EH		;
		JZ	F_MENU_EXIT	;
		ORA	A		; "рПДЗТХЪЛБ"
		JZ	F_MERGE		;
		DCR	A		; "ъБРЙУШ ЖБКМБ"
		JZ	F_SAVE		;
		JMP	F_LOAD		; "юФЕОЙС ЖБКМБ"
F_MENU_EXIT:				;
		LDA	BTEXT+3		;
		CPI	STOPBYTE	;
		CALL	W_Close		;
		CZ	W_Cls		;
		POP	H		;
		RET			;

;;
;;   рТПГЕДХТБ РТПЙЪЧПДЙФ ПФЛТЩФЙЕ ДЙБМПЗПЧПЗП ПЛОБ
;; ЪБРТБЫЙЧБЕФ ЙНС ФТЕВХЕНПЗП ЖБКМБ РТЙ ЬФПН
;;
F_INPUT_NAME:
		LXI	D,1018H		;
		LXI	H,2618H		;
		MVI	A,16H		;
		CALL	US_OPEN + 2	; ПВИПДЙН A=15h
F_I_LOOP:	LXI	B,F_S10		;
		LDA	Stat_Small	;
		MOV	H,A		;
		LDA	Stat_RUS_LAT	;
		MOV	L,A		;
		PUSH	H		;
		XRA	A		;
		STA	Stat_Small	;
		STA	Stat_RUS_LAT	;
		LXI	D,100H		;
		CALL	WPUTSDOP	;
		MVI	D,7		;
		LXI	H,F_F_ASCII	;
		MVI	A,13		;
		CALL	EDLINE		;		
		CPI	0EH		;
		CZ	W_Close		;
		POP	H		;
		RZ			;
		PUSH	H		;
		LXI	H,STR		;
		LXI	D,F_F_ASCII	;
		MVI	B,13		;
		CALL	Inc_Copy	;
		POP	H		;
		MOV	A,H		;
		STA	Stat_Small	;
		MOV	A,L		;
		STA	Stat_RUS_LAT	;
		RET			;

F_F_ASCII:	DB	CR	; оБЮБМШОБС ЪБЗМХЫЛБ
				; ЙНС ЖБКМБ Ч ASCII ЖПТНБФЕ
		DB	CR,CR,CR,CR,CR,CR,CR,CR,CR,CR,CR,CR

;; ======= ху + 7 ====== Search ======
SEARCH:		CALL	S_LINE_INPUT	; ЪБРТПУЙФШ УФТПЛЙ РПЙУЛБ Й ЪБНЕОЩ

; ;ОБЮБФШ РПЙУЛ ЪБДБООПК УФТПЛЙ Й РТЙ ОЕПВИПДЙНПУФЙ ЪБНЕОСФШ
; ;   BUF_ETALON:	--> ВХЖЕТ ДМС ЬФБМПОБ
; ;   BUF_PODM:		--> ВХЖЕТ ДМС ЪБНЕОСЕНПК УФТПЛЙ
; ;   DL_ETALON:	--> ДМЙОБ ЬФБМПОПК УФТПЛЙ
; ;   DL_PODM:		--> ДМЙОБ ЪБНЕОСЕНПК УФТПЛЙ

		CALL	NULL_POS	;ХЛБЪБФЕМШ ОБ ОБЮБМП ФЕЛУФБ
		LDA	DL_ETALON	;ВЕТЕН ДМЙОХ ЬФБМПОБ
		MOV	B,A		;УПИТБОСЕН Ч ТЕЗЙУФТБИ
		MOV	C,A		;
		LHLD	POS		;ЮЙФБЕН ХЛБЪБФЕМШ ОБ УФТПЛХ Ч HL
S_LOOP:		MOV	B,C		;ЧПУФБОБЧМЙЧБЕН "B"
		LXI	D,BUF_ETALON	;
S_LOOP1:	MOV	A,M		;УТБЧОЙЧБЕН У УЙНЧПМПН "ЛПОЕГ УФТПЛЙ"
		CPI	CR		;
		JZ	S_END_LINE	;ЛПОЕГ УФТПЛЙ ???
		LDAX	D		;ЕУМЙ ОЕ ЛПОЕГ ФП РТПЮЙФБЕН ЬФБМПО
		CMP	M		;Й УТБЧОЙН ЕЗП У ФЕЛХЭЙН УЙНЧПМПН ЕУМЙ
		INX	H		;ОЕ ТБЧОЩ ФП ЧПУФБОПЧЙФШ ХЛБЪБФЕМШ
		INX	D		;ЬФБМПОБ Й ДМЙООХ ЬФБМПОБ
		JNZ	S_LOOP		;ЙОБЮЕ ХНЕОШЫЙФШ УЮЕФЮЙЛ ХДБЮОЩИ
		DCR	B		;УТБЧОЕОЙК ЕУМЙ ТБЧОП ОХМА ФП
		JNZ	S_LOOP1		;ОБЫМЙ ЬФБМПООХА РПУМЕДПЧБФЕМШОПУФШ
;
; ; ОБЫМЙ ЙУЛПНХА УФТПЛХ ФЕРЕТШ ОЕПВИПДЙНП ПРТЕДЕМЙФШ
; ; ЮФП У ОЕК ДЕМБФШ Б ФБЛЦЕ ЧЩДБФШ УППФЧЕФУФЧХАЭЙЕ
; ; РПСУОЕОЙС РПМШЪБЧБФЕМА Й РТЙОСФШ ТЕЫЕОЙЕ П ДБМШ-
; ; ОЕЫЕН ИПДЕ ТБВПФЩ МЙВП ЪБЛПОЮЙФШ РПЙУЛ ,МЙВП РТП-
; ; ДПМЦЙФШ РПЙУЛ
; 
		PUSH	B		;УПИТБОЙН ТЕЗЙУФТЩ РТПГЕУУПТБ
		PUSH	D		;
		PUSH	H		;
		PUSH	B		;
		CALL	PRINT_POS	;ТБУРЕЮБФБЕН ОБКДЕОХС УФТПЛХ Ч
		POP	B		;
		POP	H		;
		PUSH	H		;
		MOV	A,C		;РПНЕФЙН ЙОЧЕТУОЩН ГЧЕФПН ОБКДЕОПЕ
S_LOOP2:	DCX	H		;УМПЧП
		DCR	C		;дМЙОБ ЬФБМПООПК УФТПЛЙ
		JNZ	S_LOOP2		;
		MOV	B,H		;
		MOV	C,L		;
		LXI	D,001AH		;++
		CALL	WPUTS1		;
		MOV	B,A		;
		LHLD	ENDLINE		;
		XCHG			;
		LXI	H,3D1DH		;
		MOV	A,D		;
		CMP	H		;
		CC	Cls_XY		;
		LXI	H,W_Cursor + 1	;
		CALL	LINE_I_DOP	;
		MVI	M,0		;
		LXI	D,0519H		;ЧЕТИХ ЬЛТБОБ Й РПДЗПФПЧЙН ДБООЩЕ
		LXI	H,181AH		;ДМС ПФЛТЩФЙС ПЛОБ
		LXI	B,S_SOOB1	;
		LDA	DL_PODM		;
		ORA	A		;
		PUSH	PSW		;
		JZ	S_DONE0		;
		LXI	B,S_SOOB2	;ЕУМЙ ТЕЦЙН РПЙУЛ-ЪБНЕОБ ФП
		DCR	E		;ПЛОП ЙНЕЕФ ФТЙ УФТПЛЙ ЙОБЮЕ ДЧЕ
		MVI	H,13H		;
S_DONE0:	
		PUSH	B		;
		CALL	US_OPEN		;
		POP	B		;
		LXI	D,0200H		;ЧЩЧПДЙН БМШФЕТОБФЙЧОЩЕ УФТПЛЙ
		CALL	W_DOP_INX	;Ч УППФЧЕФУФЧЙЙ У ФЕЛХЭЙН ТЕЦЙНПН
					;Й ЧЩЪЩЧБЕН РТПГЕДХТХ MENU:
		POP	PSW		;
		MVI	E,1		;
		CNZ	WPUTSDOP	;
		LXI	B,S_SOOBHLP	;
		CZ	WPUTSDOP	;
		INR	E		;
		CNZ	WPUTSDOP	;
MEN_LOOP:	CALL	MENU		;
;
; ; рПУМЕ ЧПЪЧТБФБ КЪ РПДРТПТБННЩ Ч БЛБНХМСФПТЕ ОБИПДЙФУС ОПНЕТ
; ; УФТПЛЙ Ч ЛПФПТПК ПУФБМУС ЛХТУПТ РТЙ ОБЦБФЙЙ чл ЕУМЙ
; ; ЧЩИПД РТПЙЪПЫЕМ РПУМЕ ОБЦБФЙС ЛМБЧЙЫЙ F4 ФП Ч б ВХДЕФ
; ; ОБИПДЙФУС ЛПД 0EH (Ф.Е Ч НЕОА ОЕ НПЦЕФ ВЩФШ РПЪЙГЙК
; ; ВПМШЫЕ 15
;
		CPI	0EH		; ОБЦБФБ ЛМБЧЙЫБ F4 ???
		JZ	S_EXIT_REJ	; ЕУМЙ ДБ ФП ФБЛЦЕ ЧЩИПД
		MOV	B,A		; УПИТБОСЕН РПЪЙГЙА ХЛБЪБФЕМС
		LDA	DL_PODM		; ПРТЕДЕМСЕН ФЕЛХЭЙК ТЕЦЙН
		ORA	A		; ( РПЙУЛ ЙМЙ РПЙУЛ-ЪБНЕОБ)
		JZ	ALT_POISK	; РЕТЕИПДЙН ЕУМЙ рпйул
; ; ПВТБРПФБЕН ПЛОП ДМС рпйулб Й ъбнеощ
		MOV	A,B		; ЧПУФБОПЧЙН ХЛБЪБФЕМШ
		CPI	2H		; "ртпунпфт"
		CZ	PROSMOTR	;
		JZ	MEN_LOOP	; ЧПЪЧТБФЙФУС Ч "НЕОА"
		ORA	A		; "ое ЪБНЕОСФШ"
		JZ	S_OBHOD		;
; рТПЙЪЧПДЙН ЪБНЕОХ ЬФБМПООПЗП УМПЧБ ОБ РПДНЕОСЕНПЕ
		CALL	W_Close		; ъБЛТЩЧБЕФ ПЛОП ЪБРТПУПЧ
		POP	D		; ЮЙФБЕН ФПЮЛХ ЗДЕ ОБЫМЙ УФТПЛХ
		PUSH	D		; 
		LHLD	POS		; ЮЙФБЕН ОБЮБМП УФТПЛЙ
		XCHG			;
		CALL	NEG_DE		; ЖПТНЙТХЕН ДПРПМОЙФЕМШОЩК
		DAD	D		; ЛПД ДМС ТЕЗЙУФТБ DE
					; (ЮФПВЩ РТПЧЕУФЙ ЧЩЮЙФБОЙЕ)
					; HL - УНЕЭЕОЙЕ УМПЧБ Ч STR
		CALL	COPYS		;
		CPI	200		; РТПЧЕТЛБ ДМЙООЩ УФТПЛЙ
		JNC	S_OVERFLOM	;
		LXI	B,STR		;
		DAD	B		;
		MOV	B,H		;
		MOV	C,L		;
		LDA	DL_ETALON	;
		MOV	D,A		;
S_LOOP4:	DCX	B		; РТПЙЪЧПДЙН ХДБМЕОЙЕ ЙУИПДПК
		CALL	MOVEDEL		; УФТПЛЙ У УППФЧЕФУФЧХАЭЕК
		DCR	D		; ЛПТЕЛГЙЕК ХЛБЪБФЕМС
		JNZ	S_LOOP4		;
		LDA	DL_PODM		;
		LXI	D,BUF_PODM	;
		PUSH	B		;
S_LOOP5:	PUSH	PSW		; РТПЙЪЧПДЙН ЧУФБЧЛХ
		CALL	MOVEINS		; ОПЧПК УФТПЛЙ
		LDAX	D		;
		STAX	B		;
		INX	B		;
		INX	D		;
		POP	PSW		;
		DCR	A		;
		JNZ	S_LOOP5		;		
		POP	B		;
		LXI	D,021DH		; ПФПВТБЦБЕН РТПЙЪЧЕДЕООХА
		LXI	H,3D1DH		; ЪБНЕОХ
		CALL	Cls_XY		;
		LXI	D,001Ah		;
		CALL	WPUTSDOP	;
		CALL	NARUSHENIE	; РТПЙЪЧПДЙН ЙУЛХУФЧ.ТЕЗ. ВХЖЕТБ
		CALL	REGENER		; ФЕЛУФБ
; ; рТПЙЪЧЕДЕОБ ЪБНЕОБ ФЕРЕТШ ЧЩЧПДЙН ПЛОП У ЪБРТПУПН
; ; ОБ РТПДПМЕОЙЕ РПЙУЛБ Й ЪБНЕОЩ

S_ZAPROS:	LXI	D,081AH		;
		LXI	H,151AH		;
		CALL	US_OPEN		;
		LXI	B,S_SOOBHLP3	;
		LXI	D,0100H		;
		CALL	WPUTSDOP	;
		CALL	KEYDELAU	;	
		CPI	0EH		; F4
		JZ	S_EXIT_REJ	;
		JMP	S_OBHOD		;

S_OVERFLOM:	LXI	B,SOOBR		;
		CALL	WARNING		;
		JZ	S_ZAPROS	; РТПДПМЦЙФШ РПЙУЛ
; ; ПВТБВПФБЕН ПЛОП рпйул
ALT_POISK:	DCR	B		; ЧПУФБОПЧЙН ХЛБЪБФЕМШ "ртпунпфт"
		CZ	PROSMOTR	; РТПУНПФТЕФШ УФТЛХ
		JZ	MEN_LOOP	; ЧПЪЧТБФЙФУС Ч НЕОА
S_OBHOD:	POP	H		;
		POP	D		;
		POP	B		;
		CALL	W_Close		;
		JMP	S_LOOP		;
		
S_EXIT_REJ:	CALL	W_Close		;
		POP	D		;
		POP	D		;
		POP	D		;
		LXI	D,1AH		;
		LHLD	POS		;
		MOV	B,H		;
		MOV	C,L		;
		CALL	WPUTS1		;
		CALL	RS_STR		; тЕУФБТФ ВХЖЕТБ
		RET			;

;+++++++++++ ртпгедхтб пвтбвпфлй ртпунпфтб уфтплй +++++++++++
PROSMOTR:	PUSH	PSW		;
		LXI	D,0A17H		;
		LXI	H,3617H		;
		MVI	A,16H		;
		CALL	US_OPEN + 2	; пВИПДЙН ЛПНБОДХ MVI A,15h
		LXI	B,S_SOOBHLP2	;
		CALL	WIND_PR_TOP	;
		LHLD	POS		;
		MOV	B,H		;
		MOV	C,L		;
		LXI	D,0		;
		PUSH	B		;
		CALL	WPUTS1		;
		POP	B		;
PROS_LOOP:	LXI	H,PROS_LOOP	;
		PUSH	H		;
		CALL	KEYDELAU	;
		LXI	D,0		;
		CPI	04H		; ЧМЕЧП
		JZ	PROS_LEFT	;
		CPI	06H		; ЧРТПЧП
		JZ	PROS_RIG	;
		CPI	0EH		;
		RNZ			;
		POP	H		;
		XRA	A		;
		STA	OFSET		;
		CALL	W_Close		;
		POP	PSW		;
		RET			;

PROS_LEFT:	LXI	H,OFSET		;
		INR	M		;
		PUSH	B		;
		CALL	WPUTS1		;
		POP	B		;
		LDA	ENDLINE + 1	;
		MOV	D,A		;
		MVI	E,17H		;
		CPI	37H		;
		MVI	A,' '		;
		CC	Put_XY_Char	;
		DCR	M		;
		MOV	A,D		;
		CPI	0BH		; ОБЮБМБ ДБООПЗП ПЛОБ
		CZ	PLAY		;
		RZ			;
		INR	M		;
		RET			;

PROS_RIG:	LXI	H,OFSET		;
		XRA	A		;
		ORA	M		;
		CZ	PLAY		;
		RZ			;
		DCR	M		;
		PUSH	B		;
		CALL	WPUTS1		;
		POP	B		;
		RET			;

S_END_LINE:	INX	H		;РЕТЕИПДЙН ОБ УМЕДХАЭХА УФТПЛХ
;;		INX	H		;Й РТПЧЕТСЕН ОЕ ДПУФЙЗОХФ МЙ ЛПОЕГ
		MVI	A,STOPBYTE	;ФЕЛУФБ ЕУМЙ ДБ ФП Й ОЕ ВЩМП ОБКДЕОП
		CMP	M		;ОЙ ПДОПЗП ЕФБМПОБ ФП ЧЩДБФШ УППВЭЕОЙЕ
		JZ	S_END_TXT	;П ФПН ЮФП РПУМЕДПЧБФЕМШОПУФШ ОЕ
		SHLD	POS		;ОБКДЕОБ (ЛХТУПТ ХУФБОБЧМЙЧБЕФУС
		CALL	INCY		;Ч ЛПОЕГ ФЕЛУФБ !!!!!!!!! )
		JMP	S_LOOP		;РТПДПМЦЙФШ РПЙУЛ У ОПЧПК УФТПЛЙ

		CALL	W_Close
S_END_TXT:	CALL	PRINT_POS
		CALL	RS_STR
		RET
		
WIND_PR_TOP:	CALL	HL_DE_Window	;
		PUSH	B		;
		CALL	HL_Sub_DE	;
		MOV	E,C		;
		MVI	D,1		;
		POP	B		;
		XRA	A		;
		CALL	WPUTSDOP	;
		RET			;

; ; РТПГЕДХТБ ПФЛТЩЧБЕФ ДПРПМОЙФЕМШОПЕ ПЛОП Й ЪБРТБЫЙЧБЕФ
; ; УФТПЛЙ ДМС РПЙУЛБ Й ЪБНЕОЩ РТЙ РПНПЭЙ ЧУФТПЕООПЗП ТЕ-
; ; ДБЛФПТБ EDLINE РПМХЮЕООЩЕ УФТПЛЙ ЛПРЙТХАФУС ЧП ЧТЕНЕ-
; ; ИЩЕ ВХЖЕТЩ (BUF_ETALON , BUF_PODM) Б ФБЛЦЕ Ч СЮЕКЛЙ
; ; DL_ETALON Й DL_PODM ЪБОПУСФУСДМЙОЩ ЬФЙИ УФТПЛ ЬФП
; ; ДМС РПУМЕДХАЭЙИ ПРЕТБГЙК РПЙУЛБ Й ЪБНЕОЩ Ч ПУОПЧОПН
; ; ФЕЛУФПЧПН ВХЖЕТЕ

S_LINE_DL   	SET	20		; ЛПОУФБОФБ ДМЙОЩ

S_LINE_INPUT:	LXI	D,081AH		;ПФЛТЩЧБА ПЛОП ДМС ЧЧПДБ
		LXI	H,251BH		;ЬФБМПООЩИ УФТПЛ
		CALL	US_OPEN		;
		LXI	B,ETALON	;РЕЮБФБА РПСУОЙФЕМШОЩЕ
		LXI	D,101H		;ЧЩТБЦЕОЙС
		XRA	A		;
		CALL	W_DOP_INX	;
		MOV	E,A		;
		CALL	WPUTSDOP	;
		LXI	H,STR		;РПДЗПФБЧМЙЧБА ДБООЩЕ ДМС ТЕДБЛФПТБ
		MVI	M,CR		;УФТПЛЙ EDLINE
		LXI	D,801H		;
		MVI	A,S_LINE_DL - 1	;
		PUSH	H		;
		CALL	EDLINE		;
		POP	H		;
		CPI	0EH		;ЧПЪЧТБФ РП F4 ???
		JZ	SEA_EXIT	;ЕУМЙ ДБ ФП ЧЩКФЙ ЙЪ ТЕЦЙНБ РПЙУЛБ
		MOV	A,M		;ЕУМЙ ЧПЪЧТБЭБЕНБС ТЕДБЛФПТПН УФТПЛБ
		CPI	CR		;РХУФБС ФП ЧЩКФЙ ЛБЛ РТЙ ОБЦБФЙЙ F4
		JZ	SEA_EXIT	;
		CALL	COPYSDOP	;ПРТЕДЕМСА ДМЙООХ УФТПЛЙ
		MOV	B,A		;
		STA	DL_ETALON	;УПИТБОЙФШ ДМЙООХ УФТПЛЙ ETALON
		LXI	D,BUF_ETALON	;ХЛБЪБФЕМШ ОБ ВХЖЕТ ДМС РЕТЕОПУБ
		CALL	Inc_Copy		;УФТПЛЙ ЙЪ STR
		MVI	M,CR		;
; рТЙУФХРЙФШ Л ЧЧПДХ УФТПЛЙ ЪБНЕОЩ (ЕУМЙ ПОБ РТПЙЪЧПДЙФУС)
		LXI	D,800H		;ЧЧЕУФЙ У ЛПОУПМЙ УФТПЛХ ЪБНЕОЩ
		MVI	A,S_LINE_DL - 1	;
		PUSH	H		;
		CALL	EDLINE		;
		POP	H		;ЕУМЙ ОБЦБФБ F4 ФП ЧЩИПД ХЪ ТЕЦЙНБ
		CPI	0EH		;
		JZ	SEA_EXIT	;
		CALL	COPYSDOP	;
		MOV	B,A		;
		STA	DL_PODM		;УПИТБОЙН ДМЙООХ РПДНЕОСЕНПК УФТПЛЙ
		LXI	D,BUF_PODM	;ХЛБЪБФЕМЙ ОБ ВХЖЕТ ДМС РЕТЕОПУ
		ORA	A		;ЕУМЙ УФТПЛБ ОЕ РХУФБС ФП РПЙУЛ-ЪБН.
		CNZ	Inc_Copy	;УПИТБОСЕН ЧЧЕДЕООХА УФТПЛХ
		CALL	W_Close		;
		RET			;

SEA_EXIT:	CALL	W_Close		;
		JMP	F_MAIN_EXIT	; чЩИПД

;;DL_ETALON:	DB	0H		;ДМЙОБ ЬФБМПОПК УФТПЛЙ
;;DL_PODM:	DB	0H		;ДМЙОБ ЪБНЕОСЕНПК УФТПЛЙ

; ; РТПГЕДХТБ ПВТБВПФЛЙ ЙОЖПТНБГЙПООПЗП ЧЩЪПЧБ
; ; УЕЗПДОС: 05.01.1992
M_INFO:		LXI	D,081AH		;
		LXI	H,221BH		;
		CALL	US_OPEN
		LXI	D,101H		;
		LXI	B,I_SOOB1	;
		CALL	W_DOP_INX	;
		DCR	E		;
		CALL	W_DOP_INX	;
		PUSH	B		;
		MVI	D,13H		;
		CALL	WPUTSDOP	;
		INR	E		;
		POP	B		;
		CALL	WPUTSDOP	;
		LHLD	ENDTEXT		;
		PUSH	H		;
		LXI	D, BTEXT + 2	;
		CALL	NEG_DE		;
		DAD	D		;
		LXI	D,0F01H		;
		CALL	HL_PRINT	;
		POP	D		;
		LXI	H,TEXT_LIMIT	;
		CALL	NEG_DE		;
		DAD	D		;
		LXI	D,0F00H		;
		CALL	HL_PRINT	;
		CALL	KEYDELAU	;
		CALL	W_Close		;
		RET			;

HL_PRINT:	PUSH	D		;
		MOV	A,H		;
		CALL	WJHEX		;
		MOV	A,L		;
		CALL	JHEX		;
		POP	D		;
		RET			;


;////////////// ТБВПЮЙЕ СЮЕКЛЙ ТЕДБЛФПТБ ////////////////
;; рЕТЕОЕУ ЬФЙ СЮЕКЛЙ ОБ УЙУФЕНОХА УФТБОЙГХ (EUQ - ПРТЕДЕМЕОЙС)
;; 11.03.1994
;;OFSET:	DB	0	;УНЕЭЕОЙЕ ПЛОБ ПФОПУЙФ.УФТПЛЙ
;;CURHY:	DW	0	
;;CURDY:	DB	0,0,0	;РСФЙЪО. ДЕУ. ЙУМП-ОПНЕТ УФТПЛЙ
;;CURHX:	DB	0	
;;CURDX:	DB	0,0	;ДЕУ. ОПНЕТ РПЪЙГЙЙ
POS:	DW	BTEXT+2	

;;DLINNA:		DB	0H	;ОБЮБМШОБС ДМЙООБ УФТПЛЙ
;;FLAGLINE:	DB	0H	;=0 УФТПЛБ ОЕ КЪНЕОСМБУШ <>0 ЙЪН.

;;F_SL_BUF:
;;KORBUF:		DB	0,0,0	;ВХЖЕТ ЛПТЕЛФПТБ
;;ENDLINE:	DW	0000H	;ЛПТД. ЛПОГБ УФТПЛЙ
ENDTEXT:	DW	TEXT_END;БДТЕУ ИЧПУФБ ФЕЛУФБ
;;MAXDLINNA:	DB	0H	;ОБЙВПМШЫБС ДМЙООБ ТЕДБЛФЙТХЕНПК УФТПЛЙ


;$$$$$$$$$ ВБЪПЧЩЕ РТПГЕДХТЩ $$$$$$$$$
REGENER:	LXI	H,FLAGLINE
		MOV	A,M
		ORA	A
		RZ			;ЧЩИПД ТЕЗЕОЕТБГЙС ОЕ ОХЦОБ
		DCR	M		;УВТПУЙФШ ЖМБЗ РТЙУФХРЙФШ Л ТЕЗЕОЕТБГЙЙ
		DCX	H
		MOV	B,M		;УФБТБС ДМЙООБ УФТПЛЙ
		MOV	C,B		;
		LXI	H,STR
		CALL	COPYSDOP
		SUB	B
		MOV	B,A		;ТБЪОПУФШ
		LHLD	POS
		JZ	NOSDVIG		;ДМЙООЩ УФТПЛ ОЕ ЙЪНЕОЙМЙУШ
		CC	COPUINC		;ДМЙОБ ХНЕОШЫЙМБУШ
; ДМЙООБ ХЧЕМЙЮЙМБУШ
		CNC	COPUDEC		;УДЧЙОХФШ ФЕЛУФ Ч ПУОПЧО.ВХЖЕТЕ
NOSDVIG:	MOV	A,C
		ADD	B
		MOV	B,A
		XCHG
		INR	B
		LXI	H,STR
		CALL	Inc_Copy		;ЧУФБЧЛБ  ОПЧПК УФТПЛЙ
		CALL	RS_STR
		RET
;%%%%%%%%%%%%%% COPUINCSTOP %%%%%%%%%%%
COPUINC:	PUSH	B
		PUSH	D
		PUSH	H
		PUSH	PSW
		MOV	A,B
		MVI	B,0
		DAD	B
		MOV	D,H
		MOV	E,L		;DE---> ПФЛХДБ
		MOV	C,A		;HL --> ЛХДБ
		DCR	B		;B=0FFH
		DAD	B
		PUSH	H
		LHLD	ENDTEXT
		DAD	B
		SHLD	ENDTEXT
		POP	H
		MVI	B,STOPBYTE	
COILOP0:	LDAX	D
		MOV	M,A
		CMP	B
		INX	D
		INX	H
		JNZ	COILOP0
		POP	PSW
		POP	H
		POP	D
		POP	B
		RET
;%%%%%%%%%%%%%% COPUDEC %%%%%%%%%%%
;; HL ---> БДТЕУ ФЕЛХЭЕК УФТПЛЙ Ч ФЕЛУФЕ
;; B  ---> ТБЪОПУФШ НБЦДХ УФБТПК Й ОПЧПК УФТПЛПК
;; C  ---> УФБТБС ДМЙООБ УФТПЛЙ
COPUDEC:	PUSH	B
		PUSH	D
		PUSH	H
		PUSH	PSW
		MOV	A,B
		MVI	B,0
		DAD	B		;DE -> ДП ЛХДБ
		DCX	H
		XCHG
		MOV	C,A
		LHLD	ENDTEXT
		PUSH	H
		DAD	B		;HL -> ЛХДБ
		SHLD	ENDTEXT
		PUSH	H
		LXI	B,TEXT_LIMIT

	MOV	A,B
	CMA
	MOV	B,A
	MOV	A,C
	CMA
	MOV	C,A
	INX	B

		DAD	B
		POP	H
		POP	B		;BC -> ПФЛХДБ
		JNC	COLOOP1
		LXI	B,SOOBF		;ОЕФ РБНСФЙ
		CALL	WARNING
		CALL	COPYS
		XRA	A
		STA	FLAGLINE	;ПВПТЧБФШ ТЕЗЕОЕТБГЙА УФТПЛЙ
		INR	A
		STA	OFSET		;ЗЕОЕТБГЙС ДБМЙОЕЗП РЕТЕИПДБ ДПНПК
		CALL	DOMOY
		POP	PSW		
		POP	H
		POP	D
		POP	B
		POP	PSW		;ЪБВПТ ЙЪ УФЕЛБ ДЧХИ БДТЕУПЧ
		POP	PSW		;Й ==> * REGENER
		RET

COLOOP1:	LDAX	B
		MOV	M,A
		DCX	B
		DCX	H
		MOV	A,C
		CMP	E
		JNZ	COLOOP1
		MOV	A,B
		CMP	D
		JNZ	COLOOP1
		POP	PSW
		POP	H
		POP	D
		POP	B
		RET
;$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$
NARUSHENIE:	LXI	H,FLAGLINE
		MOV	A,M
		ORA	A
		RNZ			;УФТБЛБ ЙУРТПЧМСЕФУС
		INR	M		;ЖМБЗ =1 РЕТЧПЕ ЙУРТБЧМЕОЙЕ
		RET


CINV:	PUSH	B	;
	PUSH	D	;
	PUSH	H	;
	PUSH	PSW	;
	LHLD	W_Cursor;	
	XCHG		;
	CALL	Abs_DE	;
	CALL	Addr_Screen	
	MVI	E,Cursor_Zise
	MOV	B,E	;ЧЩУПФБ
	MOV	A,D	;
	RRC		;
	MVI	A,0FH	;
	JC	CV2	;
	CMA		;
CV2:	MOV	C,A	;
CV0:	MOV	A,M	;
	XRA	C	;
	MOV	M,A	;
	INR	L	;
	DCR	B	;
	JNZ	CV0	;
	DCR	L	;
	MOV	B,E	;
	MOV	A,H	;
	ADI	20h	;
	MOV	H,A	;
CV1:	MOV	A,M	;
	XRA	C	;
	MOV	M,A	;
	DCR	L	;
	DCR	B	;
	JNZ	CV1	;
	POP	PSW	;
	POP	H	;
	POP	D	;
	POP	B	;
	RET		;

;+--[ ТЙУ ЧЕТФ.УФТЕМЛХ ]---+
STL2:		PUSH	D	
		PUSH	PSW	
		MVI	A,5	
		CALL	Put_XY_Char	
		DCR	B	
		DCR	B	
		DCR	A	
ST0:		DCR	E	
		CALL	Put_XY_Char	
		DCR	B	
		JNZ	ST0	
		DCR	E	
		DCR	A	
		CALL	Put_XY_Char	
		POP	PSW	
		POP	D	
		RET	

;+----[ ТЙУ ЗПТ. УФТЕМЛХ ]----+
PAR1:		PUSH	D	
		PUSH	PSW	
		MVI	A,6	
		CALL	Put_XY_Char	
		INR	A	
		DCR	B	
		DCR	B	
PA0:		INR	D	
		CALL	Put_XY_Char	
		DCR	B	
		JNZ	PA0	
		INR	A	
		INR	D	
		CALL	Put_XY_Char	
		POP	PSW	
		POP	D	
		RET		

;РТПГЕДХТБ PRSCREEN ТБУРЕЮБФЩЧБЕФ ФЕЛХЭЕЕ УПД ВХЖЕТБ ФЕЛУФБ ДП ЛПОГБ ПЛОБ
;
PRSCREEN:
		LDAX	B
		CPI	STOPBYTE
		RZ
		CALL	WPUTS1	
PRINL3:		LDAX	B	
		INX	B	
		CPI	CR	
		JNZ	PRINL3	
		DCR	E	
		MOV	A,E
		INR	A
		JNZ	PRSCREEN
		RET
;$$$$$$$$$$$$$$$$$$$$$$$$$$$
PLAY:		PUSH	B	
		PUSH	PSW	
		MVI	A,36H	
		OUT	08H	
		LXI	B,200H	
PLJ0:		MOV	A,C	
		OUT	0BH	
		MOV	A,B	
		OUT	0BH	
		INX	B	
		MOV	A,B	
		CPI	10	
		JNZ	PLJ0	
		MVI	A,36H	
		OUT	08H	
		POP	PSW	
		POP	B	
		RET		
;////////////////////////////
COPYSDOP:	PUSH	B
		PUSH	D
		PUSH	H
		JMP	CODOP
COPYS:		PUSH	B	
		PUSH	D	
		PUSH	H	
		LHLD	POS	
CODOP:		XCHG			;ФПЮЛБ ЧИПДБ ДМС ЛПРЙТПЧЙОЙС РП HL
		LXI	H,STR	
		DCX	H
		LXI	B,0D00H
COJ0:		LDAX	D	
		INX	H	
		INX	D	
		CMP	B	
		JZ	COQ	
		INR	C	;---//----
		JZ	COQ	;ЪБЭЙФБ ПФ РЕТЕРПМОЕОЙС
		MOV	M,A	
		JMP	COJ0	
COQ:		MOV	M,B	
		MOV	A,C	;ЮЙУМП УЛПРЙТПЧБООЩИ УЙНЧПМПЧ
		POP	H
		POP	D
		POP	B
		RET
;////////////////////
DECX:		PUSH	B	
		PUSH	D	
		PUSH	H	
		PUSH	PSW	
		LXI	H,CURHX	
		XRA	A	
		ORA	M	
		JZ	JINQ	
		DCR	M	
		LXI	B,9999H	
		JMP	JXINM	
;////////////////////
INCX:		PUSH	B	
		PUSH	D	
		PUSH	H	
		PUSH	PSW	
		LXI	H,CURHX	
		INR	M	
		JNZ	JXIN0	
		DCR	M	
		JMP	JINQ	
JXIN0:		LXI	B,100H	
JXINM:		INX	H	
		INX	H	
		MOV	A,M	
		ADD	B	
		DAA		
		MOV	M,A	
		DCX	H	
		MOV	A,M	
		ADC	C	
		DAA		
		MOV	M,A	
		MVI	B,1	
		LXI	D,0E1EH	
		JMP	JINQ2	
;//////////////////////
DECY:		PUSH	B	
		PUSH	D	
		PUSH	H	
		PUSH	PSW	
		LHLD	CURHY	
		MOV	A,H	
		ORA	L	
		JZ	JINQ	
		DCX	H	
		SHLD	CURHY	
		LXI	B,9999H	
		JMP	JIN1	
;////////////////////
INCY:		PUSH	B	
		PUSH	D	
		PUSH	H	
		PUSH	PSW	
		LHLD	CURHY	
		INX	H	
		MOV	A,H	
		ORA	L	
		JZ	JINQ	
		SHLD	CURHY	
		LXI	B,100H	
JIN1:		LXI	H,CURDY+2
		MOV	A,M	
		ADD	B	
		DAA		
		MOV	M,A	
		DCX	H	
		MOV	A,M	
		ADC	C	
		DAA		
		MOV	M,A	
		DCX	H	
		MOV	A,M	
		ADC	C	
		DAA		
		MOV	M,A	
JMAI:		MVI	B,2	
		LXI	D,81EH	
JINQ2:
		CALL	JDES	
JINQ:		POP	PSW	
		POP	H	
		POP	D	
		POP	B	
		RET		
;#################### ЧУРПНПЗБФЕМШОЩЕ РТПГЕДХТЩ ###################
;$$$$$$$$$$$$ CLEAR 3 BYTE $$$$$$$$$
CLEAR3:		MVI	D,3
CL00:		MVI	M,0
		DCX	H
		DCR	D
		JNZ	CL00
		INX	H
		RET
;;
;;	рТПГЕДХТБ РТПЙЪЧПДЙФ ТЕУФБТФ ВХЖЕТБ УФТПЛЙ.
;;
RS_STR:
	CALL	COPYS
	STA	DLINNA
	RET

;;; ртпгедхтб пфлтщфйс фйрпчпзп плоб ъбртпуб ;;;
US_OPEN:
	MVI	A,15h		; ПДЙОБТОПЕ ПЛОП У ФЕОША ФЙРБ-2
	CALL	W_Open		;
;; ИЙФТЩК ЧЩЪПЧ РТПГЕДХТЩ ESCF4
;$$$$$$$$$$$$ ESC F4 $$$$$$$$$$$$
ESCF4:		LXI	B,F4ESC
		JMP	YESDOP
;$$$$$$$$$$$$ YES NO $$$$$$$$$$$$
YESNO:		LXI	B,PPAYESNO
YESDOP:		CALL	HL_DE_Window
		INR	D
		DCR	E
		CALL	WRITE
		RET
;$$$$$$$$$$$$ WRITE $$$$$$$$$$$$$
WRITE:		LDAX	B
		ORA	A
		INX	B
		RZ
		CALL	Put_XY_Char
		INR	D
		JMP	WRITE
;;;;;;;;; INC_REMOVE ;;;;;;;
;; HL -ПФЛХДБ
;; DE -ЛХДБ
;; BC -УЛПМШЛП.
I_REMOVE:
	MOV	A,M	;
	STAX	D	;
	INX	H	;
	DCX	B	;
	INX	D	;
	MOV	A,B	;
	ORA	C	;
	JNZ	I_REMOVE;
	RET		;
;;;;;;;;; DEC_REMOVE ;;;;;;;;
;; HL - ПФЛХДБ
;; DE - ЛХДБ
;; BC - УЛПМШЛП
D_REMOVE:
	MOV	A,M	;
	STAX	D	;
	DCX	D	;
	DCX	H	;
	DCX	B	;
	MOV	A,B	;
	ORA	C	;
	JNZ	D_REMOVE;
	RET		;
;$$$$$$$$$$$$ KEYDELAY $$$$$$$$$$
KEYDELAU:	CALL	Input_Key
		INR	A
		JZ	KEYDELAU
		DCR	A
		RET
;$$$$$$$$$$$$$$$$$$
;РТПГЕДХТЩ SINC Й SDEC РПТФСФ ЧУЕ ТЕЗЙУФТБ ЛТПНЕ BC
;ТЕЪХМШФБФ:    
;SINC ->  ЛПОЕГ ФЕЛУФБ ФП "Z=1"
;SDEC ->  ОБЮБМП ФЕЛУФБ ФП "C=0"

SINC:		LHLD	POS	
		MVI	E,CR	
SI1:		MOV	A,M	
		INX	H	
		CMP	E	
		JNZ	SI1	
		MOV	A,M	
		CPI	STOPBYTE
		RZ
SSM:		SHLD	POS	
		RET		

;//////////////
SDEC:		LHLD	POS	
		LXI	D,BTEXT+3
		CALL	NEG_DE			;;;;
		DAD	D
		RNC
		LHLD	POS
		DCX	H
		MVI	E,CR
SD1:		DCX	H	
		MOV	A,M	
		CMP	E	
		JNZ	SD1	
		INX	H	
		STC
		JMP	SSM

;;   рТПЗТБННБ ПТЗБОЙЪБГЙЙ ЙОФЕТЖЕКУБ У НБЗОЙФПЖПОПН Ч ЖПТ-
;; НБФЕ "EDASM" /* (C)18.06.1993 лБТБЗБОДБ */
;; ///////////// рЙНЕОПЧ рБЧЕМ бМЕЛУЕЕЧЙЮ. //////////////
NO_SINHRO	EQU	08h	; вЕЪ РПЙУЛБ УЙОИТПВБКФБ.
YES_SINHRO	EQU	0FFh	; у РПЙУЛПН УЙОИТПВБКФБ.

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;	 рТПГЕДЕТБ ЪБРЙУЙ ЖБКМБ ОБ НБЗОЙФПЖПО.		;;
F_SAVE:
	CALL	F_INPUT_NAME	;
	SUI	0Eh		;
	RZ			;
	XRA	A		;
	MOV	H,A		;
	MOV	L,A		;
	DAD	SP		;
	SHLD	STACK_BUFER	;
	DCR	A		;
	STA	F_FLAG		; ъбрйуш жбкмб.
	LXI	H,BTEXT+2	;
	PUSH	H		;
	CALL	CONTR_ADD	;
	POP	D		;
	PUSH	B		; лпофтпмшобс ухннб
	LHLD	ENDTEXT		;
	CALL	NEG_DE		;
	DAD	D		;
	PUSH	H		; тбънет жбкмб.
	DI			;
;; жПТНЙТХЕН ФПОБМШОЩК ЪБЗПМПЧПЛ ЖБКМБ.
	MVI	D,04h		;
	XRA	A		;
F_S_TONE1:
	MVI	E,040h		;
	XRI	55h		;
F_S_TONE0:
	CALL	PUT_REC_BYTE	;
	loop	E,F_S_TONE0	;
	loop	D,F_S_TONE1	;
;; чЩЧПДЙН ЙНС ЖБКМБ
	MVI	A,0E6h		;
	LXI	H,F_F_ASCII	;
	MVI	B,4		;
F_S_NAME0:
	CALL	PUT_REC_BYTE	;
	loop	B,F_S_NAME0	;
F_S_NAME1:
	CALL	PUT_REC_BYTE	;
	MOV	A,M		;
	INX	H		;
	CPI	0Dh		;
	JNZ	F_S_NAME1	;

	XRA	A		;
	MOV	B,A		;
F_S_NULL:			;
	CALL	PUT_REC_BYTE	; вМПЛ ОХМЕЧЩИ ВБКФПЧ.
	loop	B,F_S_NULL	;
;;
;; ъБРЙЫЕН ТБЪНЕТ ЖБКМБ.
;;
	POP	H		;
	MVI	A,0E6h		;
	CALL	PUT_REC_BYTE	;
	MOV	A,L		;
	CALL	PUT_REC_BYTE	;
	MOV	A,H		;
	CALL	PUT_REC_BYTE	;
;;
;; ъБРЙЫЕН НБУЙЧ ФЕЛУФБ.
;;
	LXI	H,BTEXT+2	;
F_S_TEXT:
	MOV	A,M		;
	CALL	PUT_REC_BYTE	;
	XTHL			;
	XTHL			;
	INX	H		;
	CPI	0FFh		;
	JNZ	F_S_TEXT	;
	POP	B		;
	MOV	A,C		;
	CALL	PUT_REC_BYTE	;
	MOV	A,B		;
	CALL	PUT_REC_BYTE	;
	EI			;
	CALL	W_Close		;
	CALL	W_Close		;
F_MAIN_EXIT:			;
	POP	H		;
F_3EXIT:			;
	CALL	RS_STR		;
	CALL	INCY		;
	CALL	DECY		;
	RET			;
F_MERGE:
	MVI	A,01h		; лПНБОДБ РПДЗТХЪЛЙ.
	JMP	F_L_M		;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;	   рТПГЕДХТБ ЮФЕОЙС ЖБКМБ У НБЗОЙФПЖПОБ.	;;
F_LOAD:
	XRA	A		;
F_L_M:
	STA	F_FLAG		; лПНБОДБ ЮФЕОЙС.
	XRA	A		;
	MOV	H,A		;
	MOV	L,H		;
	DAD	SP		;
	SHLD	STACK_BUFER	;

	LXI	D,1018h		;
	LXI	H,3018h		;
	MVI	A,16h		;
	CALL	W_Open		;
	LXI	B,F_L_MESSAGE	;
	LXI	D,0500h		;
	CALL	WPUTSDOP	;
	DI			;	
	CALL	WAIT_HEADER_ASM	;пЦЙДБЕН УФБТФПЧПЗП ТБЛПТДБ.
	CALL	LOAD_NAME_ASM	;рТПЮЙФБЕН ЙНС ЖБКМБ.
	LXI	D,2B1Eh		;
	LXI	H,361Eh		;
	CALL	Cls_XY		;
	LXI	B,F_F_ASCII	;
	LXI	D,2B1Eh		;
F_L_LOOP_NAME:
	LDAX	B		;
	CPI	CR		;
	CNZ	Put_XY_Char	;
	INX	B		;
	PUSH	PSW		;
	INR	D		;
	POP	PSW		;
	JNZ	F_L_LOOP_NAME	;
	CALL	GET_YES_SINHRO	;рТПРХУФЙН ОХМЕЧХА ЪБРЙУШ.
	CALL	GET_NOT_SINHRO	;Й ТБЪНЕТ ЖБКМБ.
;; рЕТЕИПДЙН Л ЪБЗТХЪЛЕ ЖБКМБ.
	LDA	F_FLAG		;
	DCR	A		;
	LXI	H,BTEXT+2	; ОБЮБМП ФЕЛУФПЧПЗП ВХЖЕТБ
	JNZ	F_LM_MERGE	;
	LHLD	ENDTEXT		; хЛБЪБФЕМШ ОБ ЛПОЕГ ЖБКМБ
F_LM_MERGE:			; 
	LXI	D,TEXT_LIMIT	; ЛПОЕГ ФЕЛУФПЧПЗП ВХЖЕТБ
LOAD_LOOP:
	CALL	GET_NOT_SINHRO	; РТПЮЙФБЕН ВБКФ
	MOV	M,A		; уЛЙОЕН Ч РБНСФШ
	INR	A		; РТПЧЕТЙН ОБ ЛПОЕГ ФЕЛУФБ
	JZ	LOAD_EXIT	; ХИПД ЕУМЙ дб
	INX	H		; ЙОБЮЕ РТДПМЦБЕН
	CALL	MEMORY_OVER	; РТПЧЕТЛБ ОБ ТЕЪЕТЧ РБНСФЙ
	JNZ	LOAD_LOOP	;
	JC	LOAD_LOOP	;
;;;;;;;;;;;;;;;;; рЕТЕРПМОЕОЙЕ РБНСФЙ ;;;;;;;;;;;;;;;;
	MVI	M,0FFh		;
	SHLD	ENDTEXT		;
	LXI	B,F_LOAD_OVER	;
	LXI	D,0400h		;
	JMP	F_L_QUIT	;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
LOAD_EXIT:			;
	PUSH	H		; хЛБЪБФЕМШ ЛПОГБ.
	CALL	GET_NOT_SINHRO	;
	MOV	E,A		;
	CALL	GET_NOT_SINHRO	;
	MOV	D,A		;
	LDA	F_FLAG		;
	DCR	A		;
	LXI	H,BTEXT+2	;
	JNZ	F_LM_2MERGE	;
	LHLD	ENDTEXT		;
F_LM_2MERGE:			;
	CALL	CONTR_ADD	;
	EI			;
	MOV	A,D		;
	CMP	B		;
	POP	H		; чпуфбопчйн лпоег.
	JNZ	F_LOAD_ERROR	;
	MOV	A,E		;
	CMP	C		;
	JNZ	F_LOAD_ERROR	;
	SHLD	ENDTEXT		;
	CALL	W_Close		;
	CALL	W_Close		;
F_2MAIN_EXIT:
	CALL	NULL_POS	;
	CALL	PRINT_POS	;
	JMP	F_MAIN_EXIT	;

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;; пЫЙВЛБ ЮФЕОЙС ЖБКМБ. хОЙЮФПЦЙН РТЕДЙДХЭЙК Й РПЧФПТЙН.
F_LOAD_ERROR:
	CALL	F_RESTART	;
	LXI	B,ERROR_LOAD	;
	LXI	D,0D00h		;
F_L_QUIT:
	CALL	W_Cls		;
	CALL	WPUTSDOP	;
	MVI	A,50		;
F_L_ERR_LOOP:
	HLT			;
	loop	A,F_L_ERR_LOOP	;
	CALL	W_Close		;
	JMP	F_3EXIT		;
;;;;;;;;;;;;;;;;;;; I N T E R R U P T ;;;;;;;;;;;;;;;;;;;;
REC_EXIT:
	EI			;
	LHLD	STACK_BUFER	;
	SPHL			;
	LXI	B,F_INTERRUPT	;
	LXI	D,0600h		;
	LDA	F_FLAG		;
	INR	A		;
	JZ	F_L_QUIT	;
	CALL	F_RESTART	;
	MVI	D,0Bh		;
	JMP	F_L_QUIT	;

;_______________________ ртпгеуущ _________________________
	Public	PUT_REC_BYTE	; ЧЩЧПД ВБКФБ ОБ НБЗОЙФПЖПО
	Public	GET_REC_BYTE	; ЧЧПД ВБКФБ У НБЗОЙФПЖПОБ
	Public	GET_NOT_SINHRO	; ЮФЕОЙЕ ВЕЪ УЙОИТП РПЙУЛБ
	Public	GET_YES_SINHRO	; ЮФЕОЙЕ У УЙОИТП РПЙУЛПН
	Public	WAIT_HEADER_ASM	; ПЦЙДБОЙС ЪБЗПМПЧЛБ ЖБКМБ
	Public	LOAD_NAME_ASM	; ЮФЕОЙЕ ЙНЕОЙ ЖБКМБ
	Public	MEMORY_OVER	; лПОФТПМШ РЕТЕРПМОЕОЙС.

;________________________ рбнсфш __________________________
	Public	PUT_CONST	; ЛПОУФБОФБ ЪБРЙУЙ
	Public	GET_CONST	; ЛПОУФБОФБ ЮФЕОЙС

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;	рТПГЕДХТБ ТЕУФБТФБ ПРГЙЙ ЮФЕОЙС ЖБКМПЧ.		;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
F_RESTART:
	LXI	H,0FF0Dh	;
	LDA	F_FLAG		;
	DCR	A		;
	JZ	F_RES_00	;
DEL_TEXT:
	LXI	H,0FF0Dh	;
	SHLD	BTEXT+2		;
	LXI	H,BTEXT+3	;
	SHLD	ENDTEXT		;
	RET			;
F_RES_00:
	LHLD	ENDTEXT		;
	MVI	M,0FFh		;	
	RET			;

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;   рТПГЕДХТБ РПДУЮЕФБ ЛПОФТПМШОПК УХННЩ РТПЮЙФБОПЗП	;;
;; ЖБКМБ.	теъхмшфбф: BC				;;
;;	чипд: HL - хлбъбфемш обюбмб рпдуюефб.		;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
CONTR_ADD:
	LXI	B,0000h		;
CONT_LOOP:			;
	MOV	A,M		;
	INR	A		;
	RZ			;
	DCR	A		;
	ADD	C		;
	MOV	C,A		;
	MVI	A,0		;
	ADC	B		;
	MOV	B,A		;
	INX	H		;
	JMP	CONT_LOOP	;

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;	рТПГЕДХТБ ПРТЕДЕМЕОЙС ЛПОГБ РБНСФЙ ьчн		;;
;; чипд:	HL - фЕЛХЭЙК БДТЕУ.			;;
;;		DE - рТЕДЕМШОЩК БДТЕУ.			;; 
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
MEMORY_OVER:		;
	MOV	A,H	;
	CMP	D	;
	RNZ		;
	MOV	A,L	;
	CMP	E	;
	RET		;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;   рТПГЕДХТБ ЮФЕОЙС ЙНЕОЙ ЖБКМБ Ч УРЕГЙБМШОЩК ВХЖЕТ	;;
;; BUF_NAME   ( ТБЪНЕТ ЙНЕОЙ ПЗТБОЙЮЕО 12 УЙНЧПМБНЙ )	;;
;;		 тезйуфтщ ое упитбосафус !!!		;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
LOAD_NAME_ASM:			;
	LXI	H,F_F_ASCII-1	; хЛБЪБФЕМШ ОБ ВХЖЕТ.
	MVI	B,13		; УЮЕФЮЙЛ УЙНЧПМПЧ.
LOAD_NAME_LOOP:			;
	INX	H		;
	CALL	GET_NOT_SINHRO	;
	DCR	B		;
	MVI	M,0Dh		; УФБЧЙН ЧТЕНЕОХА ЪБЗМХЫЛХ.
	RZ			; ЧЩИПДЙН ЕУМЙ ВХЖЕТ ЙНЕОЙ
	MOV	M,A		; РЕТЕРПМОЕО.
	ORA	A		; ЧЩИПДЙН ЕУМЙ ТЕБМШОПЕ ЙНС
	JNZ	LOAD_NAME_LOOP	; ЪБЛПОЮЙМПУШ.
	MVI	M,0Dh		;
	RET			;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;	рТПГЕДХТБ ПЦЙДБОЙС ЪБЗПМПЧЛБ ЖБКМБ "*.ASM"	;;
;;  рТПГЕДХТБ ПУХЭЕУФЧМСЕФ РПЙУЛ ОБ МЕОФЕ УФБОДБТФОПЗП	;;
;; ЪБЗПМПЧЛБ ФЕЛУФПЧПЗП ЖБКМБ Й ЧПЪЧТБЭБЕФ ХРТБЧМЕОЙЕ	;;
;; ДМС РТПЙЪЧЕДЕОЙС ЮФЕОЙС ЙНЕОЙ ЖБКМБ.			;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
WAIT_HEADER_ASM:		;
	PUSH	PSW		;
	PUSH	B		;
WAIT_H_LOOP_00:			;
	MVI	B,4		;
	MVI	A,YES_SINHRO	;
WAIT_H_LOOP_10:			;
	CALL	GET_REC_BYTE	;
	CPI	0E6h		;
	JNZ	WAIT_H_LOOP_00	;
	DCR	B		;
	MVI	A,NO_SINHRO	;
	JNZ	WAIT_H_LOOP_10	;
	POP	B		;
	POP	PSW		;
	RET			;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;    рТПГЕДХТБ ЮФЕОЙС ВБКФБ У НБЗОЙФПЖПОБ ВЕЪ уйоитп.	;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
GET_NOT_SINHRO:
	MVI	A,NO_SINHRO	;
	JMP	GET_REC_BYTE	;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;	рТПГЕДХТБ ЮФЕОЙС ВБКФБ У УЙОИТПОЙЪБГЙЕК		;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
GET_YES_SINHRO:
	MVI	A,YES_SINHRO	;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;	рТПГЕДХТБ ЮФЕОЙС ВБКФБ У НБЗОЙФПЖПОБ.		;;
;; чипд:	б = 0FFh - У РПЙУЛПН УЙОИТПВБКФБ	;;
;;		A = 008h - ВЕЪ РПЙУЛБ УЙОИТПВБКФБ	;;
;; чщипд:	б = РТПЮЙФБОЩК ВБКФ.			;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
GET_REC_BYTE:
	PUSH	B		; УПИТБОСЕН ТЕЗЙУФТЩ.
	PUSH	D		;
	MVI	C,0		; УЖПТНЙТХЕН ЪБЗПФПЧЛХ.
	MOV	D,A		; УПИТБОЙН РБТБНЕФТ.
GET_REC_LOOP:
	IN	01h		;
	ANI	10h		; ПЦЙДБЕН РЕТЕРБДБ ХТПЧОС
	MOV	E,A		; УЙЗОБМБ.
GET_REC_00:			; ( УЙОИТПОЙЪБГЙС РП ЖБЪЕ )
	IN	01h		;
	ANI	10h		;
	CMP	E		;
	JZ	GET_REC_00	; ГЙЛМ ЦЙДБОЙС.
	RLC			;
	RLC			;
	RLC			;
	RLC			;
	MOV	A,C		;
	RAL			;
	MOV	C,A		;
	LDA	GET_CONST	;РТПЮЙФБЕН ЛПОУФБОФХ ЮФЕОЙС
	CALL	WAIT_LOOP	;
	MOV	A,D		;
	ORA	A		;
	JP	GET_REC_NO_SINHRO;
	MOV	A,C		;
	CPI	0E6h		;
	JNZ	GET_REC_01	;
	XRA	A		;
	STA	GET_INVERSE	;
GET_REC_01:			;
	CPI	19h		;
	JNZ	GET_REC_LOOP	;
	MVI	A,0FFh		;
	STA	GET_INVERSE	;
	MVI	D,9		;
GET_REC_NO_SINHRO:		;
	DCR	D		;
	JNZ	GET_REC_LOOP	;
	LDA	GET_INVERSE	;
	XRA	C		;
	POP	D		;
	POP	B		;
	RET			;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;	рТПГЕДХТБ ЧЩЧПДБ ВБКФБ ОБ НБЗОЙФОХА МЕОФХ.	;;
;; чипд:	б = чЩЧПДЙНЩК ВБКФ.			;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
PUT_REC_BYTE:
	PUSH	D		; УПИТБОЙН ТЕЗЙУФТЩ
	PUSH	PSW		;
	MOV	D,A		;
	MVI	C,8		; УЮЕФЮЙЛ ВЙФПЧ.
PUT_REC_00:			;
	MOV	A,D		; УДЧЙОЕН
	RLC			; ФЕЛХЭЙК ВЙФ ВБКФБ
	MOV	D,A		;
	MVI	A,1		; УДЕМБЕН ЕЗП ЙОЧЕТУЙА
	XRA	D		;
	ANI	01h		; ЧЩДЕМЙН
	OUT	00h		; Й ЧЩДБДЙН Ч РПТФ
	CALL	PUT_REC_WAIT	; УДЕМБЕН ЪБДЕТЦЛХ.
	MVI	A,0		;
	XRA	D		; РТПДЕМБЕН ФПЦЕ УБНПЕ ОП ВЕ ЙОЧТУЙ
	ANI	01h		;
	OUT	00h		;
	CALL	PUT_REC_WAIT	;
	DCR	C		; ВЙФЩ ЛПОЮЙМЙУШ ???
	JNZ	PUT_REC_00	;
	POP	PSW		;
	POP	D		;
	RET			;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;	рТПГЕДХТБ ПТЗБОЙЪБГЙЙ ЪБДЕТЦЛЙ ДМС РТПГЕДХТЩ	;;
;; ЧЩЧПДБ ВБКФБ ОБ НБЗОЙФПЖПО.				;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
PUT_REC_WAIT:
	LDA	PUT_CONST	;
WAIT_LOOP:
	loop	A,WAIT_LOOP	;
	IN	01h		;
	ANI	40h		;
	JZ	REC_EXIT	;
	RET			;

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;    вМПЛ УЙУФЕНОЩИ СЮЕЕЛ ДМС ТБВПФЩ У НБЗОЙФПЖПОПН	;;
;;F_FLAG:		DB	00h ; жМБЗ ПРЕТБГЙЙ У НБЗОЙФПЖ.
		;; 00 - ЮФЕОЙЕ ЖБМБ.
		;; 01 - РПДЗТХЪЛБ ЖБКМБ.
		;; 0FFh - ъбрйуш жбкмб.

;;GET_INVERSE:	DB	00h ; хЛБЪБФЕМШ ЙОЧЕТУОПК "УЙОИТП".
;;STACK_BUFER:	DW	'20'; ВХЖЕТ УПИТБОЕОЙС УФЕЛБ.
;;TMP_BUFER:	DW	'07'; ЧТЕНЕОЩК ВХЖЕТ.
; пЫЙВЛБ
ERROR_LOAD:	DB	0EFh,0DBh,0C9h,0C2h,0CBh,0C1h,0Dh

; рЕТЕРПМОЕОЕЙЕ
SOOBF:
F_LOAD_OVER:	DB	0F0h,0C5h,0D2h,0C5h,0D0h
		DB	0CFh,0CCh,0CEh,0C5h,0CEh,0C9h
		DB	0C5h,CR
; юФЕОЙЕє ху ­ рТЕТЩЧБОЙЕ
F_L_MESSAGE:	DB	0FEh,0D4h,0C5h,0CEh,0C9h,0C5h,', '
		DB	0F5h,0F3h,' - '
F_INTERRUPT:	DB	0F0h,0D2h,0C5h,0D2h
		DB	0D9h,0D7h,0C1h,0CEh,0C9h,0C5h,CR

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;	рТПГЕДХТБ ПВТБВПФЛЙ ЛПНБОДЩ 1-Copy		;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
BLOCK:
	LDA	BL_D_FLAG	;
	ORA	A		;
	JNZ	BLO_DONE	;
;;;;;;;;;;;; пВТБВПФБЕН УМХЮБК РХУФПЗП ВХЖЕТБ ;;;;;;;;;;;;
	LXI	B,BLO_SOOB	;
	CALL	BL_OVERFLOM	;
	RET			;

BLO_SOOB:	DB 'Free',CR	;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;	   рТПЙЪЧЕДЕН ЧУФБЧЛХ ВМПЛБ ЙЪ ВХЖЕТБ		;;
BLO_DONE:
;; РТПЧЕТЛБ ОБ УППФЧЕФУФЧЙЕ ТБЪНЕТПЧ ВМПЛБ Й УЧПВПДОПК
;; РБНСФЙ ПФЧЕДЕООПК РПД ФЕЛУФ.
	LHLD	ENDTEXT		;
	XCHG			;
	CALL	NEG_DE		;
	LXI	H,TEXT_LIMIT	;
	DAD	D		; ТБЪНЕТ УЧПВПДОПК
	XCHG			; РБНСФЙ
	LHLD	BL_DUMP_ZISE	;
	CALL	NEG_DE		;
	DAD	D		;
	JNC	BLO_YES		; рБНСФЙ ИЧБФБЕФ !!!
;;;;;;;;;;;; пВТБВПФБЕН ЧЕФЧШ ОЕИЧБФЛЙ РБНСФЙ ;;;;;;;;;;;;
	LXI	B,SOOBF		;
	CALL	BL_OVERFLOM	;
	RET			;
BLO_YES:
;; уЖПТНЙТХЕН "ДЩТЛХ" Ч ФЕЛУФЕ ;;
	LHLD	POS		;
	XCHG			;
	LHLD	ENDTEXT		;
	CALL	NEG_DE		;
	DAD	D		;
	MOV	B,H		; BC - уЛПМШЛП.
	MOV	C,L		;
	INX	B		;
	LHLD	ENDTEXT		;
	XCHG			; DE - пФЛХДБ.
	LHLD	BL_DUMP_ZISE	;
	DAD	D		; HL - лХДБ.
	PUSH	H		;
	XCHG			; DE <-> HL
	CALL	D_REMOVE	;
	POP	H		;
	SHLD	ENDTEXT		; лПТЕЛГЙС ХЛБЪБФЕМС ЛПОГБ
;;  уЛПРЙТХЕН ВХЖЕТ Ч "ДЩТЛХ".	;;
	LHLD	POS		;
	XCHG			;
	LHLD	BL_DUMP_ZISE	;
	MOV	B,H		;
	MOV	C,L		;
	LXI	H,DUMP_GUT	;
	CALL	I_REMOVE	;
	LHLD	W_Cursor	;
	PUSH	H		;
	INR	L		;
	INR	L		;
	INR	L		;
	MVI	H,3Dh		;
	LXI	D,0203h		;
	CALL	Cls_XY		;
	POP	D		;
	MVI	D,0		;
	LHLD	POS		;
	MOV	B,H		;
	MOV	C,L		;
	CALL	PRSCREEN	;	
	CALL	CCLEFT		;
	JMP	BL_EXIT_M	;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;	рТПГЕДХТБ ПВТБВПФЛЙ  ОБЦБФЙС  ЛМБЧЙЫЙ "F1" Ф.Е	;;
;; ЧЩВПТ ЛПНБОДЩ ХУФБОПЧЛЙ ОБЮБМБ ВМПЛБ.		;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
BL_BEGIN:
	LHLD	POS		;
	INX	H		;
	MOV	A,M		;
	CPI	STOPBYTE	; хЛБЪБФЕМШ Ч ЛПОГЕ ЖБКМБ?
	JZ	BL_ERROR	;
	LDA	BL_B_FLAG	; рТПЮЙФБЕН ЖМБЗ ХУФБОПЧЛЙ
	ORA	A		;
	JZ	BL_B_DONE	;
;;  пВТБВПФБЕН УЙФХБГЙА РПЧФПТОПК ХУФБОПЧЛЙ НБТЛЕТБ ОБЮБМБ
;; ВМПЛБ Ф.Л ЧПЪНПЦОП ПЫЙВПЮОПЕ ОБЦБФЙЕ ОБ ЛМБЧЙЫХ.
	LXI	D,281Ch		;
	LXI	H,381Ch		;
	CALL	S_ARE_YOU	;
	RNZ			;
BL_B_DONE:			;
	DCR	A		;
	STA	BL_B_FLAG	; хУФБОПЧЙН НБТЛЕТ "ОБЮБМП"
	LHLD	POS		; Й УПИТБОЙН БДТЕУ.
	SHLD	BL_F1_POS	;
	LHLD	CURDY		; уПИТБОЙН ХЛБЪБФЕМШ
	SHLD	BL_CURDY	; ОБ НЕУФПОБИПЦДЕОЙЕ
	LDA	CURDY + 2	; РПНЕФЛЙ.
	STA	BL_CURDY + 2	;
	LHLD	CURHY		;
	SHLD	BL_CURHY	;
	LXI	D,151Bh		;
	LXI	B,BL_B_VIEW	;
	CALL	WPUTSDOP	;
	RET			; чПЪЧТБФ.
;;;;;;;;;;;;;;;;; дПРПМОЙФЕМШОЩЕ СЮЕКЛЙ ;;;;;;;;;;;;;;;;;;
;BL_B_FLAG:
;	DB	0h	; !0 -  нБТЛЕТ ХУФБОПЧМЕО.
;			; 0  - оЕ ХУФБОПЧМЕО.
;BL_D_FLAG:
;	DB	0h	; 0 -  вХЖЕТ РХУФПК.
;			; !0 - вХЖЕТ ЪБРПМОЕО.
;BL_F1_POS:
;	DW	0h	; бДТЕУ УФТПЛЙ ЛПФПТХА РПНЕФЕМЙ.
;BL_DUMP_ZISE:
;	DW	0h	; тБЪНЕТ ЧЩДЕМЕОПЗП ВМПЛБ
;BL_CURDY:
;	DB	0,0,0	; чТЕНЕОПЕ УПИТБОЕОЙЕ ЛППТДЙОБФ
;			; ОБЮБМБ ВМПЛБ
;BL_CURHY:
;	DW	0h	; ---//---//---//---
;;;;;;;; уМПЧП РПСЧМСЕФУС РТЙ ХУФБОПЧЛЙ НБТЛЕТБ ;;;;;;;;;;
BL_B_VIEW:
	DB	'View',CR
BL_B_ERROR:
	DB	'Error',CR
BL_B_EDIT:
	DB	'Mode:Edit',CR
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;	рТПГЕДХТБ ПВТБВПЛЙ ОБЦБФЙС ЛМБЧЙЫЙ "F3"		;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
BL_END:
	CALL	CCLEFT		;
	CALL	BL_ZISE		; пРТЕДЕМЙН ТБЪНЕТ ВМПЛБ.
;; еУМЙ ЖМБЗ C РПДОСФ ФП ТБЪОПУФШ РПМПЦЙФЕМШОБ.
	JC	BL_E_DONE	;
BL_ERROR:
	LXI	B,BL_B_ERROR	; чЩДЕН УППВЭЕОЙЕ П ОЕЧПЪ-
	CALL	WARNING		; НПЦОПУФЙ ХУФБОПЧЛЙ НБТЛЕТБ
	RET			;
;;	вМПЛ  ХУРЕЫОП  ЧЩДЕМЕО  ФЕРЕТШ  ПФЛТПЕН ПЛОП У
;; ОХЦОЩНЙ "ВМАДБНЙ".
;;
BL_E_DONE:
	LXI	D,2A1Ah		;
	LXI	H,391Ch		;
	CALL	US_OPEN		;
	LXI	D,0202h		;
	LXI	B,BL_SOOB1	;
	CALL	W_DOP_INX	;
	DCR	E		;
	CALL	W_DOP_INX	;
	DCR	E		;
	CALL	W_DOP_INX	;
BL_LOOP:			;
	CALL	MENU		;
	CPI	0Eh		; еУМЙ ОБЦБМЙ F4 ФП УЮЙФБЕН	
	CZ	W_Close		; ОБЦБФЙЕ  ЛМБЧЙЫЙ F3 ВЩМП
	RZ			; ПЫЙВПЮОЩН.
	ORA	A		;
	JZ	BL_MOVE		; "ретенеэеойе"
	DCR	A		;
	JZ	BL_COPY		; "лпрйтпчбойе"
;;;;;;;;;;; рТПЙЪЧЕДЕН ХДБМЕОЙЕ ЧЩДЕМЕОПЗП ВМПЛБ;;;;;;;;;;
	CALL	BL_ARE_YOU	;
	CALL	W_Close		;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;; рТПЙЪЧЕДЕН ЖЙЪЙЮЕУЛПЕ ХДБМЕОЙЕ
BL_DELETE:			;
	CALL	SINC		;
	JNZ	BL_DEL_00	; JMP еУМЙ ОЕ ЛПОЕГ ФЕЛУФБ.
;;;;; пВТБВПФЛБ "F3" ОБ ЛПОГЕ ФЕЛУФБ ;;;;
	LHLD	BL_F1_POS	;
BL_EXIT1:			;
	SHLD	ENDTEXT		;
	MVI	M,STOPBYTE	;
BL_EXIT2:			;
	LHLD	BL_CURHY	;
	SHLD	CURHY		;
	LHLD	BL_CURDY	;
	SHLD	CURDY		;
	LDA	BL_CURDY + 2	;
	STA	CURDY + 2	;
	LHLD	BL_F1_POS	;
	SHLD	POS		;
	CALL	W_Cls		;
	CALL	PRINT_POS	;
BL_EXIT_M:
	CALL	RESTORE_EDIT	;
	RET			;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;	 чЕФЧШ РПМОПГЕООПЗП ХДБМЕОЙС ЛХУЛБ ФЕЛУФБ.	;;
BL_DEL_00:
	LHLD	POS		;
	PUSH	H		;
	XCHG			;
	LHLD	ENDTEXT		;
	CALL	NEG_DE		;
	DAD	D		;
	MOV	B,H		; BC - уЛПМШЛП
	MOV	C,L		;
	LHLD	BL_F1_POS	;
	XCHG			; DE - лХДБ
	POP	H		; HL - пФЛХДБ
	CALL	I_REMOVE	;
	XCHG			;
	JMP	BL_EXIT1	;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;	рТПГЕДХТБ ПТЗБОЙЪБГЙЙ РЕТЕНЕЭЕОЙС Ч ВХЖЕТ	;;
BL_MOVE:
	CALL	BL_ARE_YOU	;
	CALL	BL_LOC_COPY	;
	CALL	W_Close		;
	JMP	BL_DELETE	;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;	рТПГЕДХТБ ПТЗБОЙЪБГЙЙ ЛПРЙТПЧБОЙС Ч ВХЖЕТ	;;
BL_COPY:			;
	CALL	BL_ARE_YOU	; ъБРТПУ РПДФЧЕТЦДЕОЙС
	CALL	BL_LOC_COPY	; лПРЙТПЧБОЙЕ
	CALL	W_Close		; ЪБТЩЧБЕН ПЛОП Й ЧЩИПДЙН
	CALL	RESTORE_EDIT	;
	RET			;
;;;;;;;;;;;;; рТПГЕДХТБ ЛПРЙТПЧБОЙС Ч ВХЖЕТ ;;;;;;;;;;;;;
BL_LOC_COPY:			;
	CALL	SINC		;
	PUSH	PSW		;
	JNZ	BL_LOC_C_DONE	;
	LHLD	BL_F1_POS	; лПОЕГ ФЕЛУФБ.
	XCHG			;
	LHLD	ENDTEXT		;
	DCX	H		;
	CALL	BL_ZISE_DOP	;
	XRA	A		;
BL_LOC_C_DONE:			;	
	CNZ	BL_ZISE		; пРТЕДЕМЙН ТБЪНЕТ ВМПЛБ.
	PUSH	H		;
	XCHG			;
	CALL	NEG_DE		;
	LXI	H,DUMP_ZISE	;
	DAD	D		;
	POP	B		; BC - тБЪНЕТ ВМПЛБ
	JC	BL_C_DONE	; РПНЕУФЙМЙ Ч ВХЖЕТ.
;;;;;;;;;;;;;; вМПЛ ОЕ РПНЕЭБЕФУС Ч ВХЖЕТ ;;;;;;;;;;;;;;;;
	LXI	B,SOOBF		;
	CALL	BL_OVERFLOM	;
	CALL	W_Close		;
BL_MAIN_EXIT:			;
	POP	PSW		;
	CNZ	SDEC		;
	RET			;
;;;;;;;;; рТПЙЪЧЕДЕН ЛПРЙТПЧБОЙЕ ВМПЛБ Ч ВХЖЕТ ;;;;;;;;;;;
BL_C_DONE:
	ORI	38h		;
	STA	BL_D_FLAG	; вХЖЕТ ЪБРПМОЕО.
	MOV	H,B		;
	MOV	L,C		;
	SHLD	BL_DUMP_ZISE	; уПИТБОЙН ТБЪЕТ ВМПЛБ
	LHLD	BL_F1_POS	; HL - пФЛХДБ
	LXI	D,DUMP_GUT	; DE - KХДБ
	CALL	I_REMOVE	;
	JMP	BL_MAIN_EXIT	;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;	рТПГЕДХТБ ЧЩЧПДБ УППВЭЕОЙС Out of memory	;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
BL_OVERFLOM:			;
	MVI	A,5		;
BL_O_LOOP:			;
	PUSH	B		;
	PUSH	PSW		;
	CALL	WARNING		;
	POP	PSW		;
	POP	B		;
	DCR	A		;
	JNZ	BL_O_LOOP	;
	RET			;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;	рТПГЕДХТБ РТПЙЪЧПДЙФ ЪБРТПУ "чЩ ХЧЕТЕОЩ ???"	;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
BL_ARE_YOU:			;
	LXI	D,2019h		;
	LXI	H,3019h		;
	CALL	S_ARE_YOU	;
	RZ			;
	POP	H		;
	JMP	BL_LOOP		;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;	рТПГЕДХТБ ДМС ПРТЕДЕМЕОЙС ТБЪНЕТБ ВМПЛБ		;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
BL_ZISE:
	LHLD	BL_F1_POS	; HL = рПЪЙГЙС ЛПОГБ.
	XCHG			;
	LHLD	POS		; DE = рПЪЙГЙС ОБЮБМБ.
BL_ZISE_DOP:
	CALL	NEG_DE		; РТПЙЪЧЕДЕН ЧЩЮЙФБОЙЕ
	DAD	D		;
	RET			;	
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;	рТПГЕДХТБ ЧУФБОПЧМЕОЙС ТЕЦЙНБ ТЕДБЛФЙТПЧБОЙС	;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
RESTORE_EDIT:
	LXI	D,101Bh		;
	LXI	B,BL_B_EDIT	;
	CALL	WPUTSDOP	;
	XRA	A		;
	STA	BL_B_FLAG	;
	CALL	RS_STR		;
	RET			;
;;;;;;;;;;; фЕЛУФПЧЩЕ УППВЭЕОЙС ;;;;;;;;;;;
;; "хДБМЙФШ ВМПЛ"
BL_SOOB1:
	DB	0F5h,0C4h,0C1h,0CCh,0C9h,0D4h
	DB	0D8h,020h,0C2h,0CCh,0CFh,0CBh
	DB	CR
;; "уЛПРЙТПЧБФШ"
	DB	0F3h,0CBh,0CFh,0D0h,0C9h,0D2h
	DB	0CFh,0D7h,0C1h,0D4h,0D8h,CR
;; "рЕТЕНЕУФЙФШ"
	DB	0F0h,0C5h,0D2h,0C5h,0CDh,0C5h
	DB	0D3h,0D4h,0C9h,0D4h,0D8h,CR

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;	рТПГЕДХТБ ЙЪНЕОЕОЙС ЛПОУФБОФ ЮФЕОЙС-ЪБРЙУЙ	;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
SV_CONST:
	LXI	D,1017h		;
	LXI	H,2318h		;
	MVI	A,17h		;
	CALL	US_OPEN + 2	;
	LXI	D,201h		;
	LXI	B,SV_C_SOOB0	;
	CALL	W_DOP_INX	;
	DCR	E		;
	CALL	W_DOP_INX	;
SV_C_LOOP:			;
	CALL	MENU		;
	MOV	B,A		;
	CPI	0Eh		; F4 - ??? ФП ЧЩИПД
	CZ	W_Close		;
	RZ			;
	ORI	038h		; йУЛХУФЕООЩК ОЕ "0"
	CALL	SV_VARIAL	;
	JMP	SV_C_LOOP	;

;; "лПОУФБОФБ ЮФЕОЙС"
SV_C_SOOB0:
	DB	0EBh,0CFh,0CEh,0D3h,0D4h,0C1h
	DB	0CEh,0D4h,0C1h,020h,0DEh,0D4h
	DB	0C5h,0CEh,0C9h,0D1h,CR

;; "лПОУФБОФБ ЪБРЙУЙ"
	DB	0EBh,0CFh,0CEh,0D3h,0D4h,0C1h
	DB	0CEh,0D4h,0C1h,020h,0DAh,0C1h
	DB	0D0h,0C9h,0D3h,0C9h,CR

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;	вМПЛ ПВТБВПФЛЙ ЛПНБОДЩ "ХДБМЕОЙЕ ФЕЛУФБ"	;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
NEW_TEXT:
	LXI	D,081Bh		;
	LXI	H,181Bh		;
	CALL	S_ARE_YOU	; ъБРТТПУ ОБ ХДБМЕОЙЕ.
	RNZ			; оЕ ХДБМСФШ Й ЧЩКФЙ.
	CALL	DOMOY		;
	CALL	NULL_POS	;
	CALL	INCY		;
	CALL	DECY		;
	CALL	DEL_TEXT	;
	CALL	W_Cls		;
	CALL	RS_STR		;
	RET			;

	Title	WD8.ASM
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;	 дТБКЧЕТ ПЛПООПЗП ЙОФЕТЖЕКУБ чЕТУЙС 2.00	;;
;;______________________________________________________;;
;; бЧФПТУЛПЕ РТБЧП:	 рЙНЕОПЧ рБЧЕМ бМЕЛУЕЕЧЙЮ	;;
;;________________ (C) 26.02.1994 PPA Soft Systems _____;;
;;	рЕТЕРЙУБО 26.02.1994 ОБ ПУОПЧЕ "УФБТПЗП" 16 - Й ;;
;; ВЙФОПЗП ДТБКЧЕТБ. пУОПЧОЩЕ  ПФМЙЮЙС  ЪБЛМАЮБАФУС  Ч	;;
;; ХДБМЕОЙЙ "ОЕ ОХЦОЩИ" РТПЧЕТПЛ ОБ ЛПТТЕЛФОПУФШ ЧИПД-  ;;
;; ОЩИ  ДБООЩИ  Ф.Л. НПДХМШ РТЕДОБЪОБЮЕО ДМС ОБРЙУБОЙС 	;;
;; РТПЗТБНН Ч ЛПФПТЩИ ОЕ ЙНЕФУС ( рплб !) ЧПЪНПЦОПУФШ	;;
;; ЧМЙСФШ ОБ  ЧИПДОЩЕ РБТБНЕФТЩ  РЕТЕДБЧБЕНЩЕ ДТБКЧЕТХ	;;
;; Й ЛБЛ УМЕДУФЧЙЕ ПФУХФУФЧЙЕ ОЕЛПТЕЛФОПУФЕК.		;;
;; лТПНЕ ФПЗП ЙЪНЕОЕО БМЗПТЙФН ПФЛТЩФЙС Й ЪБЛТЩФЙС ПЛПО ;;
;;	чУЕ ЬФЙ ДЕКУФЧЙС РТЙЧЕМЙ Л ХНЕОШЫЕОЙА ТБЪНЕТБ	;;
;; НПДХМС Б ФБЛЦЕ Л ОЕЛПФПТХНХ ХЧЕМЙЮЕОЙА УЛПТПУФЙ.	;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;


;;;;;;;;;;;;; жХОЛГЙЙ РПДДЕТЦЙЧБЕНЩЕ ДТБКЧЕТПН ;;;;;;;;;;;;
	Public W_Put_Char	;ЧЩЧПД УЙНЧПМБ ЛППТД. Ч 'DE'
	Public W_Get_Char	;ЮФЕОЙЕ УЙНЧПМБ -//-
	Public W_Open		;ПФЛТЩФЙЕ ПЛОБ (DE),(HL),Б-ЖМБЗ
	Public W_Close  	;ЪБЛТЩФЙЕ ПЛОБ
	Public W_Cls		;ПФЮЙУФЛБ ПЛОБ
	Public W_Up_Scroll	;УЛТПММЙОЗ ПЛОБ ЧЧЕТИ
	Public W_Down_Scroll	;ЧОЙЪ
	Public W_Right_Scroll	;ЧРТБЧП (ОБ 2 УЙНЧПМБ)
	Public W_Left_Scroll	;ЧМЕЧП  (ОБ 2 УЙНЧПМБ)
	Public	Put_XY_Char	;
	Public	Get_XY_Char	;
	Public	Cls_XY		;
	Public	Box_XY		;
	Public	Abs_DE		;
	Public	Inc_Copy	;
	Public	Dec_Copy	;
	Public	HL_DE_Window	;
	Public	HL_Sub_DE	;
	Public	Addr_Screen	;
;;;;;;;;;;;;;;; пРТЕДЕМЕОЙЕ ЗМПВБМШОЩИ СЮЕЕЛ ;;;;;;;;;;;;;
	Public	W_Cursor	;
	Public	W_1Window	;
	Public	W_2Window	;
	Public	W_Number	;
	Public	W_Buf_Seek	;

;;;;;;;;;;;;;;; вМПЛ ТБВПЮЙИ СЮЕЕЛ РТПЗТБННЩ ;;;;;;;;;;;;;;
W_Cursor:	DW	001Ah	;;
;;     сЮЕКЛБ ИБТБЛФЕТЕЪХЕФ РПМПЦЕОЙЕ МПЛБМШОПЗП ЛХТУПТБ Ч
;; ЛБЦДПН ПФЛТЩФПН ПЛОЕ Й РТЙ ПФЛТЩФЙЙ ОПЧЩИ ПЛПО ПОБ УПИ-
;; ТБОСЕФУС Ч ВХЖЕТЕ У РПУМЕДХАЭЙН ЧПУФБОПЧМЕОЙЕН РТЙ ЪБЛ-
;; ТЩФЙЙ ПЛОБ.
;W_1Window:	DW	0h	;; (DE) ЛППТДЙОБФЩ ПЛОБ

W_2Window:	DW	3F1Fh	;; (HL) ---//----//---
;;	дБООЩЕ СЮЕКЛЙ ИТБОСФ БВУПМАФОЩЕ ЛППТДЙОБФЩ РПМПЦЕ-
;; ФЕЛХЭЕЗП ПЛОБ, ЛПФПТЩЕ ФБЛЦЕ ДЙОБНЙЮЕУЛЙ ЧПУФБОБЧМЙЧБА-
;; ФУС РТЙ ПРЕТБГЙСИ ПФЛТЩФЙС Й ЪБЛТБФЙС ОПЧЩИ ПЛПО
;W_Number:	DB	00h
;;	уПДЕТЦЙФ ЛПМЙЮЕУФЧП ПФЛТЩФЩИ ОБ ДБООЩК НПНЕОФ ПЛПО.
W_Buf_Seek:	DW	Buf_Begin	;
;;	дЙОБНЙЮЕУЛБС СЮЕКЛБ ПФТБЦБАЭБС ЧЕМЙЮЕОХ ЪБРПМОЕОЙС
;; ВХЖЕТБ ПЛПО.
Two_Box:        DB	098h,099h,08Bh,08Ch,08Ah,09Dh
One_Box:	DB	090h,0AAh,08Fh,0A9h,083h,094h
;;     вМПЛЙ ДБООЩИ ОЕПВИПДЙНЩЕ РТЙ ЧЩВПТЕ ТБЪМЙЮОЩИ ФЙРПЧ
;; ТБНПЛ ПВТБНМСАЭЙИ ПЛОП.
;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;	рТПГЕДХТБ ПФЛТЩФЙС ОПЧПЗП БЛФЙЧОПЗП ПЛОБ.	;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
W_Open:
	PUSH	B	; УПИТБОЙН ЧУЕ ТЕЗЙУФТЩ
	PUSH	D	; РТПГЕУУПТБ
	PUSH	H	;
	PUSH	PSW	;
;	MOV	B,A	;
	DCR	D	; уЛПТТЕЛФЙТХЕН ТБЪНЕТЩ ПЛОБ.
	DCR	E	;
	INR	H	;
	INR	L	;
;; Ч ДБООПК ТЕБМЙЪБГЙЙ ЧУЕ ПЛОБ У ФЕОША. 1.03.1994
;	ANI	03h	;
;	MOV	A,B	;
;	JNZ	W_Yes_Ten;
;;;;;; пВТБВПФБЕН ЧБТЙБОФ ПФУХФУФЧЙС ФЕОЙ РПД ПЛОПН ;;;;;;
;	CALL	W_Backup;
;	CALL	Cls_XY	;
;	CALL	Box_XY	;
;	JMP	W_O_Terminat; ъБЛПОЮЙФШ ПРЕТБГЙА ПФЛТЩФЙС.
;;;;;;;;;;;; пВТБВПФБЕН ПФЛТЩФЙЕ ПЛОБ У ФЕОША ;;;;;;;;;;;;
W_Yes_Ten:		;
	DCR	E	;
	INR	H	;
	CALL	W_Backup;
	INR	E	;
	DCR	H	;
	CALL	Cls_XY	;
	CALL	Box_XY	;
	POP	PSW	;
	CALL	W_Ten	;
	PUSH	PSW	;
W_O_Terminat:		;
	POP	PSW	;
	INR	E	;
	INR	D	;
	DCR	H	;
	DCR	L	;
	SHLD	W_2Window;
	XCHG		;
	SHLD	W_1Window;
	LXI	H,0	;
	SHLD	W_Cursor;
	POP	H	;
	POP	D	;
	POP	B	;
	RET		;
;;;;;;;;;; чУРПНПЗБФЕМШОБС РТПГЕДХТБ ЧЩЧПДБ ФЕОЙ ;;;;;;;;;
W_Ten:	PUSH	H	;
	PUSH	D	;
	ANI	00000011b;
	ADD	A	;
	ADI	7	;
	MOV	B,A	;
	INR	H	;
	DCR	L	;
	DCR	E	;
W_Ten1:	MOV	A,B	;
	INR	D	;
	CALL	Put_XY_Char;
	MOV	A,D	;
	CMP	H	;
	JNZ	W_Ten1	;
	INR	B	;
W_Ten3:	MOV	A,B	;
	INR	E	;
	CALL	Put_XY_Char;
	MOV	A,E	;
	CMP	L	;
	JNZ	W_Ten3	;
	POP	D	;
	POP	H	;
	RET		;
;;;;;;; рТПГЕДХТБ УПИТБОЕОЙС ЙОЖПТНБГЙЙ РПД ПЛОПН ;;;;;;;
W_Backup:	
	PUSH	PSW	;
	PUSH	D	;
	PUSH	H	;
	PUSH	H	; хЧЕМЙЮЙЧБЕН ЮЙУМП ПФЛТЩФЩИ ПЛПО.
	LXI	H,W_Number;
	INR	M	;
	POP	H	;
	CALL	HL_Sub_DE;
	LHLD	W_Buf_Seek
	PUSH	B	;
	PUSH	D	;
;; гЙЛМ  "жЙТНЕООПЗП"  ЛПРЙТПЧБОЙС  ЬЛТБООПК  ПВМБУФЙ Ч
;; ВХЖЕТ ПЛПО ОЙЦЕ ПРЙУБОБ ЕЗП УФТХЛФХТБ:
;;	(?)	 	- дБООЩe ОБИПДСЭЙЕУС РПД ПЛОПН.
;;	(Beg_PTR)	- уФБТЩК ХЛБЪБФЕМШ.
;;	(W_Cursor)	- лППТДЙОБФЩ ЛХТУПТБ Ч ПЛОЕ.
;;	(W_2Window)	- лППТДЙОБФЩ ЧЕТИОЕЗП ХЗМБ ПЛОБ.
;;	(W_1Window)	- лППТДЙОБФБ ОЙЦОЕЗП ХЗМБ ПЛОБ.
;;	(Dx_Dy)		- тБЪНЕТЩ ПЛОБ.
;;	(Load_PTR)	- хЛБЪБФЕМШ ОБЮБМБ ЧПУФБОПЧМЕОЙС.

W_Backup_Loop:		; уПИТБОЙН ПДОХ РБМПУЛХ У МЕЧПЗП
	CALL	W_Open_Help2; ЛТБС.
	PUSH	D	;
	MOV	A,D	;
	ADD	B	;
	DCR	A	; уПИТБОЙН РПМПУЛХ У РТБЧПЗП ЛТБС
	MOV	D,A	;
	CALL	W_Open_Help2;
	POP	D	;
	INR	D	;
	DCR	B	;
	DCR	B	;
	MOV	A,B	; рТПДПМЦБЕН РПЛБ ОЕ ЪБЛПОЮЙФУС
	CPI	02h	; ПЛПЫЛП.
	JNC	W_Backup_Loop;
	DCR	B	;
	CZ	W_Open_Help2
	POP	D	;
	POP	B	;
;; DE - лППТДЙОБФЩ МЕЧПЗП ОЙЦОЕЗП ХЗМБ ПЛОБ.
;; BC - тБЪНЕТЩ ПЛОБ.
	PUSH	D	;
	XCHG		;
	LHLD	W_Buf_Seek
	CALL	W_Open_Help1
	LHLD	W_Cursor
	CALL	W_Open_Help1
	LHLD	W_2Window
	CALL	W_Open_Help1
	LHLD	W_1Window
	CALL	W_Open_Help1
	MOV	H,B	;
	MOV	L,C	;
	CALL	W_Open_Help1
	POP	H	; оБЮБМШОЩЕ ЛППТДЙОБФЩ.
	CALL	W_Open_Help1
	XCHG		;
	SHLD	W_Buf_Seek
	POP	H	;
	POP	D	;
	POP	PSW	;
	RET		;
;;;;;;;; рТПГЕДХТЛБ ЗЕОЕТБГЙЙ ЙОЖПТНБГЙПООПЗП ВМПЛБ ;;;;;;;
W_Open_Help1:		;
	MOV	A,L	;
	STAX	D	;
	INX	D	;
	MOV	A,H	;
	STAX	D	;
	INX	D	;
	RET		;
;;;;;;;;;;;; рТПГЕДХТЛБ "УЛБОЙТПЧБОЙС" ЬЛТБОБ ;;;;;;;;;;;;
;; DE - лППТДЙОБФЩ ОБЮБМШОПЗП УЙНЧПМБ.
;; BC - ТБЪНЕТЩ УПИТБОСЕНПЗП ПЛОБ
W_Open_Help2:		;
	PUSH	B	;
	PUSH	D	;
W_O_Help2_1:		;
	CALL	Get_XY_Char
	MOV	M,A	;
	INX	H	;
	INR	E	;
	DCR	C	;
	JNZ	W_O_Help2_1
	POP	D	;
	POP	B	;
	RET		;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;		рТПГЕДХТБ ЪБЛТЩФЙС ПЛОБ			;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
W_Close:
	PUSH	B	;
	PUSH	D	;
	PUSH	H	;
	PUSH	PSW	;
	LXI	H,W_Number
	MOV	A,M	;
	ORA	A	;
	JZ	W_Main_Exit
	DCR	M	;
	LHLD	W_Buf_Seek;
	DCX	H	;
	MOV	D,M	; оБЮБМП ЧПУФБОПЧМЕОЙС.
	DCX	H	;
	MOV	E,M	;
	DCX	H	;
	MOV	B,M	; тБЪНЕТ ЧПУФБОПЧМЕОЙС.
	DCX	H	;
	MOV	C,M	;
;; DE - лХДБ ЧПУФБОБЧМЙЧБФШ?
;; BC - тБЪНЕТ ЧПУФБОБЧМЙЧБЕНПЗП ВМПЛБ.
	DCX	H	;
	PUSH	D	;
	XCHG		;
	CALL	W_Close_Help1	;
	SHLD	W_1Window	;
	CALL	W_Close_Help1	;
	SHLD	W_2Window	;
	CALL	W_Close_Help1	;
	SHLD	W_Cursor	;
	CALL	W_Close_Help1	;
	SHLD	W_Buf_Seek	;
	POP	D	;
W_Close_Loop1:		;
	CALL	W_Close_Help2
	PUSH	D	;
	MOV	A,D	;
	ADD	B	;
	DCR	A	;
	MOV	D,A	;
	CALL	W_Close_Help2
	POP	D	;
	INR	D	;
	DCR	B	;
	DCR	B	;
	MOV	A,B	;
	CPI	02h	;
	JNC	W_Close_Loop1
	DCR	B	;
	CZ	W_Close_Help2
	JMP	W_Main_Exit

;;;;;;;;;;; рТПГЕДХТЛБ ЧПУФБОПЧМЕОЙС "УФПМВЙЛБ";;;;;;;;;;;
;; HL - хЛБЪБФЕМШ ОБ ВХЖЕТ УФПМВЙЛБ.
;; DE - хЛБЪБФЕМШ ЛППТДЙОБФ ЬЛТБОБ.
W_Close_Help2:		;
	PUSH	B	;
	PUSH	D	;
W_C_Help1:		;
	MOV	A,M	;
	CALL	Put_XY_Char
	INX	H	;
	INR	E	;
	DCR	C	;
	JNZ	W_C_Help1;
	POP	D	;
	POP	B	;
	RET		;
;;;;;; рТПГЕДХТЛБ ЧЩВПТЛЙ ДБООЩИ ЙЪ ВМПЛБ РБТБНЕФТПЧ ;;;;;
W_Close_Help1:
	LDAX	D	;
	MOV	H,A	;
	DCX	D	;
	LDAX	D	;
	MOV	L,A	;
	DCX	D	;
	RET		;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;	рТПГЕДХТБ ЧЩЧПДБ ТБНЛЙ ЪБДБОПК ЛПОЖЙЗХТБГЙЙ	;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
Box_XY:			;
	PUSH	B	;
	PUSH	D	;
	PUSH	H	;
	PUSH	PSW	;
	ANI	4	;
	LXI	B,Two_Box;
	JZ	Box_1	;
	LXI	B,One_Box;	
Box_1:			;
	LDAX	B	;
	CALL	Put_XY_Char;	
	PUSH	D	;
	MOV	E,L	;
	INX	B	;
	LDAX	B	;
	CALL	Put_XY_Char;	
	XCHG		;
	INX	B	;
	LDAX	B	;
	CALL	Put_XY_Char;	
	XTHL		;
	MOV	E,L	;
	INX	B	;
	LDAX	B	;
	CALL	Put_XY_Char;	
	XTHL		;
	DCR	L	;
	PUSH	D	;
	INX	B	;
Box_2:			;
	LDAX	B	;
	INR	E	;
	CALL	Put_XY_Char;	
	MOV	A,E	;
	CMP	L	;
	JNZ	Box_2	;
	POP	D	;
	XCHG		;
	PUSH	D	;
	INR	L	;
Box_3:			;
	LDAX	B	;
	CALL	Put_XY_Char;	
	DCR	E	;
	MOV	A,E	;
	CMP	L	;
	JNC	Box_3	;
	POP	D	;
	POP	PSW	;
	INX	B	;
	INR	E	;
	DCR	L	;
Box_Loop:		;
	INR	D	;
	DCR	H	;
	LDAX	B	;
	CALL	Put_XY_Char;	
	PUSH	D	;
	MOV	E,L	;
	CALL	Put_XY_Char;	
	POP	D	;
	XCHG		;
	CALL	Put_XY_Char;	
	PUSH	D	;
	MOV	E,L	;
	CALL	Put_XY_Char;	
	POP	D	;
	XCHG		;
	MOV	A,D	;
	CMP	H	;
	JC	Box_Loop;
	JMP	W_Main_Exit

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;     рТПГЕДХТЛБ ПВТБВПФЛЙ НБФЕНБФЙЛЙ ДМС УЛТПММЕТБ	;;
Scroll_Match:
	MOV	A,H	;
	SUB	D	;
	ORA	A	;
	RAR		;
	MOV	C,A	;зПТЙЪПОФБМШОЩК тБЪНЕТ ПЛОБ Ч ВБКФБИ
	INR	C	;
	MOV	A,L	;
	SUB	E	;
	RLC		;
	RLC		;
	RLC		;
	MOV	B,A	; чЕТФЙЛБМШОЩК ТБЪНЕТ.
	RET		;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;  рТПГЕДХТБ DEC-ЛПРЙТПЧБОЙС 2-И ЬЛТБООЩИ РМПУЛПУФЕК	;;
Scroll_DEC_Copy:	;
	PUSH	B	;
	PUSH	D	;
	PUSH	H	;
S_DEC_Loop1:		;
	CALL	Dec_Copy;	
	DCR	H	;
	DCR	D	;
	DCR	C	;
	JNZ	S_DEC_Loop1
	POP	H	;
	POP	D	;
	POP	B	;
	MOV	A,H	;
	ADI	20h	;
	MOV	H,A	;
	MOV	A,D	;
	ADI	20h	;
	MOV	D,A	;
S_DEC_Loop2:		;
	CALL	Dec_Copy;	
	DCR	H	;
	DCR	D	;
	DCR	C	;
	JNZ	S_DEC_Loop2
	RET		;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;    рТПГЕДХТБ INC - ЛПРЙТПЧБОЙС ЬЛТБООЩИ РМПУЛПУФЕК	;;
Scroll_INC_Copy:	;
	PUSH	B	;
	PUSH	D	;
	PUSH	H	;
S_INC_Loop1:		;
	CALL	Inc_Copy;	
	INR	H	;
	INR	D	;
	DCR	C	;
	JNZ	S_INC_Loop1
	POP	H	;
	POP	D	;
	POP	B	;
	MOV	A,H	;
	ADI	20h	;
	MOV	H,A	;
	MOV	A,D	;
	ADI	20h	;
	MOV	D,A	;
S_INC_Loop2:		;
	CALL	Inc_Copy;	
	INR	H	;
	INR	D	;
	DCR	C	;
	JNZ	S_INC_Loop2
	RET		;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;	рТПГЕДХТБ ПФЮЙУФЛЙ ЪБДБОПК ПВМБУФЙ ЬЛТБОБ	;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
Cls_XY:			;
	PUSH	B	;
	PUSH	D	;
	PUSH	H	;
	PUSH	PSW	;
	JMP	W_Cls_DH;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;	   рТПГЕДХТБ ПФЮЙУФЛЙ БЛФЙЧОПЗП "ПЛОБ"		;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
W_Cls:			;
	PUSH	B	;
	PUSH	D	;
	PUSH	H	;
	PUSH	PSW	;
	CALL	HL_DE_Window	
W_Cls_DH:		;
	CALL	HL_Sub_DE	
	PUSH	B	;
	PUSH	D	;
	PUSH	H	;
	CALL	Addr_PPA_Emulator
W_Cls_7:		;
	PUSH	H	;
	PUSH	B	;
W_Cls_6:		;
	MVI	M,' '	;
	INX	H	;
	DCR	B	;
	JNZ	W_Cls_6	;
	POP	B	;
	POP	H	;
	LXI	D,40h	;
	DAD	D	;
	DCR	C	;
	JNZ	W_Cls_7	;
	POP	H	;
	POP	D	;
	POP	B	;
	MOV	A,C	;
	RLC		;
	RLC		;
	RLC		;
;;;;	DCR	A	;
	MOV	B,A	;
	MOV	A,D	;
	RRC		;
	JNC	W_Cls_1	;
	CALL	W_Cls_Stok
	INR	D	;
W_Cls_1:		;
	MOV	A,H	;
	RRC		;
	JC	W_Cls_2	;
	XCHG		;
	PUSH	D	;
	MOV	E,L	;
	CALL	W_Cls_Stok	
	POP	D	;
	XCHG		;
	DCR	H	;
W_Cls_2:		;
	MOV	A,H	;
	SUB	D	; рТЙ ЛПТТЕЛФОЩИ ДБООЩИ Carry = 0
	RAR		;
	INR	A	;
	MOV	C,A	;
	CALL	Addr_Screen	
	XRA	A	;
	PUSH	B	;
	MOV	D,B	;
	MOV	E,L	;
W_Cls_3:		;
	MOV	M,A	;
	INR	L	;
	DCR	B	;
	JNZ	W_Cls_3	;
	MOV	B,D	;
	MOV	L,E	;
	INR	H	;
	DCR	C	;
	JNZ	W_Cls_3	;
	DCR	H	;
	POP	B	;
	MOV	A,H	;
	ADI	20h	;
	MOV	H,A	;
	XRA	A	;
W_Cls_5:		;
	MOV	M,A	;
	INR	L	;
	DCR	B	;
	JNZ	W_Cls_5	;
	MOV	B,D	;
	MOV	L,E	;
	DCR	H	;
	DCR	C	;
	JNZ	W_Cls_5	;
	JMP	W_Main_Exit
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;	рТПГЕДХТБ ЮЙУФСЭБС "УФПМВЙЛ" ЬЛТБООПК ПВМБУФЙ	;;
W_Cls_Stok:		;
	PUSH	D	;
	PUSH	B	;
	MVI	A,' '	;
W_Cls_Loop1:		;
	CALL	Put_XY_Char	
	INR	E	;
	DCR	C	;
	JNZ	W_Cls_Loop1
	POP	B	;
	POP	D	;
	RET		;
;;;;;  вМПЛ РТПГЕДХТ РПДДЕТЦЛЙ РТПЗТБНОПЗП УЛТПММЕТБ ;;;;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;	рТПГЕДХТБ УЛТПМЙОЗБ ЧРТБЧП (ОБ 2 ЪОБЛБ)		;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
W_Right_Scroll:		;
	PUSH	B	;
	PUSH	D	;
	PUSH	H	;
	PUSH	PSW	;
	CALL	HL_DE_Window	
	CALL	HL_Sub_DE	
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;     вМПЛ  УЛТПМЙОЗБ ЧРТБЧП Ч ПВМБУФЙ ЬНХМСГЙЙ	;;
	PUSH	B	;
	PUSH	D	;
	PUSH	H	;
	XCHG		;
	DCR	B	;
	DCR	B	;
	CALL	Addr_PPA_Emulator	
W_Right_PPA_Loop:	;
	MOV	D,H	;
	MOV	E,L	;
	DCX	D	;
	DCX	D	;
	XCHG		;
	CALL	Dec_Copy;	
	XCHG		;
	LXI	D,-40h	;
	DAD	D	;
	DCR	C	;
	JNZ	W_Right_PPA_Loop
	POP	H	;
	POP	D	;
	POP	B	;
	MOV	A,C	;
	MOV	C,B	;
	RLC		;
	RLC		;
	RLC		;
	MOV	B,A	;
	MOV	A,C	;
	RAR		;
	MOV	C,A	;
	DCR	C	;
	XCHG		;
	INR	E	;
	CALL	Addr_Screen	
	DCX	H	;
	MOV	D,H	;
	MOV	E,L	;
	DCR	H	;
	CALL	Scroll_DEC_Copy	
	CALL	HL_DE_Window
	MOV	H,D	;
	INR	H	;
	CALL	Cls_XY	;
	JMP	W_Main_Exit
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;	рТПГЕДХТБ УЛТПМЙОЗБ ЧМЕЧП ( ОБ 2 УЙНЧПМБ )	;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
W_Left_Scroll:		;
	PUSH	B	;
	PUSH	D	;
	PUSH	H	;
	PUSH	PSW	;
	CALL	HL_DE_Window	
	CALL	HL_Sub_DE
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;    вМПЛ  "УЛТПМЙОЗБ ЧМЕЧП" Ч ПВМБУФЙ ЬНХМСГЙЙ	;;
	PUSH	B	;
	PUSH	D	;
	PUSH	H	;
	DCR	B	;
	DCR	B	;
	CALL	Addr_PPA_Emulator	
W_Left_PPA_Loop:	;
	MOV	D,H	;
	MOV	E,L	;
	INX	H	;
	INX	H	;
	CALL	Inc_Copy;	
	LXI	H,40h	;
	DAD	D	;
	DCR	C	;
	JNZ	W_Left_PPA_Loop	
W_LR_PPA_Exit:		;
	POP	H	;
	POP	D	;
	POP	B	;
	MOV	A,C	;
	MOV	C,B	;
	RLC		;
	RLC		;
	RLC		;
	MOV	B,A	;
	ORA	A	;
	MOV	A,C	;
	RAR		;
	DCR	A	;
	MOV	C,A	;
	CALL	Addr_Screen	
	MOV	D,H	;
	MOV	E,L	;
	INR	H	;
	CALL	Scroll_INC_Copy	
	CALL	HL_DE_Window
	MOV	D,H	;
	DCR	D	;
	CALL	Cls_XY	;
	JMP	W_Main_Exit
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;	     рТПГЕДХТБ УЛТПМЙОЗБ ПЛОБ ЧОЙЪ		;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
Down_Scroll:
	PUSH	B	;
	PUSH	D	;
	PUSH	H	;
	PUSH	PSW	;
	JMP	Down_Local
W_Down_Scroll:		;
	PUSH	B	;
	PUSH	D	;
	PUSH	H	;
	PUSH	PSW	;
	CALL	HL_DE_Window	
Down_Local:		;
	DI		;
	PUSH	H	;
	PUSH	D	;
	CALL	HL_Sub_DE	
	CALL	Addr_PPA_Emulator
W_Down_Loop:		;
	LXI	D,40h	;
	XCHG		;
	DAD	D	;
	CALL	Inc_Copy;	
	DCR	C	;
	JNZ	W_Down_Loop
	POP	D	;
	POP	H	;
	PUSH	H	;
	PUSH	D	;
	CALL	Scroll_Match	
	CALL	Addr_Screen
	MOV	D,H	;
	MOV	A,L	;
	ADI	8	;
	MOV	E,A	;
	XCHG		;
	CALL	Scroll_INC_Copy	
	POP	D	;
	POP	H	;
	MOV	E,L	;
	CALL	Cls_XY	;
	EI
	JMP	W_Main_Exit
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;